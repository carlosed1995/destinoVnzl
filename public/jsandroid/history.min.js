!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.PIXI=t()}}(function(){var t;return function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return n(r?r:e)},u,u.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){(function(r){t("./polyfill");var i=e.exports=t("./core");i.extras=t("./extras"),i.filters=t("./filters"),i.interaction=t("./interaction"),i.loaders=t("./loaders"),i.mesh=t("./mesh"),i.loader=new i.loaders.Loader,Object.assign(i,t("./deprecation")),r.PIXI=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./core":29,"./deprecation":78,"./extras":85,"./filters":102,"./interaction":117,"./loaders":120,"./mesh":126,"./polyfill":130}],2:[function(e,r,i){(function(e){!function(){function i(t){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,t.apply(n,arguments)}}var n,o,s={};n=this,null!=n&&(o=n.async),s.noConflict=function(){return n.async=o,s};var a=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===a.call(t)},l=function(t,e){if(t.forEach)return t.forEach(e);for(var r=0;r<t.length;r+=1)e(t[r],r,t)},u=function(t,e){if(t.map)return t.map(e);var r=[];return l(t,function(t,i,n){r.push(e(t,i,n))}),r},c=function(t,e,r){return t.reduce?t.reduce(e,r):(l(t,function(t,i,n){r=e(r,t,i,n)}),r)},p=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e};"undefined"!=typeof e&&e.nextTick?(s.nextTick=e.nextTick,s.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:s.nextTick):"function"==typeof setImmediate?(s.nextTick=function(t){setImmediate(t)},s.setImmediate=s.nextTick):(s.nextTick=function(t){setTimeout(t,0)},s.setImmediate=s.nextTick),s.each=function(t,e,r){function n(e){e?(r(e),r=function(){}):(o+=1,o>=t.length&&r())}if(r=r||function(){},!t.length)return r();var o=0;l(t,function(t){e(t,i(n))})},s.forEach=s.each,s.eachSeries=function(t,e,r){if(r=r||function(){},!t.length)return r();var i=0,n=function(){e(t[i],function(e){e?(r(e),r=function(){}):(i+=1,i>=t.length?r():n())})};n()},s.forEachSeries=s.eachSeries,s.eachLimit=function(t,e,r,i){var n=d(e);n.apply(null,[t,r,i])},s.forEachLimit=s.eachLimit;var d=function(t){return function(e,r,i){if(i=i||function(){},!e.length||0>=t)return i();var n=0,o=0,s=0;!function a(){if(n>=e.length)return i();for(;t>s&&o<e.length;)o+=1,s+=1,r(e[o-1],function(t){t?(i(t),i=function(){}):(n+=1,s-=1,n>=e.length?i():a())})}()}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[s.each].concat(e))}},v=function(t,e){return function(){var r=Array.prototype.slice.call(arguments);return e.apply(null,[d(t)].concat(r))}},g=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[s.eachSeries].concat(e))}},m=function(t,e,r,i){if(e=u(e,function(t,e){return{index:e,value:t}}),i){var n=[];t(e,function(t,e){r(t.value,function(r,i){n[t.index]=i,e(r)})},function(t){i(t,n)})}else t(e,function(t,e){r(t.value,function(t){e(t)})})};s.map=f(m),s.mapSeries=g(m),s.mapLimit=function(t,e,r,i){return y(e)(t,r,i)};var y=function(t){return v(t,m)};s.reduce=function(t,e,r,i){s.eachSeries(t,function(t,i){r(e,t,function(t,r){e=r,i(t)})},function(t){i(t,e)})},s.inject=s.reduce,s.foldl=s.reduce,s.reduceRight=function(t,e,r,i){var n=u(t,function(t){return t}).reverse();s.reduce(n,e,r,i)},s.foldr=s.reduceRight;var x=function(t,e,r,i){var n=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){r(t.value,function(r){r&&n.push(t),e()})},function(t){i(u(n.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};s.filter=f(x),s.filterSeries=g(x),s.select=s.filter,s.selectSeries=s.filterSeries;var b=function(t,e,r,i){var n=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){r(t.value,function(r){r||n.push(t),e()})},function(t){i(u(n.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};s.reject=f(b),s.rejectSeries=g(b);var _=function(t,e,r,i){t(e,function(t,e){r(t,function(r){r?(i(t),i=function(){}):e()})},function(t){i()})};s.detect=f(_),s.detectSeries=g(_),s.some=function(t,e,r){s.each(t,function(t,i){e(t,function(t){t&&(r(!0),r=function(){}),i()})},function(t){r(!1)})},s.any=s.some,s.every=function(t,e,r){s.each(t,function(t,i){e(t,function(t){t||(r(!1),r=function(){}),i()})},function(t){r(!0)})},s.all=s.every,s.sortBy=function(t,e,r){s.map(t,function(t,r){e(t,function(e,i){e?r(e):r(null,{value:t,criteria:i})})},function(t,e){if(t)return r(t);var i=function(t,e){var r=t.criteria,i=e.criteria;return i>r?-1:r>i?1:0};r(null,u(e.sort(i),function(t){return t.value}))})},s.auto=function(t,e){e=e||function(){};var r=p(t),i=r.length;if(!i)return e();var n={},o=[],a=function(t){o.unshift(t)},u=function(t){for(var e=0;e<o.length;e+=1)if(o[e]===t)return void o.splice(e,1)},d=function(){i--,l(o.slice(0),function(t){t()})};a(function(){if(!i){var t=e;e=function(){},t(null,n)}}),l(r,function(r){var i=h(t[r])?t[r]:[t[r]],o=function(t){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),t){var o={};l(p(n),function(t){o[t]=n[t]}),o[r]=i,e(t,o),e=function(){}}else n[r]=i,s.setImmediate(d)},f=i.slice(0,Math.abs(i.length-1))||[],v=function(){return c(f,function(t,e){return t&&n.hasOwnProperty(e)},!0)&&!n.hasOwnProperty(r)};if(v())i[i.length-1](o,n);else{var g=function(){v()&&(u(g),i[i.length-1](o,n))};a(g)}})},s.retry=function(t,e,r){var i=5,n=[];"function"==typeof t&&(r=e,e=t,t=i),t=parseInt(t,10)||i;var o=function(i,o){for(var a=function(t,e){return function(r){t(function(t,i){r(!t||e,{err:t,result:i})},o)}};t;)n.push(a(e,!(t-=1)));s.series(n,function(t,e){e=e[e.length-1],(i||r)(e.err,e.result)})};return r?o():o},s.waterfall=function(t,e){if(e=e||function(){},!h(t)){var r=new Error("First argument to waterfall must be an array of functions");return e(r)}if(!t.length)return e();var i=function(t){return function(r){if(r)e.apply(null,arguments),e=function(){};else{var n=Array.prototype.slice.call(arguments,1),o=t.next();n.push(o?i(o):e),s.setImmediate(function(){t.apply(null,n)})}}};i(s.iterator(t))()};var T=function(t,e,r){if(r=r||function(){},h(e))t.map(e,function(t,e){t&&t(function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),e.call(null,t,r)})},r);else{var i={};t.each(p(e),function(t,r){e[t](function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),i[t]=n,r(e)})},function(t){r(t,i)})}};s.parallel=function(t,e){T({map:s.map,each:s.each},t,e)},s.parallelLimit=function(t,e,r){T({map:y(e),each:d(e)},t,r)},s.series=function(t,e){if(e=e||function(){},h(t))s.mapSeries(t,function(t,e){t&&t(function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),e.call(null,t,r)})},e);else{var r={};s.eachSeries(p(t),function(e,i){t[e](function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),r[e]=n,i(t)})},function(t){e(t,r)})}},s.iterator=function(t){var e=function(r){var i=function(){return t.length&&t[r].apply(null,arguments),i.next()};return i.next=function(){return r<t.length-1?e(r+1):null},i};return e(0)},s.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var E=function(t,e,r,i){var n=[];t(e,function(t,e){r(t,function(t,r){n=n.concat(r||[]),e(t)})},function(t){i(t,n)})};s.concat=f(E),s.concatSeries=g(E),s.whilst=function(t,e,r){t()?e(function(i){return i?r(i):void s.whilst(t,e,r)}):r()},s.doWhilst=function(t,e,r){t(function(i){if(i)return r(i);var n=Array.prototype.slice.call(arguments,1);e.apply(null,n)?s.doWhilst(t,e,r):r()})},s.until=function(t,e,r){t()?r():e(function(i){return i?r(i):void s.until(t,e,r)})},s.doUntil=function(t,e,r){t(function(i){if(i)return r(i);var n=Array.prototype.slice.call(arguments,1);e.apply(null,n)?r():s.doUntil(t,e,r)})},s.queue=function(t,e){function r(t,e,r,i){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?s.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var n={data:e,callback:"function"==typeof i?i:null};r?t.tasks.unshift(n):t.tasks.push(n),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}void 0===e&&(e=1);var n=0,o={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,e){r(o,t,!1,e)},kill:function(){o.drain=null,o.tasks=[]},unshift:function(t,e){r(o,t,!0,e)},process:function(){if(!o.paused&&n<o.concurrency&&o.tasks.length){var e=o.tasks.shift();o.empty&&0===o.tasks.length&&o.empty(),n+=1;var r=function(){n-=1,e.callback&&e.callback.apply(e,arguments),o.drain&&o.tasks.length+n===0&&o.drain(),o.process()},s=i(r);t(e.data,s)}},length:function(){return o.tasks.length},running:function(){return n},idle:function(){return o.tasks.length+n===0},pause:function(){o.paused!==!0&&(o.paused=!0,o.process())},resume:function(){o.paused!==!1&&(o.paused=!1,o.process())}};return o},s.priorityQueue=function(t,e){function r(t,e){return t.priority-e.priority}function i(t,e,r){for(var i=-1,n=t.length-1;n>i;){var o=i+(n-i+1>>>1);r(e,t[o])>=0?i=o:n=o-1}return i}function n(t,e,n,o){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?s.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var a={data:e,priority:n,callback:"function"==typeof o?o:null};t.tasks.splice(i(t.tasks,a,r)+1,0,a),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}var o=s.queue(t,e);return o.push=function(t,e,r){n(o,t,e,r)},delete o.unshift,o},s.cargo=function(t,e){var r=!1,i=[],n={tasks:i,payload:e,saturated:null,empty:null,drain:null,drained:!0,push:function(t,r){h(t)||(t=[t]),l(t,function(t){i.push({data:t,callback:"function"==typeof r?r:null}),n.drained=!1,n.saturated&&i.length===e&&n.saturated()}),s.setImmediate(n.process)},process:function o(){if(!r){if(0===i.length)return n.drain&&!n.drained&&n.drain(),void(n.drained=!0);var s="number"==typeof e?i.splice(0,e):i.splice(0,i.length),a=u(s,function(t){return t.data});n.empty&&n.empty(),r=!0,t(a,function(){r=!1;var t=arguments;l(s,function(e){e.callback&&e.callback.apply(null,t)}),o()})}},length:function(){return i.length},running:function(){return r}};return n};var S=function(t){return function(e){var r=Array.prototype.slice.call(arguments,1);e.apply(null,r.concat([function(e){var r=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&l(r,function(e){console[t](e)}))}]))}};s.log=S("log"),s.dir=S("dir"),s.memoize=function(t,e){var r={},i={};e=e||function(t){return t};var n=function(){var n=Array.prototype.slice.call(arguments),o=n.pop(),a=e.apply(null,n);a in r?s.nextTick(function(){o.apply(null,r[a])}):a in i?i[a].push(o):(i[a]=[o],t.apply(null,n.concat([function(){r[a]=arguments;var t=i[a];delete i[a];for(var e=0,n=t.length;n>e;e++)t[e].apply(null,arguments)}])))};return n.memo=r,n.unmemoized=t,n},s.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},s.times=function(t,e,r){for(var i=[],n=0;t>n;n++)i.push(n);return s.map(i,e,r)},s.timesSeries=function(t,e,r){for(var i=[],n=0;t>n;n++)i.push(n);return s.mapSeries(i,e,r)},s.seq=function(){var t=arguments;return function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();s.reduce(t,r,function(t,r,i){r.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);i(t,e)}]))},function(t,r){i.apply(e,[t].concat(r))})}},s.compose=function(){return s.seq.apply(null,Array.prototype.reverse.call(arguments))};var A=function(t,e){var r=function(){var r=this,i=Array.prototype.slice.call(arguments),n=i.pop();return t(e,function(t,e){t.apply(r,i.concat([e]))},n)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return r.apply(this,i)}return r};s.applyEach=f(A),s.applyEachSeries=g(A),s.forever=function(t,e){function r(i){if(i){if(e)return e(i);throw i}t(r)}r()},"undefined"!=typeof r&&r.exports?r.exports=s:"undefined"!=typeof t&&t.amd?t([],function(){return s}):n.async=s}()}).call(this,e("_process"))},{_process:4}],3:[function(t,e,r){(function(t){function e(t,e){for(var r=0,i=t.length-1;i>=0;i--){var n=t[i];"."===n?t.splice(i,1):".."===n?(t.splice(i,1),r++):r&&(t.splice(i,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var r=[],i=0;i<t.length;i++)e(t[i],i,t)&&r.push(t[i]);return r}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return n.exec(t).slice(1)};r.resolve=function(){for(var r="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(r=s+"/"+r,n="/"===s.charAt(0))}return r=e(i(r.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+r||"."},r.normalize=function(t){var n=r.isAbsolute(t),o="/"===s(t,-1);return t=e(i(t.split("/"),function(t){return!!t}),!n).join("/"),t||n||(t="."),t&&o&&(t+="/"),(n?"/":"")+t},r.isAbsolute=function(t){return"/"===t.charAt(0)},r.join=function(){var t=Array.prototype.slice.call(arguments,0);return r.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},r.relative=function(t,e){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=r.resolve(t).substr(1),e=r.resolve(e).substr(1);for(var n=i(t.split("/")),o=i(e.split("/")),s=Math.min(n.length,o.length),a=s,h=0;s>h;h++)if(n[h]!==o[h]){a=h;break}for(var l=[],h=a;h<n.length;h++)l.push("..");return l=l.concat(o.slice(a)),l.join("/")},r.sep="/",r.delimiter=":",r.dirname=function(t){var e=o(t),r=e[0],i=e[1];return r||i?(i&&(i=i.substr(0,i.length-1)),r+i):"."},r.basename=function(t,e){var r=o(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},r.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return 0>e&&(e=t.length+e),t.substr(e,r)}}).call(this,t("_process"))},{_process:4}],4:[function(t,e,r){function i(){if(!a){a=!0;for(var t,e=s.length;e;){t=s,s=[];for(var r=-1;++r<e;)t[r]();e=s.length}a=!1}}function n(){}var o=e.exports={},s=[],a=!1;o.nextTick=function(t){s.push(t),a||setTimeout(i,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=n,o.addListener=n,o.once=n,o.off=n,o.removeListener=n,o.removeAllListeners=n,o.emit=n,o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],5:[function(e,r,i){(function(e){!function(n){function o(t){throw RangeError(B[t])}function s(t,e){for(var r=t.length;r--;)t[r]=e(t[r]);return t}function a(t,e){return s(t.split(O),e).join(".")}function h(t){for(var e,r,i=[],n=0,o=t.length;o>n;)e=t.charCodeAt(n++),e>=55296&&56319>=e&&o>n?(r=t.charCodeAt(n++),56320==(64512&r)?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--)):i.push(e);return i}function l(t){return s(t,function(t){var e="";return t>65535&&(t-=65536,e+=N(t>>>10&1023|55296),t=56320|1023&t),e+=N(t)}).join("")}function u(t){return 10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:E}function c(t,e){return t+22+75*(26>t)-((0!=e)<<5)}function p(t,e,r){var i=0;for(t=r?I(t/C):t>>1,t+=I(t/e);t>L*A>>1;i+=E)t=I(t/L);return I(i+(L+1)*t/(t+w))}function d(t){var e,r,i,n,s,a,h,c,d,f,v=[],g=t.length,m=0,y=R,x=M;for(r=t.lastIndexOf(D),0>r&&(r=0),i=0;r>i;++i)t.charCodeAt(i)>=128&&o("not-basic"),v.push(t.charCodeAt(i));for(n=r>0?r+1:0;g>n;){for(s=m,a=1,h=E;n>=g&&o("invalid-input"),c=u(t.charCodeAt(n++)),(c>=E||c>I((T-m)/a))&&o("overflow"),m+=c*a,d=x>=h?S:h>=x+A?A:h-x,!(d>c);h+=E)f=E-d,a>I(T/f)&&o("overflow"),a*=f;e=v.length+1,x=p(m-s,e,0==s),I(m/e)>T-y&&o("overflow"),y+=I(m/e),m%=e,v.splice(m++,0,y)}return l(v)}function f(t){var e,r,i,n,s,a,l,u,d,f,v,g,m,y,x,b=[];for(t=h(t),g=t.length,e=R,r=0,s=M,a=0;g>a;++a)v=t[a],128>v&&b.push(N(v));for(i=n=b.length,n&&b.push(D);g>i;){for(l=T,a=0;g>a;++a)v=t[a],v>=e&&l>v&&(l=v);for(m=i+1,l-e>I((T-r)/m)&&o("overflow"),r+=(l-e)*m,e=l,a=0;g>a;++a)if(v=t[a],e>v&&++r>T&&o("overflow"),v==e){for(u=r,d=E;f=s>=d?S:d>=s+A?A:d-s,!(f>u);d+=E)x=u-f,y=E-f,b.push(N(c(f+x%y,0))),u=I(x/y);b.push(N(c(u,0))),s=p(r,m,i==n),r=0,++i}++r,++e}return b.join("")}function v(t){return a(t,function(t){return F.test(t)?d(t.slice(4).toLowerCase()):t})}function g(t){return a(t,function(t){return P.test(t)?"xn--"+f(t):t})}var m="object"==typeof i&&i,y="object"==typeof r&&r&&r.exports==m&&r,x="object"==typeof e&&e;(x.global===x||x.window===x)&&(n=x);var b,_,T=2147483647,E=36,S=1,A=26,w=38,C=700,M=72,R=128,D="-",F=/^xn--/,P=/[^ -~]/,O=/\x2E|\u3002|\uFF0E|\uFF61/g,B={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},L=E-S,I=Math.floor,N=String.fromCharCode;if(b={version:"1.2.4",ucs2:{decode:h,encode:l},decode:d,encode:f,toASCII:g,toUnicode:v},"function"==typeof t&&"object"==typeof t.amd&&t.amd)t("punycode",function(){return b});else if(m&&!m.nodeType)if(y)y.exports=b;else for(_ in b)b.hasOwnProperty(_)&&(m[_]=b[_]);else n.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(t,e,r){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,r,o){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var h=1e3;o&&"number"==typeof o.maxKeys&&(h=o.maxKeys);var l=t.length;h>0&&l>h&&(l=h);for(var u=0;l>u;++u){var c,p,d,f,v=t[u].replace(a,"%20"),g=v.indexOf(r);g>=0?(c=v.substr(0,g),p=v.substr(g+1)):(c=v,p=""),d=decodeURIComponent(c),f=decodeURIComponent(p),i(s,d)?n(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],7:[function(t,e,r){"use strict";function i(t,e){if(t.map)return t.map(e);for(var r=[],i=0;i<t.length;i++)r.push(e(t[i],i));return r}var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,r,a){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?i(s(t),function(s){var a=encodeURIComponent(n(s))+r;return o(t[s])?i(t[s],function(t){return a+encodeURIComponent(n(t))}).join(e):a+encodeURIComponent(n(t[s]))}).join(e):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},{}],8:[function(t,e,r){"use strict";r.decode=r.parse=t("./decode"),r.encode=r.stringify=t("./encode")},{"./decode":6,"./encode":7}],9:[function(t,e,r){function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(t,e,r){if(t&&l(t)&&t instanceof i)return t;var n=new i;return n.parse(t,e,r),n}function o(t){return h(t)&&(t=n(t)),t instanceof i?t.format():i.prototype.format.call(t)}function s(t,e){return n(t,!1,!0).resolve(e)}function a(t,e){return t?n(t,!1,!0).resolveObject(e):e}function h(t){return"string"==typeof t}function l(t){return"object"==typeof t&&null!==t}function u(t){return null===t}function c(t){return null==t}var p=t("punycode");r.parse=n,r.resolve=s,r.resolveObject=a,r.format=o,r.Url=i;var d=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,v=["<",">",'"',"`"," ","\r","\n","  "],g=["{","}","|","\\","^","`"].concat(v),m=["'"].concat(g),y=["%","/","?",";","#"].concat(m),x=["/","?","#"],b=255,_=/^[a-z0-9A-Z_-]{0,63}$/,T=/^([a-z0-9A-Z_-]{0,63})(.*)$/,E={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},A={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},w=t("querystring");i.prototype.parse=function(t,e,r){if(!h(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t;i=i.trim();var n=d.exec(i);if(n){n=n[0];var o=n.toLowerCase();this.protocol=o,i=i.substr(n.length)}if(r||n||i.match(/^\/\/[^@\/]+@[^@\/]+/)){var s="//"===i.substr(0,2);!s||n&&S[n]||(i=i.substr(2),this.slashes=!0)}if(!S[n]&&(s||n&&!A[n])){for(var a=-1,l=0;l<x.length;l++){var u=i.indexOf(x[l]);-1!==u&&(-1===a||a>u)&&(a=u)}var c,f;f=-1===a?i.lastIndexOf("@"):i.lastIndexOf("@",a),-1!==f&&(c=i.slice(0,f),i=i.slice(f+1),this.auth=decodeURIComponent(c)),a=-1;for(var l=0;l<y.length;l++){var u=i.indexOf(y[l]);-1!==u&&(-1===a||a>u)&&(a=u)}-1===a&&(a=i.length),this.host=i.slice(0,a),i=i.slice(a),this.parseHost(),this.hostname=this.hostname||"";var v="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!v)for(var g=this.hostname.split(/\./),l=0,C=g.length;C>l;l++){var M=g[l];if(M&&!M.match(_)){for(var R="",D=0,F=M.length;F>D;D++)R+=M.charCodeAt(D)>127?"x":M[D];if(!R.match(_)){var P=g.slice(0,l),O=g.slice(l+1),B=M.match(T);B&&(P.push(B[1]),O.unshift(B[2])),O.length&&(i="/"+O.join(".")+i),this.hostname=P.join(".");break}}}if(this.hostname=this.hostname.length>b?"":this.hostname.toLowerCase(),!v){for(var L=this.hostname.split("."),I=[],l=0;l<L.length;++l){var N=L[l];I.push(N.match(/[^A-Za-z0-9_-]/)?"xn--"+p.encode(N):N)}this.hostname=I.join(".")}var U=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+U,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!E[o])for(var l=0,C=m.length;C>l;l++){var j=m[l],X=encodeURIComponent(j);X===j&&(X=escape(j)),i=i.split(j).join(X)}var G=i.indexOf("#");-1!==G&&(this.hash=i.substr(G),i=i.slice(0,G));var Y=i.indexOf("?");if(-1!==Y?(this.search=i.substr(Y),this.query=i.substr(Y+1),e&&(this.query=w.parse(this.query)),i=i.slice(0,Y)):e&&(this.search="",this.query={}),i&&(this.pathname=i),A[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",N=this.search||"";this.path=U+N}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&l(this.query)&&Object.keys(this.query).length&&(o=w.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||A[e])&&n!==!1?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),s=s.replace("#","%23"),e+n+r+s+i},i.prototype.resolve=function(t){return this.resolveObject(n(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if(h(t)){var e=new i;e.parse(t,!1,!0),t=e}var r=new i;if(Object.keys(this).forEach(function(t){r[t]=this[t]},this),r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol)return Object.keys(t).forEach(function(e){"protocol"!==e&&(r[e]=t[e])}),A[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r;if(t.protocol&&t.protocol!==r.protocol){if(!A[t.protocol])return Object.keys(t).forEach(function(e){r[e]=t[e]}),r.href=r.format(),r;if(r.protocol=t.protocol,t.host||S[t.protocol])r.pathname=t.pathname;else{for(var n=(t.pathname||"").split("/");n.length&&!(t.host=n.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==n[0]&&n.unshift(""),n.length<2&&n.unshift(""),r.pathname=n.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var o=r.pathname||"",s=r.search||"";r.path=o+s}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var a=r.pathname&&"/"===r.pathname.charAt(0),l=t.host||t.pathname&&"/"===t.pathname.charAt(0),p=l||a||r.host&&t.pathname,d=p,f=r.pathname&&r.pathname.split("/")||[],n=t.pathname&&t.pathname.split("/")||[],v=r.protocol&&!A[r.protocol];if(v&&(r.hostname="",r.port=null,r.host&&(""===f[0]?f[0]=r.host:f.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===n[0]?n[0]=t.host:n.unshift(t.host)),t.host=null),p=p&&(""===n[0]||""===f[0])),l)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,f=n;else if(n.length)f||(f=[]),f.pop(),f=f.concat(n),r.search=t.search,r.query=t.query;else if(!c(t.search)){if(v){r.hostname=r.host=f.shift();var g=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;g&&(r.auth=g.shift(),r.host=r.hostname=g.shift())}return r.search=t.search,r.query=t.query,u(r.pathname)&&u(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!f.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var m=f.slice(-1)[0],y=(r.host||t.host)&&("."===m||".."===m)||""===m,x=0,b=f.length;b>=0;b--)m=f[b],"."==m?f.splice(b,1):".."===m?(f.splice(b,1),x++):x&&(f.splice(b,1),x--);if(!p&&!d)for(;x--;x)f.unshift("..");!p||""===f[0]||f[0]&&"/"===f[0].charAt(0)||f.unshift(""),y&&"/"!==f.join("/").substr(-1)&&f.push("");var _=""===f[0]||f[0]&&"/"===f[0].charAt(0);if(v){r.hostname=r.host=_?"":f.length?f.shift():"";var g=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;g&&(r.auth=g.shift(),r.host=r.hostname=g.shift())}return p=p||r.host&&f.length,p&&!_&&f.unshift(""),f.length?r.pathname=f.join("/"):(r.pathname=null,r.path=null),u(r.pathname)&&u(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var t=this.host,e=f.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{punycode:5,querystring:8}],10:[function(t,e,r){"use strict";function i(t,e,r){r=r||2;var i=e&&e.length,a=i?e[0]*r:t.length,h=o(t,n(t,0,a,r,!0)),l=[];if(!h)return l;var c,p,d,f,v,g,m;if(i&&(h=u(t,e,h,r)),t.length>80*r){c=d=t[0],p=f=t[1];for(var y=r;a>y;y+=r)v=t[y],g=t[y+1],c>v&&(c=v),p>g&&(p=g),v>d&&(d=v),g>f&&(f=g);m=Math.max(d-c,f-p)}return s(t,h,l,r,c,p,m),l}function n(t,e,r,i,n){var o,s,a,h=0;for(o=e,s=r-i;r>o;o+=i)h+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;if(n===h>0)for(o=e;r>o;o+=i)a=A(o,a);else for(o=r-i;o>=e;o-=i)a=A(o,a);return a}function o(t,e,r){r||(r=e);var i,n=e;do if(i=!1,x(t,n.i,n.next.i)||0===y(t,n.prev.i,n.i,n.next.i)){if(n.prev.next=n.next,n.next.prev=n.prev,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ),n=r=n.prev,n===n.next)return null;i=!0}else n=n.next;while(i||n!==r);return r}function s(t,e,r,i,n,u,c,p){if(e){p||void 0===n||d(t,e,n,u,c);for(var f,v,g=e;e.prev!==e.next;)if(f=e.prev,v=e.next,a(t,e,n,u,c))r.push(f.i/i),r.push(e.i/i),r.push(v.i/i),v.prev=f,f.next=v,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ),e=v.next,g=v.next;else if(e=v,e===g){p?1===p?(e=h(t,e,r,i),s(t,e,r,i,n,u,c,2)):2===p&&l(t,e,r,i,n,u,c):s(t,o(t,e),r,i,n,u,c,1);break}}}function a(t,e,r,i,n){var o=e.prev.i,s=e.i,a=e.next.i,h=t[o],l=t[o+1],u=t[s],c=t[s+1],p=t[a],d=t[a+1],f=h*c-l*u,g=h*d-l*p,m=p*c-d*u,y=f-g-m;if(0>=y)return!1;var x,b,_,T,E,S,A,w=d-l,C=h-p,M=l-c,R=u-h;if(void 0!==r){var D=u>h?p>h?h:p:p>u?u:p,F=c>l?d>l?l:d:d>c?c:d,P=h>u?h>p?h:p:u>p?u:p,O=l>c?l>d?l:d:c>d?c:d,B=v(D,F,r,i,n),L=v(P,O,r,i,n);for(A=e.nextZ;A&&A.z<=L;)if(x=A.i,A=A.nextZ,x!==o&&x!==a&&(b=t[x],_=t[x+1],T=w*b+C*_-g,T>=0&&(E=M*b+R*_+f,E>=0&&(S=y-T-E,S>=0&&(T&&E||T&&S||E&&S)))))return!1;for(A=e.prevZ;A&&A.z>=B;)if(x=A.i,A=A.prevZ,x!==o&&x!==a&&(b=t[x],_=t[x+1],T=w*b+C*_-g,T>=0&&(E=M*b+R*_+f,E>=0&&(S=y-T-E,S>=0&&(T&&E||T&&S||E&&S)))))return!1}else for(A=e.next.next;A!==e.prev;)if(x=A.i,A=A.next,b=t[x],_=t[x+1],T=w*b+C*_-g,T>=0&&(E=M*b+R*_+f,E>=0&&(S=y-T-E,S>=0&&(T&&E||T&&S||E&&S))))return!1;return!0}function h(t,e,r,i){var n=e;do{var o=n.prev,s=n.next.next;if(o.i!==s.i&&b(t,o.i,n.i,n.next.i,s.i)&&T(t,o,s)&&T(t,s,o)){r.push(o.i/i),r.push(n.i/i),r.push(s.i/i),o.next=s,s.prev=o;var a=n.prevZ,h=n.nextZ&&n.nextZ.nextZ;a&&(a.nextZ=h),h&&(h.prevZ=a),n=e=s}n=n.next}while(n!==e);return n}function l(t,e,r,i,n,a,h){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(t,l,u)){var c=S(l,u);return l=o(t,l,l.next),c=o(t,c,c.next),s(t,l,r,i,n,a,h),void s(t,c,r,i,n,a,h)}u=u.next}l=l.next}while(l!==e)}function u(t,e,r,i){var s,a,h,l,u,p=[];for(s=0,a=e.length;a>s;s++)h=e[s]*i,l=a-1>s?e[s+1]*i:t.length,u=o(t,n(t,h,l,i,!1)),u&&p.push(g(t,u));for(p.sort(function(e,r){return t[e.i]-t[r.i]}),s=0;s<p.length;s++)c(t,p[s],r),r=o(t,r,r.next);return r}function c(t,e,r){if(r=p(t,e,r)){var i=S(r,e);o(t,i,i.next)}}function p(t,e,r){var i,n,o,s=r,a=e.i,h=t[a],l=t[a+1],u=-(1/0);do{if(n=s.i,o=s.next.i,l<=t[n+1]&&l>=t[o+1]){var c=t[n]+(l-t[n+1])*(t[o]-t[n])/(t[o+1]-t[n+1]);h>=c&&c>u&&(u=c,i=t[n]<t[o]?s:s.next)}s=s.next}while(s!==r);if(!i)return null;var p,d,f,v,g,m,y=t[i.i],x=t[i.i+1],b=h*x-l*y,_=h*l-l*u,E=l-l,S=h-u,A=l-x,w=y-h,C=b-_-(u*x-l*y),M=0>=C?-1:1,R=i,D=1/0;for(s=i.next;s!==R;)p=t[s.i],d=t[s.i+1],f=h-p,f>=0&&p>=y&&(v=(E*p+S*d-_)*M,v>=0&&(g=(A*p+w*d+b)*M,g>=0&&C*M-v-g>=0&&(m=Math.abs(l-d)/f,D>m&&T(t,s,e)&&(i=s,D=m)))),s=s.next;return i}function d(t,e,r,i,n){var o=e;do null===o.z&&(o.z=v(t[o.i],t[o.i+1],r,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,f(o)}function f(t){var e,r,i,n,o,s,a,h,l=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,i=r,a=0,e=0;l>e&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0===a?(n=i,i=i.nextZ,h--):0!==h&&i?r.z<=i.z?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,h--):(n=r,r=r.nextZ,a--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,l*=2}while(s>1);return t}function v(t,e,r,i,n){return t=1e3*(t-r)/n,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=1e3*(e-i)/n,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function g(t,e){var r=e,i=e;do t[r.i]<t[i.i]&&(i=r),r=r.next;while(r!==e);return i}function m(t,e,r){return!_(t,e,e.i,r.i)&&T(t,e,r)&&T(t,r,e)&&E(t,e,e.i,r.i)}function y(t,e,r,i){var n=(t[r+1]-t[e+1])*(t[i]-t[r])-(t[r]-t[e])*(t[i+1]-t[r+1]);return n>0?1:0>n?-1:0}function x(t,e,r){return t[e]===t[r]&&t[e+1]===t[r+1]}function b(t,e,r,i,n){return y(t,e,r,i)!==y(t,e,r,n)&&y(t,i,n,e)!==y(t,i,n,r)}function _(t,e,r,i){var n=e;do{var o=n.i,s=n.next.i;if(o!==r&&s!==r&&o!==i&&s!==i&&b(t,o,s,r,i))return!0;n=n.next}while(n!==e);return!1}function T(t,e,r){return-1===y(t,e.prev.i,e.i,e.next.i)?-1!==y(t,e.i,r.i,e.next.i)&&-1!==y(t,e.i,e.prev.i,r.i):-1===y(t,e.i,r.i,e.prev.i)||-1===y(t,e.i,e.next.i,r.i)}function E(t,e,r,i){var n=e,o=!1,s=(t[r]+t[i])/2,a=(t[r+1]+t[i+1])/2;do{var h=n.i,l=n.next.i;t[h+1]>a!=t[l+1]>a&&s<(t[l]-t[h])*(a-t[h+1])/(t[l+1]-t[h+1])+t[h]&&(o=!o),n=n.next}while(n!==e);return o}function S(t,e){var r=new w(t.i),i=new w(e.i),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function A(t,e){var r=new w(t);return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function w(t){
this.i=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null}e.exports=i},{}],11:[function(t,e,r){"use strict";function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function n(){}var o="function"!=typeof Object.create?"~":!1;n.prototype._events=void 0,n.prototype.listeners=function(t,e){var r=o?o+t:t,i=this._events&&this._events[r];if(e)return!!i;if(!i)return[];if(this._events[r].fn)return[this._events[r].fn];for(var n=0,s=this._events[r].length,a=new Array(s);s>n;n++)a[n]=this._events[r][n].fn;return a},n.prototype.emit=function(t,e,r,i,n,s){var a=o?o+t:t;if(!this._events||!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,i),!0;case 5:return u.fn.call(u.context,e,r,i,n),!0;case 6:return u.fn.call(u.context,e,r,i,n,s),!0}for(l=1,h=new Array(c-1);c>l;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var p,d=u.length;for(l=0;d>l;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,r);break;default:if(!h)for(p=1,h=new Array(c-1);c>p;p++)h[p-1]=arguments[p];u[l].fn.apply(u[l].context,h)}}return!0},n.prototype.on=function(t,e,r){var n=new i(e,r||this),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],n]:this._events[s].push(n):this._events[s]=n,this},n.prototype.once=function(t,e,r){var n=new i(e,r||this,!0),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],n]:this._events[s].push(n):this._events[s]=n,this},n.prototype.removeListener=function(t,e,r,i){var n=o?o+t:t;if(!this._events||!this._events[n])return this;var s=this._events[n],a=[];if(e)if(s.fn)(s.fn!==e||i&&!s.once||r&&s.context!==r)&&a.push(s);else for(var h=0,l=s.length;l>h;h++)(s[h].fn!==e||i&&!s[h].once||r&&s[h].context!==r)&&a.push(s[h]);return a.length?this._events[n]=1===a.length?a[0]:a:delete this._events[n],this},n.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[o?o+t:t]:this._events=o?{}:Object.create(null),this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=o,e.exports=n},{}],12:[function(t,e,r){"use strict";function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}e.exports=Object.assign||function(t,e){for(var r,n,o=i(t),s=1;s<arguments.length;s++){r=arguments[s],n=Object.keys(Object(r));for(var a=0;a<n.length;a++)o[n[a]]=r[n[a]]}return o}},{}],13:[function(e,r,i){(function(e){!function(){function i(t){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,t.apply(n,arguments)}}var n,o,s={};n=this,null!=n&&(o=n.async),s.noConflict=function(){return n.async=o,s};var a=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===a.call(t)},l=function(t,e){if(t.forEach)return t.forEach(e);for(var r=0;r<t.length;r+=1)e(t[r],r,t)},u=function(t,e){if(t.map)return t.map(e);var r=[];return l(t,function(t,i,n){r.push(e(t,i,n))}),r},c=function(t,e,r){return t.reduce?t.reduce(e,r):(l(t,function(t,i,n){r=e(r,t,i,n)}),r)},p=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e};"undefined"!=typeof e&&e.nextTick?(s.nextTick=e.nextTick,s.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:s.nextTick):"function"==typeof setImmediate?(s.nextTick=function(t){setImmediate(t)},s.setImmediate=s.nextTick):(s.nextTick=function(t){setTimeout(t,0)},s.setImmediate=s.nextTick),s.each=function(t,e,r){function n(e){e?(r(e),r=function(){}):(o+=1,o>=t.length&&r())}if(r=r||function(){},!t.length)return r();var o=0;l(t,function(t){e(t,i(n))})},s.forEach=s.each,s.eachSeries=function(t,e,r){if(r=r||function(){},!t.length)return r();var i=0,n=function(){e(t[i],function(e){e?(r(e),r=function(){}):(i+=1,i>=t.length?r():n())})};n()},s.forEachSeries=s.eachSeries,s.eachLimit=function(t,e,r,i){var n=d(e);n.apply(null,[t,r,i])},s.forEachLimit=s.eachLimit;var d=function(t){return function(e,r,i){if(i=i||function(){},!e.length||0>=t)return i();var n=0,o=0,s=0;!function a(){if(n>=e.length)return i();for(;t>s&&o<e.length;)o+=1,s+=1,r(e[o-1],function(t){t?(i(t),i=function(){}):(n+=1,s-=1,n>=e.length?i():a())})}()}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[s.each].concat(e))}},v=function(t,e){return function(){var r=Array.prototype.slice.call(arguments);return e.apply(null,[d(t)].concat(r))}},g=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[s.eachSeries].concat(e))}},m=function(t,e,r,i){if(e=u(e,function(t,e){return{index:e,value:t}}),i){var n=[];t(e,function(t,e){r(t.value,function(r,i){n[t.index]=i,e(r)})},function(t){i(t,n)})}else t(e,function(t,e){r(t.value,function(t){e(t)})})};s.map=f(m),s.mapSeries=g(m),s.mapLimit=function(t,e,r,i){return y(e)(t,r,i)};var y=function(t){return v(t,m)};s.reduce=function(t,e,r,i){s.eachSeries(t,function(t,i){r(e,t,function(t,r){e=r,i(t)})},function(t){i(t,e)})},s.inject=s.reduce,s.foldl=s.reduce,s.reduceRight=function(t,e,r,i){var n=u(t,function(t){return t}).reverse();s.reduce(n,e,r,i)},s.foldr=s.reduceRight;var x=function(t,e,r,i){var n=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){r(t.value,function(r){r&&n.push(t),e()})},function(t){i(u(n.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};s.filter=f(x),s.filterSeries=g(x),s.select=s.filter,s.selectSeries=s.filterSeries;var b=function(t,e,r,i){var n=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){r(t.value,function(r){r||n.push(t),e()})},function(t){i(u(n.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};s.reject=f(b),s.rejectSeries=g(b);var _=function(t,e,r,i){t(e,function(t,e){r(t,function(r){r?(i(t),i=function(){}):e()})},function(t){i()})};s.detect=f(_),s.detectSeries=g(_),s.some=function(t,e,r){s.each(t,function(t,i){e(t,function(t){t&&(r(!0),r=function(){}),i()})},function(t){r(!1)})},s.any=s.some,s.every=function(t,e,r){s.each(t,function(t,i){e(t,function(t){t||(r(!1),r=function(){}),i()})},function(t){r(!0)})},s.all=s.every,s.sortBy=function(t,e,r){s.map(t,function(t,r){e(t,function(e,i){e?r(e):r(null,{value:t,criteria:i})})},function(t,e){if(t)return r(t);var i=function(t,e){var r=t.criteria,i=e.criteria;return i>r?-1:r>i?1:0};r(null,u(e.sort(i),function(t){return t.value}))})},s.auto=function(t,e){e=e||function(){};var r=p(t),i=r.length;if(!i)return e();var n={},o=[],a=function(t){o.unshift(t)},u=function(t){for(var e=0;e<o.length;e+=1)if(o[e]===t)return void o.splice(e,1)},d=function(){i--,l(o.slice(0),function(t){t()})};a(function(){if(!i){var t=e;e=function(){},t(null,n)}}),l(r,function(r){var i=h(t[r])?t[r]:[t[r]],o=function(t){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),t){var o={};l(p(n),function(t){o[t]=n[t]}),o[r]=i,e(t,o),e=function(){}}else n[r]=i,s.setImmediate(d)},f=i.slice(0,Math.abs(i.length-1))||[],v=function(){return c(f,function(t,e){return t&&n.hasOwnProperty(e)},!0)&&!n.hasOwnProperty(r)};if(v())i[i.length-1](o,n);else{var g=function(){v()&&(u(g),i[i.length-1](o,n))};a(g)}})},s.retry=function(t,e,r){var i=5,n=[];"function"==typeof t&&(r=e,e=t,t=i),t=parseInt(t,10)||i;var o=function(i,o){for(var a=function(t,e){return function(r){t(function(t,i){r(!t||e,{err:t,result:i})},o)}};t;)n.push(a(e,!(t-=1)));s.series(n,function(t,e){e=e[e.length-1],(i||r)(e.err,e.result)})};return r?o():o},s.waterfall=function(t,e){if(e=e||function(){},!h(t)){var r=new Error("First argument to waterfall must be an array of functions");return e(r)}if(!t.length)return e();var i=function(t){return function(r){if(r)e.apply(null,arguments),e=function(){};else{var n=Array.prototype.slice.call(arguments,1),o=t.next();n.push(o?i(o):e),s.setImmediate(function(){t.apply(null,n)})}}};i(s.iterator(t))()};var T=function(t,e,r){if(r=r||function(){},h(e))t.map(e,function(t,e){t&&t(function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),e.call(null,t,r)})},r);else{var i={};t.each(p(e),function(t,r){e[t](function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),i[t]=n,r(e)})},function(t){r(t,i)})}};s.parallel=function(t,e){T({map:s.map,each:s.each},t,e)},s.parallelLimit=function(t,e,r){T({map:y(e),each:d(e)},t,r)},s.series=function(t,e){if(e=e||function(){},h(t))s.mapSeries(t,function(t,e){t&&t(function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),e.call(null,t,r)})},e);else{var r={};s.eachSeries(p(t),function(e,i){t[e](function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),r[e]=n,i(t)})},function(t){e(t,r)})}},s.iterator=function(t){var e=function(r){var i=function(){return t.length&&t[r].apply(null,arguments),i.next()};return i.next=function(){return r<t.length-1?e(r+1):null},i};return e(0)},s.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var E=function(t,e,r,i){var n=[];t(e,function(t,e){r(t,function(t,r){n=n.concat(r||[]),e(t)})},function(t){i(t,n)})};s.concat=f(E),s.concatSeries=g(E),s.whilst=function(t,e,r){t()?e(function(i){return i?r(i):void s.whilst(t,e,r)}):r()},s.doWhilst=function(t,e,r){t(function(i){if(i)return r(i);var n=Array.prototype.slice.call(arguments,1);e.apply(null,n)?s.doWhilst(t,e,r):r()})},s.until=function(t,e,r){t()?r():e(function(i){return i?r(i):void s.until(t,e,r)})},s.doUntil=function(t,e,r){t(function(i){if(i)return r(i);var n=Array.prototype.slice.call(arguments,1);e.apply(null,n)?r():s.doUntil(t,e,r)})},s.queue=function(t,e){function r(t,e,r,i){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?s.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var n={data:e,callback:"function"==typeof i?i:null};r?t.tasks.unshift(n):t.tasks.push(n),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}void 0===e&&(e=1);var n=0,o={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,e){r(o,t,!1,e)},kill:function(){o.drain=null,o.tasks=[]},unshift:function(t,e){r(o,t,!0,e)},process:function(){if(!o.paused&&n<o.concurrency&&o.tasks.length){var e=o.tasks.shift();o.empty&&0===o.tasks.length&&o.empty(),n+=1;var r=function(){n-=1,e.callback&&e.callback.apply(e,arguments),o.drain&&o.tasks.length+n===0&&o.drain(),o.process()},s=i(r);t(e.data,s)}},length:function(){return o.tasks.length},running:function(){return n},idle:function(){return o.tasks.length+n===0},pause:function(){o.paused!==!0&&(o.paused=!0,o.process())},resume:function(){o.paused!==!1&&(o.paused=!1,o.process())}};return o},s.priorityQueue=function(t,e){function r(t,e){return t.priority-e.priority}function i(t,e,r){for(var i=-1,n=t.length-1;n>i;){var o=i+(n-i+1>>>1);r(e,t[o])>=0?i=o:n=o-1}return i}function n(t,e,n,o){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?s.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var a={data:e,priority:n,callback:"function"==typeof o?o:null};t.tasks.splice(i(t.tasks,a,r)+1,0,a),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}var o=s.queue(t,e);return o.push=function(t,e,r){n(o,t,e,r)},delete o.unshift,o},s.cargo=function(t,e){var r=!1,i=[],n={tasks:i,payload:e,saturated:null,empty:null,drain:null,drained:!0,push:function(t,r){h(t)||(t=[t]),l(t,function(t){i.push({data:t,callback:"function"==typeof r?r:null}),n.drained=!1,n.saturated&&i.length===e&&n.saturated()}),s.setImmediate(n.process)},process:function o(){if(!r){if(0===i.length)return n.drain&&!n.drained&&n.drain(),void(n.drained=!0);var s="number"==typeof e?i.splice(0,e):i.splice(0,i.length),a=u(s,function(t){return t.data});n.empty&&n.empty(),r=!0,t(a,function(){r=!1;var t=arguments;l(s,function(e){e.callback&&e.callback.apply(null,t)}),o()})}},length:function(){return i.length},running:function(){return r}};return n};var S=function(t){return function(e){var r=Array.prototype.slice.call(arguments,1);e.apply(null,r.concat([function(e){var r=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&l(r,function(e){console[t](e)}))}]))}};s.log=S("log"),s.dir=S("dir"),s.memoize=function(t,e){var r={},i={};e=e||function(t){return t};var n=function(){var n=Array.prototype.slice.call(arguments),o=n.pop(),a=e.apply(null,n);a in r?s.nextTick(function(){o.apply(null,r[a])}):a in i?i[a].push(o):(i[a]=[o],t.apply(null,n.concat([function(){r[a]=arguments;var t=i[a];delete i[a];for(var e=0,n=t.length;n>e;e++)t[e].apply(null,arguments)}])))};return n.memo=r,n.unmemoized=t,n},s.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},s.times=function(t,e,r){for(var i=[],n=0;t>n;n++)i.push(n);return s.map(i,e,r)},s.timesSeries=function(t,e,r){for(var i=[],n=0;t>n;n++)i.push(n);return s.mapSeries(i,e,r)},s.seq=function(){var t=arguments;return function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();s.reduce(t,r,function(t,r,i){r.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);i(t,e)}]))},function(t,r){i.apply(e,[t].concat(r))})}},s.compose=function(){return s.seq.apply(null,Array.prototype.reverse.call(arguments))};var A=function(t,e){var r=function(){var r=this,i=Array.prototype.slice.call(arguments),n=i.pop();return t(e,function(t,e){t.apply(r,i.concat([e]))},n)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return r.apply(this,i)}return r};s.applyEach=f(A),s.applyEachSeries=g(A),s.forever=function(t,e){function r(i){if(i){if(e)return e(i);throw i}t(r)}r()},"undefined"!=typeof r&&r.exports?r.exports=s:"undefined"!=typeof t&&t.amd?t([],function(){return s}):n.async=s}()}).call(this,e("_process"))},{_process:4}],14:[function(t,e,r){arguments[4][11][0].apply(r,arguments)},{dup:11}],15:[function(t,e,r){function i(t,e){a.call(this),e=e||10,this.baseUrl=t||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._boundOnLoad=this._onLoad.bind(this),this._buffer=[],this._numToLoad=0,this._queue=n.queue(this._boundLoadResource,e),this.resources={}}var n=t("async"),o=t("url"),s=t("./Resource"),a=t("eventemitter3");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.add=i.prototype.enqueue=function(t,e,r,i){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(i=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.resources[t])throw new Error('Resource with name "'+t+'" already exists.');return e=this._handleBaseUrl(e),this.resources[t]=new s(t,e,r),"function"==typeof i&&this.resources[t].once("afterMiddleware",i),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[t]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[t]),this._progressChunk=100/this._buffer.length),this},i.prototype._handleBaseUrl=function(t){var e=o.parse(t);return e.protocol||0===e.pathname.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&t.lastIndexOf("/")!==t.length-1?this.baseUrl+"/"+t:this.baseUrl+t},i.prototype.before=i.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},i.prototype.after=i.prototype.use=function(t){return this._afterMiddleware.push(t),this},i.prototype.reset=function(){this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1,this.resources={}},i.prototype.load=function(t){if("function"==typeof t&&this.once("complete",t),this._queue.started)return this;this.emit("start",this);for(var e=0;e<this._buffer.length;++e)this._queue.push(this._buffer[e]);return this._buffer.length=0,this},i.prototype._loadResource=function(t,e){var r=this;t._dequeue=e,this._runMiddleware(t,this._beforeMiddleware,function(){t.load(r._boundOnLoad)})},i.prototype._onComplete=function(){this.emit("complete",this,this.resources)},i.prototype._onLoad=function(t){this.progress+=this._progressChunk,this.emit("progress",this,t),t.error?this.emit("error",t.error,this,t):this.emit("load",this,t),this._runMiddleware(t,this._afterMiddleware,function(){t.emit("afterMiddleware",t),this._numToLoad--,0===this._numToLoad&&this._onComplete()}),t._dequeue()},i.prototype._runMiddleware=function(t,e,r){var i=this;n.eachSeries(e,function(e,r){e.call(i,t,r)},r.bind(this,t))},i.LOAD_TYPE=s.LOAD_TYPE,i.XHR_READY_STATE=s.XHR_READY_STATE,i.XHR_RESPONSE_TYPE=s.XHR_RESPONSE_TYPE},{"./Resource":16,async:13,eventemitter3:14,url:9}],16:[function(t,e,r){function i(t,e,r){if(s.call(this),r=r||{},"string"!=typeof t||"string"!=typeof e)throw new Error("Both name and url are required for constructing a resource.");this.name=t,this.url=e,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=r.crossOrigin===!0?"anonymous":null,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function n(t){return t.toString().replace("object ","")}function o(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}var s=t("eventemitter3"),a=t("url"),h=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError),this.data.removeEventListener("load",this._boundComplete),this.data.removeEventListener("progress",this._boundOnProgress),this.data.removeEventListener("canplaythrough",this._boundComplete)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError),this.xhr.removeEventListener("abort",this._boundXhrOnAbort),this.xhr.removeEventListener("progress",this._boundOnProgress),this.xhr.removeEventListener("load",this._boundXhrOnLoad)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.emit("complete",this)},i.prototype.load=function(t){switch(this.emit("start",this),t&&this.once("complete",t),"string"!=typeof this.crossOrigin&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case i.LOAD_TYPE.IMAGE:this._loadImage();break;case i.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case i.LOAD_TYPE.VIDEO:this._loadElement("video");break;case i.LOAD_TYPE.XHR:default:h&&this.crossOrigin?this._loadXdr():this._loadXhr()}},i.prototype._loadImage=function(){this.data=new Image,this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.data.src=this.url,this.isImage=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},i.prototype._loadElement=function(t){if(this.data=document.createElement(t),Array.isArray(this.url))for(var e=0;e<this.url.length;++e)this.data.appendChild(this._createSource(t,this.url[e]));else this.data.appendChild(this._createSource(t,this.url));this["is"+t[0].toUpperCase()+t.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()},i.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.responseType=this.xhrType===i.XHR_RESPONSE_TYPE.JSON||this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT?i.XHR_RESPONSE_TYPE.TEXT:this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},i.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){t.send()},0)},i.prototype._createSource=function(t,e,r){r||(r=t+"/"+e.substr(e.lastIndexOf(".")+1));var i=document.createElement("source");return i.src=e,i.type=r,i},i.prototype._onError=function(t){this.error=new Error("Failed to load element using "+t.target.nodeName),this.complete()},i.prototype._onProgress=function(t){t&&t.lengthComputable&&this.emit("progress",this,t.loaded/t.total)},i.prototype._xhrOnError=function(){this.error=new Error(n(this.xhr)+" Request failed. Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"'),this.complete()},i.prototype._xhrOnAbort=function(){this.error=new Error(n(this.xhr)+" Request was aborted by the user."),this.complete()},i.prototype._xdrOnTimeout=function(){this.error=new Error(n(this.xhr)+" Request timed out."),this.complete()},i.prototype._xhrOnLoad=function(){var t=this.xhr,e=void 0!==t.status?t.status:200;if(200===e||204===e||0===e&&t.responseText.length>0)if(this.xhrType===i.XHR_RESPONSE_TYPE.TEXT)this.data=t.responseText;else if(this.xhrType===i.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(t.responseText),this.isJson=!0}catch(r){this.error=new Error("Error trying to parse loaded json:",r)}else if(this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var n=new DOMParser;this.data=n.parseFromString(t.responseText,"text/xml")}else{var o=document.createElement("div");o.innerHTML=t.responseText,this.data=o}this.isXml=!0}catch(r){this.error=new Error("Error trying to parse loaded xml:",r)}else this.data=t.response||t.responseText;else this.error=new Error("["+t.status+"]"+t.statusText+":"+t.responseURL);this.complete()},i.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";e=e||window.location,l||(l=document.createElement("a")),l.href=t,t=a.parse(l.href);var r=!t.port&&""===e.port||t.port===e.port;return t.hostname===e.hostname&&r&&t.protocol===e.protocol?"":"anonymous"},i.prototype._determineXhrType=function(){return i._xhrTypeMap[this._getExtension()]||i.XHR_RESPONSE_TYPE.TEXT},i.prototype._determineLoadType=function(){return i._loadTypeMap[this._getExtension()]||i.LOAD_TYPE.XHR},i.prototype._getExtension=function(){var t,e=this.url;if(this.isDataUrl){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var i=e.indexOf("?");-1!==i&&(e=e.substring(0,i)),t=e.substring(e.lastIndexOf(".")+1)}return t},i.prototype._getMimeFromXhrType=function(t){switch(t){case i.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case i.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case i.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case i.XHR_RESPONSE_TYPE.JSON:return"application/json";case i.XHR_RESPONSE_TYPE.DEFAULT:case i.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},i.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},i.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},i.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},i._loadTypeMap={gif:i.LOAD_TYPE.IMAGE,png:i.LOAD_TYPE.IMAGE,bmp:i.LOAD_TYPE.IMAGE,jpg:i.LOAD_TYPE.IMAGE,jpeg:i.LOAD_TYPE.IMAGE,tif:i.LOAD_TYPE.IMAGE,tiff:i.LOAD_TYPE.IMAGE,webp:i.LOAD_TYPE.IMAGE,tga:i.LOAD_TYPE.IMAGE},i._xhrTypeMap={xhtml:i.XHR_RESPONSE_TYPE.DOCUMENT,html:i.XHR_RESPONSE_TYPE.DOCUMENT,htm:i.XHR_RESPONSE_TYPE.DOCUMENT,xml:i.XHR_RESPONSE_TYPE.DOCUMENT,tmx:i.XHR_RESPONSE_TYPE.DOCUMENT,tsx:i.XHR_RESPONSE_TYPE.DOCUMENT,svg:i.XHR_RESPONSE_TYPE.DOCUMENT,gif:i.XHR_RESPONSE_TYPE.BLOB,png:i.XHR_RESPONSE_TYPE.BLOB,bmp:i.XHR_RESPONSE_TYPE.BLOB,jpg:i.XHR_RESPONSE_TYPE.BLOB,jpeg:i.XHR_RESPONSE_TYPE.BLOB,tif:i.XHR_RESPONSE_TYPE.BLOB,tiff:i.XHR_RESPONSE_TYPE.BLOB,webp:i.XHR_RESPONSE_TYPE.BLOB,tga:i.XHR_RESPONSE_TYPE.BLOB,json:i.XHR_RESPONSE_TYPE.JSON,text:i.XHR_RESPONSE_TYPE.TEXT,txt:i.XHR_RESPONSE_TYPE.TEXT},i.setExtensionLoadType=function(t,e){o(i._loadTypeMap,t,e)},i.setExtensionXhrType=function(t,e){o(i._xhrTypeMap,t,e)}},{eventemitter3:14,url:9}],17:[function(t,e,r){e.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(t){for(var e,r="",i=new Array(4),n=0,o=0,s=0;n<t.length;){for(e=new Array(3),o=0;o<e.length;o++)e[o]=n<t.length?255&t.charCodeAt(n++):0;switch(i[0]=e[0]>>2,i[1]=(3&e[0])<<4|e[1]>>4,i[2]=(15&e[1])<<2|e[2]>>6,i[3]=63&e[2],s=n-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(o=0;o<i.length;o++)r+=this._keyStr.charAt(i[o])}return r}}},{}],18:[function(t,e,r){e.exports=t("./Loader"),e.exports.Resource=t("./Resource"),e.exports.middleware={caching:{memory:t("./middlewares/caching/memory")},parsing:{blob:t("./middlewares/parsing/blob")}}},{"./Loader":15,"./Resource":16,"./middlewares/caching/memory":19,"./middlewares/parsing/blob":20}],19:[function(t,e,r){var i={};e.exports=function(){return function(t,e){i[t.url]?(t.data=i[t.url],t.complete()):(t.once("complete",function(){i[this.url]=this.data}),e())}}},{}],20:[function(t,e,r){var i=t("../../Resource"),n=t("../../b64");window.URL=window.URL||window.webkitURL,e.exports=function(){return function(t,e){if(!t.data)return e();if(t.xhr&&t.xhrType===i.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=URL.createObjectURL(t.data);t.blob=t.data,t.data=new Image,t.data.src=r,t.isImage=!0,t.data.onload=function(){URL.revokeObjectURL(r),t.data.onload=null,e()}}}else{var o=t.xhr.getResponseHeader("content-type");o&&0===o.indexOf("image")&&(t.data=new Image,t.data.src="data:"+o+";base64,"+n.encodeBinary(t.xhr.responseText),t.isImage=!0,t.data.onload=function(){t.data.onload=null,e()})}else e()}}},{"../../Resource":16,"../../b64":17}],21:[function(t,e,r){e.exports={name:"pixi.js",version:"3.0.7",description:"Pixi.js is a fast lightweight 2D library that works across all devices.",author:"Mat Groves",contributors:["Chad Engler <chad@pantherdev.com>","Richard Davey <rdavey@gmail.com>"],main:"./src/index.js",homepage:"http://goodboydigital.com/",bugs:"https://github.com/GoodBoyDigital/pixi.js/issues",license:"MIT",repository:{type:"git",url:"https://github.com/GoodBoyDigital/pixi.js.git"},scripts:{start:"gulp && gulp watch",test:"gulp && testem ci",build:"gulp",docs:"jsdoc -c ./gulp/util/jsdoc.conf.json -R README.md"},files:["bin/","src/"],dependencies:{async:"^0.9.0",brfs:"^1.4.0",earcut:"^2.0.1",eventemitter3:"^1.1.0","object-assign":"^2.0.0","resource-loader":"^1.6.1"},devDependencies:{browserify:"^10.2.3",chai:"^3.0.0",del:"^1.2.0",gulp:"^3.9.0","gulp-cached":"^1.1.0","gulp-concat":"^2.5.2","gulp-debug":"^2.0.1","gulp-jshint":"^1.11.0","gulp-mirror":"^0.4.0","gulp-plumber":"^1.0.1","gulp-rename":"^1.2.2","gulp-sourcemaps":"^1.5.2","gulp-uglify":"^1.2.0","gulp-util":"^3.0.5","jaguarjs-jsdoc":"git+https://github.com/davidshimjs/jaguarjs-jsdoc.git",jsdoc:"^3.3.0","jshint-summary":"^0.4.0",minimist:"^1.1.1",mocha:"^2.2.5","require-dir":"^0.3.0","run-sequence":"^1.1.0",testem:"^0.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.2.1"},browserify:{transform:["brfs"]}}},{}],22:[function(t,e,r){var i={VERSION:t("../../package.json").version,PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};e.exports=i},{"../../package.json":21}],23:[function(t,e,r){function i(){o.call(this),this.children=[]}var n=t("../math"),o=t("./DisplayObject"),s=t("../textures/RenderTexture"),a=new n.Matrix;i.prototype=Object.create(o.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}}),i.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},i.prototype.addChildAt=function(t,e){if(t===this)return t;if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t.emit("added",this),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},i.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),i=this.getChildIndex(e);if(0>r||0>i)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[r]=e,this.children[i]=t}},i.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},i.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var r=this.getChildIndex(t);this.children.splice(r,1),this.children.splice(e,0,t)},i.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[t]},i.prototype.removeChild=function(t){var e=this.children.indexOf(t);return-1!==e?this.removeChildAt(e):void 0},i.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,this.children.splice(t,1),e.emit("removed",this),e},i.prototype.removeChildren=function(t,e){var r=t||0,i="number"==typeof e?e:this.children.length,n=i-r;if(n>0&&i>=n){for(var o=this.children.splice(r,n),s=0;s<o.length;++s)o[s].parent=null;return o}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},i.prototype.generateTexture=function(t,e,r){var i=this.getLocalBounds(),n=new s(t,0|i.width,0|i.height,r,e);return a.tx=-i.x,a.ty=-i.y,n.render(this,a),n},i.prototype.updateTransform=function(){
if(this.visible){this.displayObjectUpdateTransform();for(var t=0,e=this.children.length;e>t;++t)this.children[t].updateTransform()}},i.prototype.containerUpdateTransform=i.prototype.updateTransform,i.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return n.Rectangle.EMPTY;for(var t,e,r,i=1/0,o=1/0,s=-(1/0),a=-(1/0),h=!1,l=0,u=this.children.length;u>l;++l){var c=this.children[l];c.visible&&(h=!0,t=this.children[l].getBounds(),i=i<t.x?i:t.x,o=o<t.y?o:t.y,e=t.width+t.x,r=t.height+t.y,s=s>e?s:e,a=a>r?a:r)}if(!h)return n.Rectangle.EMPTY;var p=this._bounds;p.x=i,p.y=o,p.width=s-i,p.height=a-o,this._currentBounds=p}return this._currentBounds},i.prototype.containerGetBounds=i.prototype.getBounds,i.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=n.Matrix.IDENTITY;for(var e=0,r=this.children.length;r>e;++e)this.children[e].updateTransform();return this.worldTransform=t,this._currentBounds=null,this.getBounds(n.Matrix.IDENTITY)},i.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var e,r;if(this._mask||this._filters){for(t.currentRenderer.flush(),this._filters&&t.filterManager.pushFilter(this,this._filters),this._mask&&t.maskManager.pushMask(this,this._mask),t.currentRenderer.start(),this._renderWebGL(t),e=0,r=this.children.length;r>e;e++)this.children[e].renderWebGL(t);t.currentRenderer.flush(),this._mask&&t.maskManager.popMask(this,this._mask),this._filters&&t.filterManager.popFilter(),t.currentRenderer.start()}else for(this._renderWebGL(t),e=0,r=this.children.length;r>e;++e)this.children[e].renderWebGL(t)}},i.prototype._renderWebGL=function(t){},i.prototype._renderCanvas=function(t){},i.prototype.renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask,t),this._renderCanvas(t);for(var e=0,r=this.children.length;r>e;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},i.prototype.destroy=function(t){if(o.prototype.destroy.call(this),t)for(var e=0,r=this.children.length;r>e;++e)this.children[e].destroy(t);this.removeChildren(),this.children=null}},{"../math":32,"../textures/RenderTexture":70,"./DisplayObject":24}],24:[function(t,e,r){function i(){s.call(this),this.position=new n.Point,this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.worldTransform=new n.Matrix,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new n.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cachedObject=null}var n=t("../math"),o=t("../textures/RenderTexture"),s=t("eventemitter3"),a=t("../const"),h=new n.Matrix;i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0),this._mask=t,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}}),i.prototype.updateTransform=function(){var t,e,r,i,n,o,s=this.parent.worldTransform,h=this.worldTransform;this.rotation%a.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,e=this._sr*this.scale.x,r=-this._sr*this.scale.y,i=this._cr*this.scale.y,n=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(n-=this.pivot.x*t+this.pivot.y*r,o-=this.pivot.x*e+this.pivot.y*i),h.a=t*s.a+e*s.c,h.b=t*s.b+e*s.d,h.c=r*s.a+i*s.c,h.d=r*s.b+i*s.d,h.tx=n*s.a+o*s.c+s.tx,h.ty=n*s.b+o*s.d+s.ty):(t=this.scale.x,i=this.scale.y,n=this.position.x-this.pivot.x*t,o=this.position.y-this.pivot.y*i,h.a=t*s.a,h.b=t*s.b,h.c=i*s.c,h.d=i*s.d,h.tx=n*s.a+o*s.c+s.tx,h.ty=n*s.b+o*s.d+s.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null},i.prototype.displayObjectUpdateTransform=i.prototype.updateTransform,i.prototype.getBounds=function(t){return n.Rectangle.EMPTY},i.prototype.getLocalBounds=function(){return this.getBounds(n.Matrix.IDENTITY)},i.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},i.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},i.prototype.renderWebGL=function(t){},i.prototype.renderCanvas=function(t){},i.prototype.generateTexture=function(t,e,r){var i=this.getLocalBounds(),n=new o(t,0|i.width,0|i.height,e,r);return h.tx=-i.x,h.ty=-i.y,n.render(this,h),n},i.prototype.destroy=function(){this.position=null,this.scale=null,this.pivot=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.worldTransform=null,this.filterArea=null}},{"../const":22,"../math":32,"../textures/RenderTexture":70,eventemitter3:11}],25:[function(t,e,r){function i(){n.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=u.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new l.Rectangle(0,0,1,1),this.dirty=!0,this.glDirty=!1,this.boundsDirty=!0,this.cachedSpriteDirty=!1}var n=t("../display/Container"),o=t("../textures/Texture"),s=t("../renderers/canvas/utils/CanvasBuffer"),a=t("../renderers/canvas/utils/CanvasGraphics"),h=t("./GraphicsData"),l=t("../math"),u=t("../const"),c=new l.Point;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{}),i.prototype.clone=function(){var t=new i;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=this.dirty,t.glDirty=this.glDirty,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var e=0;e<this.graphicsData.length;++e)t.graphicsData.push(this.graphicsData[e].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},i.prototype.lineStyle=function(t,e,r){return this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===r?1:r,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new l.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},i.prototype.moveTo=function(t,e){return this.drawShape(new l.Polygon([t,e])),this},i.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},i.prototype.quadraticCurveTo=function(t,e,r,i){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var n,o,s=20,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var h=a[a.length-2],l=a[a.length-1],u=0,c=1;s>=c;++c)u=c/s,n=h+(t-h)*u,o=l+(e-l)*u,a.push(n+(t+(r-t)*u-n)*u,o+(e+(i-e)*u-o)*u);return this.dirty=this.boundsDirty=!0,this},i.prototype.bezierCurveTo=function(t,e,r,i,n,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var s,a,h,l,u,c=20,p=this.currentPath.shape.points,d=p[p.length-2],f=p[p.length-1],v=0,g=1;c>=g;++g)v=g/c,s=1-v,a=s*s,h=a*s,l=v*v,u=l*v,p.push(h*d+3*a*v*t+3*s*l*r+u*n,h*f+3*a*v*e+3*s*l*i+u*o);return this.dirty=this.boundsDirty=!0,this},i.prototype.arcTo=function(t,e,r,i,n){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,s=o[o.length-2],a=o[o.length-1],h=a-e,l=s-t,u=i-e,c=r-t,p=Math.abs(h*c-l*u);if(1e-8>p||0===n)(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e);else{var d=h*h+l*l,f=u*u+c*c,v=h*u+l*c,g=n*Math.sqrt(d)/p,m=n*Math.sqrt(f)/p,y=g*v/d,x=m*v/f,b=g*c+m*l,_=g*u+m*h,T=l*(m+y),E=h*(m+y),S=c*(g+x),A=u*(g+x),w=Math.atan2(E-_,T-b),C=Math.atan2(A-_,S-b);this.arc(b+t,_+e,n,w,C,l*u>c*h)}return this.dirty=this.boundsDirty=!0,this},i.prototype.arc=function(t,e,r,i,n,o){if(o=o||!1,i===n)return this;!o&&i>=n?n+=2*Math.PI:o&&n>=i&&(i+=2*Math.PI);var s=o?-1*(i-n):n-i,a=40*Math.ceil(Math.abs(s)/(2*Math.PI));if(0===s)return this;var h=t+Math.cos(i)*r,l=e+Math.sin(i)*r;this.currentPath?o&&this.filling?this.currentPath.shape.points.push(t,e):this.currentPath.shape.points.push(h,l):o&&this.filling?this.moveTo(t,e):this.moveTo(h,l);for(var u=this.currentPath.shape.points,c=s/(2*a),p=2*c,d=Math.cos(c),f=Math.sin(c),v=a-1,g=v%1/v,m=0;v>=m;m++){var y=m+g*m,x=c+i+p*y,b=Math.cos(x),_=-Math.sin(x);u.push((d*b+f*_)*r+t,(d*-_+f*b)*r+e)}return this.dirty=this.boundsDirty=!0,this},i.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},i.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},i.prototype.drawRect=function(t,e,r,i){return this.drawShape(new l.Rectangle(t,e,r,i)),this},i.prototype.drawRoundedRect=function(t,e,r,i,n){return this.drawShape(new l.RoundedRectangle(t,e,r,i,n)),this},i.prototype.drawCircle=function(t,e,r){return this.drawShape(new l.Circle(t,e,r)),this},i.prototype.drawEllipse=function(t,e,r,i){return this.drawShape(new l.Ellipse(t,e,r,i)),this},i.prototype.drawPolygon=function(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r]}return this.drawShape(new l.Polygon(e)),this},i.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},i.prototype.generateTexture=function(t,e,r){e=e||1;var i=this.getLocalBounds(),n=new s(i.width*e,i.height*e),h=o.fromCanvas(n.canvas,r);return h.baseTexture.resolution=e,n.context.scale(e,e),n.context.translate(-i.x,-i.y),a.renderGraphics(this,n.context),h},i.prototype._renderWebGL=function(t){this.glDirty&&(this.dirty=!0,this.glDirty=!1),t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this)},i.prototype._renderCanvas=function(t){if(this.isMask!==!0){this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint);var e=t.context,r=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=t.blendModes[t.currentBlendMode]);var i=t.resolution;e.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),a.renderGraphics(this,e)}},i.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return l.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),this.glDirty=!0,this.cachedSpriteDirty=!0,this.boundsDirty=!1);var e=this._localBounds,r=e.x,i=e.width+e.x,n=e.y,o=e.height+e.y,s=t||this.worldTransform,a=s.a,h=s.b,u=s.c,c=s.d,p=s.tx,d=s.ty,f=a*i+u*o+p,v=c*o+h*i+d,g=a*r+u*o+p,m=c*o+h*r+d,y=a*r+u*n+p,x=c*n+h*r+d,b=a*i+u*n+p,_=c*n+h*i+d,T=f,E=v,S=f,A=v;S=S>g?g:S,S=S>y?y:S,S=S>b?b:S,A=A>m?m:A,A=A>x?x:A,A=A>_?_:A,T=g>T?g:T,T=y>T?y:T,T=b>T?b:T,E=m>E?m:E,E=x>E?x:E,E=_>E?_:E,this._bounds.x=S,this._bounds.width=T-S,this._bounds.y=A,this._bounds.height=E-A,this._currentBounds=this._bounds}return this._currentBounds},i.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,c);for(var e=this.graphicsData,r=0;r<e.length;r++){var i=e[r];if(i.fill&&i.shape&&i.shape.contains(c.x,c.y))return!0}return!1},i.prototype.updateLocalBounds=function(){var t=1/0,e=-(1/0),r=1/0,i=-(1/0);if(this.graphicsData.length)for(var n,o,s,a,h,l,c=0;c<this.graphicsData.length;c++){var p=this.graphicsData[c],d=p.type,f=p.lineWidth;if(n=p.shape,d===u.SHAPES.RECT||d===u.SHAPES.RREC)s=n.x-f/2,a=n.y-f/2,h=n.width+f,l=n.height+f,t=t>s?s:t,e=s+h>e?s+h:e,r=r>a?a:r,i=a+l>i?a+l:i;else if(d===u.SHAPES.CIRC)s=n.x,a=n.y,h=n.radius+f/2,l=n.radius+f/2,t=t>s-h?s-h:t,e=s+h>e?s+h:e,r=r>a-l?a-l:r,i=a+l>i?a+l:i;else if(d===u.SHAPES.ELIP)s=n.x,a=n.y,h=n.width+f/2,l=n.height+f/2,t=t>s-h?s-h:t,e=s+h>e?s+h:e,r=r>a-l?a-l:r,i=a+l>i?a+l:i;else{o=n.points;for(var v=0;v<o.length;v+=2)s=o[v],a=o[v+1],t=t>s-f?s-f:t,e=s+f>e?s+f:e,r=r>a-f?a-f:r,i=a+f>i?a+f:i}}else t=0,e=0,r=0,i=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=r-g,this._localBounds.height=i-r+2*g},i.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new h(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===u.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty=this.boundsDirty=!0,e},i.prototype.destroy=function(){n.prototype.destroy.apply(this,arguments);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();for(var e in this._webgl)for(var r=0;r<this._webgl[e].data.length;++r)this._webgl[e].data[r].destroy();this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":22,"../display/Container":23,"../math":32,"../renderers/canvas/utils/CanvasBuffer":44,"../renderers/canvas/utils/CanvasGraphics":45,"../textures/Texture":71,"./GraphicsData":26}],26:[function(t,e,r){function i(t,e,r,i,n,o,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=r,this._lineTint=e,this.fillColor=i,this.fillAlpha=n,this._fillTint=i,this.fill=o,this.shape=s,this.type=s.type}i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},i.prototype.destroy=function(){this.shape=null}},{}],27:[function(t,e,r){function i(t){a.call(this,t),this.graphicsDataPool=[],this.primitiveShader=null,this.complexPrimitiveShader=null,this.maximumSimplePolySize=200}var n=t("../../utils"),o=t("../../math"),s=t("../../const"),a=t("../../renderers/webgl/utils/ObjectRenderer"),h=t("../../renderers/webgl/WebGLRenderer"),l=t("./WebGLGraphicsData"),u=t("earcut");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,e.exports=i,h.registerPlugin("graphics",i),i.prototype.onContextChange=function(){},i.prototype.destroy=function(){a.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},i.prototype.render=function(t){var e,r=this.renderer,i=r.gl,o=r.shaderManager.plugins.primitiveShader;t.dirty&&this.updateGraphics(t,i);var s=t._webGL[i.id];r.blendModeManager.setBlendMode(t.blendMode);for(var a=0;a<s.data.length;a++)1===s.data[a].mode?(e=s.data[a],r.stencilManager.pushStencil(t,e,r),i.uniform1f(r.shaderManager.complexPrimitiveShader.uniforms.alpha._location,t.worldAlpha*e.alpha),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilManager.popStencil(t,e,r)):(e=s.data[a],o=r.shaderManager.primitiveShader,r.shaderManager.setShader(o),i.uniformMatrix3fv(o.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),i.uniformMatrix3fv(o.uniforms.projectionMatrix._location,!1,r.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(o.uniforms.tint._location,n.hex2rgb(t.tint)),i.uniform1f(o.uniforms.alpha._location,t.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.vertexAttribPointer(o.attributes.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(o.attributes.aColor,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,e.indices.length,i.UNSIGNED_SHORT,0))},i.prototype.updateGraphics=function(t){var e=this.renderer.gl,r=t._webGL[e.id];r||(r=t._webGL[e.id]={lastIndex:0,data:[],gl:e}),t.dirty=!1;var i;if(t.clearDirty){for(t.clearDirty=!1,i=0;i<r.data.length;i++){var n=r.data[i];n.reset(),this.graphicsDataPool.push(n)}r.data=[],r.lastIndex=0}var o;for(i=r.lastIndex;i<t.graphicsData.length;i++){var a=t.graphicsData[i];if(a.type===s.SHAPES.POLY){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1])&&a.points.push(a.points[0],a.points[1]),a.fill&&a.points.length>=6)if(a.points.length<2*this.maximumSimplePolySize){o=this.switchMode(r,0);var h=this.buildPoly(a,o);h||(o=this.switchMode(r,1),this.buildComplexPoly(a,o))}else o=this.switchMode(r,1),this.buildComplexPoly(a,o);a.lineWidth>0&&(o=this.switchMode(r,0),this.buildLine(a,o))}else o=this.switchMode(r,0),a.type===s.SHAPES.RECT?this.buildRectangle(a,o):a.type===s.SHAPES.CIRC||a.type===s.SHAPES.ELIP?this.buildCircle(a,o):a.type===s.SHAPES.RREC&&this.buildRoundedRectangle(a,o);r.lastIndex++}for(i=0;i<r.data.length;i++)o=r.data[i],o.dirty&&o.upload()},i.prototype.switchMode=function(t,e){var r;return t.data.length?(r=t.data[t.data.length-1],(r.points.length>32e4||r.mode!==e||1===e)&&(r=this.graphicsDataPool.pop()||new l(t.gl),r.mode=e,t.data.push(r))):(r=this.graphicsDataPool.pop()||new l(t.gl),r.mode=e,t.data.push(r)),r.dirty=!0,r},i.prototype.buildRectangle=function(t,e){var r=t.shape,i=r.x,o=r.y,s=r.width,a=r.height;if(t.fill){var h=n.hex2rgb(t.fillColor),l=t.fillAlpha,u=h[0]*l,c=h[1]*l,p=h[2]*l,d=e.points,f=e.indices,v=d.length/6;d.push(i,o),d.push(u,c,p,l),d.push(i+s,o),d.push(u,c,p,l),d.push(i,o+a),d.push(u,c,p,l),d.push(i+s,o+a),d.push(u,c,p,l),f.push(v,v,v+1,v+2,v+3,v+3)}if(t.lineWidth){var g=t.points;t.points=[i,o,i+s,o,i+s,o+a,i,o+a,i,o],this.buildLine(t,e),t.points=g}},i.prototype.buildRoundedRectangle=function(t,e){var r=t.shape,i=r.x,o=r.y,s=r.width,a=r.height,h=r.radius,l=[];if(l.push(i,o+h),this.quadraticBezierCurve(i,o+a-h,i,o+a,i+h,o+a,l),this.quadraticBezierCurve(i+s-h,o+a,i+s,o+a,i+s,o+a-h,l),this.quadraticBezierCurve(i+s,o+h,i+s,o,i+s-h,o,l),this.quadraticBezierCurve(i+h,o,i,o,i,o+h+1e-10,l),t.fill){var c=n.hex2rgb(t.fillColor),p=t.fillAlpha,d=c[0]*p,f=c[1]*p,v=c[2]*p,g=e.points,m=e.indices,y=g.length/6,x=u(l,null,2),b=0;for(b=0;b<x.length;b+=3)m.push(x[b]+y),m.push(x[b]+y),m.push(x[b+1]+y),m.push(x[b+2]+y),m.push(x[b+2]+y);for(b=0;b<l.length;b++)g.push(l[b],l[++b],d,f,v,p)}if(t.lineWidth){var _=t.points;t.points=l,this.buildLine(t,e),t.points=_}},i.prototype.quadraticBezierCurve=function(t,e,r,i,n,o,s){function a(t,e,r){var i=e-t;return t+i*r}for(var h,l,u,c,p,d,f=20,v=s||[],g=0,m=0;f>=m;m++)g=m/f,h=a(t,r,g),l=a(e,i,g),u=a(r,n,g),c=a(i,o,g),p=a(h,u,g),d=a(l,c,g),v.push(p,d);return v},i.prototype.buildCircle=function(t,e){var r,i,o=t.shape,a=o.x,h=o.y;t.type===s.SHAPES.CIRC?(r=o.radius,i=o.radius):(r=o.width,i=o.height);var l=40,u=2*Math.PI/l,c=0;if(t.fill){var p=n.hex2rgb(t.fillColor),d=t.fillAlpha,f=p[0]*d,v=p[1]*d,g=p[2]*d,m=e.points,y=e.indices,x=m.length/6;for(y.push(x),c=0;l+1>c;c++)m.push(a,h,f,v,g,d),m.push(a+Math.sin(u*c)*r,h+Math.cos(u*c)*i,f,v,g,d),y.push(x++,x++);y.push(x-1)}if(t.lineWidth){var b=t.points;for(t.points=[],c=0;l+1>c;c++)t.points.push(a+Math.sin(u*c)*r,h+Math.cos(u*c)*i);this.buildLine(t,e),t.points=b}},i.prototype.buildLine=function(t,e){var r=0,i=t.points;if(0!==i.length){if(t.lineWidth%2)for(r=0;r<i.length;r++)i[r]+=.5;var s=new o.Point(i[0],i[1]),a=new o.Point(i[i.length-2],i[i.length-1]);if(s.x===a.x&&s.y===a.y){i=i.slice(),i.pop(),i.pop(),a=new o.Point(i[i.length-2],i[i.length-1]);var h=a.x+.5*(s.x-a.x),l=a.y+.5*(s.y-a.y);i.unshift(h,l),i.push(h,l)}var u,c,p,d,f,v,g,m,y,x,b,_,T,E,S,A,w,C,M,R,D,F,P,O=e.points,B=e.indices,L=i.length/2,I=i.length,N=O.length/6,U=t.lineWidth/2,k=n.hex2rgb(t.lineColor),j=t.lineAlpha,X=k[0]*j,G=k[1]*j,Y=k[2]*j;for(p=i[0],d=i[1],f=i[2],v=i[3],y=-(d-v),x=p-f,P=Math.sqrt(y*y+x*x),y/=P,x/=P,y*=U,x*=U,O.push(p-y,d-x,X,G,Y,j),O.push(p+y,d+x,X,G,Y,j),r=1;L-1>r;r++)p=i[2*(r-1)],d=i[2*(r-1)+1],f=i[2*r],v=i[2*r+1],g=i[2*(r+1)],m=i[2*(r+1)+1],y=-(d-v),x=p-f,P=Math.sqrt(y*y+x*x),y/=P,x/=P,y*=U,x*=U,b=-(v-m),_=f-g,P=Math.sqrt(b*b+_*_),b/=P,_/=P,b*=U,_*=U,S=-x+d-(-x+v),A=-y+f-(-y+p),w=(-y+p)*(-x+v)-(-y+f)*(-x+d),C=-_+m-(-_+v),M=-b+f-(-b+g),R=(-b+g)*(-_+v)-(-b+f)*(-_+m),D=S*M-C*A,Math.abs(D)<.1?(D+=10.1,O.push(f-y,v-x,X,G,Y,j),O.push(f+y,v+x,X,G,Y,j)):(u=(A*R-M*w)/D,c=(C*w-S*R)/D,F=(u-f)*(u-f)+(c-v)+(c-v),F>19600?(T=y-b,E=x-_,P=Math.sqrt(T*T+E*E),T/=P,E/=P,T*=U,E*=U,O.push(f-T,v-E),O.push(X,G,Y,j),O.push(f+T,v+E),O.push(X,G,Y,j),O.push(f-T,v-E),O.push(X,G,Y,j),I++):(O.push(u,c),O.push(X,G,Y,j),O.push(f-(u-f),v-(c-v)),O.push(X,G,Y,j)));for(p=i[2*(L-2)],d=i[2*(L-2)+1],f=i[2*(L-1)],v=i[2*(L-1)+1],y=-(d-v),x=p-f,P=Math.sqrt(y*y+x*x),y/=P,x/=P,y*=U,x*=U,O.push(f-y,v-x),O.push(X,G,Y,j),O.push(f+y,v+x),O.push(X,G,Y,j),B.push(N),r=0;I>r;r++)B.push(N++);B.push(N-1)}},i.prototype.buildComplexPoly=function(t,e){var r=t.points.slice();if(!(r.length<6)){var i=e.indices;e.points=r,e.alpha=t.fillAlpha,e.color=n.hex2rgb(t.fillColor);for(var o,s,a=1/0,h=-(1/0),l=1/0,u=-(1/0),c=0;c<r.length;c+=2)o=r[c],s=r[c+1],a=a>o?o:a,h=o>h?o:h,l=l>s?s:l,u=s>u?s:u;r.push(a,l,h,l,h,u,a,u);var p=r.length/2;for(c=0;p>c;c++)i.push(c)}},i.prototype.buildPoly=function(t,e){var r=t.points;if(!(r.length<6)){var i=e.points,o=e.indices,s=r.length/2,a=n.hex2rgb(t.fillColor),h=t.fillAlpha,l=a[0]*h,c=a[1]*h,p=a[2]*h,d=u(r,null,2);if(!d)return!1;var f=i.length/6,v=0;for(v=0;v<d.length;v+=3)o.push(d[v]+f),o.push(d[v]+f),o.push(d[v+1]+f),o.push(d[v+2]+f),o.push(d[v+2]+f);for(v=0;s>v;v++)i.push(r[2*v],r[2*v+1],l,c,p,h);return!0}}},{"../../const":22,"../../math":32,"../../renderers/webgl/WebGLRenderer":48,"../../renderers/webgl/utils/ObjectRenderer":62,"../../utils":76,"./WebGLGraphicsData":28,earcut:10}],28:[function(t,e,r){function i(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0,this.glPoints=null,this.glIndices=null}i.prototype.constructor=i,e.exports=i,i.prototype.reset=function(){this.points.length=0,this.indices.length=0},i.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndices=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndices,t.STATIC_DRAW),this.dirty=!1},i.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.gl.deleteBuffer(this.buffer),this.gl.deleteBuffer(this.indexBuffer),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{}],29:[function(t,e,r){var i=e.exports=Object.assign(t("./const"),t("./math"),{utils:t("./utils"),ticker:t("./ticker"),DisplayObject:t("./display/DisplayObject"),Container:t("./display/Container"),Sprite:t("./sprites/Sprite"),ParticleContainer:t("./particles/ParticleContainer"),SpriteRenderer:t("./sprites/webgl/SpriteRenderer"),ParticleRenderer:t("./particles/webgl/ParticleRenderer"),Text:t("./text/Text"),Graphics:t("./graphics/Graphics"),GraphicsData:t("./graphics/GraphicsData"),GraphicsRenderer:t("./graphics/webgl/GraphicsRenderer"),Texture:t("./textures/Texture"),BaseTexture:t("./textures/BaseTexture"),RenderTexture:t("./textures/RenderTexture"),VideoBaseTexture:t("./textures/VideoBaseTexture"),TextureUvs:t("./textures/TextureUvs"),CanvasRenderer:t("./renderers/canvas/CanvasRenderer"),CanvasGraphics:t("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:t("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:t("./renderers/webgl/WebGLRenderer"),ShaderManager:t("./renderers/webgl/managers/ShaderManager"),Shader:t("./renderers/webgl/shaders/Shader"),ObjectRenderer:t("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:t("./renderers/webgl/utils/RenderTarget"),AbstractFilter:t("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:t("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:t("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(t,e,r,n){return t=t||800,e=e||600,!n&&i.utils.isWebGLSupported()?new i.WebGLRenderer(t,e,r):new i.CanvasRenderer(t,e,r)}})},{"./const":22,"./display/Container":23,"./display/DisplayObject":24,"./graphics/Graphics":25,"./graphics/GraphicsData":26,"./graphics/webgl/GraphicsRenderer":27,"./math":32,"./particles/ParticleContainer":38,"./particles/webgl/ParticleRenderer":40,"./renderers/canvas/CanvasRenderer":43,"./renderers/canvas/utils/CanvasBuffer":44,"./renderers/canvas/utils/CanvasGraphics":45,"./renderers/webgl/WebGLRenderer":48,"./renderers/webgl/filters/AbstractFilter":49,"./renderers/webgl/filters/FXAAFilter":50,"./renderers/webgl/filters/SpriteMaskFilter":51,"./renderers/webgl/managers/ShaderManager":55,"./renderers/webgl/shaders/Shader":60,"./renderers/webgl/utils/ObjectRenderer":62,"./renderers/webgl/utils/RenderTarget":64,"./sprites/Sprite":66,"./sprites/webgl/SpriteRenderer":67,"./text/Text":68,"./textures/BaseTexture":69,"./textures/RenderTexture":70,"./textures/Texture":71,"./textures/TextureUvs":72,"./textures/VideoBaseTexture":73,"./ticker":75,"./utils":76}],30:[function(t,e,r){function i(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}var n=t("./Point");i.prototype.constructor=i,e.exports=i,i.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},i.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},i.prototype.apply=function(t,e){e=e||new n;var r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e},i.prototype.applyInverse=function(t,e){e=e||new n;var r=1/(this.a*this.d+this.c*-this.b),i=t.x,o=t.y;return e.x=this.d*r*i+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e},i.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},i.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},i.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,o=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},i.prototype.append=function(t){var e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this},i.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},i.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,o=t*i-e*r;return this.a=i/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-i*n)/o,this.ty=-(t*this.ty-e*n)/o,this},i.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},i.prototype.clone=function(){var t=new i;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i.IDENTITY=new i,i.TEMP_MATRIX=new i},{"./Point":31}],31:[function(t,e,r){function i(t,e){this.x=t||0,this.y=e||0}i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.copy=function(t){this.set(t.x,t.y)},i.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},i.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)}},{}],32:[function(t,e,r){e.exports={Point:t("./Point"),Matrix:t("./Matrix"),Circle:t("./shapes/Circle"),Ellipse:t("./shapes/Ellipse"),Polygon:t("./shapes/Polygon"),Rectangle:t("./shapes/Rectangle"),RoundedRectangle:t("./shapes/RoundedRectangle")}},{"./Matrix":30,"./Point":31,"./shapes/Circle":33,"./shapes/Ellipse":34,"./shapes/Polygon":35,"./shapes/Rectangle":36,"./shapes/RoundedRectangle":37}],33:[function(t,e,r){function i(t,e,r){this.x=t||0,this.y=e||0,this.radius=r||0,this.type=o.SHAPES.CIRC}var n=t("./Rectangle"),o=t("../../const");i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.radius)},i.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.x-t,i=this.y-e,n=this.radius*this.radius;return r*=r,i*=i,n>=r+i},i.prototype.getBounds=function(){return new n(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":22,"./Rectangle":36}],34:[function(t,e,r){function i(t,e,r,i){this.x=t||0,this.y=e||0,this.width=r||0,this.height=i||0,this.type=o.SHAPES.ELIP}var n=t("./Rectangle"),o=t("../../const");i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,i=(e-this.y)/this.height;return r*=r,i*=i,1>=r+i},i.prototype.getBounds=function(){return new n(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":22,"./Rectangle":36}],35:[function(t,e,r){function i(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r]}if(e[0]instanceof n){for(var i=[],s=0,a=e.length;a>s;s++)i.push(e[s].x,e[s].y);e=i}this.closed=!0,this.points=e,this.type=o.SHAPES.POLY}var n=t("../Point"),o=t("../../const");i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.points.slice())},i.prototype.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,o=i-1;i>n;o=n++){var s=this.points[2*n],a=this.points[2*n+1],h=this.points[2*o],l=this.points[2*o+1],u=a>e!=l>e&&(h-s)*(e-a)/(l-a)+s>t;u&&(r=!r)}return r}},{"../../const":22,"../Point":31}],36:[function(t,e,r){function i(t,e,r,i){this.x=t||0,this.y=e||0,this.width=r||0,this.height=i||0,this.type=n.SHAPES.RECT}var n=t("../../const");i.prototype.constructor=i,e.exports=i,i.EMPTY=new i(0,0,0,0),i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height?!0:!1}},{"../../const":22}],37:[function(t,e,r){function i(t,e,r,i,o){this.x=t||0,this.y=e||0,this.width=r||0,this.height=i||0,this.radius=o||20,this.type=n.SHAPES.RREC}var n=t("../../const");i.prototype.constructor=i,e.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.radius)},i.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height?!0:!1}},{"../../const":22}],38:[function(t,e,r){function i(t,e){n.call(this),this._properties=[!1,!0,!1,!1,!1],this._size=t||15e3,this._buffers=null,this._updateStatic=!1,this.interactiveChildren=!1,this.blendMode=o.BLEND_MODES.NORMAL,this.roundPixels=!0,this.setProperties(e)}var n=t("../display/Container"),o=t("../const");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.setProperties=function(t){t&&(this._properties[0]="scale"in t?!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="alpha"in t?!!t.alpha:this._properties[4])},i.prototype.updateTransform=function(){
this.displayObjectUpdateTransform()},i.prototype.renderWebGL=function(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},i.prototype.addChildAt=function(t,e){if(t===this)return t;if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this._updateStatic=!0,t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},i.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,this.children.splice(t,1),this._updateStatic=!0,e},i.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,r=this.worldTransform,i=!0,n=0,o=0,s=0,a=0;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var h=0;h<this.children.length;++h){var l=this.children[h];if(l.visible){var u=l.texture.frame;if(e.globalAlpha=this.worldAlpha*l.alpha,l.rotation%(2*Math.PI)===0)i&&(e.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),i=!1),n=l.anchor.x*-u.width*l.scale.x+l.position.x+.5,o=l.anchor.y*-u.height*l.scale.y+l.position.y+.5,s=u.width*l.scale.x,a=u.height*l.scale.y;else{i||(i=!0),l.displayObjectUpdateTransform();var c=l.worldTransform;t.roundPixels?e.setTransform(c.a,c.b,c.c,c.d,0|c.tx,0|c.ty):e.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),n=l.anchor.x*-u.width+.5,o=l.anchor.y*-u.height+.5,s=u.width,a=u.height}e.drawImage(l.texture.baseTexture.source,u.x,u.y,u.width,u.height,n,o,s,a)}}}},i.prototype.destroy=function(){if(n.prototype.destroy.apply(this,arguments),this._buffers)for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._properties=null,this._buffers=null}},{"../const":22,"../display/Container":23}],39:[function(t,e,r){function i(t,e,r){this.gl=t,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<e.length;i++){var n=e[i];n.dynamic?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}i.prototype.constructor=i,e.exports=i,i.prototype.initBuffers=function(){var t,e,r=this.gl,i=0;for(this.dynamicStride=0,t=0;t<this.dynamicProperties.length;t++)e=this.dynamicProperties[t],e.offset=i,i+=e.size,this.dynamicStride+=e.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.dynamicBuffer),r.bufferData(r.ARRAY_BUFFER,this.dynamicData,r.DYNAMIC_DRAW);var n=0;for(this.staticStride=0,t=0;t<this.staticProperties.length;t++)e=this.staticProperties[t],e.offset=n,n+=e.size,this.staticStride+=e.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.staticBuffer),r.bufferData(r.ARRAY_BUFFER,this.staticData,r.DYNAMIC_DRAW)},i.prototype.uploadDynamic=function(t,e,r){for(var i=this.gl,n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(t,e,r,this.dynamicData,this.dynamicStride,o.offset)}i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.dynamicData)},i.prototype.uploadStatic=function(t,e,r){for(var i=this.gl,n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(t,e,r,this.staticData,this.staticStride,o.offset)}i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.staticData)},i.prototype.bind=function(){var t,e,r=this.gl;for(r.bindBuffer(r.ARRAY_BUFFER,this.dynamicBuffer),t=0;t<this.dynamicProperties.length;t++)e=this.dynamicProperties[t],r.vertexAttribPointer(e.attribute,e.size,r.FLOAT,!1,4*this.dynamicStride,4*e.offset);for(r.bindBuffer(r.ARRAY_BUFFER,this.staticBuffer),t=0;t<this.staticProperties.length;t++)e=this.staticProperties[t],r.vertexAttribPointer(e.attribute,e.size,r.FLOAT,!1,4*this.staticStride,4*e.offset)},i.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.gl.deleteBuffer(this.dynamicBuffer),this.staticProperties=null,this.staticData=null,this.gl.deleteBuffer(this.staticBuffer)}},{}],40:[function(t,e,r){function i(t){n.call(this,t),this.size=15e3;var e=6*this.size;this.indices=new Uint16Array(e);for(var r=0,i=0;e>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new h.Matrix}var n=t("../../renderers/webgl/utils/ObjectRenderer"),o=t("../../renderers/webgl/WebGLRenderer"),s=t("./ParticleShader"),a=t("./ParticleBuffer"),h=t("../../math");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,o.registerPlugin("particle",i),i.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=new s(this.renderer.shaderManager),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,dynamic:!1,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,dynamic:!0,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,dynamic:!1,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,dynamic:!1,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,dynamic:!1,size:1,uploadFunction:this.uploadAlpha,offset:0}]},i.prototype.start=function(){var t=this.renderer.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.shader;this.renderer.shaderManager.setShader(e)},i.prototype.render=function(t){var e=t.children,r=e.length,i=t._size;if(0!==r){r>i&&(r=i),t._buffers||(t._buffers=this.generateBuffers(t)),this.renderer.blendModeManager.setBlendMode(t.blendMode);var n=this.renderer.gl,o=t.worldTransform.copy(this.tempMatrix);o.prepend(this.renderer.currentRenderTarget.projectionMatrix),n.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,o.toArray(!0)),n.uniform1f(this.shader.uniforms.uAlpha._location,t.worldAlpha);var s=t._updateStatic,a=e[0]._texture.baseTexture;if(a._glTextures[n.id])n.bindTexture(n.TEXTURE_2D,a._glTextures[n.id]);else{if(!this.renderer.updateTexture(a))return;this.properties[0].dynamic&&this.properties[3].dynamic||(s=!0)}for(var h=0,l=0;r>l;l+=this.size){var u=r-l;u>this.size&&(u=this.size);var c=t._buffers[h++];c.uploadDynamic(e,l,u),s&&c.uploadStatic(e,l,u),c.bind(this.shader),n.drawElements(n.TRIANGLES,6*u,n.UNSIGNED_SHORT,0),this.renderer.drawCount++}t._updateStatic=!1}},i.prototype.generateBuffers=function(t){var e,r=this.renderer.gl,i=[],n=t._size;for(e=0;e<t._properties.length;e++)this.properties[e].dynamic=t._properties[e];for(e=0;n>e;e+=this.size)i.push(new a(r,this.properties,this.size,this.shader));return i},i.prototype.uploadVertices=function(t,e,r,i,n,o){for(var s,a,h,l,u,c,p,d,f,v=0;r>v;v++)s=t[e+v],a=s._texture,l=s.scale.x,u=s.scale.y,a.trim?(h=a.trim,p=h.x-s.anchor.x*h.width,c=p+a.crop.width,f=h.y-s.anchor.y*h.height,d=f+a.crop.height):(c=a._frame.width*(1-s.anchor.x),p=a._frame.width*-s.anchor.x,d=a._frame.height*(1-s.anchor.y),f=a._frame.height*-s.anchor.y),i[o]=p*l,i[o+1]=f*u,i[o+n]=c*l,i[o+n+1]=f*u,i[o+2*n]=c*l,i[o+2*n+1]=d*u,i[o+3*n]=p*l,i[o+3*n+1]=d*u,o+=4*n},i.prototype.uploadPosition=function(t,e,r,i,n,o){for(var s=0;r>s;s++){var a=t[e+s].position;i[o]=a.x,i[o+1]=a.y,i[o+n]=a.x,i[o+n+1]=a.y,i[o+2*n]=a.x,i[o+2*n+1]=a.y,i[o+3*n]=a.x,i[o+3*n+1]=a.y,o+=4*n}},i.prototype.uploadRotation=function(t,e,r,i,n,o){for(var s=0;r>s;s++){var a=t[e+s].rotation;i[o]=a,i[o+n]=a,i[o+2*n]=a,i[o+3*n]=a,o+=4*n}},i.prototype.uploadUvs=function(t,e,r,i,n,o){for(var s=0;r>s;s++){var a=t[e+s]._texture._uvs;a?(i[o]=a.x0,i[o+1]=a.y0,i[o+n]=a.x1,i[o+n+1]=a.y1,i[o+2*n]=a.x2,i[o+2*n+1]=a.y2,i[o+3*n]=a.x3,i[o+3*n+1]=a.y3,o+=4*n):(i[o]=0,i[o+1]=0,i[o+n]=0,i[o+n+1]=0,i[o+2*n]=0,i[o+2*n+1]=0,i[o+3*n]=0,i[o+3*n+1]=0,o+=4*n)}},i.prototype.uploadAlpha=function(t,e,r,i,n,o){for(var s=0;r>s;s++){var a=t[e+s].alpha;i[o]=a,i[o+n]=a,i[o+2*n]=a,i[o+3*n]=a,o+=4*n}},i.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),n.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../math":32,"../../renderers/webgl/WebGLRenderer":48,"../../renderers/webgl/utils/ObjectRenderer":62,"./ParticleBuffer":39,"./ParticleShader":41}],41:[function(t,e,r){function i(t){n.call(this,t,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var n=t("../../renderers/webgl/shaders/TextureShader");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},{"../../renderers/webgl/shaders/TextureShader":61}],42:[function(t,e,r){function i(t,e,r,i){if(a.call(this),n.sayHello(t),i)for(var h in s.DEFAULT_RENDER_OPTIONS)"undefined"==typeof i[h]&&(i[h]=s.DEFAULT_RENDER_OPTIONS[h]);else i=s.DEFAULT_RENDER_OPTIONS;this.type=s.RENDERER_TYPE.UNKNOWN,this.width=e||800,this.height=r||600,this.view=i.view||document.createElement("canvas"),this.resolution=i.resolution,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=i.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent={worldTransform:new o.Matrix,worldAlpha:1,children:[]},this._lastObjectRendered=this._tempDisplayObjectParent}var n=t("../utils"),o=t("../math"),s=t("../const"),a=t("eventemitter3");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=n.hex2string(t),n.hex2rgb(t,this._backgroundColorRgb)}}}),i.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},i.prototype.destroy=function(t){t&&this.view.parent&&this.view.parent.removeChild(this.view),this.type=s.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgb=null,this._backgroundColorString=null}},{"../const":22,"../math":32,"../utils":76,eventemitter3:11}],43:[function(t,e,r){function i(t,e,r){n.call(this,"Canvas",t,e,r),this.type=h.RENDERER_TYPE.CANVAS,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.maskManager=new o,this.roundPixels=!1,this.currentScaleMode=h.SCALE_MODES.DEFAULT,this.currentBlendMode=h.BLEND_MODES.NORMAL,this.smoothProperty="imageSmoothingEnabled",this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this._mapBlendModes(),this._tempDisplayObjectParent={worldTransform:new a.Matrix,worldAlpha:1},this.resize(t,e)}var n=t("../SystemRenderer"),o=t("./utils/CanvasMaskManager"),s=t("../../utils"),a=t("../../math"),h=t("../../const");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,s.pluginTarget.mixin(i),i.prototype.render=function(t){var e=t.parent;this._lastObjectRendered=t,t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=e,this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.currentBlendMode=h.BLEND_MODES.NORMAL,this.context.globalCompositeOperation=this.blendModes[h.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t,this.context)},i.prototype.destroy=function(t){this.destroyPlugins(),n.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.roundPixels=!1,this.currentScaleMode=0,this.currentBlendMode=0,this.smoothProperty=null},i.prototype.renderDisplayObject=function(t,e){var r=this.context;this.context=e,t.renderCanvas(this),this.context=r},i.prototype.resize=function(t,e){n.prototype.resize.call(this,t,e),this.currentScaleMode=h.SCALE_MODES.DEFAULT,this.smoothProperty&&(this.context[this.smoothProperty]=this.currentScaleMode===h.SCALE_MODES.LINEAR)},i.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},s.canUseNewCanvasBlendModes()?(this.blendModes[h.BLEND_MODES.NORMAL]="source-over",this.blendModes[h.BLEND_MODES.ADD]="lighter",this.blendModes[h.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[h.BLEND_MODES.SCREEN]="screen",this.blendModes[h.BLEND_MODES.OVERLAY]="overlay",this.blendModes[h.BLEND_MODES.DARKEN]="darken",this.blendModes[h.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[h.BLEND_MODES.COLOR_DODGE]="color-dodge",this.blendModes[h.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[h.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[h.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[h.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[h.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[h.BLEND_MODES.HUE]="hue",this.blendModes[h.BLEND_MODES.SATURATION]="saturate",this.blendModes[h.BLEND_MODES.COLOR]="color",this.blendModes[h.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[h.BLEND_MODES.NORMAL]="source-over",this.blendModes[h.BLEND_MODES.ADD]="lighter",this.blendModes[h.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[h.BLEND_MODES.SCREEN]="source-over",this.blendModes[h.BLEND_MODES.OVERLAY]="source-over",this.blendModes[h.BLEND_MODES.DARKEN]="source-over",this.blendModes[h.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[h.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[h.BLEND_MODES.COLOR_BURN]="source-over",this.blendModes[h.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[h.BLEND_MODES.SOFT_LIGHT]="source-over",this.blendModes[h.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[h.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[h.BLEND_MODES.HUE]="source-over",this.blendModes[h.BLEND_MODES.SATURATION]="source-over",this.blendModes[h.BLEND_MODES.COLOR]="source-over",this.blendModes[h.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":22,"../../math":32,"../../utils":76,"../SystemRenderer":42,"./utils/CanvasMaskManager":46}],44:[function(t,e,r){function i(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e}i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}}),i.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e},i.prototype.destroy=function(){this.context=null,this.canvas=null}},{}],45:[function(t,e,r){var i=t("../../../const"),n={};e.exports=n,n.renderGraphics=function(t,e){var r=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var n=0;n<t.graphicsData.length;n++){var o=t.graphicsData[n],s=o.shape,a=o._fillTint,h=o._lineTint;if(e.lineWidth=o.lineWidth,o.type===i.SHAPES.POLY){e.beginPath();var l=s.points;e.moveTo(l[0],l[1]);for(var u=1;u<l.length/2;u++)e.lineTo(l[2*u],l[2*u+1]);s.closed&&e.lineTo(l[0],l[1]),l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*r,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*r,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(o.type===i.SHAPES.RECT)(o.fillColor||0===o.fillColor)&&(e.globalAlpha=o.fillAlpha*r,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fillRect(s.x,s.y,s.width,s.height)),o.lineWidth&&(e.globalAlpha=o.lineAlpha*r,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.strokeRect(s.x,s.y,s.width,s.height));else if(o.type===i.SHAPES.CIRC)e.beginPath(),e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*r,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*r,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke());else if(o.type===i.SHAPES.ELIP){var c=2*s.width,p=2*s.height,d=s.x-c/2,f=s.y-p/2;e.beginPath();var v=.5522848,g=c/2*v,m=p/2*v,y=d+c,x=f+p,b=d+c/2,_=f+p/2;e.moveTo(d,_),e.bezierCurveTo(d,_-m,b-g,f,b,f),e.bezierCurveTo(b+g,f,y,_-m,y,_),e.bezierCurveTo(y,_+m,b+g,x,b,x),e.bezierCurveTo(b-g,x,d,_+m,d,_),e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*r,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*r,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(o.type===i.SHAPES.RREC){var T=s.x,E=s.y,S=s.width,A=s.height,w=s.radius,C=Math.min(S,A)/2|0;w=w>C?C:w,e.beginPath(),e.moveTo(T,E+w),e.lineTo(T,E+A-w),e.quadraticCurveTo(T,E+A,T+w,E+A),e.lineTo(T+S-w,E+A),e.quadraticCurveTo(T+S,E+A,T+S,E+A-w),e.lineTo(T+S,E+w),e.quadraticCurveTo(T+S,E,T+S-w,E),e.lineTo(T+w,E),e.quadraticCurveTo(T,E,T,E+w),e.closePath(),(o.fillColor||0===o.fillColor)&&(e.globalAlpha=o.fillAlpha*r,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*r,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}}},n.renderGraphicsMask=function(t,e){var r=t.graphicsData.length;if(0!==r){e.beginPath();for(var n=0;r>n;n++){var o=t.graphicsData[n],s=o.shape;if(o.type===i.SHAPES.POLY){var a=s.points;e.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)e.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(o.type===i.SHAPES.RECT)e.rect(s.x,s.y,s.width,s.height),e.closePath();else if(o.type===i.SHAPES.CIRC)e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath();else if(o.type===i.SHAPES.ELIP){var l=2*s.width,u=2*s.height,c=s.x-l/2,p=s.y-u/2,d=.5522848,f=l/2*d,v=u/2*d,g=c+l,m=p+u,y=c+l/2,x=p+u/2;e.moveTo(c,x),e.bezierCurveTo(c,x-v,y-f,p,y,p),e.bezierCurveTo(y+f,p,g,x-v,g,x),e.bezierCurveTo(g,x+v,y+f,m,y,m),e.bezierCurveTo(y-f,m,c,x+v,c,x),e.closePath()}else if(o.type===i.SHAPES.RREC){var b=s.x,_=s.y,T=s.width,E=s.height,S=s.radius,A=Math.min(T,E)/2|0;S=S>A?A:S,e.moveTo(b,_+S),e.lineTo(b,_+E-S),e.quadraticCurveTo(b,_+E,b+S,_+E),e.lineTo(b+T-S,_+E),e.quadraticCurveTo(b+T,_+E,b+T,_+E-S),e.lineTo(b+T,_+S),e.quadraticCurveTo(b+T,_,b+T-S,_),e.lineTo(b+S,_),e.quadraticCurveTo(b,_,b,_+S),e.closePath()}}}},n.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,r=(t.tint>>8&255)/255,i=(255&t.tint)/255,n=0;n<t.graphicsData.length;n++){var o=t.graphicsData[n],s=0|o.fillColor,a=0|o.lineColor;o._fillTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*r*255<<8)+(255&s)/255*i*255,o._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*i*255}}},{"../../../const":22}],46:[function(t,e,r){function i(){}var n=t("./CanvasGraphics");i.prototype.constructor=i,e.exports=i,i.prototype.pushMask=function(t,e){e.context.save();var r=t.alpha,i=t.worldTransform,o=e.resolution;e.context.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),t.texture||(n.renderGraphicsMask(t,e.context),e.context.clip()),t.worldAlpha=r},i.prototype.popMask=function(t){t.context.restore()},i.prototype.destroy=function(){}},{"./CanvasGraphics":45}],47:[function(t,e,r){var i=t("../../../utils"),n={};e.exports=n,n.getTintedTexture=function(t,e){var r=t.texture;e=n.roundColor(e);var i="#"+("00000"+(0|e).toString(16)).substr(-6);if(r.tintCache=r.tintCache||{},r.tintCache[i])return r.tintCache[i];var o=n.canvas||document.createElement("canvas");if(n.tintMethod(r,e,o),n.convertTintToImage){var s=new Image;s.src=o.toDataURL(),r.tintCache[i]=s}else r.tintCache[i]=o,n.canvas=null;return o},n.tintWithMultiply=function(t,e,r){var i=r.getContext("2d"),n=t.crop;r.width=n.width,r.height=n.height,i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,n.width,n.height),i.globalCompositeOperation="multiply",i.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.globalCompositeOperation="destination-atop",i.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},n.tintWithOverlay=function(t,e,r){var i=r.getContext("2d"),n=t.crop;r.width=n.width,r.height=n.height,i.globalCompositeOperation="copy",i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,n.width,n.height),i.globalCompositeOperation="destination-atop",i.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},n.tintWithPerPixel=function(t,e,r){var n=r.getContext("2d"),o=t.crop;r.width=o.width,r.height=o.height,n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);for(var s=i.hex2rgb(e),a=s[0],h=s[1],l=s[2],u=n.getImageData(0,0,o.width,o.height),c=u.data,p=0;p<c.length;p+=4)c[p+0]*=a,c[p+1]*=h,c[p+2]*=l;n.putImageData(u,0,0)},n.roundColor=function(t){var e=n.cacheStepsPerColorChannel,r=i.hex2rgb(t);return r[0]=Math.min(255,r[0]/e*e),r[1]=Math.min(255,r[1]/e*e),r[2]=Math.min(255,r[2]/e*e),i.rgb2hex(r)},n.cacheStepsPerColorChannel=8,n.convertTintToImage=!1,n.canUseMultiply=i.canUseNewCanvasBlendModes(),n.tintMethod=n.canUseMultiply?n.tintWithMultiply:n.tintWithPerPixel},{"../../../utils":76}],48:[function(t,e,r){function i(t,e,r){r=r||{},n.call(this,"WebGL",t,e,r),this.type=f.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!r.forceFXAA&&r.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new o(this),this.maskManager=new s(this),this.stencilManager=new a(this),this.filterManager=new h(this),this.blendModeManager=new l(this),this.currentRenderTarget=null,this.currentRenderer=new c(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._renderTargetStack=[]}var n=t("../SystemRenderer"),o=t("./managers/ShaderManager"),s=t("./managers/MaskManager"),a=t("./managers/StencilManager"),h=t("./managers/FilterManager"),l=t("./managers/BlendModeManager"),u=t("./utils/RenderTarget"),c=t("./utils/ObjectRenderer"),p=t("./filters/FXAAFilter"),d=t("../../utils"),f=t("../../const");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,d.pluginTarget.mixin(i),i.glContextId=0,i.prototype._createContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=i.glContextId++,t.id=this.glContextId,t.renderer=this},i.prototype._initContext=function(){var t=this.gl;t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.renderTarget=new u(t,this.width,this.height,null,this.resolution,!0),this.setRenderTarget(this.renderTarget),this.emit("context",t),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!t.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new p])},i.prototype.render=function(t){if(!this.gl.isContextLost()){this.drawCount=0,this._lastObjectRendered=t,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,t.filterArea=this.renderTarget.size,t.filters=this._FXAAFilter);var e=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=e;var r=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?r.clearColor(0,0,0,0):r.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),r.clear(r.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.renderTarget)}},i.prototype.renderDisplayObject=function(t,e,r){this.setRenderTarget(e),r&&e.clear(),this.filterManager.setFilterStack(e.filterStack),t.renderWebGL(this),this.currentRenderer.flush()},i.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},i.prototype.setRenderTarget=function(t){this.currentRenderTarget!==t&&(this.currentRenderTarget=t,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(t.stencilMaskStack))},i.prototype.resize=function(t,e){n.prototype.resize.call(this,t,e),this.filterManager.resize(t,e),this.renderTarget.resize(t,e),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},i.prototype.updateTexture=function(t){if(t=t.baseTexture||t,t.hasLoaded){var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture(),t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this)),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._glTextures[e.id]}},i.prototype.destroyTexture=function(t){t=t.baseTexture||t,t.hasLoaded&&t._glTextures[this.gl.id]&&this.gl.deleteTexture(t._glTextures[this.gl.id])},i.prototype.handleContextLost=function(t){t.preventDefault()},i.prototype.handleContextRestored=function(){this._initContext();for(var t in d.BaseTextureCache)d.BaseTextureCache[t]._glTextures.length=0},i.prototype.destroy=function(t){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),n.prototype.destroy.call(this,t),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.drawCount=0,this.gl=null},i.prototype._mapGlModes=function(){var t=this.gl;this.blendModes||(this.blendModes={},this.blendModes[f.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],this.blendModes[f.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SCREEN]=[t.SRC_ALPHA,t.ONE],this.blendModes[f.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[f.DRAW_MODES.POINTS]=t.POINTS,this.drawModes[f.DRAW_MODES.LINES]=t.LINES,this.drawModes[f.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,this.drawModes[f.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLES]=t.TRIANGLES,this.drawModes[f.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN)}},{"../../const":22,"../../utils":76,"../SystemRenderer":42,"./filters/FXAAFilter":50,"./managers/BlendModeManager":52,"./managers/FilterManager":53,"./managers/MaskManager":54,"./managers/ShaderManager":55,"./managers/StencilManager":56,"./utils/ObjectRenderer":62,"./utils/RenderTarget":64}],49:[function(t,e,r){function i(t,e,r){this.shaders=[],this.padding=0,this.uniforms=r||{},this.vertexSrc=t||n.defaultVertexSrc,this.fragmentSrc=e||n.defaultFragmentSrc}var n=t("../shaders/TextureShader");i.prototype.constructor=i,e.exports=i,i.prototype.getShader=function(t){var e=t.gl,r=this.shaders[e.id];return r||(r=new n(t.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[e.id]=r),r},i.prototype.applyFilter=function(t,e,r,i){var n=this.getShader(t);t.filterManager.applyFilter(n,e,r,i)},i.prototype.syncUniform=function(t){for(var e=0,r=this.shaders.length;r>e;++e)this.shaders[e].syncUniform(t)}},{"../shaders/TextureShader":61}],50:[function(t,e,r){function i(){n.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{
resolution:{type:"v2",value:{x:1,y:1}}})}var n=t("./AbstractFilter");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager,n=this.getShader(t);i.applyFilter(n,e,r)}},{"./AbstractFilter":49}],51:[function(t,e,r){function i(t){var e=new o.Matrix;n.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:t._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:e.toArray(!0)}}),this.maskSprite=t,this.maskMatrix=e}var n=t("./AbstractFilter"),o=t("../../../math");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager;this.uniforms.mask.value=this.maskSprite._texture,i.calculateMappedMatrix(e.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.alpha.value=this.maskSprite.worldAlpha;var n=this.getShader(t);i.applyFilter(n,e,r)},Object.defineProperties(i.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}},offset:{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}})},{"../../../math":32,"./AbstractFilter":49}],52:[function(t,e,r){function i(t){n.call(this,t),this.currentBlendMode=99999}var n=t("./WebGLManager");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(e[0],e[1]),!0}},{"./WebGLManager":57}],53:[function(t,e,r){function i(t){n.call(this,t),this.filterStack=[],this.filterStack.push({renderTarget:t.currentRenderTarget,filter:[],bounds:null}),this.texturePool=[],this.textureSize=new h.Rectangle(0,0,t.width,t.height),this.currentFrame=null}var n=t("./WebGLManager"),o=t("../utils/RenderTarget"),s=t("../../../const"),a=t("../utils/Quad"),h=t("../../../math");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.onContextChange=function(){this.texturePool.length=0;var t=this.renderer.gl;this.quad=new a(t)},i.prototype.setFilterStack=function(t){this.filterStack=t},i.prototype.pushFilter=function(t,e){var r=t.filterArea?t.filterArea.clone():t.getBounds();r.x=0|r.x,r.y=0|r.y,r.width=0|r.width,r.height=0|r.height;var i=0|e[0].padding;if(r.x-=i,r.y-=i,r.width+=2*i,r.height+=2*i,this.renderer.currentRenderTarget.transform){var n=this.renderer.currentRenderTarget.transform;r.x+=n.tx,r.y+=n.ty,this.capFilterArea(r),r.x-=n.tx,r.y-=n.ty}else this.capFilterArea(r);if(r.width>0&&r.height>0){this.currentFrame=r;var o=this.getRenderTarget();this.renderer.setRenderTarget(o),o.clear(),this.filterStack.push({renderTarget:o,filter:e})}else this.filterStack.push({renderTarget:null,filter:e})},i.prototype.popFilter=function(){var t=this.filterStack.pop(),e=this.filterStack[this.filterStack.length-1],r=t.renderTarget;if(t.renderTarget){var i=e.renderTarget,n=this.renderer.gl;this.currentFrame=r.frame,this.quad.map(this.textureSize,r.frame),n.bindBuffer(n.ARRAY_BUFFER,this.quad.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var o=t.filter;if(n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,n.FLOAT,!1,0,32),n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,n.FLOAT,!1,0,64),this.renderer.blendModeManager.setBlendMode(s.BLEND_MODES.NORMAL),1===o.length)o[0].uniforms.dimensions&&(o[0].uniforms.dimensions.value[0]=this.renderer.width,o[0].uniforms.dimensions.value[1]=this.renderer.height,o[0].uniforms.dimensions.value[2]=this.quad.vertices[0],o[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),o[0].applyFilter(this.renderer,r,i),this.returnRenderTarget(r);else{for(var a=r,h=this.getRenderTarget(!0),l=0;l<o.length-1;l++){var u=o[l];u.uniforms.dimensions&&(u.uniforms.dimensions.value[0]=this.renderer.width,u.uniforms.dimensions.value[1]=this.renderer.height,u.uniforms.dimensions.value[2]=this.quad.vertices[0],u.uniforms.dimensions.value[3]=this.quad.vertices[5]),u.applyFilter(this.renderer,a,h);var c=a;a=h,h=c}o[o.length-1].applyFilter(this.renderer,a,i),this.returnRenderTarget(a),this.returnRenderTarget(h)}return t.filter}},i.prototype.getRenderTarget=function(t){var e=this.texturePool.pop()||new o(this.renderer.gl,this.textureSize.width,this.textureSize.height,s.SCALE_MODES.LINEAR,this.renderer.resolution*s.FILTER_RESOLUTION);return e.frame=this.currentFrame,t&&e.clear(!0),e},i.prototype.returnRenderTarget=function(t){this.texturePool.push(t)},i.prototype.applyFilter=function(t,e,r,i){var n=this.renderer.gl;this.renderer.setRenderTarget(r),i&&r.clear(),this.renderer.shaderManager.setShader(t),t.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),t.syncUniforms(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)},i.prototype.calculateMappedMatrix=function(t,e,r){var i=e.worldTransform.copy(h.Matrix.TEMP_MATRIX),n=e._texture.baseTexture,o=r.identity(),s=this.textureSize.height/this.textureSize.width;o.translate(t.x/this.textureSize.width,t.y/this.textureSize.height),o.scale(1,s);var a=this.textureSize.width/n.width,l=this.textureSize.height/n.height;return i.tx/=n.width*a,i.ty/=n.width*a,i.invert(),o.prepend(i),o.scale(1,1/s),o.scale(a,l),o.translate(e.anchor.x,e.anchor.y),o},i.prototype.capFilterArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.textureSize.width&&(t.width=this.textureSize.width-t.x),t.y+t.height>this.textureSize.height&&(t.height=this.textureSize.height-t.y)},i.prototype.resize=function(t,e){this.textureSize.width=t,this.textureSize.height=e;for(var r=0;r<this.texturePool.length;r++)this.texturePool[r].resize(t,e)},i.prototype.destroy=function(){this.filterStack=null,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null}},{"../../../const":22,"../../../math":32,"../utils/Quad":63,"../utils/RenderTarget":64,"./WebGLManager":57}],54:[function(t,e,r){function i(t){n.call(this,t),this.stencilStack=[],this.reverse=!0,this.count=0,this.alphaMaskPool=[]}var n=t("./WebGLManager"),o=t("../filters/SpriteMaskFilter");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.pushMask=function(t,e){e.texture?this.pushSpriteMask(t,e):this.pushStencilMask(t,e)},i.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.popStencilMask(t,e)},i.prototype.pushSpriteMask=function(t,e){var r=this.alphaMaskPool.pop();r||(r=[new o(e)]),r[0].maskSprite=e,this.renderer.filterManager.pushFilter(t,r)},i.prototype.popSpriteMask=function(){var t=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(t)},i.prototype.pushStencilMask=function(t,e){this.renderer.stencilManager.pushMask(e)},i.prototype.popStencilMask=function(t,e){this.renderer.stencilManager.popMask(e)}},{"../filters/SpriteMaskFilter":51,"./WebGLManager":57}],55:[function(t,e,r){function i(t){n.call(this,t),this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.stack=[],this._currentId=-1,this.currentShader=null}var n=t("./WebGLManager"),o=t("../shaders/TextureShader"),s=t("../shaders/ComplexPrimitiveShader"),a=t("../shaders/PrimitiveShader"),h=t("../../../utils");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,h.pluginTarget.mixin(i),e.exports=i,i.prototype.onContextChange=function(){this.initPlugins();var t=this.renderer.gl;this.maxAttibs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.attribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.defaultShader=new o(this),this.primitiveShader=new a(this),this.complexPrimitiveShader=new s(this)},i.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(var r in t)this.tempAttribState[t[r]]=!0;var i=this.renderer.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.attribState[e]?i.enableVertexAttribArray(e):i.disableVertexAttribArray(e))},i.prototype.setShader=function(t){return this._currentId===t.uid?!1:(this._currentId=t.uid,this.currentShader=t,this.renderer.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},i.prototype.destroy=function(){n.prototype.destroy.call(this),this.destroyPlugins(),this.attribState=null,this.tempAttribState=null}},{"../../../utils":76,"../shaders/ComplexPrimitiveShader":58,"../shaders/PrimitiveShader":59,"../shaders/TextureShader":61,"./WebGLManager":57}],56:[function(t,e,r){function i(t){n.call(this,t),this.stencilMaskStack=null}var n=t("./WebGLManager"),o=t("../../../utils");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.stencilStack.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},i.prototype.pushStencil=function(t,e){this.renderer.currentRenderTarget.attachStencilBuffer();var r=this.renderer.gl,i=this.stencilMaskStack;this.bindGraphics(t,e,this.renderer),0===i.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),i.reverse=!0,i.count=0),i.stencilStack.push(e);var n=i.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===e.mode?(r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),i.reverse?(r.stencilFunc(r.EQUAL,255-n,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,n,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),i.reverse?r.stencilFunc(r.EQUAL,255-(n+1),255):r.stencilFunc(r.EQUAL,n+1,255),i.reverse=!i.reverse):(i.reverse?(r.stencilFunc(r.EQUAL,n,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-n,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),i.reverse?r.stencilFunc(r.EQUAL,n+1,255):r.stencilFunc(r.EQUAL,255-(n+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),i.count++},i.prototype.bindGraphics=function(t,e){this._currentGraphics=t;var r,i=this.renderer.gl;1===e.mode?(r=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(r),i.uniformMatrix3fv(r.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),i.uniformMatrix3fv(r.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(r.uniforms.tint._location,o.hex2rgb(t.tint)),i.uniform3fv(r.uniforms.color._location,e.color),i.uniform1f(r.uniforms.alpha._location,t.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.vertexAttribPointer(r.attributes.aVertexPosition,2,i.FLOAT,!1,8,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(r=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(r),i.uniformMatrix3fv(r.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),i.uniformMatrix3fv(r.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(r.uniforms.tint._location,o.hex2rgb(t.tint)),i.uniform1f(r.uniforms.alpha._location,t.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.vertexAttribPointer(r.attributes.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(r.attributes.aColor,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},i.prototype.popStencil=function(t,e){var r=this.renderer.gl,i=this.stencilMaskStack;if(i.stencilStack.pop(),i.count--,0===i.stencilStack.length)r.disable(r.STENCIL_TEST);else{var n=i.count;this.bindGraphics(t,e,this.renderer),r.colorMask(!1,!1,!1,!1),1===e.mode?(i.reverse=!i.reverse,i.reverse?(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),i.reverse?r.stencilFunc(r.EQUAL,n,255):r.stencilFunc(r.EQUAL,255-n,255)):(i.reverse?(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),i.reverse?r.stencilFunc(r.EQUAL,n,255):r.stencilFunc(r.EQUAL,255-n,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},i.prototype.destroy=function(){n.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},i.prototype.pushMask=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),t.dirty&&this.renderer.plugins.graphics.updateGraphics(t,this.renderer.gl),t._webGL[this.renderer.gl.id].data.length&&this.pushStencil(t,t._webGL[this.renderer.gl.id].data[0],this.renderer)},i.prototype.popMask=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.popStencil(t,t._webGL[this.renderer.gl.id].data[0],this.renderer)}},{"../../../utils":76,"./WebGLManager":57}],57:[function(t,e,r){function i(t){this.renderer=t,this.renderer.on("context",this.onContextChange,this)}i.prototype.constructor=i,e.exports=i,i.prototype.onContextChange=function(){},i.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],58:[function(t,e,r){function i(t){n.call(this,t,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var n=t("./Shader");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},{"./Shader":60}],59:[function(t,e,r){function i(t){n.call(this,t,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var n=t("./Shader");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},{"./Shader":60}],60:[function(t,e,r){function i(t,e,r,i,o){if(!e||!r)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=n.uid(),this.gl=t.renderer.gl,this.shaderManager=t,this.program=null,this.uniforms=i||{},this.attributes=o||{},this.textureCount=1,this.vertexSrc=e,this.fragmentSrc=r,this.init()}var n=t("../../../utils");i.prototype.constructor=i,e.exports=i,i.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},i.prototype.cacheUniformLocations=function(t){for(var e=0;e<t.length;++e)this.uniforms[t[e]]._location=this.gl.getUniformLocation(this.program,t[e])},i.prototype.cacheAttributeLocations=function(t){for(var e=0;e<t.length;++e)this.attributes[t[e]]=this.gl.getAttribLocation(this.program,t[e])},i.prototype.compile=function(){var t=this.gl,e=this._glCompile(t.VERTEX_SHADER,this.vertexSrc),r=this._glCompile(t.FRAGMENT_SHADER,this.fragmentSrc),i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(i,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(i)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(i)),t.deleteProgram(i),i=null),t.deleteShader(e),t.deleteShader(r),this.program=i},i.prototype.syncUniform=function(t){var e,r,i=t._location,o=t.value,s=this.gl;switch(t.type){case"b":case"bool":case"boolean":s.uniform1i(i,o?1:0);break;case"i":case"1i":s.uniform1i(i,o);break;case"f":case"1f":s.uniform1f(i,o);break;case"2f":s.uniform2f(i,o[0],o[1]);break;case"3f":s.uniform3f(i,o[0],o[1],o[2]);break;case"4f":s.uniform4f(i,o[0],o[1],o[2],o[3]);break;case"v2":s.uniform2f(i,o.x,o.y);break;case"v3":s.uniform3f(i,o.x,o.y,o.z);break;case"v4":s.uniform4f(i,o.x,o.y,o.z,o.w);break;case"1iv":s.uniform1iv(i,o);break;case"2iv":s.uniform2iv(i,o);break;case"3iv":s.uniform3iv(i,o);break;case"4iv":s.uniform4iv(i,o);break;case"1fv":s.uniform1fv(i,o);break;case"2fv":s.uniform2fv(i,o);break;case"3fv":s.uniform3fv(i,o);break;case"4fv":s.uniform4fv(i,o);break;case"m2":case"mat2":case"Matrix2fv":s.uniformMatrix2fv(i,t.transpose,o);break;case"m3":case"mat3":case"Matrix3fv":s.uniformMatrix3fv(i,t.transpose,o);break;case"m4":case"mat4":case"Matrix4fv":s.uniformMatrix4fv(i,t.transpose,o);break;case"c":"number"==typeof o&&(o=n.hex2rgb(o)),s.uniform3f(i,o[0],o[1],o[2]);break;case"iv1":s.uniform1iv(i,o);break;case"iv":s.uniform3iv(i,o);break;case"fv1":s.uniform1fv(i,o);break;case"fv":s.uniform3fv(i,o);break;case"v2v":for(t._array||(t._array=new Float32Array(2*o.length)),e=0,r=o.length;r>e;++e)t._array[2*e]=o[e].x,t._array[2*e+1]=o[e].y;s.uniform2fv(i,t._array);break;case"v3v":for(t._array||(t._array=new Float32Array(3*o.length)),e=0,r=o.length;r>e;++e)t._array[3*e]=o[e].x,t._array[3*e+1]=o[e].y,t._array[3*e+2]=o[e].z;s.uniform3fv(i,t._array);break;case"v4v":for(t._array||(t._array=new Float32Array(4*o.length)),e=0,r=o.length;r>e;++e)t._array[4*e]=o[e].x,t._array[4*e+1]=o[e].y,t._array[4*e+2]=o[e].z,t._array[4*e+3]=o[e].w;s.uniform4fv(i,t._array);break;case"t":case"sampler2D":if(!t.value||!t.value.baseTexture.hasLoaded)break;s.activeTexture(s["TEXTURE"+this.textureCount]);var a=t.value.baseTexture._glTextures[s.id];a||(this.initSampler2D(t),a=t.value.baseTexture._glTextures[s.id]),s.bindTexture(s.TEXTURE_2D,a),s.uniform1i(t._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+t.type)}},i.prototype.syncUniforms=function(){this.textureCount=1;for(var t in this.uniforms)this.syncUniform(this.uniforms[t])},i.prototype.initSampler2D=function(t){var e=this.gl,r=t.value.baseTexture;if(r.hasLoaded)if(t.textureData){var i=t.textureData;r._glTextures[e.id]=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,i.luminance?e.LUMINANCE:e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.magFilter?i.magFilter:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.wrapS?i.wrapS:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.wrapS?i.wrapS:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.wrapT?i.wrapT:e.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(r)},i.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},i.prototype._glCompile=function(t,e){var r=this.gl.createShader(t);return this.gl.shaderSource(r,e),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(console.log(this.gl.getShaderInfoLog(r)),null)}},{"../../../utils":76}],61:[function(t,e,r){function i(t,e,r,o,s){var a={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(o)for(var h in o)a[h]=o[h];var l={aVertexPosition:0,aTextureCoord:0,aColor:0};if(s)for(var u in s)l[u]=s[u];e=e||i.defaultVertexSrc,r=r||i.defaultFragmentSrc,n.call(this,t,e,r,a,l)}var n=t("./Shader");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),i.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":60}],62:[function(t,e,r){function i(t){n.call(this,t)}var n=t("../managers/WebGLManager");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.start=function(){},i.prototype.stop=function(){this.flush()},i.prototype.flush=function(){},i.prototype.render=function(t){}},{"../managers/WebGLManager":57}],63:[function(t,e,r){function i(t){this.gl=t,this.vertices=new Float32Array([0,0,200,0,200,200,0,200]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.indices=new Uint16Array([0,1,2,0,3,2]),this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,128,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.upload()}i.prototype.constructor=i,i.prototype.map=function(t,e){var r=0,i=0;this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.upload()},i.prototype.upload=function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices),t.bufferSubData(t.ARRAY_BUFFER,32,this.uvs),t.bufferSubData(t.ARRAY_BUFFER,64,this.colors)},e.exports=i},{}],64:[function(t,e,r){var i=t("../../../math"),n=t("../../../utils"),o=t("../../../const"),s=t("./StencilMaskStack"),a=function(t,e,r,a,h,l){if(this.gl=t,this.frameBuffer=null,this.texture=null,this.size=new i.Rectangle(0,0,1,1),this.resolution=h||o.RESOLUTION,this.projectionMatrix=new i.Matrix,this.transform=null,this.frame=null,this.stencilBuffer=null,this.stencilMaskStack=new s,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.scaleMode=a||o.SCALE_MODES.DEFAULT,this.root=l,!this.root){this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a===o.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,a===o.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST);var u=n.isPowerOfTwo(e,r);u?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}this.resize(e,r)};a.prototype.constructor=a,e.exports=a,a.prototype.clear=function(t){var e=this.gl;t&&e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},a.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var t=this.gl;this.stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencilBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}},a.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);var e=this.frame||this.size;this.calculateProjection(e),this.transform&&this.projectionMatrix.append(this.transform),t.viewport(0,0,e.width*this.resolution,e.height*this.resolution)},a.prototype.calculateProjection=function(t){var e=this.projectionMatrix;e.identity(),this.root?(e.a=1/t.width*2,e.d=-1/t.height*2,e.tx=-1-t.x*e.a,e.ty=1-t.y*e.d):(e.a=1/t.width*2,e.d=1/t.height*2,e.tx=-1-t.x*e.a,e.ty=-1-t.y*e.d)},a.prototype.resize=function(t,e){if(t=0|t,e=0|e,this.size.width!==t||this.size.height!==e){if(this.size.width=t,this.size.height=e,!this.root){var r=this.gl;r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t*this.resolution,e*this.resolution,0,r.RGBA,r.UNSIGNED_BYTE,null),this.stencilBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,this.stencilBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t*this.resolution,e*this.resolution))}var i=this.frame||this.size;this.calculateProjection(i)}},a.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null}},{"../../../const":22,"../../../math":32,"../../../utils":76,"./StencilMaskStack":65}],65:[function(t,e,r){function i(){this.stencilStack=[],this.reverse=!0,this.count=0}i.prototype.constructor=i,e.exports=i},{}],66:[function(t,e,r){function i(t){s.call(this),this.anchor=new n.Point,this._texture=null,this._width=0,this._height=0,this.tint=16777215,this.blendMode=l.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=t||o.EMPTY}var n=t("../math"),o=t("../textures/Texture"),s=t("../display/Container"),a=t("../renderers/canvas/utils/CanvasTinter"),h=t("../utils"),l=t("../const"),u=new n.Point;i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this.scale.x*this.texture._frame.width},set:function(t){this.scale.x=t/this.texture._frame.width,this._width=t}},height:{get:function(){return this.scale.y*this.texture._frame.height},set:function(t){this.scale.y=t/this.texture._frame.height,this._height=t}},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}}),i.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},i.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this)},i.prototype.getBounds=function(t){if(!this._currentBounds){var e,r,i,n,o=this._texture._frame.width,s=this._texture._frame.height,a=o*(1-this.anchor.x),h=o*-this.anchor.x,l=s*(1-this.anchor.y),u=s*-this.anchor.y,c=t||this.worldTransform,p=c.a,d=c.b,f=c.c,v=c.d,g=c.tx,m=c.ty;if(0===d&&0===f)0>p&&(p*=-1),0>v&&(v*=-1),e=p*h+g,r=p*a+g,i=v*u+m,n=v*l+m;else{var y=p*h+f*u+g,x=v*u+d*h+m,b=p*a+f*u+g,_=v*u+d*a+m,T=p*a+f*l+g,E=v*l+d*a+m,S=p*h+f*l+g,A=v*l+d*h+m;e=y,e=e>b?b:e,e=e>T?T:e,e=e>S?S:e,i=x,i=i>_?_:i,i=i>E?E:i,i=i>A?A:i,r=y,r=b>r?b:r,r=T>r?T:r,r=S>r?S:r,n=x,n=_>n?_:n,n=E>n?E:n,n=A>n?A:n}if(this.children.length){var w=this.containerGetBounds();a=w.x,h=w.x+w.width,l=w.y,u=w.y+w.height,e=a>e?e:a,i=l>i?i:l,r=r>h?r:h,n=n>u?n:u}var C=this._bounds;C.x=e,C.width=r-e,C.y=i,C.height=n-i,this._currentBounds=C}return this._currentBounds},i.prototype.getLocalBounds=function(){return this._bounds.x=-this._texture._frame.width*this.anchor.x,this._bounds.y=-this._texture._frame.height*this.anchor.y,this._bounds.width=this._texture._frame.width,this._bounds.height=this._texture._frame.height,this._bounds},i.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,u);var e,r=this._texture._frame.width,i=this._texture._frame.height,n=-r*this.anchor.x;return u.x>n&&u.x<n+r&&(e=-i*this.anchor.y,u.y>e&&u.y<e+i)?!0:!1},i.prototype._renderCanvas=function(t){if(!(this.texture.crop.width<=0||this.texture.crop.height<=0)&&(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=t.blendModes[t.currentBlendMode]),this.texture.valid)){var e,r,i,n,o=this._texture,s=this.worldTransform;if(t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.currentScaleMode!==o.baseTexture.scaleMode&&(t.currentScaleMode=o.baseTexture.scaleMode,t.context[t.smoothProperty]=t.currentScaleMode===l.SCALE_MODES.LINEAR),o.rotate){var h=s.a,u=s.b;s.a=-s.c,s.b=-s.d,s.c=h,s.d=u,i=o.crop.height,n=o.crop.width,e=o.trim?o.trim.y-this.anchor.y*o.trim.height:this.anchor.y*-o._frame.height,r=o.trim?o.trim.x-this.anchor.x*o.trim.width:this.anchor.x*-o._frame.width}else i=o.crop.width,n=o.crop.height,e=o.trim?o.trim.x-this.anchor.x*o.trim.width:this.anchor.x*-o._frame.width,r=o.trim?o.trim.y-this.anchor.y*o.trim.height:this.anchor.y*-o._frame.height;t.roundPixels?(t.context.setTransform(s.a,s.b,s.c,s.d,s.tx*t.resolution|0,s.ty*t.resolution|0),e=0|e,r=0|r):t.context.setTransform(s.a,s.b,s.c,s.d,s.tx*t.resolution,s.ty*t.resolution);var c=o.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=a.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,i*c,n*c,e*t.resolution,r*t.resolution,i*t.resolution,n*t.resolution)):t.context.drawImage(o.baseTexture.source,o.crop.x*c,o.crop.y*c,i*c,n*c,e*t.resolution,r*t.resolution,i*t.resolution,n*t.resolution)}},i.prototype.destroy=function(t,e){s.prototype.destroy.call(this),this.anchor=null,t&&this._texture.destroy(e),this._texture=null,this.shader=null},i.fromFrame=function(t){var e=h.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');

return new i(e)},i.fromImage=function(t,e,r){return new i(o.fromImage(t,e,r))}},{"../const":22,"../display/Container":23,"../math":32,"../renderers/canvas/utils/CanvasTinter":47,"../textures/Texture":71,"../utils":76}],67:[function(t,e,r){function i(t){n.call(this,t),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=s.SPRITE_BATCH_SIZE;var e=4*this.size*this.vertByteSize,r=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(r);for(var i=0,o=0;r>i;i+=6,o+=4)this.indices[i+0]=o+0,this.indices[i+1]=o+1,this.indices[i+2]=o+2,this.indices[i+3]=o+0,this.indices[i+4]=o+2,this.indices[i+5]=o+3;this.currentBatchSize=0,this.sprites=[],this.shader=null}var n=t("../../renderers/webgl/utils/ObjectRenderer"),o=t("../../renderers/webgl/WebGLRenderer"),s=t("../../const");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,o.registerPlugin("sprite",i),i.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999},i.prototype.render=function(t){var e=t._texture;this.currentBatchSize>=this.size&&this.flush();var r=e._uvs;if(r){var i,n,o,s,a=t.anchor.x,h=t.anchor.y;if(e.trim){var l=e.trim;n=l.x-a*l.width,i=n+e.crop.width,s=l.y-h*l.height,o=s+e.crop.height}else i=e._frame.width*(1-a),n=e._frame.width*-a,o=e._frame.height*(1-h),s=e._frame.height*-h;var u=this.currentBatchSize*this.vertByteSize,c=t.worldTransform,p=c.a,d=c.b,f=c.c,v=c.d,g=c.tx,m=c.ty,y=this.colors,x=this.positions;this.renderer.roundPixels?(x[u]=p*n+f*s+g|0,x[u+1]=v*s+d*n+m|0,x[u+5]=p*i+f*s+g|0,x[u+6]=v*s+d*i+m|0,x[u+10]=p*i+f*o+g|0,x[u+11]=v*o+d*i+m|0,x[u+15]=p*n+f*o+g|0,x[u+16]=v*o+d*n+m|0):(x[u]=p*n+f*s+g,x[u+1]=v*s+d*n+m,x[u+5]=p*i+f*s+g,x[u+6]=v*s+d*i+m,x[u+10]=p*i+f*o+g,x[u+11]=v*o+d*i+m,x[u+15]=p*n+f*o+g,x[u+16]=v*o+d*n+m),x[u+2]=r.x0,x[u+3]=r.y0,x[u+7]=r.x1,x[u+8]=r.y1,x[u+12]=r.x2,x[u+13]=r.y2,x[u+17]=r.x3,x[u+18]=r.y3;var b=t.tint;y[u+4]=y[u+9]=y[u+14]=y[u+19]=(b>>16)+(65280&b)+((255&b)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},i.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e=this.renderer.gl;if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var r=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);e.bufferSubData(e.ARRAY_BUFFER,0,r)}for(var i,n,o,s,a=0,h=0,l=null,u=this.renderer.blendModeManager.currentBlendMode,c=null,p=!1,d=!1,f=0,v=this.currentBatchSize;v>f;f++)s=this.sprites[f],i=s._texture.baseTexture,n=s.blendMode,o=s.shader||this.shader,p=u!==n,d=c!==o,(l!==i||p||d)&&(this.renderBatch(l,a,h),h=f,a=0,l=i,p&&(u=n,this.renderer.blendModeManager.setBlendMode(u)),d&&(c=o,t=c.shaders?c.shaders[e.id]:c,t||(t=c.getShader(this.renderer)),this.renderer.shaderManager.setShader(t),t.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),t.syncUniforms(),e.activeTexture(e.TEXTURE0))),a++;this.renderBatch(l,a,h),this.currentBatchSize=0}},i.prototype.renderBatch=function(t,e,r){if(0!==e){var i=this.renderer.gl;t._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]):this.renderer.updateTexture(t),i.drawElements(i.TRIANGLES,6*e,i.UNSIGNED_SHORT,6*r*2),this.renderer.drawCount++}},i.prototype.start=function(){var t=this.renderer.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.vertByteSize;t.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.shader.attributes.aColor,4,t.UNSIGNED_BYTE,!0,e,16)},i.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer),this.renderer.gl.deleteBuffer(this.indexBuffer),this.shader.destroy(),this.renderer=null,this.vertices=null,this.positions=null,this.colors=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.sprites=null,this.shader=null}},{"../../const":22,"../../renderers/webgl/WebGLRenderer":48,"../../renderers/webgl/utils/ObjectRenderer":62}],68:[function(t,e,r){function i(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||h.RESOLUTION,this._text=null,this._style=null;var i=o.fromCanvas(this.canvas);i.trim=new s.Rectangle,n.call(this,i),this.text=t,this.style=e}var n=t("../sprites/Sprite"),o=t("../textures/Texture"),s=t("../math"),a=t("../utils"),h=t("../const");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.fontPropertiesCache={},i.fontPropertiesCanvas=document.createElement("canvas"),i.fontPropertiesContext=i.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(i.prototype,{width:{get:function(){return this.dirty&&this.updateText(),this.scale.x*this._texture._frame.width},set:function(t){this.scale.x=t/this._texture._frame.width,this._width=t}},height:{get:function(){return this.dirty&&this.updateText(),this.scale.y*this._texture._frame.height},set:function(t){this.scale.y=t/this._texture._frame.height,this._height=t}},style:{get:function(){return this._style},set:function(t){t=t||{},"number"==typeof t.fill&&(t.fill=a.hex2string(t.fill)),"number"==typeof t.stroke&&(t.stroke=a.hex2string(t.stroke)),"number"==typeof t.dropShadowColor&&(t.dropShadowColor=a.hex2string(t.dropShadowColor)),t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowColor=t.dropShadowColor||"#000000",t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||5,t.padding=t.padding||0,t.textBaseline=t.textBaseline||"alphabetic",t.lineJoin=t.lineJoin||"miter",t.miterLimit=t.miterLimit||10,this._style=t,this.dirty=!0}},text:{get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}}}),i.prototype.updateText=function(){var t=this._style;this.context.font=t.font;for(var e=t.wordWrap?this.wordWrap(this._text):this._text,r=e.split(/(?:\r\n|\r|\n)/),i=new Array(r.length),n=0,o=this.determineFontProperties(t.font),s=0;s<r.length;s++){var a=this.context.measureText(r[s]).width;i[s]=a,n=Math.max(n,a)}var h=n+t.strokeThickness;t.dropShadow&&(h+=t.dropShadowDistance),this.canvas.width=(h+this.context.lineWidth)*this.resolution;var l=this.style.lineHeight||o.fontSize+t.strokeThickness,u=l*r.length;t.dropShadow&&(u+=t.dropShadowDistance),this.canvas.height=(u+2*this._style.padding)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=t.font,this.context.strokeStyle=t.stroke,this.context.lineWidth=t.strokeThickness,this.context.textBaseline=t.textBaseline,this.context.lineJoin=t.lineJoin,this.context.miterLimit=t.miterLimit;var c,p;if(t.dropShadow){this.context.fillStyle=t.dropShadowColor;var d=Math.cos(t.dropShadowAngle)*t.dropShadowDistance,f=Math.sin(t.dropShadowAngle)*t.dropShadowDistance;for(s=0;s<r.length;s++)c=t.strokeThickness/2,p=t.strokeThickness/2+s*l+o.ascent,"right"===t.align?c+=n-i[s]:"center"===t.align&&(c+=(n-i[s])/2),t.fill&&this.context.fillText(r[s],c+d,p+f+this._style.padding)}for(this.context.fillStyle=t.fill,s=0;s<r.length;s++)c=t.strokeThickness/2,p=t.strokeThickness/2+s*l+o.ascent,"right"===t.align?c+=n-i[s]:"center"===t.align&&(c+=(n-i[s])/2),t.stroke&&t.strokeThickness&&this.context.strokeText(r[s],c,p+this._style.padding),t.fill&&this.context.fillText(r[s],c,p+this._style.padding);this.updateTexture()},i.prototype.updateTexture=function(){var t=this._texture;t.baseTexture.hasLoaded=!0,t.baseTexture.resolution=this.resolution,t.baseTexture.width=this.canvas.width/this.resolution,t.baseTexture.height=this.canvas.height/this.resolution,t.crop.width=t._frame.width=this.canvas.width/this.resolution,t.crop.height=t._frame.height=this.canvas.height/this.resolution,t.trim.x=0,t.trim.y=-this._style.padding,t.trim.width=t._frame.width,t.trim.height=t._frame.height-2*this._style.padding,this._width=this.canvas.width/this.resolution,this._height=this.canvas.height/this.resolution,t.baseTexture.emit("update",t.baseTexture),this.dirty=!1},i.prototype.renderWebGL=function(t){this.dirty&&this.updateText(),n.prototype.renderWebGL.call(this,t)},i.prototype._renderCanvas=function(t){this.dirty&&this.updateText(),n.prototype._renderCanvas.call(this,t)},i.prototype.determineFontProperties=function(t){var e=i.fontPropertiesCache[t];if(!e){e={};var r=i.fontPropertiesCanvas,n=i.fontPropertiesContext;n.font=t;var o=Math.ceil(n.measureText("|Mq").width),s=Math.ceil(n.measureText("M").width),a=2*s;s=1.4*s|0,r.width=o,r.height=a,n.fillStyle="#f00",n.fillRect(0,0,o,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|Mq",0,s);var h,l,u=n.getImageData(0,0,o,a).data,c=u.length,p=4*o,d=0,f=!1;for(h=0;s>h;h++){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d+=p}for(e.ascent=s-h,d=c-p,f=!1,h=a;h>s;h--){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d-=p}e.descent=h-s,e.fontSize=e.ascent+e.descent,i.fontPropertiesCache[t]=e}return e},i.prototype.wordWrap=function(t){for(var e="",r=t.split("\n"),i=this._style.wordWrapWidth,n=0;n<r.length;n++){for(var o=i,s=r[n].split(" "),a=0;a<s.length;a++){var h=this.context.measureText(s[a]).width,l=h+this.context.measureText(" ").width;0===a||l>o?(a>0&&(e+="\n"),e+=s[a],o=i-h):(o-=l,e+=" "+s[a])}n<r.length-1&&(e+="\n")}return e},i.prototype.getBounds=function(t){return this.dirty&&this.updateText(),n.prototype.getBounds.call(this,t)},i.prototype.destroy=function(t){this.context=null,this.canvas=null,this._style=null,this._texture.destroy(void 0===t?!0:t)}},{"../const":22,"../math":32,"../sprites/Sprite":66,"../textures/Texture":71,"../utils":76}],69:[function(t,e,r){function i(t,e,r){s.call(this),this.uid=n.uid(),this.resolution=r||1,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=e||o.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,this._glTextures=[],t&&this.loadSource(t)}var n=t("../utils"),o=t("../const"),s=t("eventemitter3");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=n.isPowerOfTwo(this.realWidth,this.realHeight),this.emit("update",this)},i.prototype.loadSource=function(t){var e=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=t,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!t.getContext){this.isLoading=!0;var r=this;t.onload=function(){t.onload=null,t.onerror=null,r.isLoading&&(r.isLoading=!1,r._sourceLoaded(),r.emit("loaded",r))},t.onerror=function(){t.onload=null,t.onerror=null,r.isLoading&&(r.isLoading=!1,r.emit("error",r))},t.complete&&t.src&&(this.isLoading=!1,t.onload=null,t.onerror=null,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this))}},i.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},i.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},i.prototype.dispose=function(){this.emit("dispose",this),this._glTextures.length=0},i.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},i.fromImage=function(t,e,r){var o=n.BaseTextureCache[t];if(void 0===e&&0!==t.indexOf("data:")&&(e=!0),!o){var s=new Image;e&&(s.crossOrigin=""),o=new i(s,r),o.imageUrl=t,s.src=t,n.BaseTextureCache[t]=o,o.resolution=n.getResolutionOfUrl(t)}return o},i.fromCanvas=function(t,e){t._pixiId||(t._pixiId="canvas_"+n.uid());var r=n.BaseTextureCache[t._pixiId];return r||(r=new i(t,e),n.BaseTextureCache[t._pixiId]=r),r}},{"../const":22,"../utils":76,eventemitter3:11}],70:[function(t,e,r){function i(t,e,r,i,c){if(!t)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");e=e||100,r=r||100,c=c||u.RESOLUTION;var p=new n;if(p.width=e,p.height=r,p.resolution=c,p.scaleMode=i||u.SCALE_MODES.DEFAULT,p.hasLoaded=!0,o.call(this,p,new l.Rectangle(0,0,e,r)),this.width=e,this.height=r,this.resolution=c,this.render=null,this.renderer=t,this.renderer.type===u.RENDERER_TYPE.WEBGL){var d=this.renderer.gl;this.textureBuffer=new s(d,this.width,this.height,p.scaleMode,this.resolution),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.filterManager=new a(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(e,r),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new h(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var n=t("./BaseTexture"),o=t("./Texture"),s=t("../renderers/webgl/utils/RenderTarget"),a=t("../renderers/webgl/managers/FilterManager"),h=t("../renderers/canvas/utils/CanvasBuffer"),l=t("../math"),u=t("../const"),c=new l.Matrix;i.prototype=Object.create(o.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.resize=function(t,e,r){(t!==this.width||e!==this.height)&&(this.valid=t>0&&e>0,this.width=this._frame.width=this.crop.width=t,this.height=this._frame.height=this.crop.height=e,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)))},i.prototype.clear=function(){this.valid&&(this.renderer.type===u.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},i.prototype.renderWebGL=function(t,e,r,i){if(this.valid){if(i=void 0!==i?i:!0,this.textureBuffer.transform=e,this.textureBuffer.activate(),t.worldAlpha=1,i){t.worldTransform.identity(),t.currentBounds=null;var n,o,s=t.children;for(n=0,o=s.length;o>n;++n)s[n].updateTransform()}var a=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(t,this.textureBuffer,r),this.renderer.filterManager=a}},i.prototype.renderCanvas=function(t,e,r,i){if(this.valid){i=!!i;var n=t.worldTransform,o=c;o.identity(),e&&o.append(e),t.worldTransform=o,t.worldAlpha=1;var s,a,h=t.children;for(s=0,a=h.length;a>s;++s)h[s].updateTransform();r&&this.textureBuffer.clear(),t.worldTransform=n;var l=this.textureBuffer.context,u=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,l),this.renderer.resolution=u}},i.prototype.destroy=function(){o.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},i.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},i.prototype.getBase64=function(){return this.getCanvas().toDataURL()},i.prototype.getCanvas=function(){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var t=this.renderer.gl,e=this.textureBuffer.size.width,r=this.textureBuffer.size.height,i=new Uint8Array(4*e*r);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,r,t.RGBA,t.UNSIGNED_BYTE,i),t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new h(e,r),o=n.context.getImageData(0,0,e,r);return o.data.set(i),n.context.putImageData(o,0,0),n.canvas}return this.textureBuffer.canvas},i.prototype.getPixels=function(){var t,e;if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var r=this.renderer.gl;t=this.textureBuffer.size.width,e=this.textureBuffer.size.height;var i=new Uint8Array(4*t*e);return r.bindFramebuffer(r.FRAMEBUFFER,this.textureBuffer.frameBuffer),r.readPixels(0,0,t,e,r.RGBA,r.UNSIGNED_BYTE,i),r.bindFramebuffer(r.FRAMEBUFFER,null),i}return t=this.textureBuffer.canvas.width,e=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,t,e).data},i.prototype.getPixel=function(t,e){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var r=this.renderer.gl,i=new Uint8Array(4);return r.bindFramebuffer(r.FRAMEBUFFER,this.textureBuffer.frameBuffer),r.readPixels(t,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),r.bindFramebuffer(r.FRAMEBUFFER,null),i}return this.textureBuffer.canvas.getContext("2d").getImageData(t,e,1,1).data}},{"../const":22,"../math":32,"../renderers/canvas/utils/CanvasBuffer":44,"../renderers/webgl/managers/FilterManager":53,"../renderers/webgl/utils/RenderTarget":64,"./BaseTexture":69,"./Texture":71}],71:[function(t,e,r){function i(t,e,r,n,o){a.call(this),this.noFrame=!1,e||(this.noFrame=!0,e=new h.Rectangle(0,0,1,1)),t instanceof i&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||e,this.rotate=!!o,t.hasLoaded?(this.noFrame&&(e=new h.Rectangle(0,0,t.width,t.height),t.on("update",this.onBaseTextureUpdated,this)),this.frame=e):t.once("loaded",this.onBaseTextureLoaded,this)}var n=t("./BaseTexture"),o=t("./VideoBaseTexture"),s=t("./TextureUvs"),a=t("eventemitter3"),h=t("../math"),l=t("../utils");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{frame:{get:function(){return this._frame},set:function(t){if(this._frame=t,this.noFrame=!1,this.width=t.width,this.height=t.height,!this.trim&&!this.rotate&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=t,this.valid&&this._updateUvs()}}}),i.prototype.update=function(){this.baseTexture.update()},i.prototype.onBaseTextureLoaded=function(t){this.frame=this.noFrame?new h.Rectangle(0,0,t.width,t.height):this._frame,this.emit("update",this)},i.prototype.onBaseTextureUpdated=function(t){this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},i.prototype.destroy=function(t){this.baseTexture&&(t&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1},i.prototype.clone=function(){return new i(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},i.prototype._updateUvs=function(){this._uvs||(this._uvs=new s),this._uvs.set(this.crop,this.baseTexture,this.rotate)},i.fromImage=function(t,e,r){var o=l.TextureCache[t];return o||(o=new i(n.fromImage(t,e,r)),l.TextureCache[t]=o),o},i.fromFrame=function(t){var e=l.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},i.fromCanvas=function(t,e){return new i(n.fromCanvas(t,e))},i.fromVideo=function(t,e){return"string"==typeof t?i.fromVideoUrl(t,e):new i(o.fromVideo(t,e))},i.fromVideoUrl=function(t,e){return new i(o.fromUrl(t,e))},i.addTextureToCache=function(t,e){l.TextureCache[e]=t},i.removeTextureFromCache=function(t){var e=l.TextureCache[t];return delete l.TextureCache[t],delete l.BaseTextureCache[t],e},i.EMPTY=new i(new n)},{"../math":32,"../utils":76,"./BaseTexture":69,"./TextureUvs":72,"./VideoBaseTexture":73,eventemitter3:11}],72:[function(t,e,r){function i(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}e.exports=i,i.prototype.set=function(t,e,r){var i=e.width,n=e.height;r?(this.x0=(t.x+t.height)/i,this.y0=t.y/n,this.x1=(t.x+t.height)/i,this.y1=(t.y+t.width)/n,this.x2=t.x/i,this.y2=(t.y+t.width)/n,this.x3=t.x/i,this.y3=t.y/n):(this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n)}},{}],73:[function(t,e,r){function i(t,e){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),o.call(this,t,e),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),t.complete||(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function n(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=t,r.type=e,r}var o=t("./BaseTexture"),s=t("../utils");i.prototype=Object.create(o.prototype),i.prototype.constructor=i,e.exports=i,i.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},i.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},i.prototype._onPlayStop=function(){this.autoUpdate=!1},i.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},i.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete s.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),o.prototype.destroy.call(this)},i.fromVideo=function(t,e){t._pixiId||(t._pixiId="video_"+s.uid());var r=s.BaseTextureCache[t._pixiId];return r||(r=new i(t,e),s.BaseTextureCache[t._pixiId]=r),r},i.fromUrl=function(t,e){var r=document.createElement("video");if(Array.isArray(t))for(var o=0;o<t.length;++o)r.appendChild(n(t.src||t,t.mime));else r.appendChild(n(t.src||t,t.mime));return r.load(),r.play(),i.fromVideo(r,e)},i.fromUrls=i.fromUrl},{"../utils":76,"./BaseTexture":69}],74:[function(t,e,r){function i(){var t=this;this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._emitter.listeners(s,!0)&&(t._requestId=requestAnimationFrame(t._tick)))},this._emitter=new o,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/n.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var n=t("../const"),o=t("eventemitter3"),s="tick";Object.defineProperties(i.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,n.TARGET_FPMS);this._maxElapsedMS=1/e}}}),i.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(s,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},i.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},i.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},i.prototype.add=function(t,e){return this._emitter.on(s,t,e),this._startIfPossible(),this},i.prototype.addOnce=function(t,e){return this._emitter.once(s,t,e),this._startIfPossible(),this},i.prototype.remove=function(t,e){return this._emitter.off(s,t,e),this._emitter.listeners(s,!0)||this._cancelIfNeeded(),this},i.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},i.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},i.prototype.update=function(t){var e;t=t||performance.now(),e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*n.TARGET_FPMS*this.speed,this._emitter.emit(s,this.deltaTime),this.lastTime=t},e.exports=i},{"../const":22,eventemitter3:11}],75:[function(t,e,r){var i=t("./Ticker"),n=new i;n.autoStart=!0,e.exports={shared:n,Ticker:i}},{"./Ticker":74}],76:[function(t,e,r){var i=t("../const"),n=e.exports={_uid:0,_saidHello:!1,pluginTarget:t("./pluginTarget"),async:t("async"),uid:function(){return++n._uid},hex2rgb:function(t,e){return e=e||[],e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},hex2string:function(t){return t=t.toString(16),t="000000".substr(0,6-t.length)+t,"#"+t},rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},canUseNewCanvasBlendModes:function(){if("undefined"==typeof document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",r=new Image;r.src=t+"AP804Oa6"+e;var i=new Image;i.src=t+"/wCKxvRF"+e;var n=document.createElement("canvas");n.width=6,n.height=1;var o=n.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(r,0,0),o.drawImage(i,2,0);var s=o.getImageData(2,0,1,1).data;return 255===s[0]&&0===s[1]&&0===s[2]},getNextPowerOfTwo:function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;t>e;)e<<=1;return e},isPowerOfTwo:function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},getResolutionOfUrl:function(t){var e=i.RETINA_PREFIX.exec(t);return e?parseFloat(e[1]):1},sayHello:function(t){if(!n._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c Pixi.js "+i.VERSION+" -  "+t+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,e)}else window.console&&window.console.log("Pixi.js "+i.VERSION+" - "+t+" - http://www.pixijs.com/");n._saidHello=!0}},isWebGLSupported:function(){var t={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return!(!r||!r.getContextAttributes().stencil)}catch(i){return!1}},TextureCache:{},BaseTextureCache:{}}},{"../const":22,"./pluginTarget":77,async:2}],77:[function(t,e,r){function i(t){t.__plugins={},t.registerPlugin=function(e,r){t.__plugins[e]=r},t.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var e in t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}e.exports={mixin:function(t){i(t)}}},{}],78:[function(t,e,r){var i=t("./core"),n=t("./mesh"),o=t("./extras"),s=t("./filters");i.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},i.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(i,{Stage:{get:function(){return console.warn("You do not need to use a PIXI Stage any more, you can simply render any container."),i.Container}},DisplayObjectContainer:{get:function(){return console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),i.Container}},Strip:{get:function(){return console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),n.Mesh}},Rope:{get:function(){return console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),n.Rope}},MovieClip:{get:function(){return console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on."),o.MovieClip}},TilingSprite:{get:function(){return console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),o.TilingSprite}},BitmapText:{get:function(){return console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),o.BitmapText}},blendModes:{get:function(){return console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),i.BLEND_MODES}},scaleModes:{get:function(){return console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),i.SCALE_MODES}},BaseTextureCache:{get:function(){return console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),i.utils.BaseTextureCache}},TextureCache:{get:function(){return console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),i.utils.TextureCache}},math:{get:function(){return console.warn("The math namespace is deprecated, please access members already accessible on PIXI."),i}}}),i.Sprite.prototype.setTexture=function(t){this.texture=t,console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},o.BitmapText.prototype.setText=function(t){this.text=t,console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")},i.Text.prototype.setText=function(t){this.text=t,console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},i.Text.prototype.setStyle=function(t){this.style=t,console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},i.Texture.prototype.setFrame=function(t){this.frame=t,console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")},Object.defineProperties(s,{AbstractFilter:{get:function(){return console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on."),i.AbstractFilter}},FXAAFilter:{get:function(){return console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on."),i.FXAAFilter}},SpriteMaskFilter:{get:function(){return console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),i.SpriteMaskFilter}}}),i.utils.uuid=function(){return console.warn("utils.uuid() is deprecated, please use utils.uid() from now on."),i.utils.uid()}},{"./core":29,"./extras":85,"./filters":102,"./mesh":126}],79:[function(t,e,r){function i(t,e){n.Container.call(this),e=e||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==e.tint?e.tint:16777215,align:e.align||"left",name:null,size:0},this.font=e.font,this._text=t,this.maxWidth=0,this.dirty=!1,this.updateText()}var n=t("../core");i.prototype=Object.create(n.Container.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{tint:{get:function(){return this._font.tint},set:function(t){
this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):i.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}}}),i.prototype.updateText=function(){for(var t=i.fonts[this._font.name],e=new n.Point,r=null,o=[],s=0,a=0,h=[],l=0,u=this._font.size/t.size,c=-1,p=0;p<this.text.length;p++){var d=this.text.charCodeAt(p);if(c=/(\s)/.test(this.text.charAt(p))?p:c,/(?:\r\n|\r|\n)/.test(this.text.charAt(p)))h.push(s),a=Math.max(a,s),l++,e.x=0,e.y+=t.lineHeight,r=null;else if(-1!==c&&this.maxWidth>0&&e.x*u>this.maxWidth)o.splice(c,p-c),p=c,c=-1,h.push(s),a=Math.max(a,s),l++,e.x=0,e.y+=t.lineHeight,r=null;else{var f=t.chars[d];f&&(r&&f.kerning[r]&&(e.x+=f.kerning[r]),o.push({texture:f.texture,line:l,charCode:d,position:new n.Point(e.x+f.xOffset,e.y+f.yOffset)}),s=e.x+(f.texture.width+f.xOffset),e.x+=f.xAdvance,r=d)}}h.push(s),a=Math.max(a,s);var v=[];for(p=0;l>=p;p++){var g=0;"right"===this._font.align?g=a-h[p]:"center"===this._font.align&&(g=(a-h[p])/2),v.push(g)}var m=o.length,y=this.tint;for(p=0;m>p;p++){var x=this._glyphs[p];x?x.texture=o[p].texture:(x=new n.Sprite(o[p].texture),this._glyphs.push(x)),x.position.x=(o[p].position.x+v[o[p].line])*u,x.position.y=o[p].position.y*u,x.scale.x=x.scale.y=u,x.tint=y,x.parent||this.addChild(x)}for(p=m;p<this._glyphs.length;++p)this.removeChild(this._glyphs[p]);this.textWidth=a*u,this.textHeight=(e.y+t.lineHeight)*u},i.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},i.prototype.getLocalBounds=function(){return this.validate(),n.Container.prototype.getLocalBounds.call(this)},i.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},i.fonts={}},{"../core":29}],80:[function(t,e,r){function i(t){n.Sprite.call(this,t[0]),this._textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var n=t("../core");i.prototype=Object.create(n.Sprite.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(t){this._textures=t,this.texture=this._textures[Math.floor(this._currentTime)%this._textures.length]}},currentFrame:{get:function(){return Math.floor(this._currentTime)%this._textures.length}}}),i.prototype.stop=function(){this.playing&&(this.playing=!1,n.ticker.shared.remove(this.update,this))},i.prototype.play=function(){this.playing||(this.playing=!0,n.ticker.shared.add(this.update,this))},i.prototype.gotoAndStop=function(t){this.stop(),this._currentTime=t;var e=Math.floor(this._currentTime);this._texture=this._textures[e%this._textures.length]},i.prototype.gotoAndPlay=function(t){this._currentTime=t,this.play()},i.prototype.update=function(t){this._currentTime+=this.animationSpeed*t;var e=Math.floor(this._currentTime);0>e?this.loop?this._texture=this._textures[this._textures.length-1+e%this._textures.length]:(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this.loop||e<this._textures.length?this._texture=this._textures[e%this._textures.length]:e>=this._textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())},i.prototype.destroy=function(){this.stop(),n.Sprite.prototype.destroy.call(this)},i.fromFrames=function(t){for(var e=[],r=0;r<t.length;++r)e.push(new n.Texture.fromFrame(t[r]));return new i(e)},i.fromImages=function(t){for(var e=[],r=0;r<t.length;++r)e.push(new n.Texture.fromImage(t[r]));return new i(e)}},{"../core":29}],81:[function(t,e,r){function i(t,e,r){n.Sprite.call(this,t),this.tileScale=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this._width=e||100,this._height=r||100,this._uvs=new n.TextureUvs,this._canvasPattern=null,this.shader=new n.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var n=t("../core"),o=new n.Point;i.prototype=Object.create(n.Sprite.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}}}),i.prototype._onTextureUpdate=function(){},i.prototype._renderWebGL=function(t){var e=this._texture;if(e&&e._uvs){var r=e._uvs,i=e._frame.width,n=e._frame.height,o=e.baseTexture.width,s=e.baseTexture.height;e._uvs=this._uvs,e._frame.width=this.width,e._frame.height=this.height,this.shader.uniforms.uPixelSize.value[0]=1/o,this.shader.uniforms.uPixelSize.value[1]=1/s,this.shader.uniforms.uFrame.value[0]=r.x0,this.shader.uniforms.uFrame.value[1]=r.y0,this.shader.uniforms.uFrame.value[2]=r.x1-r.x0,this.shader.uniforms.uFrame.value[3]=r.y2-r.y0,this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(i*this.tileScale.x)/this._width,this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(n*this.tileScale.y)/this._height,this.shader.uniforms.uTransform.value[2]=o/this._width*this.tileScale.x,this.shader.uniforms.uTransform.value[3]=s/this._height*this.tileScale.y,t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this),e._uvs=r,e._frame.width=i,e._frame.height=n}},i.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var r=t.context,i=this.worldTransform,o=t.resolution,s=e.baseTexture,a=this.tilePosition.x%(e._frame.width*this.tileScale.x),h=this.tilePosition.y%(e._frame.height*this.tileScale.y);if(!this._canvasPattern){var l=new n.CanvasBuffer(e._frame.width,e._frame.height);l.context.drawImage(s.source,-e._frame.x,-e._frame.y),this._canvasPattern=l.context.createPattern(l.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),r.scale(this.tileScale.x,this.tileScale.y),r.translate(a+this.anchor.x*-this._width,h+this.anchor.y*-this._height),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=t.blendModes[t.currentBlendMode]),r.fillStyle=this._canvasPattern,r.fillRect(-a,-h,this._width/this.tileScale.x,this._height/this.tileScale.y)}},i.prototype.getBounds=function(){var t,e,r,i,n=this._width,o=this._height,s=n*(1-this.anchor.x),a=n*-this.anchor.x,h=o*(1-this.anchor.y),l=o*-this.anchor.y,u=this.worldTransform,c=u.a,p=u.b,d=u.c,f=u.d,v=u.tx,g=u.ty,m=c*a+d*l+v,y=f*l+p*a+g,x=c*s+d*l+v,b=f*l+p*s+g,_=c*s+d*h+v,T=f*h+p*s+g,E=c*a+d*h+v,S=f*h+p*a+g;t=m,t=t>x?x:t,t=t>_?_:t,t=t>E?E:t,r=y,r=r>b?b:r,r=r>T?T:r,r=r>S?S:r,e=m,e=x>e?x:e,e=_>e?_:e,e=E>e?E:e,i=y,i=b>i?b:i,i=T>i?T:i,i=S>i?S:i;var A=this._bounds;return A.x=t,A.width=e-t,A.y=r,A.height=i-r,this._currentBounds=A,A},i.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,o);var e,r=this._width,i=this._height,n=-r*this.anchor.x;return o.x>n&&o.x<n+r&&(e=-i*this.anchor.y,o.y>e&&o.y<e+i)?!0:!1},i.prototype.destroy=function(){n.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},i.fromFrame=function(t,e,r){var o=n.utils.TextureCache[t];if(!o)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new i(o,e,r)},i.fromImage=function(t,e,r,o,s){return new i(n.Texture.fromImage(t,o,s),e,r)}},{"../core":29}],82:[function(t,e,r){var i=t("../core"),n=i.DisplayObject,o=new i.Matrix;n.prototype._cacheAsBitmap=!1,n.prototype._originalRenderWebGL=null,n.prototype._originalRenderCanvas=null,n.prototype._originalUpdateTransform=null,n.prototype._originalHitTest=null,n.prototype._originalDestroy=null,n.prototype._cachedSprite=null,Object.defineProperties(n.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._originalRenderWebGL=this.renderWebGL,this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}}),n.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cachedSprite.worldAlpha=this.worldAlpha,t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this._cachedSprite))},n.prototype._initCachedDisplayObject=function(t){if(!this._cachedSprite){t.currentRenderer.flush();var e=this.getLocalBounds().clone();if(this._filters){var r=this._filters[0].padding;e.x-=r,e.y-=r,e.width+=2*r,e.height+=2*r}var n=t.currentRenderTarget,s=t.filterManager.filterStack,a=new i.RenderTexture(t,0|e.width,0|e.height),h=o;h.tx=-e.x,h.ty=-e.y,this.renderWebGL=this._originalRenderWebGL,a.render(this,h,!0,!0),t.setRenderTarget(n),t.filterManager.filterStack=s,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new i.Sprite(a),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},n.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(t))},n.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cachedSprite){var e=this.getLocalBounds(),r=t.context,n=new i.RenderTexture(t,0|e.width,0|e.height),s=o;s.tx=-e.x,s.ty=-e.y,this.renderCanvas=this._originalRenderCanvas,n.render(this,s,!0),t.context=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new i.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},n.prototype._getCachedBounds=function(){return this._cachedSprite._currentBounds=null,this._cachedSprite.getBounds()},n.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy(),this._cachedSprite=null},n.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this._originalDestroy()}},{"../core":29}],83:[function(t,e,r){var i=t("../core");i.DisplayObject.prototype.name=null,i.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},{"../core":29}],84:[function(t,e,r){var i=t("../core");i.DisplayObject.prototype.getGlobalPosition=function(t){return t=t||new i.Point,this.parent?(this.displayObjectUpdateTransform(),t.x=this.worldTransform.tx,t.y=this.worldTransform.ty):(t.x=this.position.x,t.y=this.position.y),t}},{"../core":29}],85:[function(t,e,r){t("./cacheAsBitmap"),t("./getChildByName"),t("./getGlobalPosition"),e.exports={MovieClip:t("./MovieClip"),TilingSprite:t("./TilingSprite"),BitmapText:t("./BitmapText")}},{"./BitmapText":79,"./MovieClip":80,"./TilingSprite":81,"./cacheAsBitmap":82,"./getChildByName":83,"./getGlobalPosition":84}],86:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.uniforms.pixelSize.value=t}}})},{"../../core":29}],87:[function(t,e,r){function i(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new s,this.defaultFilter=new n.AbstractFilter}var n=t("../../core"),o=t("../blur/BlurXFilter"),s=t("../blur/BlurYFilter");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(t,e,r),this.blurXFilter.applyFilter(t,e,i),t.blendModeManager.setBlendMode(n.BLEND_MODES.SCREEN),this.blurYFilter.applyFilter(t,i,r),t.blendModeManager.setBlendMode(n.BLEND_MODES.NORMAL),t.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}})},{"../../core":29,"../blur/BlurXFilter":90,"../blur/BlurYFilter":91}],88:[function(t,e,r){function i(t,e){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:t||0},dirY:{type:"1f",value:e||0}}),this.defaultFilter=new n.AbstractFilter,this.passes=1,this.dirX=t||0,this.dirY=e||0,this.strength=4}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r,i){var n=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.width/e.size.width),1===this.passes)t.filterManager.applyFilter(n,e,r,i);else{var o=t.filterManager.getRenderTarget(!0);t.filterManager.applyFilter(n,e,o,i);for(var s=0;s<this.passes-2;s++)t.filterManager.applyFilter(n,o,o,i);t.filterManager.applyFilter(n,o,r,i),t.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*t,this.strength=t}},dirX:{get:function(){return this.dirX},set:function(t){this.uniforms.dirX.value=t}},dirY:{get:function(){return this.dirY},set:function(t){this.uniforms.dirY.value=t}}})},{"../../core":29}],89:[function(t,e,r){function i(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new s}var n=t("../../core"),o=t("./BlurXFilter"),s=t("./BlurYFilter");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(t,e,i),this.blurYFilter.applyFilter(t,i,r),t.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.padding=.5*Math.abs(t),this.blurXFilter.blur=this.blurYFilter.blur=t}},passes:{get:function(){return this.blurXFilter.passes},set:function(t){this.blurXFilter.passes=this.blurYFilter.passes=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}})},{"../../core":29,"./BlurXFilter":90,"./BlurYFilter":91}],90:[function(t,e,r){function i(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r,i){var n=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.width/e.size.width),1===this.passes)t.filterManager.applyFilter(n,e,r,i);else{for(var o=t.filterManager.getRenderTarget(!0),s=e,a=o,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(n,s,a,!0);var l=a;a=s,s=l}t.filterManager.applyFilter(n,s,r,i),t.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*Math.abs(t),this.strength=t}}})},{"../../core":29}],91:[function(t,e,r){function i(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r,i){var n=this.getShader(t);if(this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(e.frame.height/e.size.height),1===this.passes)t.filterManager.applyFilter(n,e,r,i);else{for(var o=t.filterManager.getRenderTarget(!0),s=e,a=o,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(n,s,a,!0);var l=a;a=s,s=l}t.filterManager.applyFilter(n,s,r,i),t.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*Math.abs(t),this.strength=t}}})},{"../../core":29}],92:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i},{"../../core":29}],93:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4];\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9];\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14];\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19];\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype._loadMatrix=function(t,e){e=!!e;var r=t;e&&(this._multiply(r,this.uniforms.m.value,t),r=this._colorMatrix(r)),this.uniforms.m.value=r},i.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19],t},i.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},i.prototype.brightness=function(t,e){var r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},i.prototype.greyscale=function(t,e){var r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},i.prototype.grayscale=i.prototype.greyscale,i.prototype.blackAndWhite=function(t){var e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),i=Math.sin(t),n=.213,o=.715,s=.072,a=[n+r*(1-n)+i*-n,o+r*-o+i*-o,s+r*-s+i*(1-s),0,0,n+r*-n+.143*i,o+r*(1-o)+.14*i,s+r*-s+i*-.283,0,0,n+r*-n+i*-(1-n),o+r*-o+i*o,s+r*(1-s)+i*s,0,0,0,0,0,1,0];this._loadMatrix(a,e)},i.prototype.contrast=function(t,e){var r=(t||0)+1,i=-128*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)},i.prototype.saturate=function(t,e){var r=2*(t||0)/3+1,i=(r-1)*-.5,n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)},i.prototype.desaturate=function(t){this.saturate(-1)},i.prototype.negative=function(t){var e=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.sepia=function(t){var e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.technicolor=function(t){var e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.polaroid=function(t){var e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.toBGR=function(t){var e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.kodachrome=function(t){var e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.browni=function(t){var e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.vintage=function(t){var e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.colorTone=function(t,e,r,i,n){t=t||.2,e=e||.15,r=r||16770432,i=i||3375104;var o=(r>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,h=(i>>16&255)/255,l=(i>>8&255)/255,u=(255&i)/255,c=[.3,.59,.11,0,0,o,s,a,t,0,h,l,u,e,0,o-h,s-l,a-u,0,0];this._loadMatrix(c,n)},i.prototype.night=function(t,e){t=t||.1;var r=[-2*t,-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},i.prototype.predator=function(t,e){var r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)},i.prototype.lsd=function(t){var e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)},i.prototype.reset=function(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)},Object.defineProperties(i.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(t){this.uniforms.m.value=t}}})},{"../../core":29}],94:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t;

}}})},{"../../core":29}],95:[function(t,e,r){function i(t,e,r){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(t)},texelSize:{type:"v2",value:{x:1/e,y:1/r}}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=new Float32Array(t)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(t){this.uniforms.texelSize.value.x=1/t}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(t){this.uniforms.texelSize.value.y=1/t}}})},{"../../core":29}],96:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i},{"../../core":29}],97:[function(t,e,r){function i(t){var e=new n.Matrix;t.renderable=!1,n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 original =  texture2D(uSampler, vTextureCoord);\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:t.texture},otherMatrix:{type:"mat3",value:e.toArray(!0)},scale:{type:"v2",value:{x:1,y:1}}}),this.maskSprite=t,this.maskMatrix=e,this.scale=new n.Point(20,20)}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager;i.calculateMappedMatrix(e.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/e.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/e.frame.height);var n=this.getShader(t);i.applyFilter(n,e,r)},Object.defineProperties(i.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(t){this.uniforms.mapSampler.value=t}}})},{"../../core":29}],98:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}},angle:{get:function(){return this.uniforms.angle.value},set:function(t){this.uniforms.angle.value=t}}})},{"../../core":29}],99:[function(t,e,r){function i(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r,i){var n=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.height/e.size.height),1===this.passes)t.filterManager.applyFilter(n,e,r,i);else{for(var o=t.filterManager.getRenderTarget(!0),s=e,a=o,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(n,s,a,i);var l=a;a=s,s=l}t.filterManager.applyFilter(n,s,r,i),t.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*t,this.strength=t}}})},{"../../core":29}],100:[function(t,e,r){function i(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYTintFilter=new s,this.defaultFilter=new n.AbstractFilter,this.padding=30,this._dirtyPosition=!0,this._angle=45*Math.PI/180,this._distance=10,this.alpha=.75,this.hideObject=!1,this.blendMode=n.BLEND_MODES.MULTIPLY}var n=t("../../core"),o=t("../blur/BlurXFilter"),s=t("./BlurYTintFilter");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance),this.blurXFilter.applyFilter(t,e,i),t.blendModeManager.setBlendMode(this.blendMode),this.blurYTintFilter.applyFilter(t,i,r),t.blendModeManager.setBlendMode(n.BLEND_MODES.NORMAL),this.hideObject||this.defaultFilter.applyFilter(t,e,r),t.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYTintFilter.blur=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(t){this.blurYTintFilter.blur=t}},color:{get:function(){return n.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(t){this.blurYTintFilter.uniforms.color.value=n.utils.hex2rgb(t)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(t){this.blurYTintFilter.uniforms.alpha.value=t}},distance:{get:function(){return this._distance},set:function(t){this._dirtyPosition=!0,this._distance=t}},angle:{get:function(){return this._angle},set:function(t){this._dirtyPosition=!0,this._angle=t}}})},{"../../core":29,"../blur/BlurXFilter":90,"./BlurYTintFilter":99}],101:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}})},{"../../core":29}],102:[function(t,e,r){e.exports={AsciiFilter:t("./ascii/AsciiFilter"),BloomFilter:t("./bloom/BloomFilter"),BlurFilter:t("./blur/BlurFilter"),BlurXFilter:t("./blur/BlurXFilter"),BlurYFilter:t("./blur/BlurYFilter"),BlurDirFilter:t("./blur/BlurDirFilter"),ColorMatrixFilter:t("./color/ColorMatrixFilter"),ColorStepFilter:t("./color/ColorStepFilter"),ConvolutionFilter:t("./convolution/ConvolutionFilter"),CrossHatchFilter:t("./crosshatch/CrossHatchFilter"),DisplacementFilter:t("./displacement/DisplacementFilter"),DotScreenFilter:t("./dot/DotScreenFilter"),GrayFilter:t("./gray/GrayFilter"),DropShadowFilter:t("./dropshadow/DropShadowFilter"),InvertFilter:t("./invert/InvertFilter"),NoiseFilter:t("./noise/NoiseFilter"),NormalMapFilter:t("./normal/NormalMapFilter"),PixelateFilter:t("./pixelate/PixelateFilter"),RGBSplitFilter:t("./rgb/RGBSplitFilter"),ShockwaveFilter:t("./shockwave/ShockwaveFilter"),SepiaFilter:t("./sepia/SepiaFilter"),SmartBlurFilter:t("./blur/SmartBlurFilter"),TiltShiftFilter:t("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:t("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:t("./tiltshift/TiltShiftYFilter"),TwistFilter:t("./twist/TwistFilter")}},{"./ascii/AsciiFilter":86,"./bloom/BloomFilter":87,"./blur/BlurDirFilter":88,"./blur/BlurFilter":89,"./blur/BlurXFilter":90,"./blur/BlurYFilter":91,"./blur/SmartBlurFilter":92,"./color/ColorMatrixFilter":93,"./color/ColorStepFilter":94,"./convolution/ConvolutionFilter":95,"./crosshatch/CrossHatchFilter":96,"./displacement/DisplacementFilter":97,"./dot/DotScreenFilter":98,"./dropshadow/DropShadowFilter":100,"./gray/GrayFilter":101,"./invert/InvertFilter":103,"./noise/NoiseFilter":104,"./normal/NormalMapFilter":105,"./pixelate/PixelateFilter":106,"./rgb/RGBSplitFilter":107,"./sepia/SepiaFilter":108,"./shockwave/ShockwaveFilter":109,"./tiltshift/TiltShiftFilter":111,"./tiltshift/TiltShiftXFilter":112,"./tiltshift/TiltShiftYFilter":113,"./twist/TwistFilter":114}],103:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{invert:{type:"1f",value:1}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}})},{"../../core":29}],104:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(t){this.uniforms.noise.value=t}}})},{"../../core":29}],105:[function(t,e,r){function i(t){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D displacementMap;\nuniform sampler2D uSampler;\n\nuniform vec4 dimensions;\n\nconst vec2 Resolution = vec2(1.0,1.0);      //resolution of screen\nuniform vec3 LightPos;    //light position, normalized\nconst vec4 LightColor = vec4(1.0, 1.0, 1.0, 1.0);      //light RGBA -- alpha is intensity\nconst vec4 AmbientColor = vec4(1.0, 1.0, 1.0, 0.5);    //ambient RGBA -- alpha is intensity\nconst vec3 Falloff = vec3(0.0, 1.0, 0.2);         //attenuation coefficients\n\nuniform vec3 LightDir; // = vec3(1.0, 0.0, 1.0);\n\nuniform vec2 mapDimensions; // = vec2(256.0, 256.0);\n\n\nvoid main(void)\n{\n    vec2 mapCords = vTextureCoord.xy;\n\n    vec4 color = texture2D(uSampler, vTextureCoord.st);\n    vec3 nColor = texture2D(displacementMap, vTextureCoord.st).rgb;\n\n\n    mapCords *= vec2(dimensions.x/512.0, dimensions.y/512.0);\n\n    mapCords.y *= -1.0;\n    mapCords.y += 1.0;\n\n    // RGBA of our diffuse color\n    vec4 DiffuseColor = texture2D(uSampler, vTextureCoord);\n\n    // RGB of our normal map\n    vec3 NormalMap = texture2D(displacementMap, mapCords).rgb;\n\n    // The delta position of light\n    // vec3 LightDir = vec3(LightPos.xy - (gl_FragCoord.xy / Resolution.xy), LightPos.z);\n    vec3 LightDir = vec3(LightPos.xy - (mapCords.xy), LightPos.z);\n\n    // Correct for aspect ratio\n    // LightDir.x *= Resolution.x / Resolution.y;\n\n    // Determine distance (used for attenuation) BEFORE we normalize our LightDir\n    float D = length(LightDir);\n\n    // normalize our vectors\n    vec3 N = normalize(NormalMap * 2.0 - 1.0);\n    vec3 L = normalize(LightDir);\n\n    // Pre-multiply light color with intensity\n    // Then perform 'N dot L' to determine our diffuse term\n    vec3 Diffuse = (LightColor.rgb * LightColor.a) * max(dot(N, L), 0.0);\n\n    // pre-multiply ambient color with intensity\n    vec3 Ambient = AmbientColor.rgb * AmbientColor.a;\n\n    // calculate attenuation\n    float Attenuation = 1.0 / ( Falloff.x + (Falloff.y*D) + (Falloff.z*D*D) );\n\n    // the calculation which brings it all together\n    vec3 Intensity = Ambient + Diffuse * Attenuation;\n    vec3 FinalColor = DiffuseColor.rgb * Intensity;\n    gl_FragColor = vColor * vec4(FinalColor, DiffuseColor.a);\n\n    // gl_FragColor = vec4(1.0, 0.0, 0.0, Attenuation); // vColor * vec4(FinalColor, DiffuseColor.a);\n\n/*\n    // normalise color\n    vec3 normal = normalize(nColor * 2.0 - 1.0);\n\n    vec3 deltaPos = vec3( (light.xy - gl_FragCoord.xy) / resolution.xy, light.z );\n\n    float lambert = clamp(dot(normal, lightDir), 0.0, 1.0);\n\n    float d = sqrt(dot(deltaPos, deltaPos));\n    float att = 1.0 / ( attenuation.x + (attenuation.y*d) + (attenuation.z*d*d) );\n\n    vec3 result = (ambientColor * ambientIntensity) + (lightColor.rgb * lambert) * att;\n    result *= color.rgb;\n\n    gl_FragColor = vec4(result, 1.0);\n*/\n}\n",{displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:15,y:15}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:1}},dimensions:{type:"4f",value:[0,0,0,0]},LightPos:{type:"3f",value:[0,1,0]}}),t.baseTexture._powerOf2=!0,t.baseTexture.hasLoaded?this.onTextureLoaded():t.baseTexture.once("loaded",this.onTextureLoaded,this)}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height},Object.defineProperties(i.prototype,{map:{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}},scale:{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}},offset:{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}})},{"../../core":29}],106:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.uniforms.pixelSize.value=t}}})},{"../../core":29}],107:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}},green:{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}},blue:{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}})},{"../../core":29}],108:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}})},{"../../core":29}],109:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(t){this.uniforms.center.value=t}},params:{get:function(){return this.uniforms.params.value},set:function(t){this.uniforms.params.value=t}},time:{get:function(){return this.uniforms.time.value},set:function(t){this.uniforms.time.value=t}}})},{"../../core":29}],110:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}}),this.updateDelta()}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.updateDelta=function(){this.uniforms.delta.value.x=0,this.uniforms.delta.value.y=0},Object.defineProperties(i.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(t){this.uniforms.blur.value=t}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(t){this.uniforms.gradientBlur.value=t}},start:{get:function(){return this.uniforms.start.value},set:function(t){this.uniforms.start.value=t,this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(t){this.uniforms.end.value=t,this.updateDelta()}}})},{"../../core":29}],111:[function(t,e,r){function i(){n.AbstractFilter.call(this),this.tiltShiftXFilter=new o,this.tiltShiftYFilter=new s}var n=t("../../core"),o=t("./TiltShiftXFilter"),s=t("./TiltShiftYFilter");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.applyFilter=function(t,e,r){var i=t.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(t,e,i),this.tiltShiftYFilter.applyFilter(t,i,r),t.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}}})},{"../../core":29,"./TiltShiftXFilter":112,"./TiltShiftYFilter":113}],112:[function(t,e,r){function i(){n.call(this)}var n=t("./TiltShiftAxisFilter");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.updateDelta=function(){var t=this.uniforms.end.value.x-this.uniforms.start.value.x,e=this.uniforms.end.value.y-this.uniforms.start.value.y,r=Math.sqrt(t*t+e*e);this.uniforms.delta.value.x=t/r,this.uniforms.delta.value.y=e/r}},{"./TiltShiftAxisFilter":110}],113:[function(t,e,r){function i(){n.call(this)}var n=t("./TiltShiftAxisFilter");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.updateDelta=function(){var t=this.uniforms.end.value.x-this.uniforms.start.value.x,e=this.uniforms.end.value.y-this.uniforms.start.value.y,r=Math.sqrt(t*t+e*e);this.uniforms.delta.value.x=-e/r,this.uniforms.delta.value.y=t/r}},{"./TiltShiftAxisFilter":110}],114:[function(t,e,r){function i(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var n=t("../../core");i.prototype=Object.create(n.AbstractFilter.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}},radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},angle:{get:function(){return this.uniforms.angle.value},set:function(t){this.uniforms.angle.value=t}}})},{"../../core":29}],115:[function(t,e,r){function i(){this.global=new n.Point,this.target=null,this.originalEvent=null}var n=t("../core");i.prototype.constructor=i,e.exports=i,i.prototype.getLocalPosition=function(t,e,r){var i=t.worldTransform,o=r?r:this.global,s=i.a,a=i.c,h=i.tx,l=i.b,u=i.d,c=i.ty,p=1/(s*u+a*-l);return e=e||new n.Point,e.x=u*p*o.x+-a*p*o.x+(c*a-h*u)*p,e.y=s*p*o.y+-l*p*o.y+(-c*s+h*l)*p,e}},{"../core":29}],116:[function(t,e,r){function i(t,e){e=e||{},this.renderer=t,this.autoPreventDefault=void 0!==e.autoPreventDefault?e.autoPreventDefault:!0,this.interactionFrequency=e.interactionFrequency||10,this.mouse=new o,this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this._tempPoint=new n.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var n=t("../core"),o=t("./InteractionData");Object.assign(n.DisplayObject.prototype,t("./interactiveTarget")),i.prototype.constructor=i,e.exports=i,i.prototype.setTargetElement=function(t,e){this.removeEvents(),this.interactionDOMElement=t,this.resolution=e||1,this.addEvents()},i.prototype.addEvents=function(){this.interactionDOMElement&&(n.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},i.prototype.removeEvents=function(){this.interactionDOMElement&&(n.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),
this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},i.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement)){if(this.didMove)return void(this.didMove=!1);this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)}},i.prototype.dispatchEvent=function(t,e,r){r.stopped||(r.target=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},i.prototype.mapPositionToPoint=function(t,e,r){var i=this.interactionDOMElement.getBoundingClientRect();t.x=(e-i.left)*(this.interactionDOMElement.width/i.width)/this.resolution,t.y=(r-i.top)*(this.interactionDOMElement.height/i.height)/this.resolution},i.prototype.processInteractive=function(t,e,r,i,n){if(!e.visible)return!1;var o=e.children,s=!1;if(n=n||e.interactive,e.interactiveChildren)for(var a=o.length-1;a>=0;a--)!s&&i?s=this.processInteractive(t,o[a],r,!0,n):this.processInteractive(t,o[a],r,!1,!1);return n&&(i&&(e.hitArea?(e.worldTransform.applyInverse(t,this._tempPoint),s=e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):e.containsPoint&&(s=e.containsPoint(t))),e.interactive&&r(e,s)),s},i.prototype.onMouseDown=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)},i.prototype.processMouseDown=function(t,e){var r=this.mouse.originalEvent,i=2===r.button||3===r.which;e&&(t[i?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(t,i?"rightdown":"mousedown",this.eventData))},i.prototype.onMouseUp=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)},i.prototype.processMouseUp=function(t,e){var r=this.mouse.originalEvent,i=2===r.button||3===r.which,n=i?"_isRightDown":"_isLeftDown";e?(this.dispatchEvent(t,i?"rightup":"mouseup",this.eventData),t[n]&&(t[n]=!1,this.dispatchEvent(t,i?"rightclick":"click",this.eventData))):t[n]&&(t[n]=!1,this.dispatchEvent(t,i?"rightupoutside":"mouseupoutside",this.eventData))},i.prototype.onMouseMove=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.didMove=!0,this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},i.prototype.processMouseMove=function(t,e){this.dispatchEvent(t,"mousemove",this.eventData),this.processMouseOverOut(t,e)},i.prototype.onMouseOut=function(t){this.mouse.originalEvent=t,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.interactionDOMElement.style.cursor="inherit",this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)},i.prototype.processMouseOverOut=function(t,e){e?(t._over||(t._over=!0,this.dispatchEvent(t,"mouseover",this.eventData)),t.buttonMode&&(this.cursor=t.defaultCursor)):t._over&&(t._over=!1,this.dispatchEvent(t,"mouseout",this.eventData))},i.prototype.onTouchStart=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,r=e.length,i=0;r>i;i++){var n=e[i],o=this.getTouchData(n);o.originalEvent=t,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.returnTouchData(o)}},i.prototype.processTouchStart=function(t,e){e&&(t._touchDown=!0,this.dispatchEvent(t,"touchstart",this.eventData))},i.prototype.onTouchEnd=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,r=e.length,i=0;r>i;i++){var n=e[i],o=this.getTouchData(n);o.originalEvent=t,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.returnTouchData(o)}},i.prototype.processTouchEnd=function(t,e){e?(this.dispatchEvent(t,"touchend",this.eventData),t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"tap",this.eventData))):t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"touchendoutside",this.eventData))},i.prototype.onTouchMove=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,r=e.length,i=0;r>i;i++){var n=e[i],o=this.getTouchData(n);o.originalEvent=t,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchMove,!1),this.returnTouchData(o)}},i.prototype.processTouchMove=function(t,e){e=e,this.dispatchEvent(t,"touchmove",this.eventData)},i.prototype.getTouchData=function(t){var e=this.interactiveDataPool.pop();return e||(e=new o),e.identifier=t.identifier,this.mapPositionToPoint(e.global,t.clientX,t.clientY),navigator.isCocoonJS&&(e.global.x=e.global.x/this.resolution,e.global.y=e.global.y/this.resolution),t.globalX=e.global.x,t.globalY=e.global.y,e},i.prototype.returnTouchData=function(t){this.interactiveDataPool.push(t)},i.prototype.destroy=function(){this.removeEvents(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},n.WebGLRenderer.registerPlugin("interaction",i),n.CanvasRenderer.registerPlugin("interaction",i)},{"../core":29,"./InteractionData":115,"./interactiveTarget":118}],117:[function(t,e,r){e.exports={InteractionData:t("./InteractionData"),InteractionManager:t("./InteractionManager"),interactiveTarget:t("./interactiveTarget")}},{"./InteractionData":115,"./InteractionManager":116,"./interactiveTarget":118}],118:[function(t,e,r){var i={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1};e.exports=i},{}],119:[function(t,e,r){function i(t,e){var r={},i=t.data.getElementsByTagName("info")[0],n=t.data.getElementsByTagName("common")[0];r.font=i.getAttribute("face"),r.size=parseInt(i.getAttribute("size"),10),r.lineHeight=parseInt(n.getAttribute("lineHeight"),10),r.chars={};for(var a=t.data.getElementsByTagName("char"),h=0;h<a.length;h++){var l=parseInt(a[h].getAttribute("id"),10),u=new o.Rectangle(parseInt(a[h].getAttribute("x"),10)+e.frame.x,parseInt(a[h].getAttribute("y"),10)+e.frame.y,parseInt(a[h].getAttribute("width"),10),parseInt(a[h].getAttribute("height"),10));r.chars[l]={xOffset:parseInt(a[h].getAttribute("xoffset"),10),yOffset:parseInt(a[h].getAttribute("yoffset"),10),xAdvance:parseInt(a[h].getAttribute("xadvance"),10),kerning:{},texture:new o.Texture(e.baseTexture,u)}}var c=t.data.getElementsByTagName("kerning");for(h=0;h<c.length;h++){var p=parseInt(c[h].getAttribute("first"),10),d=parseInt(c[h].getAttribute("second"),10),f=parseInt(c[h].getAttribute("amount"),10);r.chars[d].kerning[p]=f}t.bitmapFont=r,s.BitmapText.fonts[r.font]=r}var n=t("resource-loader").Resource,o=t("../core"),s=t("../extras"),a=t("path");e.exports=function(){return function(t,e){if(!t.data||!t.isXml)return e();if(0===t.data.getElementsByTagName("page").length||0===t.data.getElementsByTagName("info").length||null===t.data.getElementsByTagName("info")[0].getAttribute("face"))return e();var r=a.dirname(t.url);"."===r&&(r=""),this.baseUrl&&r&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/"),r=r.replace(this.baseUrl,"")),r&&"/"!==r.charAt(r.length-1)&&(r+="/");var s=r+t.data.getElementsByTagName("page")[0].getAttribute("file");if(o.utils.TextureCache[s])i(t,o.utils.TextureCache[s]),e();else{var h={crossOrigin:t.crossOrigin,loadType:n.LOAD_TYPE.IMAGE};this.add(t.name+"_image",s,h,function(r){i(t,r.texture),e()})}}}},{"../core":29,"../extras":85,path:3,"resource-loader":18}],120:[function(t,e,r){e.exports={Loader:t("./loader"),bitmapFontParser:t("./bitmapFontParser"),spritesheetParser:t("./spritesheetParser"),textureParser:t("./textureParser"),Resource:t("resource-loader").Resource}},{"./bitmapFontParser":119,"./loader":121,"./spritesheetParser":122,"./textureParser":123,"resource-loader":18}],121:[function(t,e,r){function i(t,e){n.call(this,t,e);for(var r=0;r<i._pixiMiddleware.length;++r)this.use(i._pixiMiddleware[r]())}var n=t("resource-loader"),o=t("./textureParser"),s=t("./spritesheetParser"),a=t("./bitmapFontParser");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i._pixiMiddleware=[n.middleware.parsing.blob,o,s,a],i.addPixiMiddleware=function(t){i._pixiMiddleware.push(t)};var h=n.Resource;h.setExtensionXhrType("fnt",h.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":119,"./spritesheetParser":122,"./textureParser":123,"resource-loader":18}],122:[function(t,e,r){var i=t("resource-loader").Resource,n=t("path"),o=t("../core");e.exports=function(){return function(t,e){if(!t.data||!t.isJson||!t.data.frames)return e();var r={crossOrigin:t.crossOrigin,loadType:i.LOAD_TYPE.IMAGE},s=n.dirname(t.url.replace(this.baseUrl,"")),a=o.utils.getResolutionOfUrl(t.url);this.add(t.name+"_image",s+"/"+t.data.meta.image,r,function(r){t.textures={};var i=t.data.frames;for(var n in i){var s=i[n].frame;if(s){var h=null,l=null;if(h=i[n].rotated?new o.Rectangle(s.x,s.y,s.h,s.w):new o.Rectangle(s.x,s.y,s.w,s.h),i[n].trimmed&&(l=new o.Rectangle(i[n].spriteSourceSize.x/a,i[n].spriteSourceSize.y/a,i[n].sourceSize.w/a,i[n].sourceSize.h/a)),i[n].rotated){var u=h.width;h.width=h.height,h.height=u}h.x/=a,h.y/=a,h.width/=a,h.height/=a,t.textures[n]=new o.Texture(r.texture.baseTexture,h,h.clone(),l,i[n].rotated),o.utils.TextureCache[n]=t.textures[n]}}e()})}}},{"../core":29,path:3,"resource-loader":18}],123:[function(t,e,r){var i=t("../core");e.exports=function(){return function(t,e){t.data&&t.isImage&&(t.texture=new i.Texture(new i.BaseTexture(t.data,null,i.utils.getResolutionOfUrl(t.url))),i.utils.TextureCache[t.url]=t.texture),e()}}},{"../core":29}],124:[function(t,e,r){function i(t,e,r,o,s){n.Container.call(this),this._texture=null,this.uvs=r||new Float32Array([0,1,1,1,1,0,0,1]),this.vertices=e||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=o||new Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=n.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=s||i.DRAW_MODES.TRIANGLE_MESH,this.texture=t}var n=t("../core"),o=new n.Point,s=new n.Polygon;i.prototype=Object.create(n.Container.prototype),i.prototype.constructor=i,e.exports=i,Object.defineProperties(i.prototype,{texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}}),i.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.mesh),t.plugins.mesh.render(this)},i.prototype._renderCanvas=function(t){var e=t.context,r=this.worldTransform;t.roundPixels?e.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):e.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.drawMode===i.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(e):this._renderCanvasTriangles(e)},i.prototype._renderCanvasTriangleMesh=function(t){for(var e=this.vertices,r=this.uvs,i=e.length/2,n=0;i-2>n;n++){var o=2*n;this._renderCanvasDrawTriangle(t,e,r,o,o+2,o+4)}},i.prototype._renderCanvasTriangles=function(t){for(var e=this.vertices,r=this.uvs,i=this.indices,n=i.length,o=0;n>o;o+=3){var s=2*i[o],a=2*i[o+1],h=2*i[o+2];this._renderCanvasDrawTriangle(t,e,r,s,a,h)}},i.prototype._renderCanvasDrawTriangle=function(t,e,r,i,n,o){var s=this._texture.baseTexture.source,a=this._texture.baseTexture.width,h=this._texture.baseTexture.height,l=e[i],u=e[n],c=e[o],p=e[i+1],d=e[n+1],f=e[o+1],v=r[i]*a,g=r[n]*a,m=r[o]*a,y=r[i+1]*h,x=r[n+1]*h,b=r[o+1]*h;if(this.canvasPadding>0){var _=this.canvasPadding/this.worldTransform.a,T=this.canvasPadding/this.worldTransform.d,E=(l+u+c)/3,S=(p+d+f)/3,A=l-E,w=p-S,C=Math.sqrt(A*A+w*w);l=E+A/C*(C+_),p=S+w/C*(C+T),A=u-E,w=d-S,C=Math.sqrt(A*A+w*w),u=E+A/C*(C+_),d=S+w/C*(C+T),A=c-E,w=f-S,C=Math.sqrt(A*A+w*w),c=E+A/C*(C+_),f=S+w/C*(C+T)}t.save(),t.beginPath(),t.moveTo(l,p),t.lineTo(u,d),t.lineTo(c,f),t.closePath(),t.clip();var M=v*x+y*m+g*b-x*m-y*g-v*b,R=l*x+y*c+u*b-x*c-y*u-l*b,D=v*u+l*m+g*c-u*m-l*g-v*c,F=v*x*c+y*u*m+l*g*b-l*x*m-y*g*c-v*u*b,P=p*x+y*f+d*b-x*f-y*d-p*b,O=v*d+p*m+g*f-d*m-p*g-v*f,B=v*x*f+y*d*m+p*g*b-p*x*m-y*g*f-v*d*b;t.transform(R/M,P/M,D/M,O/M,F/M,B/M),t.drawImage(s,0,0),t.restore()},i.prototype.renderMeshFlat=function(t){var e=this.context,r=t.vertices,i=r.length/2;e.beginPath();for(var n=1;i-2>n;n++){var o=2*n,s=r[o],a=r[o+2],h=r[o+4],l=r[o+1],u=r[o+3],c=r[o+5];e.moveTo(s,l),e.lineTo(a,u),e.lineTo(h,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},i.prototype._onTextureUpdate=function(){this.updateFrame=!0},i.prototype.getBounds=function(t){if(!this._currentBounds){for(var e=t||this.worldTransform,r=e.a,i=e.b,o=e.c,s=e.d,a=e.tx,h=e.ty,l=-(1/0),u=-(1/0),c=1/0,p=1/0,d=this.vertices,f=0,v=d.length;v>f;f+=2){var g=d[f],m=d[f+1],y=r*g+o*m+a,x=s*m+i*g+h;c=c>y?y:c,p=p>x?x:p,l=y>l?y:l,u=x>u?x:u}if(c===-(1/0)||u===1/0)return n.Rectangle.EMPTY;var b=this._bounds;b.x=c,b.width=l-c,b.y=p,b.height=u-p,this._currentBounds=b}return this._currentBounds},i.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,o);var e,r,n=this.vertices,a=s.points;if(this.drawMode===i.DRAW_MODES.TRIANGLES){var h=this.indices;for(r=this.indices.length,e=0;r>e;e+=3){var l=2*h[e],u=2*h[e+1],c=2*h[e+2];if(a[0]=n[l],a[1]=n[l+1],a[2]=n[u],a[3]=n[u+1],a[4]=n[c],a[5]=n[c+1],s.contains(o.x,o.y))return!0}}else for(r=n.length,e=0;r>e;e+=6)if(a[0]=n[e],a[1]=n[e+1],a[2]=n[e+2],a[3]=n[e+3],a[4]=n[e+4],a[5]=n[e+5],s.contains(o.x,o.y))return!0;return!1},i.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":29}],125:[function(t,e,r){function i(t,e){n.call(this,t),this.points=e,this.vertices=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length),this._ready=!0,this.refresh()}var n=t("./Mesh"),o=t("../core");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i,i.prototype.refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){var e=this.uvs,r=this.indices,i=this.colors,n=this._texture._uvs,s=new o.Point(n.x0,n.y0),a=new o.Point(n.x2-n.x0,n.y2-n.y0);e[0]=0+s.x,e[1]=0+s.y,e[2]=0+s.x,e[3]=1*a.y+s.y,i[0]=1,i[1]=1,r[0]=0,r[1]=1;for(var h,l,u,c=t.length,p=1;c>p;p++)h=t[p],l=4*p,u=p/(c-1),e[l]=u*a.x+s.x,e[l+1]=0+s.y,e[l+2]=u*a.x+s.x,e[l+3]=1*a.y+s.y,l=2*p,i[l]=1,i[l+1]=1,l=2*p,r[l]=l,r[l+1]=l+1;this.dirty=!0}},i.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},i.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){for(var e,r,i,n,o,s,a=t[0],h=0,l=0,u=this.vertices,c=t.length,p=0;c>p;p++)r=t[p],i=4*p,e=p<t.length-1?t[p+1]:r,l=-(e.x-a.x),h=e.y-a.y,n=10*(1-p/(c-1)),n>1&&(n=1),o=Math.sqrt(h*h+l*l),s=this._texture.height/2,h/=o,l/=o,h*=s,l*=s,u[i]=r.x+h,u[i+1]=r.y+l,u[i+2]=r.x-h,u[i+3]=r.y-l,a=r;this.containerUpdateTransform()}}},{"../core":29,"./Mesh":124}],126:[function(t,e,r){e.exports={Mesh:t("./Mesh"),Rope:t("./Rope"),MeshRenderer:t("./webgl/MeshRenderer"),MeshShader:t("./webgl/MeshShader")}},{"./Mesh":124,"./Rope":125,"./webgl/MeshRenderer":127,"./webgl/MeshShader":128}],127:[function(t,e,r){function i(t){n.ObjectRenderer.call(this,t),this.indices=new Uint16Array(15e3);for(var e=0,r=0;15e3>e;e+=6,r+=4)this.indices[e+0]=r+0,this.indices[e+1]=r+1,this.indices[e+2]=r+2,this.indices[e+3]=r+0,this.indices[e+4]=r+2,this.indices[e+5]=r+3}var n=t("../../core"),o=t("../Mesh");i.prototype=Object.create(n.ObjectRenderer.prototype),i.prototype.constructor=i,e.exports=i,n.WebGLRenderer.registerPlugin("mesh",i),i.prototype.onContextChange=function(){},i.prototype.render=function(t){t._vertexBuffer||this._initWebGL(t);var e=this.renderer,r=e.gl,i=t._texture.baseTexture,n=e.shaderManager.plugins.meshShader,s=t.drawMode===o.DRAW_MODES.TRIANGLE_MESH?r.TRIANGLE_STRIP:r.TRIANGLES;e.blendModeManager.setBlendMode(t.blendMode),r.uniformMatrix3fv(n.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),r.uniformMatrix3fv(n.uniforms.projectionMatrix._location,!1,e.currentRenderTarget.projectionMatrix.toArray(!0)),r.uniform1f(n.uniforms.alpha._location,t.worldAlpha),t.dirty?(t.dirty=!1,r.bindBuffer(r.ARRAY_BUFFER,t._vertexBuffer),r.bufferData(r.ARRAY_BUFFER,t.vertices,r.STATIC_DRAW),r.vertexAttribPointer(n.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t._uvBuffer),r.bufferData(r.ARRAY_BUFFER,t.uvs,r.STATIC_DRAW),r.vertexAttribPointer(n.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),i._glTextures[r.id]?r.bindTexture(r.TEXTURE_2D,i._glTextures[r.id]):this.renderer.updateTexture(i),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.indices,r.STATIC_DRAW)):(r.bindBuffer(r.ARRAY_BUFFER,t._vertexBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,t.vertices),r.vertexAttribPointer(n.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t._uvBuffer),r.vertexAttribPointer(n.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),i._glTextures[r.id]?r.bindTexture(r.TEXTURE_2D,i._glTextures[r.id]):this.renderer.updateTexture(i),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.indices)),r.drawElements(s,t.indices.length,r.UNSIGNED_SHORT,0)},i.prototype._initWebGL=function(t){var e=this.renderer.gl;t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),t.colors&&(t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},i.prototype.flush=function(){},i.prototype.start=function(){var t=this.renderer.shaderManager.plugins.meshShader;this.renderer.shaderManager.setShader(t)},i.prototype.destroy=function(){}},{"../../core":29,"../Mesh":124}],128:[function(t,e,r){function i(t){n.Shader.call(this,t,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var n=t("../../core");i.prototype=Object.create(n.Shader.prototype),i.prototype.constructor=i,e.exports=i,n.ShaderManager.registerPlugin("meshShader",i)},{"../../core":29}],129:[function(t,e,r){Object.assign||(Object.assign=t("object-assign"))},{"object-assign":12}],130:[function(t,e,r){t("./Object.assign"),t("./requestAnimationFrame")},{"./Object.assign":129,"./requestAnimationFrame":131}],131:[function(t,e,r){(function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var r=Date.now(),i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+r-e;return 0>i&&(i=0),r=e,setTimeout(function(){r=Date.now(),t(performance.now())},i)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});var Box2D={};!function(a2j,undefined){function emptyFn(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(obj,p,cfg){cfg.get instanceof Function&&obj.__defineGetter__(p,cfg.get),cfg.set instanceof Function&&obj.__defineSetter__(p,cfg.set)}),a2j.inherit=function(cls,base){var tmpCtr=cls;emptyFn.prototype=base.prototype,cls.prototype=new emptyFn,cls.prototype.constructor=tmpCtr},a2j.generateCallback=function(context,cb){return function(){cb.apply(context,arguments)}},a2j.NVector=function(length){length===undefined&&(length=0);for(var tmp=new Array(length||0),i=0;length>i;++i)tmp[i]=0;return tmp},a2j.is=function(o1,o2){return null===o1?!1:o2 instanceof Function&&o1 instanceof o2?!0:o1.constructor.__implements!=undefined&&o1.constructor.__implements[o2]?!0:!1},a2j.parseUInt=function(v){return Math.abs(parseInt(v))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={}),"undefined"==typeof Box2D.Collision&&(Box2D.Collision={}),"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),"undefined"==typeof Box2D.Common&&(Box2D.Common={}),"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={}),"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={}),"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function b2AABB(){b2AABB.b2AABB.apply(this,arguments)}function b2Bound(){b2Bound.b2Bound.apply(this,arguments)}function b2BoundValues(){b2BoundValues.b2BoundValues.apply(this,arguments),this.constructor===b2BoundValues&&this.b2BoundValues.apply(this,arguments)}function b2Collision(){b2Collision.b2Collision.apply(this,arguments)}function b2ContactID(){b2ContactID.b2ContactID.apply(this,arguments),this.constructor===b2ContactID&&this.b2ContactID.apply(this,arguments)}function b2ContactPoint(){b2ContactPoint.b2ContactPoint.apply(this,arguments)}function b2Distance(){b2Distance.b2Distance.apply(this,arguments)}function b2DistanceInput(){b2DistanceInput.b2DistanceInput.apply(this,arguments)}function b2DistanceOutput(){b2DistanceOutput.b2DistanceOutput.apply(this,arguments)}function b2DistanceProxy(){b2DistanceProxy.b2DistanceProxy.apply(this,arguments)}function b2DynamicTree(){b2DynamicTree.b2DynamicTree.apply(this,arguments),this.constructor===b2DynamicTree&&this.b2DynamicTree.apply(this,arguments)}function b2DynamicTreeBroadPhase(){b2DynamicTreeBroadPhase.b2DynamicTreeBroadPhase.apply(this,arguments)}function b2DynamicTreeNode(){b2DynamicTreeNode.b2DynamicTreeNode.apply(this,arguments)}function b2DynamicTreePair(){b2DynamicTreePair.b2DynamicTreePair.apply(this,arguments)}function b2Manifold(){b2Manifold.b2Manifold.apply(this,arguments),this.constructor===b2Manifold&&this.b2Manifold.apply(this,arguments)}function b2ManifoldPoint(){b2ManifoldPoint.b2ManifoldPoint.apply(this,arguments),this.constructor===b2ManifoldPoint&&this.b2ManifoldPoint.apply(this,arguments)}function b2Point(){b2Point.b2Point.apply(this,arguments)}function b2RayCastInput(){b2RayCastInput.b2RayCastInput.apply(this,arguments),this.constructor===b2RayCastInput&&this.b2RayCastInput.apply(this,arguments)}function b2RayCastOutput(){b2RayCastOutput.b2RayCastOutput.apply(this,arguments)}function b2Segment(){b2Segment.b2Segment.apply(this,arguments)}function b2SeparationFunction(){b2SeparationFunction.b2SeparationFunction.apply(this,arguments)}function b2Simplex(){b2Simplex.b2Simplex.apply(this,arguments),this.constructor===b2Simplex&&this.b2Simplex.apply(this,arguments)}function b2SimplexCache(){b2SimplexCache.b2SimplexCache.apply(this,arguments)}function b2SimplexVertex(){b2SimplexVertex.b2SimplexVertex.apply(this,arguments)}function b2TimeOfImpact(){b2TimeOfImpact.b2TimeOfImpact.apply(this,arguments)}function b2TOIInput(){b2TOIInput.b2TOIInput.apply(this,arguments)}function b2WorldManifold(){b2WorldManifold.b2WorldManifold.apply(this,arguments),this.constructor===b2WorldManifold&&this.b2WorldManifold.apply(this,arguments)}function ClipVertex(){ClipVertex.ClipVertex.apply(this,arguments)}function Features(){Features.Features.apply(this,arguments)}function b2CircleShape(){b2CircleShape.b2CircleShape.apply(this,arguments),this.constructor===b2CircleShape&&this.b2CircleShape.apply(this,arguments)}function b2EdgeChainDef(){b2EdgeChainDef.b2EdgeChainDef.apply(this,arguments),this.constructor===b2EdgeChainDef&&this.b2EdgeChainDef.apply(this,arguments)}function b2EdgeShape(){b2EdgeShape.b2EdgeShape.apply(this,arguments),this.constructor===b2EdgeShape&&this.b2EdgeShape.apply(this,arguments)}function b2MassData(){b2MassData.b2MassData.apply(this,arguments)}function b2PolygonShape(){b2PolygonShape.b2PolygonShape.apply(this,arguments),this.constructor===b2PolygonShape&&this.b2PolygonShape.apply(this,arguments)}function b2Shape(){b2Shape.b2Shape.apply(this,arguments),this.constructor===b2Shape&&this.b2Shape.apply(this,arguments)}function b2Color(){b2Color.b2Color.apply(this,arguments),this.constructor===b2Color&&this.b2Color.apply(this,arguments)}function b2Settings(){b2Settings.b2Settings.apply(this,arguments)}function b2Mat22(){b2Mat22.b2Mat22.apply(this,arguments),this.constructor===b2Mat22&&this.b2Mat22.apply(this,arguments)}function b2Mat33(){b2Mat33.b2Mat33.apply(this,arguments),this.constructor===b2Mat33&&this.b2Mat33.apply(this,arguments)}function b2Math(){b2Math.b2Math.apply(this,arguments)}function b2Sweep(){b2Sweep.b2Sweep.apply(this,arguments)}function b2Transform(){b2Transform.b2Transform.apply(this,arguments),this.constructor===b2Transform&&this.b2Transform.apply(this,arguments)}function b2Vec2(){b2Vec2.b2Vec2.apply(this,arguments),this.constructor===b2Vec2&&this.b2Vec2.apply(this,arguments)}function b2Vec3(){b2Vec3.b2Vec3.apply(this,arguments),this.constructor===b2Vec3&&this.b2Vec3.apply(this,arguments)}function b2Body(){b2Body.b2Body.apply(this,arguments),this.constructor===b2Body&&this.b2Body.apply(this,arguments)}function b2BodyDef(){b2BodyDef.b2BodyDef.apply(this,arguments),this.constructor===b2BodyDef&&this.b2BodyDef.apply(this,arguments)}function b2ContactFilter(){b2ContactFilter.b2ContactFilter.apply(this,arguments)}function b2ContactImpulse(){b2ContactImpulse.b2ContactImpulse.apply(this,arguments)}function b2ContactListener(){b2ContactListener.b2ContactListener.apply(this,arguments)}function b2ContactManager(){b2ContactManager.b2ContactManager.apply(this,arguments),this.constructor===b2ContactManager&&this.b2ContactManager.apply(this,arguments)}function b2DebugDraw(){b2DebugDraw.b2DebugDraw.apply(this,arguments),this.constructor===b2DebugDraw&&this.b2DebugDraw.apply(this,arguments)}function b2DestructionListener(){b2DestructionListener.b2DestructionListener.apply(this,arguments)}function b2FilterData(){b2FilterData.b2FilterData.apply(this,arguments)}function b2Fixture(){b2Fixture.b2Fixture.apply(this,arguments),this.constructor===b2Fixture&&this.b2Fixture.apply(this,arguments)}function b2FixtureDef(){b2FixtureDef.b2FixtureDef.apply(this,arguments),this.constructor===b2FixtureDef&&this.b2FixtureDef.apply(this,arguments)}function b2Island(){b2Island.b2Island.apply(this,arguments),this.constructor===b2Island&&this.b2Island.apply(this,arguments)}function b2TimeStep(){b2TimeStep.b2TimeStep.apply(this,arguments)}function b2World(){b2World.b2World.apply(this,arguments),this.constructor===b2World&&this.b2World.apply(this,arguments)}function b2CircleContact(){b2CircleContact.b2CircleContact.apply(this,arguments)}function b2Contact(){b2Contact.b2Contact.apply(this,arguments),this.constructor===b2Contact&&this.b2Contact.apply(this,arguments)}function b2ContactConstraint(){b2ContactConstraint.b2ContactConstraint.apply(this,arguments),this.constructor===b2ContactConstraint&&this.b2ContactConstraint.apply(this,arguments)}function b2ContactConstraintPoint(){b2ContactConstraintPoint.b2ContactConstraintPoint.apply(this,arguments)}function b2ContactEdge(){b2ContactEdge.b2ContactEdge.apply(this,arguments)}function b2ContactFactory(){b2ContactFactory.b2ContactFactory.apply(this,arguments),this.constructor===b2ContactFactory&&this.b2ContactFactory.apply(this,arguments)}function b2ContactRegister(){b2ContactRegister.b2ContactRegister.apply(this,arguments)}function b2ContactResult(){b2ContactResult.b2ContactResult.apply(this,arguments)}function b2ContactSolver(){b2ContactSolver.b2ContactSolver.apply(this,arguments),this.constructor===b2ContactSolver&&this.b2ContactSolver.apply(this,arguments)}function b2EdgeAndCircleContact(){b2EdgeAndCircleContact.b2EdgeAndCircleContact.apply(this,arguments)}function b2NullContact(){b2NullContact.b2NullContact.apply(this,arguments),this.constructor===b2NullContact&&this.b2NullContact.apply(this,arguments)}function b2PolyAndCircleContact(){b2PolyAndCircleContact.b2PolyAndCircleContact.apply(this,arguments)}function b2PolyAndEdgeContact(){b2PolyAndEdgeContact.b2PolyAndEdgeContact.apply(this,arguments)}function b2PolygonContact(){b2PolygonContact.b2PolygonContact.apply(this,arguments)}function b2PositionSolverManifold(){b2PositionSolverManifold.b2PositionSolverManifold.apply(this,arguments),this.constructor===b2PositionSolverManifold&&this.b2PositionSolverManifold.apply(this,arguments)}function b2BuoyancyController(){b2BuoyancyController.b2BuoyancyController.apply(this,arguments)}function b2ConstantAccelController(){b2ConstantAccelController.b2ConstantAccelController.apply(this,arguments)}function b2ConstantForceController(){b2ConstantForceController.b2ConstantForceController.apply(this,arguments)}function b2Controller(){b2Controller.b2Controller.apply(this,arguments)}function b2ControllerEdge(){b2ControllerEdge.b2ControllerEdge.apply(this,arguments)}function b2GravityController(){b2GravityController.b2GravityController.apply(this,arguments)}function b2TensorDampingController(){b2TensorDampingController.b2TensorDampingController.apply(this,arguments)}function b2DistanceJoint(){b2DistanceJoint.b2DistanceJoint.apply(this,arguments),this.constructor===b2DistanceJoint&&this.b2DistanceJoint.apply(this,arguments)}function b2DistanceJointDef(){b2DistanceJointDef.b2DistanceJointDef.apply(this,arguments),this.constructor===b2DistanceJointDef&&this.b2DistanceJointDef.apply(this,arguments)}function b2FrictionJoint(){b2FrictionJoint.b2FrictionJoint.apply(this,arguments),this.constructor===b2FrictionJoint&&this.b2FrictionJoint.apply(this,arguments)}function b2FrictionJointDef(){b2FrictionJointDef.b2FrictionJointDef.apply(this,arguments),this.constructor===b2FrictionJointDef&&this.b2FrictionJointDef.apply(this,arguments);

}function b2GearJoint(){b2GearJoint.b2GearJoint.apply(this,arguments),this.constructor===b2GearJoint&&this.b2GearJoint.apply(this,arguments)}function b2GearJointDef(){b2GearJointDef.b2GearJointDef.apply(this,arguments),this.constructor===b2GearJointDef&&this.b2GearJointDef.apply(this,arguments)}function b2Jacobian(){b2Jacobian.b2Jacobian.apply(this,arguments)}function b2Joint(){b2Joint.b2Joint.apply(this,arguments),this.constructor===b2Joint&&this.b2Joint.apply(this,arguments)}function b2JointDef(){b2JointDef.b2JointDef.apply(this,arguments),this.constructor===b2JointDef&&this.b2JointDef.apply(this,arguments)}function b2JointEdge(){b2JointEdge.b2JointEdge.apply(this,arguments)}function b2LineJoint(){b2LineJoint.b2LineJoint.apply(this,arguments),this.constructor===b2LineJoint&&this.b2LineJoint.apply(this,arguments)}function b2LineJointDef(){b2LineJointDef.b2LineJointDef.apply(this,arguments),this.constructor===b2LineJointDef&&this.b2LineJointDef.apply(this,arguments)}function b2MouseJoint(){b2MouseJoint.b2MouseJoint.apply(this,arguments),this.constructor===b2MouseJoint&&this.b2MouseJoint.apply(this,arguments)}function b2MouseJointDef(){b2MouseJointDef.b2MouseJointDef.apply(this,arguments),this.constructor===b2MouseJointDef&&this.b2MouseJointDef.apply(this,arguments)}function b2PrismaticJoint(){b2PrismaticJoint.b2PrismaticJoint.apply(this,arguments),this.constructor===b2PrismaticJoint&&this.b2PrismaticJoint.apply(this,arguments)}function b2PrismaticJointDef(){b2PrismaticJointDef.b2PrismaticJointDef.apply(this,arguments),this.constructor===b2PrismaticJointDef&&this.b2PrismaticJointDef.apply(this,arguments)}function b2PulleyJoint(){b2PulleyJoint.b2PulleyJoint.apply(this,arguments),this.constructor===b2PulleyJoint&&this.b2PulleyJoint.apply(this,arguments)}function b2PulleyJointDef(){b2PulleyJointDef.b2PulleyJointDef.apply(this,arguments),this.constructor===b2PulleyJointDef&&this.b2PulleyJointDef.apply(this,arguments)}function b2RevoluteJoint(){b2RevoluteJoint.b2RevoluteJoint.apply(this,arguments),this.constructor===b2RevoluteJoint&&this.b2RevoluteJoint.apply(this,arguments)}function b2RevoluteJointDef(){b2RevoluteJointDef.b2RevoluteJointDef.apply(this,arguments),this.constructor===b2RevoluteJointDef&&this.b2RevoluteJointDef.apply(this,arguments)}function b2WeldJoint(){b2WeldJoint.b2WeldJoint.apply(this,arguments),this.constructor===b2WeldJoint&&this.b2WeldJoint.apply(this,arguments)}function b2WeldJointDef(){b2WeldJointDef.b2WeldJointDef.apply(this,arguments),this.constructor===b2WeldJointDef&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=b2AABB,Box2D.Collision.b2Bound=b2Bound,Box2D.Collision.b2BoundValues=b2BoundValues,Box2D.Collision.b2Collision=b2Collision,Box2D.Collision.b2ContactID=b2ContactID,Box2D.Collision.b2ContactPoint=b2ContactPoint,Box2D.Collision.b2Distance=b2Distance,Box2D.Collision.b2DistanceInput=b2DistanceInput,Box2D.Collision.b2DistanceOutput=b2DistanceOutput,Box2D.Collision.b2DistanceProxy=b2DistanceProxy,Box2D.Collision.b2DynamicTree=b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode=b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair=b2DynamicTreePair,Box2D.Collision.b2Manifold=b2Manifold,Box2D.Collision.b2ManifoldPoint=b2ManifoldPoint,Box2D.Collision.b2Point=b2Point,Box2D.Collision.b2RayCastInput=b2RayCastInput,Box2D.Collision.b2RayCastOutput=b2RayCastOutput,Box2D.Collision.b2Segment=b2Segment,Box2D.Collision.b2SeparationFunction=b2SeparationFunction,Box2D.Collision.b2Simplex=b2Simplex,Box2D.Collision.b2SimplexCache=b2SimplexCache,Box2D.Collision.b2SimplexVertex=b2SimplexVertex,Box2D.Collision.b2TimeOfImpact=b2TimeOfImpact,Box2D.Collision.b2TOIInput=b2TOIInput,Box2D.Collision.b2WorldManifold=b2WorldManifold,Box2D.Collision.ClipVertex=ClipVertex,Box2D.Collision.Features=Features,Box2D.Collision.Shapes.b2CircleShape=b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef=b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape=b2EdgeShape,Box2D.Collision.Shapes.b2MassData=b2MassData,Box2D.Collision.Shapes.b2PolygonShape=b2PolygonShape,Box2D.Collision.Shapes.b2Shape=b2Shape,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=b2Color,Box2D.Common.b2Settings=b2Settings,Box2D.Common.Math.b2Mat22=b2Mat22,Box2D.Common.Math.b2Mat33=b2Mat33,Box2D.Common.Math.b2Math=b2Math,Box2D.Common.Math.b2Sweep=b2Sweep,Box2D.Common.Math.b2Transform=b2Transform,Box2D.Common.Math.b2Vec2=b2Vec2,Box2D.Common.Math.b2Vec3=b2Vec3,Box2D.Dynamics.b2Body=b2Body,Box2D.Dynamics.b2BodyDef=b2BodyDef,Box2D.Dynamics.b2ContactFilter=b2ContactFilter,Box2D.Dynamics.b2ContactImpulse=b2ContactImpulse,Box2D.Dynamics.b2ContactListener=b2ContactListener,Box2D.Dynamics.b2ContactManager=b2ContactManager,Box2D.Dynamics.b2DebugDraw=b2DebugDraw,Box2D.Dynamics.b2DestructionListener=b2DestructionListener,Box2D.Dynamics.b2FilterData=b2FilterData,Box2D.Dynamics.b2Fixture=b2Fixture,Box2D.Dynamics.b2FixtureDef=b2FixtureDef,Box2D.Dynamics.b2Island=b2Island,Box2D.Dynamics.b2TimeStep=b2TimeStep,Box2D.Dynamics.b2World=b2World,Box2D.Dynamics.Contacts.b2CircleContact=b2CircleContact,Box2D.Dynamics.Contacts.b2Contact=b2Contact,Box2D.Dynamics.Contacts.b2ContactConstraint=b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge=b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory=b2ContactFactory,Box2D.Dynamics.Contacts.b2ContactRegister=b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult=b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver=b2ContactSolver,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact=b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact=b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold=b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2BuoyancyController=b2BuoyancyController,Box2D.Dynamics.Controllers.b2ConstantAccelController=b2ConstantAccelController,Box2D.Dynamics.Controllers.b2ConstantForceController=b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller=b2Controller,Box2D.Dynamics.Controllers.b2ControllerEdge=b2ControllerEdge,Box2D.Dynamics.Controllers.b2GravityController=b2GravityController,Box2D.Dynamics.Controllers.b2TensorDampingController=b2TensorDampingController,Box2D.Dynamics.Joints.b2DistanceJoint=b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef=b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint=b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef=b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint=b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef=b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian=b2Jacobian,Box2D.Dynamics.Joints.b2Joint=b2Joint,Box2D.Dynamics.Joints.b2JointDef=b2JointDef,Box2D.Dynamics.Joints.b2JointEdge=b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint=b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef=b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint=b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef=b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint=b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef=b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint=b2PulleyJoint,Box2D.Dynamics.Joints.b2PulleyJointDef=b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint=b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef=b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint=b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef=b2WeldJointDef}(),Box2D.postDefs=[],function(){var b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2PolygonShape=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),b2Shape=Box2D.Collision.Shapes.b2Shape,b2Settings=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b2Math=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b2Sweep=Box2D.Common.Math.b2Sweep,b2Transform=Box2D.Common.Math.b2Transform,b2Vec2=Box2D.Common.Math.b2Vec2,b2AABB=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),b2Bound=Box2D.Collision.b2Bound,b2BoundValues=Box2D.Collision.b2BoundValues,b2Collision=Box2D.Collision.b2Collision,b2ContactID=Box2D.Collision.b2ContactID,b2ContactPoint=Box2D.Collision.b2ContactPoint,b2Distance=Box2D.Collision.b2Distance,b2DistanceInput=Box2D.Collision.b2DistanceInput,b2DistanceOutput=Box2D.Collision.b2DistanceOutput,b2DistanceProxy=Box2D.Collision.b2DistanceProxy,b2DynamicTree=Box2D.Collision.b2DynamicTree,b2DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,b2DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,b2DynamicTreePair=Box2D.Collision.b2DynamicTreePair,b2Manifold=Box2D.Collision.b2Manifold,b2ManifoldPoint=Box2D.Collision.b2ManifoldPoint,b2Point=Box2D.Collision.b2Point,b2RayCastInput=Box2D.Collision.b2RayCastInput,b2RayCastOutput=Box2D.Collision.b2RayCastOutput,b2Segment=Box2D.Collision.b2Segment,b2SeparationFunction=Box2D.Collision.b2SeparationFunction,b2Simplex=Box2D.Collision.b2Simplex,b2SimplexCache=Box2D.Collision.b2SimplexCache,b2SimplexVertex=Box2D.Collision.b2SimplexVertex,b2TimeOfImpact=Box2D.Collision.b2TimeOfImpact,b2TOIInput=Box2D.Collision.b2TOIInput,b2WorldManifold=Box2D.Collision.b2WorldManifold,ClipVertex=Box2D.Collision.ClipVertex,Features=Box2D.Collision.Features,IBroadPhase=Box2D.Collision.IBroadPhase;b2AABB.b2AABB=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2},b2AABB.prototype.IsValid=function(){var dX=this.upperBound.x-this.lowerBound.x,dY=this.upperBound.y-this.lowerBound.y,valid=dX>=0&&dY>=0;return valid=valid&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return new b2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b2AABB.prototype.GetExtents=function(){return new b2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b2AABB.prototype.Contains=function(aabb){var result=!0;return result=result&&this.lowerBound.x<=aabb.lowerBound.x,result=result&&this.lowerBound.y<=aabb.lowerBound.y,result=result&&aabb.upperBound.x<=this.upperBound.x,result=result&&aabb.upperBound.y<=this.upperBound.y},b2AABB.prototype.RayCast=function(output,input){var tmin=-Number.MAX_VALUE,tmax=Number.MAX_VALUE,pX=input.p1.x,pY=input.p1.y,dX=input.p2.x-input.p1.x,dY=input.p2.y-input.p1.y,absDX=Math.abs(dX),absDY=Math.abs(dY),normal=output.normal,inv_d=0,t1=0,t2=0,t3=0,s=0;if(absDX<Number.MIN_VALUE){if(pX<this.lowerBound.x||this.upperBound.x<pX)return!1}else if(inv_d=1/dX,t1=(this.lowerBound.x-pX)*inv_d,t2=(this.upperBound.x-pX)*inv_d,s=-1,t1>t2&&(t3=t1,t1=t2,t2=t3,s=1),t1>tmin&&(normal.x=s,normal.y=0,tmin=t1),tmax=Math.min(tmax,t2),tmin>tmax)return!1;if(absDY<Number.MIN_VALUE){if(pY<this.lowerBound.y||this.upperBound.y<pY)return!1}else if(inv_d=1/dY,t1=(this.lowerBound.y-pY)*inv_d,t2=(this.upperBound.y-pY)*inv_d,s=-1,t1>t2&&(t3=t1,t1=t2,t2=t3,s=1),t1>tmin&&(normal.y=s,normal.x=0,tmin=t1),tmax=Math.min(tmax,t2),tmin>tmax)return!1;return output.fraction=tmin,!0},b2AABB.prototype.TestOverlap=function(other){var d1X=other.lowerBound.x-this.upperBound.x,d1Y=other.lowerBound.y-this.upperBound.y,d2X=this.lowerBound.x-other.upperBound.x,d2Y=this.lowerBound.y-other.upperBound.y;return d1X>0||d1Y>0?!1:d2X>0||d2Y>0?!1:!0},b2AABB.Combine=function(aabb1,aabb2){var aabb=new b2AABB;return aabb.Combine(aabb1,aabb2),aabb},b2AABB.prototype.Combine=function(aabb1,aabb2){this.lowerBound.x=Math.min(aabb1.lowerBound.x,aabb2.lowerBound.x),this.lowerBound.y=Math.min(aabb1.lowerBound.y,aabb2.lowerBound.y),this.upperBound.x=Math.max(aabb1.upperBound.x,aabb2.upperBound.x),this.upperBound.y=Math.max(aabb1.upperBound.y,aabb2.upperBound.y)},b2Bound.b2Bound=function(){},b2Bound.prototype.IsLower=function(){return 0==(1&this.value)},b2Bound.prototype.IsUpper=function(){return 1==(1&this.value)},b2Bound.prototype.Swap=function(b){var tempValue=this.value,tempProxy=this.proxy,tempStabbingCount=this.stabbingCount;this.value=b.value,this.proxy=b.proxy,this.stabbingCount=b.stabbingCount,b.value=tempValue,b.proxy=tempProxy,b.stabbingCount=tempStabbingCount},b2BoundValues.b2BoundValues=function(){},b2BoundValues.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},b2Collision.b2Collision=function(){},b2Collision.ClipSegmentToLine=function(vOut,vIn,normal,offset){void 0===offset&&(offset=0);var cv,numOut=0;cv=vIn[0];var vIn0=cv.v;cv=vIn[1];var vIn1=cv.v,distance0=normal.x*vIn0.x+normal.y*vIn0.y-offset,distance1=normal.x*vIn1.x+normal.y*vIn1.y-offset;if(0>=distance0&&vOut[numOut++].Set(vIn[0]),0>=distance1&&vOut[numOut++].Set(vIn[1]),0>distance0*distance1){var interp=distance0/(distance0-distance1);cv=vOut[numOut];var tVec=cv.v;tVec.x=vIn0.x+interp*(vIn1.x-vIn0.x),tVec.y=vIn0.y+interp*(vIn1.y-vIn0.y),cv=vOut[numOut];var cv2;distance0>0?(cv2=vIn[0],cv.id=cv2.id):(cv2=vIn[1],cv.id=cv2.id),++numOut}return numOut},b2Collision.EdgeSeparation=function(poly1,xf1,edge1,poly2,xf2){void 0===edge1&&(edge1=0);var tMat,tVec,vertices1=(parseInt(poly1.m_vertexCount),poly1.m_vertices),normals1=poly1.m_normals,count2=parseInt(poly2.m_vertexCount),vertices2=poly2.m_vertices;tMat=xf1.R,tVec=normals1[edge1];var normal1WorldX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normal1WorldY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=xf2.R;for(var normal1X=tMat.col1.x*normal1WorldX+tMat.col1.y*normal1WorldY,normal1Y=tMat.col2.x*normal1WorldX+tMat.col2.y*normal1WorldY,index=0,minDot=Number.MAX_VALUE,i=0;count2>i;++i){tVec=vertices2[i];var dot=tVec.x*normal1X+tVec.y*normal1Y;minDot>dot&&(minDot=dot,index=i)}tVec=vertices1[edge1],tMat=xf1.R;var v1X=xf1.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),v1Y=xf1.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);tVec=vertices2[index],tMat=xf2.R;var v2X=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),v2Y=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);v2X-=v1X,v2Y-=v1Y;var separation=v2X*normal1WorldX+v2Y*normal1WorldY;return separation},b2Collision.FindMaxSeparation=function(edgeIndex,poly1,xf1,poly2,xf2){var tVec,tMat,count1=parseInt(poly1.m_vertexCount),normals1=poly1.m_normals;tMat=xf2.R,tVec=poly2.m_centroid;var dX=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),dY=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);tMat=xf1.R,tVec=poly1.m_centroid,dX-=xf1.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),dY-=xf1.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);for(var dLocal1X=dX*xf1.R.col1.x+dY*xf1.R.col1.y,dLocal1Y=dX*xf1.R.col2.x+dY*xf1.R.col2.y,edge=0,maxDot=-Number.MAX_VALUE,i=0;count1>i;++i){tVec=normals1[i];var dot=tVec.x*dLocal1X+tVec.y*dLocal1Y;dot>maxDot&&(maxDot=dot,edge=i)}var s=b2Collision.EdgeSeparation(poly1,xf1,edge,poly2,xf2),prevEdge=parseInt(edge-1>=0?edge-1:count1-1),sPrev=b2Collision.EdgeSeparation(poly1,xf1,prevEdge,poly2,xf2),nextEdge=parseInt(count1>edge+1?edge+1:0),sNext=b2Collision.EdgeSeparation(poly1,xf1,nextEdge,poly2,xf2),bestEdge=0,bestSeparation=0,increment=0;if(sPrev>s&&sPrev>sNext)increment=-1,bestEdge=prevEdge,bestSeparation=sPrev;else{if(!(sNext>s))return edgeIndex[0]=edge,s;increment=1,bestEdge=nextEdge,bestSeparation=sNext}for(;;){if(edge=-1==increment?bestEdge-1>=0?bestEdge-1:count1-1:count1>bestEdge+1?bestEdge+1:0,s=b2Collision.EdgeSeparation(poly1,xf1,edge,poly2,xf2),!(s>bestSeparation))break;bestEdge=edge,bestSeparation=s}return edgeIndex[0]=bestEdge,bestSeparation},b2Collision.FindIncidentEdge=function(c,poly1,xf1,edge1,poly2,xf2){void 0===edge1&&(edge1=0);var tMat,tVec,normals1=(parseInt(poly1.m_vertexCount),poly1.m_normals),count2=parseInt(poly2.m_vertexCount),vertices2=poly2.m_vertices,normals2=poly2.m_normals;tMat=xf1.R,tVec=normals1[edge1];var normal1X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normal1Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=xf2.R;var tX=tMat.col1.x*normal1X+tMat.col1.y*normal1Y;normal1Y=tMat.col2.x*normal1X+tMat.col2.y*normal1Y,normal1X=tX;for(var index=0,minDot=Number.MAX_VALUE,i=0;count2>i;++i){tVec=normals2[i];var dot=normal1X*tVec.x+normal1Y*tVec.y;minDot>dot&&(minDot=dot,index=i)}var tClip,i1=parseInt(index),i2=parseInt(count2>i1+1?i1+1:0);tClip=c[0],tVec=vertices2[i1],tMat=xf2.R,tClip.v.x=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),tClip.v.y=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tClip.id.features.referenceEdge=edge1,tClip.id.features.incidentEdge=i1,tClip.id.features.incidentVertex=0,tClip=c[1],tVec=vertices2[i2],tMat=xf2.R,tClip.v.x=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),tClip.v.y=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tClip.id.features.referenceEdge=edge1,tClip.id.features.incidentEdge=i2,tClip.id.features.incidentVertex=1},b2Collision.MakeClipPointVector=function(){var r=new Vector(2);return r[0]=new ClipVertex,r[1]=new ClipVertex,r},b2Collision.CollidePolygons=function(manifold,polyA,xfA,polyB,xfB){var cv;manifold.m_pointCount=0;var totalRadius=polyA.m_radius+polyB.m_radius,edgeA=0;b2Collision.s_edgeAO[0]=edgeA;var separationA=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,polyA,xfA,polyB,xfB);if(edgeA=b2Collision.s_edgeAO[0],!(separationA>totalRadius)){var edgeB=0;b2Collision.s_edgeBO[0]=edgeB;var separationB=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,polyB,xfB,polyA,xfA);if(edgeB=b2Collision.s_edgeBO[0],!(separationB>totalRadius)){var poly1,poly2,xf1,xf2,tMat,edge1=0,flip=0,k_relativeTol=.98,k_absoluteTol=.001;separationB>k_relativeTol*separationA+k_absoluteTol?(poly1=polyB,poly2=polyA,xf1=xfB,xf2=xfA,edge1=edgeB,manifold.m_type=b2Manifold.e_faceB,flip=1):(poly1=polyA,poly2=polyB,xf1=xfA,xf2=xfB,edge1=edgeA,manifold.m_type=b2Manifold.e_faceA,flip=0);var incidentEdge=b2Collision.s_incidentEdge;b2Collision.FindIncidentEdge(incidentEdge,poly1,xf1,edge1,poly2,xf2);var local_v12,count1=parseInt(poly1.m_vertexCount),vertices1=poly1.m_vertices,local_v11=vertices1[edge1];local_v12=count1>edge1+1?vertices1[parseInt(edge1+1)]:vertices1[0];var localTangent=b2Collision.s_localTangent;localTangent.Set(local_v12.x-local_v11.x,local_v12.y-local_v11.y),localTangent.Normalize();var localNormal=b2Collision.s_localNormal;localNormal.x=localTangent.y,localNormal.y=-localTangent.x;var planePoint=b2Collision.s_planePoint;planePoint.Set(.5*(local_v11.x+local_v12.x),.5*(local_v11.y+local_v12.y));var tangent=b2Collision.s_tangent;tMat=xf1.R,tangent.x=tMat.col1.x*localTangent.x+tMat.col2.x*localTangent.y,tangent.y=tMat.col1.y*localTangent.x+tMat.col2.y*localTangent.y;var tangent2=b2Collision.s_tangent2;tangent2.x=-tangent.x,tangent2.y=-tangent.y;var normal=b2Collision.s_normal;normal.x=tangent.y,normal.y=-tangent.x;var v11=b2Collision.s_v11,v12=b2Collision.s_v12;v11.x=xf1.position.x+(tMat.col1.x*local_v11.x+tMat.col2.x*local_v11.y),v11.y=xf1.position.y+(tMat.col1.y*local_v11.x+tMat.col2.y*local_v11.y),v12.x=xf1.position.x+(tMat.col1.x*local_v12.x+tMat.col2.x*local_v12.y),v12.y=xf1.position.y+(tMat.col1.y*local_v12.x+tMat.col2.y*local_v12.y);var frontOffset=normal.x*v11.x+normal.y*v11.y,sideOffset1=-tangent.x*v11.x-tangent.y*v11.y+totalRadius,sideOffset2=tangent.x*v12.x+tangent.y*v12.y+totalRadius,clipPoints1=b2Collision.s_clipPoints1,clipPoints2=b2Collision.s_clipPoints2,np=0;if(np=b2Collision.ClipSegmentToLine(clipPoints1,incidentEdge,tangent2,sideOffset1),!(2>np||(np=b2Collision.ClipSegmentToLine(clipPoints2,clipPoints1,tangent,sideOffset2),2>np))){manifold.m_localPlaneNormal.SetV(localNormal),manifold.m_localPoint.SetV(planePoint);for(var pointCount=0,i=0;i<b2Settings.b2_maxManifoldPoints;++i){cv=clipPoints2[i];var separation=normal.x*cv.v.x+normal.y*cv.v.y-frontOffset;if(totalRadius>=separation){var cp=manifold.m_points[pointCount];tMat=xf2.R;var tX=cv.v.x-xf2.position.x,tY=cv.v.y-xf2.position.y;cp.m_localPoint.x=tX*tMat.col1.x+tY*tMat.col1.y,cp.m_localPoint.y=tX*tMat.col2.x+tY*tMat.col2.y,cp.m_id.Set(cv.id),cp.m_id.features.flip=flip,++pointCount}}manifold.m_pointCount=pointCount}}}},b2Collision.CollideCircles=function(manifold,circle1,xf1,circle2,xf2){manifold.m_pointCount=0;var tMat,tVec;tMat=xf1.R,tVec=circle1.m_p;var p1X=xf1.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),p1Y=xf1.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);tMat=xf2.R,tVec=circle2.m_p;var p2X=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),p2Y=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),dX=p2X-p1X,dY=p2Y-p1Y,distSqr=dX*dX+dY*dY,radius=circle1.m_radius+circle2.m_radius;distSqr>radius*radius||(manifold.m_type=b2Manifold.e_circles,manifold.m_localPoint.SetV(circle1.m_p),manifold.m_localPlaneNormal.SetZero(),manifold.m_pointCount=1,manifold.m_points[0].m_localPoint.SetV(circle2.m_p),manifold.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(manifold,polygon,xf1,circle,xf2){manifold.m_pointCount=0;var tVec,tMat,dX=0,dY=0;tMat=xf2.R,tVec=circle.m_p;var cX=xf2.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),cY=xf2.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);dX=cX-xf1.position.x,dY=cY-xf1.position.y,tMat=xf1.R;for(var cLocalX=dX*tMat.col1.x+dY*tMat.col1.y,cLocalY=dX*tMat.col2.x+dY*tMat.col2.y,normalIndex=0,separation=-Number.MAX_VALUE,radius=polygon.m_radius+circle.m_radius,vertexCount=parseInt(polygon.m_vertexCount),vertices=polygon.m_vertices,normals=polygon.m_normals,i=0;vertexCount>i;++i){tVec=vertices[i],dX=cLocalX-tVec.x,dY=cLocalY-tVec.y,tVec=normals[i];var s=tVec.x*dX+tVec.y*dY;if(s>radius)return;s>separation&&(separation=s,normalIndex=i)}var vertIndex1=parseInt(normalIndex),vertIndex2=parseInt(vertexCount>vertIndex1+1?vertIndex1+1:0),v1=vertices[vertIndex1],v2=vertices[vertIndex2];if(separation<Number.MIN_VALUE)return manifold.m_pointCount=1,manifold.m_type=b2Manifold.e_faceA,manifold.m_localPlaneNormal.SetV(normals[normalIndex]),manifold.m_localPoint.x=.5*(v1.x+v2.x),manifold.m_localPoint.y=.5*(v1.y+v2.y),manifold.m_points[0].m_localPoint.SetV(circle.m_p),void(manifold.m_points[0].m_id.key=0);var u1=(cLocalX-v1.x)*(v2.x-v1.x)+(cLocalY-v1.y)*(v2.y-v1.y),u2=(cLocalX-v2.x)*(v1.x-v2.x)+(cLocalY-v2.y)*(v1.y-v2.y);if(0>=u1){if((cLocalX-v1.x)*(cLocalX-v1.x)+(cLocalY-v1.y)*(cLocalY-v1.y)>radius*radius)return;manifold.m_pointCount=1,manifold.m_type=b2Manifold.e_faceA,manifold.m_localPlaneNormal.x=cLocalX-v1.x,manifold.m_localPlaneNormal.y=cLocalY-v1.y,manifold.m_localPlaneNormal.Normalize(),manifold.m_localPoint.SetV(v1),manifold.m_points[0].m_localPoint.SetV(circle.m_p),manifold.m_points[0].m_id.key=0}else if(0>=u2){if((cLocalX-v2.x)*(cLocalX-v2.x)+(cLocalY-v2.y)*(cLocalY-v2.y)>radius*radius)return;manifold.m_pointCount=1,manifold.m_type=b2Manifold.e_faceA,manifold.m_localPlaneNormal.x=cLocalX-v2.x,manifold.m_localPlaneNormal.y=cLocalY-v2.y,manifold.m_localPlaneNormal.Normalize(),manifold.m_localPoint.SetV(v2),manifold.m_points[0].m_localPoint.SetV(circle.m_p),manifold.m_points[0].m_id.key=0}else{var faceCenterX=.5*(v1.x+v2.x),faceCenterY=.5*(v1.y+v2.y);if(separation=(cLocalX-faceCenterX)*normals[vertIndex1].x+(cLocalY-faceCenterY)*normals[vertIndex1].y,separation>radius)return;manifold.m_pointCount=1,manifold.m_type=b2Manifold.e_faceA,manifold.m_localPlaneNormal.x=normals[vertIndex1].x,manifold.m_localPlaneNormal.y=normals[vertIndex1].y,manifold.m_localPlaneNormal.Normalize(),manifold.m_localPoint.Set(faceCenterX,faceCenterY),manifold.m_points[0].m_localPoint.SetV(circle.m_p),manifold.m_points[0].m_id.key=0}},b2Collision.TestOverlap=function(a,b){var t1=b.lowerBound,t2=a.upperBound,d1X=t1.x-t2.x,d1Y=t1.y-t2.y;t1=a.lowerBound,t2=b.upperBound;var d2X=t1.x-t2.x,d2Y=t1.y-t2.y;return d1X>0||d1Y>0?!1:d2X>0||d2Y>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new b2Vec2,Box2D.Collision.b2Collision.s_localNormal=new b2Vec2,Box2D.Collision.b2Collision.s_planePoint=new b2Vec2,Box2D.Collision.b2Collision.s_normal=new b2Vec2,Box2D.Collision.b2Collision.s_tangent=new b2Vec2,Box2D.Collision.b2Collision.s_tangent2=new b2Vec2,Box2D.Collision.b2Collision.s_v11=new b2Vec2,Box2D.Collision.b2Collision.s_v12=new b2Vec2,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new b2Vec2,Box2D.Collision.b2Collision.b2_nullFeature=255}),b2ContactID.b2ContactID=function(){this.features=new Features},b2ContactID.prototype.b2ContactID=function(){this.features._m_id=this},b2ContactID.prototype.Set=function(id){this.key=id._key},b2ContactID.prototype.Copy=function(){var id=new b2ContactID;return id.key=this.key,id},Object.defineProperty(b2ContactID.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(b2ContactID.prototype,"key",{enumerable:!1,configurable:!0,set:function(value){void 0===value&&(value=0),this._key=value,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),b2ContactPoint.b2ContactPoint=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2Distance.b2Distance=function(){},b2Distance.Distance=function(output,cache,input){++b2Distance.b2_gjkCalls;var proxyA=input.proxyA,proxyB=input.proxyB,transformA=input.transformA,transformB=input.transformB,simplex=b2Distance.s_simplex;simplex.ReadCache(cache,proxyA,transformA,proxyB,transformB);for(var p,vertices=simplex.m_vertices,k_maxIters=20,saveA=b2Distance.s_saveA,saveB=b2Distance.s_saveB,saveCount=0,closestPoint=simplex.GetClosestPoint(),distanceSqr1=closestPoint.LengthSquared(),distanceSqr2=distanceSqr1,i=0,iter=0;k_maxIters>iter;){for(saveCount=simplex.m_count,i=0;saveCount>i;i++)saveA[i]=vertices[i].indexA,saveB[i]=vertices[i].indexB;switch(simplex.m_count){case 1:break;case 2:simplex.Solve2();break;case 3:simplex.Solve3();break;default:b2Settings.b2Assert(!1)}if(3==simplex.m_count)break;p=simplex.GetClosestPoint(),distanceSqr2=p.LengthSquared(),distanceSqr1=distanceSqr2;var d=simplex.GetSearchDirection();if(d.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var vertex=vertices[simplex.m_count];vertex.indexA=proxyA.GetSupport(b2Math.MulTMV(transformA.R,d.GetNegative())),vertex.wA=b2Math.MulX(transformA,proxyA.GetVertex(vertex.indexA)),vertex.indexB=proxyB.GetSupport(b2Math.MulTMV(transformB.R,d)),vertex.wB=b2Math.MulX(transformB,proxyB.GetVertex(vertex.indexB)),vertex.w=b2Math.SubtractVV(vertex.wB,vertex.wA),++iter,++b2Distance.b2_gjkIters;var duplicate=!1;for(i=0;saveCount>i;i++)if(vertex.indexA==saveA[i]&&vertex.indexB==saveB[i]){duplicate=!0;break}if(duplicate)break;++simplex.m_count}if(b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,iter),simplex.GetWitnessPoints(output.pointA,output.pointB),output.distance=b2Math.SubtractVV(output.pointA,output.pointB).Length(),output.iterations=iter,simplex.WriteCache(cache),input.useRadii){var rA=proxyA.m_radius,rB=proxyB.m_radius;if(output.distance>rA+rB&&output.distance>Number.MIN_VALUE){output.distance-=rA+rB;var normal=b2Math.SubtractVV(output.pointB,output.pointA);normal.Normalize(),output.pointA.x+=rA*normal.x,output.pointA.y+=rA*normal.y,output.pointB.x-=rB*normal.x,output.pointB.y-=rB*normal.y}else p=new b2Vec2,p.x=.5*(output.pointA.x+output.pointB.x),p.y=.5*(output.pointA.y+output.pointB.y),output.pointA.x=output.pointB.x=p.x,output.pointA.y=output.pointB.y=p.y,output.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new b2Simplex,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),b2DistanceInput.b2DistanceInput=function(){},b2DistanceOutput.b2DistanceOutput=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceProxy.b2DistanceProxy=function(){},b2DistanceProxy.prototype.Set=function(shape){switch(shape.GetType()){case b2Shape.e_circleShape:var circle=shape instanceof b2CircleShape?shape:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=circle.m_p,this.m_count=1,this.m_radius=circle.m_radius;break;case b2Shape.e_polygonShape:var polygon=shape instanceof b2PolygonShape?shape:null;this.m_vertices=polygon.m_vertices,this.m_count=polygon.m_vertexCount,this.m_radius=polygon.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(d){for(var bestIndex=0,bestValue=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,i=1;i<this.m_count;++i){var value=this.m_vertices[i].x*d.x+this.m_vertices[i].y*d.y;value>bestValue&&(bestIndex=i,bestValue=value)}return bestIndex},b2DistanceProxy.prototype.GetSupportVertex=function(d){for(var bestIndex=0,bestValue=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,i=1;i<this.m_count;++i){var value=this.m_vertices[i].x*d.x+this.m_vertices[i].y*d.y;value>bestValue&&(bestIndex=i,bestValue=value)}return this.m_vertices[bestIndex]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(index){return void 0===index&&(index=0),b2Settings.b2Assert(index>=0&&index<this.m_count),this.m_vertices[index]},b2DynamicTree.b2DynamicTree=function(){},b2DynamicTree.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},b2DynamicTree.prototype.CreateProxy=function(aabb,userData){var node=this.AllocateNode(),extendX=b2Settings.b2_aabbExtension,extendY=b2Settings.b2_aabbExtension;return node.aabb.lowerBound.x=aabb.lowerBound.x-extendX,node.aabb.lowerBound.y=aabb.lowerBound.y-extendY,node.aabb.upperBound.x=aabb.upperBound.x+extendX,node.aabb.upperBound.y=aabb.upperBound.y+extendY,node.userData=userData,this.InsertLeaf(node),node},b2DynamicTree.prototype.DestroyProxy=function(proxy){this.RemoveLeaf(proxy),this.FreeNode(proxy)},b2DynamicTree.prototype.MoveProxy=function(proxy,aabb,displacement){if(b2Settings.b2Assert(proxy.IsLeaf()),proxy.aabb.Contains(aabb))return!1;this.RemoveLeaf(proxy);var extendX=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(displacement.x>0?displacement.x:-displacement.x),extendY=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(displacement.y>0?displacement.y:-displacement.y);return proxy.aabb.lowerBound.x=aabb.lowerBound.x-extendX,proxy.aabb.lowerBound.y=aabb.lowerBound.y-extendY,proxy.aabb.upperBound.x=aabb.upperBound.x+extendX,proxy.aabb.upperBound.y=aabb.upperBound.y+extendY,this.InsertLeaf(proxy),!0},b2DynamicTree.prototype.Rebalance=function(iterations){if(void 0===iterations&&(iterations=0),null!=this.m_root)for(var i=0;iterations>i;i++){for(var node=this.m_root,bit=0;0==node.IsLeaf();)node=this.m_path>>bit&1?node.child2:node.child1,bit=bit+1&31;++this.m_path,this.RemoveLeaf(node),this.InsertLeaf(node)}},b2DynamicTree.prototype.GetFatAABB=function(proxy){return proxy.aabb},b2DynamicTree.prototype.GetUserData=function(proxy){return proxy.userData},b2DynamicTree.prototype.Query=function(callback,aabb){if(null!=this.m_root){var stack=new Vector,count=0;for(stack[count++]=this.m_root;count>0;){var node=stack[--count];if(node.aabb.TestOverlap(aabb))if(node.IsLeaf()){var proceed=callback(node);if(!proceed)return}else stack[count++]=node.child1,stack[count++]=node.child2}}},b2DynamicTree.prototype.RayCast=function(callback,input){if(null!=this.m_root){var p1=input.p1,p2=input.p2,r=b2Math.SubtractVV(p1,p2);r.Normalize();var v=b2Math.CrossFV(1,r),abs_v=b2Math.AbsV(v),maxFraction=input.maxFraction,segmentAABB=new b2AABB,tX=0,tY=0;tX=p1.x+maxFraction*(p2.x-p1.x),tY=p1.y+maxFraction*(p2.y-p1.y),
segmentAABB.lowerBound.x=Math.min(p1.x,tX),segmentAABB.lowerBound.y=Math.min(p1.y,tY),segmentAABB.upperBound.x=Math.max(p1.x,tX),segmentAABB.upperBound.y=Math.max(p1.y,tY);var stack=new Vector,count=0;for(stack[count++]=this.m_root;count>0;){var node=stack[--count];if(0!=node.aabb.TestOverlap(segmentAABB)){var c=node.aabb.GetCenter(),h=node.aabb.GetExtents(),separation=Math.abs(v.x*(p1.x-c.x)+v.y*(p1.y-c.y))-abs_v.x*h.x-abs_v.y*h.y;if(!(separation>0))if(node.IsLeaf()){var subInput=new b2RayCastInput;if(subInput.p1=input.p1,subInput.p2=input.p2,subInput.maxFraction=input.maxFraction,maxFraction=callback(subInput,node),0==maxFraction)return;maxFraction>0&&(tX=p1.x+maxFraction*(p2.x-p1.x),tY=p1.y+maxFraction*(p2.y-p1.y),segmentAABB.lowerBound.x=Math.min(p1.x,tX),segmentAABB.lowerBound.y=Math.min(p1.y,tY),segmentAABB.upperBound.x=Math.max(p1.x,tX),segmentAABB.upperBound.y=Math.max(p1.y,tY))}else stack[count++]=node.child1,stack[count++]=node.child2}}}},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var node=this.m_freeList;return this.m_freeList=node.parent,node.parent=null,node.child1=null,node.child2=null,node}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(node){node.parent=this.m_freeList,this.m_freeList=node},b2DynamicTree.prototype.InsertLeaf=function(leaf){if(++this.m_insertionCount,null==this.m_root)return this.m_root=leaf,void(this.m_root.parent=null);var center=leaf.aabb.GetCenter(),sibling=this.m_root;if(0==sibling.IsLeaf())do{var child1=sibling.child1,child2=sibling.child2,norm1=Math.abs((child1.aabb.lowerBound.x+child1.aabb.upperBound.x)/2-center.x)+Math.abs((child1.aabb.lowerBound.y+child1.aabb.upperBound.y)/2-center.y),norm2=Math.abs((child2.aabb.lowerBound.x+child2.aabb.upperBound.x)/2-center.x)+Math.abs((child2.aabb.lowerBound.y+child2.aabb.upperBound.y)/2-center.y);sibling=norm2>norm1?child1:child2}while(0==sibling.IsLeaf());var node1=sibling.parent,node2=this.AllocateNode();if(node2.parent=node1,node2.userData=null,node2.aabb.Combine(leaf.aabb,sibling.aabb),node1){sibling.parent.child1==sibling?node1.child1=node2:node1.child2=node2,node2.child1=sibling,node2.child2=leaf,sibling.parent=node2,leaf.parent=node2;do{if(node1.aabb.Contains(node2.aabb))break;node1.aabb.Combine(node1.child1.aabb,node1.child2.aabb),node2=node1,node1=node1.parent}while(node1)}else node2.child1=sibling,node2.child2=leaf,sibling.parent=node2,leaf.parent=node2,this.m_root=node2},b2DynamicTree.prototype.RemoveLeaf=function(leaf){if(leaf==this.m_root)return void(this.m_root=null);var sibling,node2=leaf.parent,node1=node2.parent;if(sibling=node2.child1==leaf?node2.child2:node2.child1,node1)for(node1.child1==node2?node1.child1=sibling:node1.child2=sibling,sibling.parent=node1,this.FreeNode(node2);node1;){var oldAABB=node1.aabb;if(node1.aabb=b2AABB.Combine(node1.child1.aabb,node1.child2.aabb),oldAABB.Contains(node1.aabb))break;node1=node1.parent}else this.m_root=sibling,sibling.parent=null,this.FreeNode(node2)},b2DynamicTreeBroadPhase.b2DynamicTreeBroadPhase=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(aabb,userData){var proxy=this.m_tree.CreateProxy(aabb,userData);return++this.m_proxyCount,this.BufferMove(proxy),proxy},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(proxy){this.UnBufferMove(proxy),--this.m_proxyCount,this.m_tree.DestroyProxy(proxy)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(proxy,aabb,displacement){var buffer=this.m_tree.MoveProxy(proxy,aabb,displacement);buffer&&this.BufferMove(proxy)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(proxyA,proxyB){var aabbA=this.m_tree.GetFatAABB(proxyA),aabbB=this.m_tree.GetFatAABB(proxyB);return aabbA.TestOverlap(aabbB)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(proxy){return this.m_tree.GetUserData(proxy)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(proxy){return this.m_tree.GetFatAABB(proxy)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(callback){function QueryCallback(proxy){if(proxy==queryProxy)return!0;__this.m_pairCount==__this.m_pairBuffer.length&&(__this.m_pairBuffer[__this.m_pairCount]=new b2DynamicTreePair);var pair=__this.m_pairBuffer[__this.m_pairCount];return pair.proxyA=queryProxy>proxy?proxy:queryProxy,pair.proxyB=proxy>=queryProxy?proxy:queryProxy,++__this.m_pairCount,!0}var __this=this;__this.m_pairCount=0;var queryProxy,i=0;for(i=0;i<__this.m_moveBuffer.length;++i){queryProxy=__this.m_moveBuffer[i];var fatAABB=__this.m_tree.GetFatAABB(queryProxy);__this.m_tree.Query(QueryCallback,fatAABB)}__this.m_moveBuffer.length=0;for(var i=0;i<__this.m_pairCount;){var primaryPair=__this.m_pairBuffer[i],userDataA=__this.m_tree.GetUserData(primaryPair.proxyA),userDataB=__this.m_tree.GetUserData(primaryPair.proxyB);for(callback(userDataA,userDataB),++i;i<__this.m_pairCount;){var pair=__this.m_pairBuffer[i];if(pair.proxyA!=primaryPair.proxyA||pair.proxyB!=primaryPair.proxyB)break;++i}}},b2DynamicTreeBroadPhase.prototype.Query=function(callback,aabb){this.m_tree.Query(callback,aabb)},b2DynamicTreeBroadPhase.prototype.RayCast=function(callback,input){this.m_tree.RayCast(callback,input)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(iterations){void 0===iterations&&(iterations=0),this.m_tree.Rebalance(iterations)},b2DynamicTreeBroadPhase.prototype.BufferMove=function(proxy){this.m_moveBuffer[this.m_moveBuffer.length]=proxy},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(proxy){var i=parseInt(this.m_moveBuffer.indexOf(proxy));this.m_moveBuffer.splice(i,1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(pair1,pair2){return 0},b2DynamicTreeBroadPhase.__implements={},b2DynamicTreeBroadPhase.__implements[IBroadPhase]=!0,b2DynamicTreeNode.b2DynamicTreeNode=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return null==this.child1},b2DynamicTreePair.b2DynamicTreePair=function(){},b2Manifold.b2Manifold=function(){this.m_pointCount=0},b2Manifold.prototype.b2Manifold=function(){this.m_points=new Vector(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)this.m_points[i]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.Reset=function(){for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)(this.m_points[i]instanceof b2ManifoldPoint?this.m_points[i]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},b2Manifold.prototype.Set=function(m){this.m_pointCount=m.m_pointCount;for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)(this.m_points[i]instanceof b2ManifoldPoint?this.m_points[i]:null).Set(m.m_points[i]);this.m_localPlaneNormal.SetV(m.m_localPlaneNormal),this.m_localPoint.SetV(m.m_localPoint),this.m_type=m.m_type},b2Manifold.prototype.Copy=function(){var copy=new b2Manifold;return copy.Set(this),copy},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),b2ManifoldPoint.b2ManifoldPoint=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.b2ManifoldPoint=function(){this.Reset()},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(m){this.m_localPoint.SetV(m.m_localPoint),this.m_normalImpulse=m.m_normalImpulse,this.m_tangentImpulse=m.m_tangentImpulse,this.m_id.Set(m.m_id)},b2Point.b2Point=function(){this.p=new b2Vec2},b2Point.prototype.Support=function(xf,vX,vY){return void 0===vX&&(vX=0),void 0===vY&&(vY=0),this.p},b2Point.prototype.GetFirstVertex=function(xf){return this.p},b2RayCastInput.b2RayCastInput=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.b2RayCastInput=function(p1,p2,maxFraction){void 0===p1&&(p1=null),void 0===p2&&(p2=null),void 0===maxFraction&&(maxFraction=1),p1&&this.p1.SetV(p1),p2&&this.p2.SetV(p2),this.maxFraction=maxFraction},b2RayCastOutput.b2RayCastOutput=function(){this.normal=new b2Vec2},b2Segment.b2Segment=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(lambda,normal,segment,maxLambda){void 0===maxLambda&&(maxLambda=0);var s=segment.p1,rX=segment.p2.x-s.x,rY=segment.p2.y-s.y,dX=this.p2.x-this.p1.x,dY=this.p2.y-this.p1.y,nX=dY,nY=-dX,k_slop=100*Number.MIN_VALUE,denom=-(rX*nX+rY*nY);if(denom>k_slop){var bX=s.x-this.p1.x,bY=s.y-this.p1.y,a=bX*nX+bY*nY;if(a>=0&&maxLambda*denom>=a){var mu2=-rX*bY+rY*bX;if(mu2>=-k_slop*denom&&denom*(1+k_slop)>=mu2){a/=denom;var nLen=Math.sqrt(nX*nX+nY*nY);return nX/=nLen,nY/=nLen,lambda[0]=a,normal.Set(nX,nY),!0}}}return!1},b2Segment.prototype.Extend=function(aabb){this.ExtendForward(aabb),this.ExtendBackward(aabb)},b2Segment.prototype.ExtendForward=function(aabb){var dX=this.p2.x-this.p1.x,dY=this.p2.y-this.p1.y,lambda=Math.min(dX>0?(aabb.upperBound.x-this.p1.x)/dX:0>dX?(aabb.lowerBound.x-this.p1.x)/dX:Number.POSITIVE_INFINITY,dY>0?(aabb.upperBound.y-this.p1.y)/dY:0>dY?(aabb.lowerBound.y-this.p1.y)/dY:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+dX*lambda,this.p2.y=this.p1.y+dY*lambda},b2Segment.prototype.ExtendBackward=function(aabb){var dX=-this.p2.x+this.p1.x,dY=-this.p2.y+this.p1.y,lambda=Math.min(dX>0?(aabb.upperBound.x-this.p2.x)/dX:0>dX?(aabb.lowerBound.x-this.p2.x)/dX:Number.POSITIVE_INFINITY,dY>0?(aabb.upperBound.y-this.p2.y)/dY:0>dY?(aabb.lowerBound.y-this.p2.y)/dY:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+dX*lambda,this.p1.y=this.p2.y+dY*lambda},b2SeparationFunction.b2SeparationFunction=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.prototype.Initialize=function(cache,proxyA,transformA,proxyB,transformB){this.m_proxyA=proxyA,this.m_proxyB=proxyB;var count=parseInt(cache.count);b2Settings.b2Assert(count>0&&3>count);var localPointA,localPointA1,localPointA2,localPointB,localPointB1,localPointB2,tMat,tVec,pointAX=0,pointAY=0,pointBX=0,pointBY=0,normalX=0,normalY=0,s=0,sgn=0;if(1==count)this.m_type=b2SeparationFunction.e_points,localPointA=this.m_proxyA.GetVertex(cache.indexA[0]),localPointB=this.m_proxyB.GetVertex(cache.indexB[0]),tVec=localPointA,tMat=transformA.R,pointAX=transformA.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=transformA.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tVec=localPointB,tMat=transformB.R,pointBX=transformB.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=transformB.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),this.m_axis.x=pointBX-pointAX,this.m_axis.y=pointBY-pointAY,this.m_axis.Normalize();else if(cache.indexB[0]==cache.indexB[1])this.m_type=b2SeparationFunction.e_faceA,localPointA1=this.m_proxyA.GetVertex(cache.indexA[0]),localPointA2=this.m_proxyA.GetVertex(cache.indexA[1]),localPointB=this.m_proxyB.GetVertex(cache.indexB[0]),this.m_localPoint.x=.5*(localPointA1.x+localPointA2.x),this.m_localPoint.y=.5*(localPointA1.y+localPointA2.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(localPointA2,localPointA1),1),this.m_axis.Normalize(),tVec=this.m_axis,tMat=transformA.R,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tVec=this.m_localPoint,tMat=transformA.R,pointAX=transformA.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=transformA.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tVec=localPointB,tMat=transformB.R,pointBX=transformB.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=transformB.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),s=(pointBX-pointAX)*normalX+(pointBY-pointAY)*normalY,0>s&&this.m_axis.NegativeSelf();else if(cache.indexA[0]==cache.indexA[0])this.m_type=b2SeparationFunction.e_faceB,localPointB1=this.m_proxyB.GetVertex(cache.indexB[0]),localPointB2=this.m_proxyB.GetVertex(cache.indexB[1]),localPointA=this.m_proxyA.GetVertex(cache.indexA[0]),this.m_localPoint.x=.5*(localPointB1.x+localPointB2.x),this.m_localPoint.y=.5*(localPointB1.y+localPointB2.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(localPointB2,localPointB1),1),this.m_axis.Normalize(),tVec=this.m_axis,tMat=transformB.R,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tVec=this.m_localPoint,tMat=transformB.R,pointBX=transformB.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=transformB.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tVec=localPointA,tMat=transformA.R,pointAX=transformA.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=transformA.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),s=(pointAX-pointBX)*normalX+(pointAY-pointBY)*normalY,0>s&&this.m_axis.NegativeSelf();else{localPointA1=this.m_proxyA.GetVertex(cache.indexA[0]),localPointA2=this.m_proxyA.GetVertex(cache.indexA[1]),localPointB1=this.m_proxyB.GetVertex(cache.indexB[0]),localPointB2=this.m_proxyB.GetVertex(cache.indexB[1]);var dA=(b2Math.MulX(transformA,localPointA),b2Math.MulMV(transformA.R,b2Math.SubtractVV(localPointA2,localPointA1))),dB=(b2Math.MulX(transformB,localPointB),b2Math.MulMV(transformB.R,b2Math.SubtractVV(localPointB2,localPointB1))),a=dA.x*dA.x+dA.y*dA.y,e=dB.x*dB.x+dB.y*dB.y,r=b2Math.SubtractVV(dB,dA),c=dA.x*r.x+dA.y*r.y,f=dB.x*r.x+dB.y*r.y,b=dA.x*dB.x+dA.y*dB.y,denom=a*e-b*b;s=0,0!=denom&&(s=b2Math.Clamp((b*f-c*e)/denom,0,1));var t=(b*s+f)/e;0>t&&(t=0,s=b2Math.Clamp((b-c)/a,0,1)),localPointA=new b2Vec2,localPointA.x=localPointA1.x+s*(localPointA2.x-localPointA1.x),localPointA.y=localPointA1.y+s*(localPointA2.y-localPointA1.y),localPointB=new b2Vec2,localPointB.x=localPointB1.x+s*(localPointB2.x-localPointB1.x),localPointB.y=localPointB1.y+s*(localPointB2.y-localPointB1.y),0==s||1==s?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(localPointB2,localPointB1),1),this.m_axis.Normalize(),this.m_localPoint=localPointB,tVec=this.m_axis,tMat=transformB.R,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tVec=this.m_localPoint,tMat=transformB.R,pointBX=transformB.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=transformB.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tVec=localPointA,tMat=transformA.R,pointAX=transformA.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=transformA.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),sgn=(pointAX-pointBX)*normalX+(pointAY-pointBY)*normalY,0>s&&this.m_axis.NegativeSelf()):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(localPointA2,localPointA1),1),this.m_localPoint=localPointA,tVec=this.m_axis,tMat=transformA.R,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tVec=this.m_localPoint,tMat=transformA.R,pointAX=transformA.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=transformA.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tVec=localPointB,tMat=transformB.R,pointBX=transformB.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=transformB.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),sgn=(pointBX-pointAX)*normalX+(pointBY-pointAY)*normalY,0>s&&this.m_axis.NegativeSelf())}},b2SeparationFunction.prototype.Evaluate=function(transformA,transformB){var axisA,axisB,localPointA,localPointB,pointA,pointB,normal,seperation=0;switch(this.m_type){case b2SeparationFunction.e_points:return axisA=b2Math.MulTMV(transformA.R,this.m_axis),axisB=b2Math.MulTMV(transformB.R,this.m_axis.GetNegative()),localPointA=this.m_proxyA.GetSupportVertex(axisA),localPointB=this.m_proxyB.GetSupportVertex(axisB),pointA=b2Math.MulX(transformA,localPointA),pointB=b2Math.MulX(transformB,localPointB),seperation=(pointB.x-pointA.x)*this.m_axis.x+(pointB.y-pointA.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return normal=b2Math.MulMV(transformA.R,this.m_axis),pointA=b2Math.MulX(transformA,this.m_localPoint),axisB=b2Math.MulTMV(transformB.R,normal.GetNegative()),localPointB=this.m_proxyB.GetSupportVertex(axisB),pointB=b2Math.MulX(transformB,localPointB),seperation=(pointB.x-pointA.x)*normal.x+(pointB.y-pointA.y)*normal.y;case b2SeparationFunction.e_faceB:return normal=b2Math.MulMV(transformB.R,this.m_axis),pointB=b2Math.MulX(transformB,this.m_localPoint),axisA=b2Math.MulTMV(transformA.R,normal.GetNegative()),localPointA=this.m_proxyA.GetSupportVertex(axisA),pointA=b2Math.MulX(transformA,localPointA),seperation=(pointA.x-pointB.x)*normal.x+(pointA.y-pointB.y)*normal.y;default:return b2Settings.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),b2Simplex.b2Simplex=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=new Vector(3)},b2Simplex.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.ReadCache=function(cache,proxyA,transformA,proxyB,transformB){b2Settings.b2Assert(0<=cache.count&&cache.count<=3);var wALocal,wBLocal;this.m_count=cache.count;for(var vertices=this.m_vertices,i=0;i<this.m_count;i++){var v=vertices[i];v.indexA=cache.indexA[i],v.indexB=cache.indexB[i],wALocal=proxyA.GetVertex(v.indexA),wBLocal=proxyB.GetVertex(v.indexB),v.wA=b2Math.MulX(transformA,wALocal),v.wB=b2Math.MulX(transformB,wBLocal),v.w=b2Math.SubtractVV(v.wB,v.wA),v.a=0}if(this.m_count>1){var metric1=cache.metric,metric2=this.GetMetric();(.5*metric1>metric2||metric2>2*metric1||metric2<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(v=vertices[0],v.indexA=0,v.indexB=0,wALocal=proxyA.GetVertex(0),wBLocal=proxyB.GetVertex(0),v.wA=b2Math.MulX(transformA,wALocal),v.wB=b2Math.MulX(transformB,wBLocal),v.w=b2Math.SubtractVV(v.wB,v.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(cache){cache.metric=this.GetMetric(),cache.count=Box2D.parseUInt(this.m_count);for(var vertices=this.m_vertices,i=0;i<this.m_count;i++)cache.indexA[i]=Box2D.parseUInt(vertices[i].indexA),cache.indexB[i]=Box2D.parseUInt(vertices[i].indexB)},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e12=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),sgn=b2Math.CrossVV(e12,this.m_v1.w.GetNegative());return sgn>0?b2Math.CrossFV(1,e12):b2Math.CrossVF(e12,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(pA,pB){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:pA.SetV(this.m_v1.wA),pB.SetV(this.m_v1.wB);break;case 2:pA.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,pA.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,pB.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,pB.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:pB.x=pA.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,pB.y=pA.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var w1=this.m_v1.w,w2=this.m_v2.w,e12=b2Math.SubtractVV(w2,w1),d12_2=-(w1.x*e12.x+w1.y*e12.y);if(0>=d12_2)return this.m_v1.a=1,void(this.m_count=1);var d12_1=w2.x*e12.x+w2.y*e12.y;if(0>=d12_1)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var inv_d12=1/(d12_1+d12_2);this.m_v1.a=d12_1*inv_d12,this.m_v2.a=d12_2*inv_d12,this.m_count=2},b2Simplex.prototype.Solve3=function(){var w1=this.m_v1.w,w2=this.m_v2.w,w3=this.m_v3.w,e12=b2Math.SubtractVV(w2,w1),w1e12=b2Math.Dot(w1,e12),w2e12=b2Math.Dot(w2,e12),d12_1=w2e12,d12_2=-w1e12,e13=b2Math.SubtractVV(w3,w1),w1e13=b2Math.Dot(w1,e13),w3e13=b2Math.Dot(w3,e13),d13_1=w3e13,d13_2=-w1e13,e23=b2Math.SubtractVV(w3,w2),w2e23=b2Math.Dot(w2,e23),w3e23=b2Math.Dot(w3,e23),d23_1=w3e23,d23_2=-w2e23,n123=b2Math.CrossVV(e12,e13),d123_1=n123*b2Math.CrossVV(w2,w3),d123_2=n123*b2Math.CrossVV(w3,w1),d123_3=n123*b2Math.CrossVV(w1,w2);if(0>=d12_2&&0>=d13_2)return this.m_v1.a=1,void(this.m_count=1);if(d12_1>0&&d12_2>0&&0>=d123_3){var inv_d12=1/(d12_1+d12_2);return this.m_v1.a=d12_1*inv_d12,this.m_v2.a=d12_2*inv_d12,void(this.m_count=2)}if(d13_1>0&&d13_2>0&&0>=d123_2){var inv_d13=1/(d13_1+d13_2);return this.m_v1.a=d13_1*inv_d13,this.m_v3.a=d13_2*inv_d13,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(0>=d12_1&&0>=d23_2)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(0>=d13_1&&0>=d23_1)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(d23_1>0&&d23_2>0&&0>=d123_1){var inv_d23=1/(d23_1+d23_2);return this.m_v2.a=d23_1*inv_d23,this.m_v3.a=d23_2*inv_d23,this.m_count=2,void this.m_v1.Set(this.m_v3)}var inv_d123=1/(d123_1+d123_2+d123_3);this.m_v1.a=d123_1*inv_d123,this.m_v2.a=d123_2*inv_d123,this.m_v3.a=d123_3*inv_d123,this.m_count=3},b2SimplexCache.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},b2SimplexVertex.b2SimplexVertex=function(){},b2SimplexVertex.prototype.Set=function(other){this.wA.SetV(other.wA),this.wB.SetV(other.wB),this.w.SetV(other.w),this.a=other.a,this.indexA=other.indexA,this.indexB=other.indexB},b2TimeOfImpact.b2TimeOfImpact=function(){},b2TimeOfImpact.TimeOfImpact=function(input){++b2TimeOfImpact.b2_toiCalls;var proxyA=input.proxyA,proxyB=input.proxyB,sweepA=input.sweepA,sweepB=input.sweepB;b2Settings.b2Assert(sweepA.t0==sweepB.t0),b2Settings.b2Assert(1-sweepA.t0>Number.MIN_VALUE);var radius=proxyA.m_radius+proxyB.m_radius,tolerance=input.tolerance,alpha=0,k_maxIterations=1e3,iter=0,target=0;for(b2TimeOfImpact.s_cache.count=0,b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(sweepA.GetTransform(b2TimeOfImpact.s_xfA,alpha),sweepB.GetTransform(b2TimeOfImpact.s_xfB,alpha),b2TimeOfImpact.s_distanceInput.proxyA=proxyA,b2TimeOfImpact.s_distanceInput.proxyB=proxyB,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput),b2TimeOfImpact.s_distanceOutput.distance<=0){alpha=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,proxyA,b2TimeOfImpact.s_xfA,proxyB,b2TimeOfImpact.s_xfB);var separation=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(0>=separation){alpha=1;break}if(0==iter&&(target=separation>radius?b2Math.Max(radius-tolerance,.75*radius):b2Math.Max(separation-tolerance,.02*radius)),.5*tolerance>separation-target){if(0==iter){alpha=1;break}break}var newAlpha=alpha,x1=alpha,x2=1,f1=separation;sweepA.GetTransform(b2TimeOfImpact.s_xfA,x2),sweepB.GetTransform(b2TimeOfImpact.s_xfB,x2);var f2=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(f2>=target){alpha=1;break}for(var rootIterCount=0;;){var x=0;x=1&rootIterCount?x1+(target-f1)*(x2-x1)/(f2-f1):.5*(x1+x2),sweepA.GetTransform(b2TimeOfImpact.s_xfA,x),sweepB.GetTransform(b2TimeOfImpact.s_xfB,x);var f=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(f-target)<.025*tolerance){newAlpha=x;break}if(f>target?(x1=x,f1=f):(x2=x,f2=f),++rootIterCount,++b2TimeOfImpact.b2_toiRootIters,50==rootIterCount)break}if(b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,rootIterCount),newAlpha<(1+100*Number.MIN_VALUE)*alpha)break;if(alpha=newAlpha,iter++,++b2TimeOfImpact.b2_toiIters,iter==k_maxIterations)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,iter),alpha},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput}),b2TOIInput.b2TOIInput=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2WorldManifold.b2WorldManifold=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.b2WorldManifold=function(){this.m_points=new Vector(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)this.m_points[i]=new b2Vec2},b2WorldManifold.prototype.Initialize=function(manifold,xfA,radiusA,xfB,radiusB){if(void 0===radiusA&&(radiusA=0),void 0===radiusB&&(radiusB=0),0!=manifold.m_pointCount){var tVec,tMat,i=0,normalX=0,normalY=0,planePointX=0,planePointY=0,clipPointX=0,clipPointY=0;switch(manifold.m_type){case b2Manifold.e_circles:tMat=xfA.R,tVec=manifold.m_localPoint;var pointAX=xfA.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,pointAY=xfA.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=xfB.R,tVec=manifold.m_points[0].m_localPoint;var pointBX=xfB.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,pointBY=xfB.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,dX=pointBX-pointAX,dY=pointBY-pointAY,d2=dX*dX+dY*dY;if(d2>Number.MIN_VALUE*Number.MIN_VALUE){var d=Math.sqrt(d2);this.m_normal.x=dX/d,this.m_normal.y=dY/d}else this.m_normal.x=1,this.m_normal.y=0;var cAX=pointAX+radiusA*this.m_normal.x,cAY=pointAY+radiusA*this.m_normal.y,cBX=pointBX-radiusB*this.m_normal.x,cBY=pointBY-radiusB*this.m_normal.y;this.m_points[0].x=.5*(cAX+cBX),this.m_points[0].y=.5*(cAY+cBY);break;case b2Manifold.e_faceA:for(tMat=xfA.R,tVec=manifold.m_localPlaneNormal,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=xfA.R,tVec=manifold.m_localPoint,planePointX=xfA.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,planePointY=xfA.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_normal.x=normalX,this.m_normal.y=normalY,i=0;i<manifold.m_pointCount;i++)tMat=xfB.R,tVec=manifold.m_points[i].m_localPoint,clipPointX=xfB.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,clipPointY=xfB.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_points[i].x=clipPointX+.5*(radiusA-(clipPointX-planePointX)*normalX-(clipPointY-planePointY)*normalY-radiusB)*normalX,this.m_points[i].y=clipPointY+.5*(radiusA-(clipPointX-planePointX)*normalX-(clipPointY-planePointY)*normalY-radiusB)*normalY;break;case b2Manifold.e_faceB:for(tMat=xfB.R,tVec=manifold.m_localPlaneNormal,normalX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,normalY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=xfB.R,tVec=manifold.m_localPoint,planePointX=xfB.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,planePointY=xfB.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_normal.x=-normalX,this.m_normal.y=-normalY,i=0;i<manifold.m_pointCount;i++)tMat=xfA.R,tVec=manifold.m_points[i].m_localPoint,clipPointX=xfA.position.x+tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,clipPointY=xfA.position.y+tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_points[i].x=clipPointX+.5*(radiusB-(clipPointX-planePointX)*normalX-(clipPointY-planePointY)*normalY-radiusA)*normalX,this.m_points[i].y=clipPointY+.5*(radiusB-(clipPointX-planePointX)*normalX-(clipPointY-planePointY)*normalY-radiusA)*normalY}}},ClipVertex.ClipVertex=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(other){this.v.SetV(other.v),this.id.Set(other.id)},Features.Features=function(){},Object.defineProperty(Features.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(Features.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(value){void 0===value&&(value=0),this._referenceEdge=value,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(Features.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(Features.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(value){void 0===value&&(value=0),this._incidentEdge=value,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(Features.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(Features.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(value){void 0===value&&(value=0),this._incidentVertex=value,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(Features.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(Features.prototype,"flip",{enumerable:!1,configurable:!0,set:function(value){void 0===value&&(value=0),this._flip=value,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){{var b2Settings=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2Shape=Box2D.Collision.Shapes.b2Shape,b2Mat22=Box2D.Common.Math.b2Mat22,b2Math=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b2Transform=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),b2Vec2=Box2D.Common.Math.b2Vec2,b2Distance=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),b2DistanceInput=Box2D.Collision.b2DistanceInput,b2DistanceOutput=Box2D.Collision.b2DistanceOutput,b2DistanceProxy=Box2D.Collision.b2DistanceProxy,b2SimplexCache=(Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase}Box2D.inherit(b2CircleShape,Box2D.Collision.Shapes.b2Shape),b2CircleShape.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,b2CircleShape.b2CircleShape=function(){
Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var s=new b2CircleShape;return s.Set(this),s},b2CircleShape.prototype.Set=function(other){if(this.__super.Set.call(this,other),Box2D.is(other,b2CircleShape)){var other2=other instanceof b2CircleShape?other:null;this.m_p.SetV(other2.m_p)}},b2CircleShape.prototype.TestPoint=function(transform,p){var tMat=transform.R,dX=transform.position.x+(tMat.col1.x*this.m_p.x+tMat.col2.x*this.m_p.y),dY=transform.position.y+(tMat.col1.y*this.m_p.x+tMat.col2.y*this.m_p.y);return dX=p.x-dX,dY=p.y-dY,dX*dX+dY*dY<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(output,input,transform){var tMat=transform.R,positionX=transform.position.x+(tMat.col1.x*this.m_p.x+tMat.col2.x*this.m_p.y),positionY=transform.position.y+(tMat.col1.y*this.m_p.x+tMat.col2.y*this.m_p.y),sX=input.p1.x-positionX,sY=input.p1.y-positionY,b=sX*sX+sY*sY-this.m_radius*this.m_radius,rX=input.p2.x-input.p1.x,rY=input.p2.y-input.p1.y,c=sX*rX+sY*rY,rr=rX*rX+rY*rY,sigma=c*c-rr*b;if(0>sigma||rr<Number.MIN_VALUE)return!1;var a=-(c+Math.sqrt(sigma));return a>=0&&a<=input.maxFraction*rr?(a/=rr,output.fraction=a,output.normal.x=sX+a*rX,output.normal.y=sY+a*rY,output.normal.Normalize(),!0):!1},b2CircleShape.prototype.ComputeAABB=function(aabb,transform){var tMat=transform.R,pX=transform.position.x+(tMat.col1.x*this.m_p.x+tMat.col2.x*this.m_p.y),pY=transform.position.y+(tMat.col1.y*this.m_p.x+tMat.col2.y*this.m_p.y);aabb.lowerBound.Set(pX-this.m_radius,pY-this.m_radius),aabb.upperBound.Set(pX+this.m_radius,pY+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(massData,density){void 0===density&&(density=0),massData.mass=density*b2Settings.b2_pi*this.m_radius*this.m_radius,massData.center.SetV(this.m_p),massData.I=massData.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){void 0===offset&&(offset=0);var p=b2Math.MulX(xf,this.m_p),l=-(b2Math.Dot(normal,p)-offset);if(l<-this.m_radius+Number.MIN_VALUE)return 0;if(l>this.m_radius)return c.SetV(p),Math.PI*this.m_radius*this.m_radius;var r2=this.m_radius*this.m_radius,l2=l*l,area=r2*(Math.asin(l/this.m_radius)+Math.PI/2)+l*Math.sqrt(r2-l2),com=-2/3*Math.pow(r2-l2,1.5)/area;return c.x=p.x+normal.x*com,c.y=p.y+normal.y*com,area},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(position){this.m_p.SetV(position)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(radius){void 0===radius&&(radius=0),this.m_radius=radius},b2CircleShape.prototype.b2CircleShape=function(radius){void 0===radius&&(radius=0),this.__super.b2Shape.call(this),this.m_type=b2Shape.e_circleShape,this.m_radius=radius},b2EdgeChainDef.b2EdgeChainDef=function(){},b2EdgeChainDef.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(b2EdgeShape,Box2D.Collision.Shapes.b2Shape),b2EdgeShape.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,b2EdgeShape.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.TestPoint=function(transform,p){return!1},b2EdgeShape.prototype.RayCast=function(output,input,transform){var tMat,rX=input.p2.x-input.p1.x,rY=input.p2.y-input.p1.y;tMat=transform.R;var v1X=transform.position.x+(tMat.col1.x*this.m_v1.x+tMat.col2.x*this.m_v1.y),v1Y=transform.position.y+(tMat.col1.y*this.m_v1.x+tMat.col2.y*this.m_v1.y),nX=transform.position.y+(tMat.col1.y*this.m_v2.x+tMat.col2.y*this.m_v2.y)-v1Y,nY=-(transform.position.x+(tMat.col1.x*this.m_v2.x+tMat.col2.x*this.m_v2.y)-v1X),k_slop=100*Number.MIN_VALUE,denom=-(rX*nX+rY*nY);if(denom>k_slop){var bX=input.p1.x-v1X,bY=input.p1.y-v1Y,a=bX*nX+bY*nY;if(a>=0&&a<=input.maxFraction*denom){var mu2=-rX*bY+rY*bX;if(mu2>=-k_slop*denom&&denom*(1+k_slop)>=mu2){a/=denom,output.fraction=a;var nLen=Math.sqrt(nX*nX+nY*nY);return output.normal.x=nX/nLen,output.normal.y=nY/nLen,!0}}}return!1},b2EdgeShape.prototype.ComputeAABB=function(aabb,transform){var tMat=transform.R,v1X=transform.position.x+(tMat.col1.x*this.m_v1.x+tMat.col2.x*this.m_v1.y),v1Y=transform.position.y+(tMat.col1.y*this.m_v1.x+tMat.col2.y*this.m_v1.y),v2X=transform.position.x+(tMat.col1.x*this.m_v2.x+tMat.col2.x*this.m_v2.y),v2Y=transform.position.y+(tMat.col1.y*this.m_v2.x+tMat.col2.y*this.m_v2.y);v2X>v1X?(aabb.lowerBound.x=v1X,aabb.upperBound.x=v2X):(aabb.lowerBound.x=v2X,aabb.upperBound.x=v1X),v2Y>v1Y?(aabb.lowerBound.y=v1Y,aabb.upperBound.y=v2Y):(aabb.lowerBound.y=v2Y,aabb.upperBound.y=v1Y)},b2EdgeShape.prototype.ComputeMass=function(massData,density){void 0===density&&(density=0),massData.mass=0,massData.center.SetV(this.m_v1),massData.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){void 0===offset&&(offset=0);var v0=new b2Vec2(normal.x*offset,normal.y*offset),v1=b2Math.MulX(xf,this.m_v1),v2=b2Math.MulX(xf,this.m_v2),d1=b2Math.Dot(normal,v1)-offset,d2=b2Math.Dot(normal,v2)-offset;if(d1>0){if(d2>0)return 0;v1.x=-d2/(d1-d2)*v1.x+d1/(d1-d2)*v2.x,v1.y=-d2/(d1-d2)*v1.y+d1/(d1-d2)*v2.y}else d2>0&&(v2.x=-d2/(d1-d2)*v1.x+d1/(d1-d2)*v2.x,v2.y=-d2/(d1-d2)*v1.y+d1/(d1-d2)*v2.y);return c.x=(v0.x+v1.x+v2.x)/3,c.y=(v0.y+v1.y+v2.y)/3,.5*((v1.x-v0.x)*(v2.y-v0.y)-(v1.y-v0.y)*(v2.x-v0.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(xf){var tMat=xf.R;return new b2Vec2(xf.position.x+(tMat.col1.x*this.m_coreV1.x+tMat.col2.x*this.m_coreV1.y),xf.position.y+(tMat.col1.y*this.m_coreV1.x+tMat.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(xf,dX,dY){void 0===dX&&(dX=0),void 0===dY&&(dY=0);var tMat=xf.R,v1X=xf.position.x+(tMat.col1.x*this.m_coreV1.x+tMat.col2.x*this.m_coreV1.y),v1Y=xf.position.y+(tMat.col1.y*this.m_coreV1.x+tMat.col2.y*this.m_coreV1.y),v2X=xf.position.x+(tMat.col1.x*this.m_coreV2.x+tMat.col2.x*this.m_coreV2.y),v2Y=xf.position.y+(tMat.col1.y*this.m_coreV2.x+tMat.col2.y*this.m_coreV2.y);return v1X*dX+v1Y*dY>v2X*dX+v2Y*dY?(this.s_supportVec.x=v1X,this.s_supportVec.y=v1Y):(this.s_supportVec.x=v2X,this.s_supportVec.y=v2Y),this.s_supportVec},b2EdgeShape.prototype.b2EdgeShape=function(v1,v2){this.__super.b2Shape.call(this),this.m_type=b2Shape.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=v1,this.m_v2=v2,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.SetPrevEdge=function(edge,core,cornerDir,convex){this.m_prevEdge=edge,this.m_coreV1=core,this.m_cornerDir1=cornerDir,this.m_cornerConvex1=convex},b2EdgeShape.prototype.SetNextEdge=function(edge,core,cornerDir,convex){this.m_nextEdge=edge,this.m_coreV2=core,this.m_cornerDir2=cornerDir,this.m_cornerConvex2=convex},b2MassData.b2MassData=function(){this.mass=0,this.center=new b2Vec2(0,0),this.I=0},Box2D.inherit(b2PolygonShape,Box2D.Collision.Shapes.b2Shape),b2PolygonShape.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,b2PolygonShape.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},b2PolygonShape.prototype.Copy=function(){var s=new b2PolygonShape;return s.Set(this),s},b2PolygonShape.prototype.Set=function(other){if(this.__super.Set.call(this,other),Box2D.is(other,b2PolygonShape)){var other2=other instanceof b2PolygonShape?other:null;this.m_centroid.SetV(other2.m_centroid),this.m_vertexCount=other2.m_vertexCount,this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(other2.m_vertices[i]),this.m_normals[i].SetV(other2.m_normals[i])}},b2PolygonShape.prototype.SetAsArray=function(vertices,vertexCount){void 0===vertexCount&&(vertexCount=0);var tVec,v=new Vector,i=0;for(i=0;i<vertices.length;++i)tVec=vertices[i],v.push(tVec);this.SetAsVector(v,vertexCount)},b2PolygonShape.AsArray=function(vertices,vertexCount){void 0===vertexCount&&(vertexCount=0);var polygonShape=new b2PolygonShape;return polygonShape.SetAsArray(vertices,vertexCount),polygonShape},b2PolygonShape.prototype.SetAsVector=function(vertices,vertexCount){void 0===vertexCount&&(vertexCount=0),0==vertexCount&&(vertexCount=vertices.length),b2Settings.b2Assert(vertexCount>=2),this.m_vertexCount=vertexCount,this.Reserve(vertexCount);var i=0;for(i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(vertices[i]);for(i=0;i<this.m_vertexCount;++i){var i1=parseInt(i),i2=parseInt(i+1<this.m_vertexCount?i+1:0),edge=b2Math.SubtractVV(this.m_vertices[i2],this.m_vertices[i1]);b2Settings.b2Assert(edge.LengthSquared()>Number.MIN_VALUE),this.m_normals[i].SetV(b2Math.CrossVF(edge,1)),this.m_normals[i].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.AsVector=function(vertices,vertexCount){void 0===vertexCount&&(vertexCount=0);var polygonShape=new b2PolygonShape;return polygonShape.SetAsVector(vertices,vertexCount),polygonShape},b2PolygonShape.prototype.SetAsBox=function(hx,hy){void 0===hx&&(hx=0),void 0===hy&&(hy=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-hx,-hy),this.m_vertices[1].Set(hx,-hy),this.m_vertices[2].Set(hx,hy),this.m_vertices[3].Set(-hx,hy),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.AsBox=function(hx,hy){void 0===hx&&(hx=0),void 0===hy&&(hy=0);var polygonShape=new b2PolygonShape;return polygonShape.SetAsBox(hx,hy),polygonShape},b2PolygonShape.prototype.SetAsOrientedBox=function(hx,hy,center,angle){void 0===hx&&(hx=0),void 0===hy&&(hy=0),void 0===center&&(center=null),void 0===angle&&(angle=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-hx,-hy),this.m_vertices[1].Set(hx,-hy),this.m_vertices[2].Set(hx,hy),this.m_vertices[3].Set(-hx,hy),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=center;var xf=new b2Transform;xf.position=center,xf.R.Set(angle);for(var i=0;i<this.m_vertexCount;++i)this.m_vertices[i]=b2Math.MulX(xf,this.m_vertices[i]),this.m_normals[i]=b2Math.MulMV(xf.R,this.m_normals[i])},b2PolygonShape.AsOrientedBox=function(hx,hy,center,angle){void 0===hx&&(hx=0),void 0===hy&&(hy=0),void 0===center&&(center=null),void 0===angle&&(angle=0);var polygonShape=new b2PolygonShape;return polygonShape.SetAsOrientedBox(hx,hy,center,angle),polygonShape},b2PolygonShape.prototype.SetAsEdge=function(v1,v2){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(v1),this.m_vertices[1].SetV(v2),this.m_centroid.x=.5*(v1.x+v2.x),this.m_centroid.y=.5*(v1.y+v2.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(v2,v1),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.AsEdge=function(v1,v2){var polygonShape=new b2PolygonShape;return polygonShape.SetAsEdge(v1,v2),polygonShape},b2PolygonShape.prototype.TestPoint=function(xf,p){for(var tVec,tMat=xf.R,tX=p.x-xf.position.x,tY=p.y-xf.position.y,pLocalX=tX*tMat.col1.x+tY*tMat.col1.y,pLocalY=tX*tMat.col2.x+tY*tMat.col2.y,i=0;i<this.m_vertexCount;++i){tVec=this.m_vertices[i],tX=pLocalX-tVec.x,tY=pLocalY-tVec.y,tVec=this.m_normals[i];var dot=tVec.x*tX+tVec.y*tY;if(dot>0)return!1}return!0},b2PolygonShape.prototype.RayCast=function(output,input,transform){var tMat,tVec,lower=0,upper=input.maxFraction,tX=0,tY=0;tX=input.p1.x-transform.position.x,tY=input.p1.y-transform.position.y,tMat=transform.R;var p1X=tX*tMat.col1.x+tY*tMat.col1.y,p1Y=tX*tMat.col2.x+tY*tMat.col2.y;tX=input.p2.x-transform.position.x,tY=input.p2.y-transform.position.y,tMat=transform.R;for(var p2X=tX*tMat.col1.x+tY*tMat.col1.y,p2Y=tX*tMat.col2.x+tY*tMat.col2.y,dX=p2X-p1X,dY=p2Y-p1Y,index=parseInt(-1),i=0;i<this.m_vertexCount;++i){tVec=this.m_vertices[i],tX=tVec.x-p1X,tY=tVec.y-p1Y,tVec=this.m_normals[i];var numerator=tVec.x*tX+tVec.y*tY,denominator=tVec.x*dX+tVec.y*dY;if(0==denominator){if(0>numerator)return!1}else 0>denominator&&lower*denominator>numerator?(lower=numerator/denominator,index=i):denominator>0&&upper*denominator>numerator&&(upper=numerator/denominator);if(upper<lower-Number.MIN_VALUE)return!1}return index>=0?(output.fraction=lower,tMat=transform.R,tVec=this.m_normals[index],output.normal.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,output.normal.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(aabb,xf){for(var tMat=xf.R,tVec=this.m_vertices[0],lowerX=xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),lowerY=xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),upperX=lowerX,upperY=lowerY,i=1;i<this.m_vertexCount;++i){tVec=this.m_vertices[i];var vX=xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),vY=xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);lowerX=vX>lowerX?lowerX:vX,lowerY=vY>lowerY?lowerY:vY,upperX=upperX>vX?upperX:vX,upperY=upperY>vY?upperY:vY}aabb.lowerBound.x=lowerX-this.m_radius,aabb.lowerBound.y=lowerY-this.m_radius,aabb.upperBound.x=upperX+this.m_radius,aabb.upperBound.y=upperY+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(massData,density){if(void 0===density&&(density=0),2==this.m_vertexCount)return massData.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),massData.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),massData.mass=0,void(massData.I=0);for(var centerX=0,centerY=0,area=0,I=0,p1X=0,p1Y=0,k_inv3=1/3,i=0;i<this.m_vertexCount;++i){var p2=this.m_vertices[i],p3=i+1<this.m_vertexCount?this.m_vertices[parseInt(i+1)]:this.m_vertices[0],e1X=p2.x-p1X,e1Y=p2.y-p1Y,e2X=p3.x-p1X,e2Y=p3.y-p1Y,D=e1X*e2Y-e1Y*e2X,triangleArea=.5*D;area+=triangleArea,centerX+=triangleArea*k_inv3*(p1X+p2.x+p3.x),centerY+=triangleArea*k_inv3*(p1Y+p2.y+p3.y);var px=p1X,py=p1Y,ex1=e1X,ey1=e1Y,ex2=e2X,ey2=e2Y,intx2=k_inv3*(.25*(ex1*ex1+ex2*ex1+ex2*ex2)+(px*ex1+px*ex2))+.5*px*px,inty2=k_inv3*(.25*(ey1*ey1+ey2*ey1+ey2*ey2)+(py*ey1+py*ey2))+.5*py*py;I+=D*(intx2+inty2)}massData.mass=density*area,centerX*=1/area,centerY*=1/area,massData.center.Set(centerX,centerY),massData.I=density*I},b2PolygonShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){void 0===offset&&(offset=0);var normalL=b2Math.MulTMV(xf.R,normal),offsetL=offset-b2Math.Dot(normal,xf.position),depths=new Vector_a2j_Number,diveCount=0,intoIndex=parseInt(-1),outoIndex=parseInt(-1),lastSubmerged=!1,i=0;for(i=0;i<this.m_vertexCount;++i){depths[i]=b2Math.Dot(normalL,this.m_vertices[i])-offsetL;var isSubmerged=depths[i]<-Number.MIN_VALUE;i>0&&(isSubmerged?lastSubmerged||(intoIndex=i-1,diveCount++):lastSubmerged&&(outoIndex=i-1,diveCount++)),lastSubmerged=isSubmerged}switch(diveCount){case 0:if(lastSubmerged){var md=new b2MassData;return this.ComputeMass(md,1),c.SetV(b2Math.MulX(xf,md.center)),md.mass}return 0;case 1:-1==intoIndex?intoIndex=this.m_vertexCount-1:outoIndex=this.m_vertexCount-1}var p3,intoIndex2=parseInt((intoIndex+1)%this.m_vertexCount),outoIndex2=parseInt((outoIndex+1)%this.m_vertexCount),intoLamdda=(0-depths[intoIndex])/(depths[intoIndex2]-depths[intoIndex]),outoLamdda=(0-depths[outoIndex])/(depths[outoIndex2]-depths[outoIndex]),intoVec=new b2Vec2(this.m_vertices[intoIndex].x*(1-intoLamdda)+this.m_vertices[intoIndex2].x*intoLamdda,this.m_vertices[intoIndex].y*(1-intoLamdda)+this.m_vertices[intoIndex2].y*intoLamdda),outoVec=new b2Vec2(this.m_vertices[outoIndex].x*(1-outoLamdda)+this.m_vertices[outoIndex2].x*outoLamdda,this.m_vertices[outoIndex].y*(1-outoLamdda)+this.m_vertices[outoIndex2].y*outoLamdda),area=0,center=new b2Vec2,p2=this.m_vertices[intoIndex2];for(i=intoIndex2;i!=outoIndex2;){i=(i+1)%this.m_vertexCount,p3=i==outoIndex2?outoVec:this.m_vertices[i];var triangleArea=.5*((p2.x-intoVec.x)*(p3.y-intoVec.y)-(p2.y-intoVec.y)*(p3.x-intoVec.x));area+=triangleArea,center.x+=triangleArea*(intoVec.x+p2.x+p3.x)/3,center.y+=triangleArea*(intoVec.y+p2.y+p3.y)/3,p2=p3}return center.Multiply(1/area),c.SetV(b2Math.MulX(xf,center)),area},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(d){for(var bestIndex=0,bestValue=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,i=1;i<this.m_vertexCount;++i){var value=this.m_vertices[i].x*d.x+this.m_vertices[i].y*d.y;value>bestValue&&(bestIndex=i,bestValue=value)}return bestIndex},b2PolygonShape.prototype.GetSupportVertex=function(d){for(var bestIndex=0,bestValue=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,i=1;i<this.m_vertexCount;++i){var value=this.m_vertices[i].x*d.x+this.m_vertices[i].y*d.y;value>bestValue&&(bestIndex=i,bestValue=value)}return this.m_vertices[bestIndex]},b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=new Vector,this.m_normals=new Vector},b2PolygonShape.prototype.Reserve=function(count){void 0===count&&(count=0);for(var i=parseInt(this.m_vertices.length);count>i;i++)this.m_vertices[i]=new b2Vec2,this.m_normals[i]=new b2Vec2},b2PolygonShape.ComputeCentroid=function(vs,count){void 0===count&&(count=0);for(var c=new b2Vec2,area=0,p1X=0,p1Y=0,inv3=1/3,i=0;count>i;++i){var p2=vs[i],p3=count>i+1?vs[parseInt(i+1)]:vs[0],e1X=p2.x-p1X,e1Y=p2.y-p1Y,e2X=p3.x-p1X,e2Y=p3.y-p1Y,D=e1X*e2Y-e1Y*e2X,triangleArea=.5*D;area+=triangleArea,c.x+=triangleArea*inv3*(p1X+p2.x+p3.x),c.y+=triangleArea*inv3*(p1Y+p2.y+p3.y)}return c.x*=1/area,c.y*=1/area,c},b2PolygonShape.ComputeOBB=function(obb,vs,count){void 0===count&&(count=0);var i=0,p=new Vector(count+1);for(i=0;count>i;++i)p[i]=vs[i];p[count]=p[0];var minArea=Number.MAX_VALUE;for(i=1;count>=i;++i){var root=p[parseInt(i-1)],uxX=p[i].x-root.x,uxY=p[i].y-root.y,length=Math.sqrt(uxX*uxX+uxY*uxY);uxX/=length,uxY/=length;for(var uyX=-uxY,uyY=uxX,lowerX=Number.MAX_VALUE,lowerY=Number.MAX_VALUE,upperX=-Number.MAX_VALUE,upperY=-Number.MAX_VALUE,j=0;count>j;++j){var dX=p[j].x-root.x,dY=p[j].y-root.y,rX=uxX*dX+uxY*dY,rY=uyX*dX+uyY*dY;lowerX>rX&&(lowerX=rX),lowerY>rY&&(lowerY=rY),rX>upperX&&(upperX=rX),rY>upperY&&(upperY=rY)}var area=(upperX-lowerX)*(upperY-lowerY);if(.95*minArea>area){minArea=area,obb.R.col1.x=uxX,obb.R.col1.y=uxY,obb.R.col2.x=uyX,obb.R.col2.y=uyY;var centerX=.5*(lowerX+upperX),centerY=.5*(lowerY+upperY),tMat=obb.R;obb.center.x=root.x+(tMat.col1.x*centerX+tMat.col2.x*centerY),obb.center.y=root.y+(tMat.col1.y*centerX+tMat.col2.y*centerY),obb.extents.x=.5*(upperX-lowerX),obb.extents.y=.5*(upperY-lowerY)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new b2Mat22}),b2Shape.b2Shape=function(){},b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(other){this.m_radius=other.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(xf,p){return!1},b2Shape.prototype.RayCast=function(output,input,transform){return!1},b2Shape.prototype.ComputeAABB=function(aabb,xf){},b2Shape.prototype.ComputeMass=function(massData,density){void 0===density&&(density=0)},b2Shape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){return void 0===offset&&(offset=0),0},b2Shape.TestOverlap=function(shape1,transform1,shape2,transform2){var input=new b2DistanceInput;input.proxyA=new b2DistanceProxy,input.proxyA.Set(shape1),input.proxyB=new b2DistanceProxy,input.proxyB.Set(shape2),input.transformA=transform1,input.transformB=transform2,input.useRadii=!0;var simplexCache=new b2SimplexCache;simplexCache.count=0;var output=new b2DistanceOutput;return b2Distance.Distance(output,simplexCache,input),output.distance<10*Number.MIN_VALUE},b2Shape.prototype.b2Shape=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){{var b2Color=Box2D.Common.b2Color,b2Settings=(Box2D.Common.b2internal,Box2D.Common.b2Settings),b2Math=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3}b2Color.b2Color=function(){this._r=0,this._g=0,this._b=0},b2Color.prototype.b2Color=function(rr,gg,bb){void 0===rr&&(rr=0),void 0===gg&&(gg=0),void 0===bb&&(bb=0),this._r=Box2D.parseUInt(255*b2Math.Clamp(rr,0,1)),this._g=Box2D.parseUInt(255*b2Math.Clamp(gg,0,1)),this._b=Box2D.parseUInt(255*b2Math.Clamp(bb,0,1))},b2Color.prototype.Set=function(rr,gg,bb){void 0===rr&&(rr=0),void 0===gg&&(gg=0),void 0===bb&&(bb=0),this._r=Box2D.parseUInt(255*b2Math.Clamp(rr,0,1)),this._g=Box2D.parseUInt(255*b2Math.Clamp(gg,0,1)),this._b=Box2D.parseUInt(255*b2Math.Clamp(bb,0,1))},Object.defineProperty(b2Color.prototype,"r",{enumerable:!1,configurable:!0,set:function(rr){void 0===rr&&(rr=0),this._r=Box2D.parseUInt(255*b2Math.Clamp(rr,0,1))}}),Object.defineProperty(b2Color.prototype,"g",{enumerable:!1,configurable:!0,set:function(gg){void 0===gg&&(gg=0),this._g=Box2D.parseUInt(255*b2Math.Clamp(gg,0,1))}}),Object.defineProperty(b2Color.prototype,"b",{enumerable:!1,configurable:!0,set:function(bb){void 0===bb&&(bb=0),this._b=Box2D.parseUInt(255*b2Math.Clamp(bb,0,1))}}),Object.defineProperty(b2Color.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),b2Settings.b2Settings=function(){},b2Settings.b2MixFriction=function(friction1,friction2){return void 0===friction1&&(friction1=0),void 0===friction2&&(friction2=0),Math.sqrt(friction1*friction2)},b2Settings.b2MixRestitution=function(restitution1,restitution2){return void 0===restitution1&&(restitution1=0),void 0===restitution2&&(restitution2=0),restitution1>restitution2?restitution1:restitution2},b2Settings.b2Assert=function(a){if(!a)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi})}(),function(){var b2Mat22=(Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Common.Math.b2Mat22),b2Mat33=Box2D.Common.Math.b2Mat33,b2Math=Box2D.Common.Math.b2Math,b2Sweep=Box2D.Common.Math.b2Sweep,b2Transform=Box2D.Common.Math.b2Transform,b2Vec2=Box2D.Common.Math.b2Vec2,b2Vec3=Box2D.Common.Math.b2Vec3;b2Mat22.b2Mat22=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.prototype.b2Mat22=function(){this.SetIdentity()},b2Mat22.FromAngle=function(angle){void 0===angle&&(angle=0);var mat=new b2Mat22;return mat.Set(angle),mat},b2Mat22.FromVV=function(c1,c2){var mat=new b2Mat22;return mat.SetVV(c1,c2),mat},b2Mat22.prototype.Set=function(angle){void 0===angle&&(angle=0);var c=Math.cos(angle),s=Math.sin(angle);this.col1.x=c,this.col2.x=-s,this.col1.y=s,this.col2.y=c},b2Mat22.prototype.SetVV=function(c1,c2){this.col1.SetV(c1),this.col2.SetV(c2)},b2Mat22.prototype.Copy=function(){var mat=new b2Mat22;return mat.SetM(this),mat},b2Mat22.prototype.SetM=function(m){this.col1.SetV(m.col1),this.col2.SetV(m.col2)},b2Mat22.prototype.AddM=function(m){this.col1.x+=m.col1.x,this.col1.y+=m.col1.y,this.col2.x+=m.col2.x,this.col2.y+=m.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(out){var a=this.col1.x,b=this.col2.x,c=this.col1.y,d=this.col2.y,det=a*d-b*c;return 0!=det&&(det=1/det),out.col1.x=det*d,out.col2.x=-det*b,out.col1.y=-det*c,out.col2.y=det*a,out},b2Mat22.prototype.Solve=function(out,bX,bY){void 0===bX&&(bX=0),void 0===bY&&(bY=0);var a11=this.col1.x,a12=this.col2.x,a21=this.col1.y,a22=this.col2.y,det=a11*a22-a12*a21;return 0!=det&&(det=1/det),out.x=det*(a22*bX-a12*bY),out.y=det*(a11*bY-a21*bX),out},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat33.b2Mat33=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.b2Mat33=function(c1,c2,c3){void 0===c1&&(c1=null),void 0===c2&&(c2=null),void 0===c3&&(c3=null),c1||c2||c3?(this.col1.SetV(c1),this.col2.SetV(c2),this.col3.SetV(c3)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},b2Mat33.prototype.SetVVV=function(c1,c2,c3){this.col1.SetV(c1),this.col2.SetV(c2),this.col3.SetV(c3)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(m){this.col1.SetV(m.col1),this.col2.SetV(m.col2),this.col3.SetV(m.col3)},b2Mat33.prototype.AddM=function(m){this.col1.x+=m.col1.x,this.col1.y+=m.col1.y,this.col1.z+=m.col1.z,this.col2.x+=m.col2.x,this.col2.y+=m.col2.y,this.col2.z+=m.col2.z,this.col3.x+=m.col3.x,this.col3.y+=m.col3.y,this.col3.z+=m.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(out,bX,bY){void 0===bX&&(bX=0),void 0===bY&&(bY=0);var a11=this.col1.x,a12=this.col2.x,a21=this.col1.y,a22=this.col2.y,det=a11*a22-a12*a21;return 0!=det&&(det=1/det),out.x=det*(a22*bX-a12*bY),out.y=det*(a11*bY-a21*bX),out},b2Mat33.prototype.Solve33=function(out,bX,bY,bZ){void 0===bX&&(bX=0),void 0===bY&&(bY=0),void 0===bZ&&(bZ=0);var a11=this.col1.x,a21=this.col1.y,a31=this.col1.z,a12=this.col2.x,a22=this.col2.y,a32=this.col2.z,a13=this.col3.x,a23=this.col3.y,a33=this.col3.z,det=a11*(a22*a33-a32*a23)+a21*(a32*a13-a12*a33)+a31*(a12*a23-a22*a13);return 0!=det&&(det=1/det),out.x=det*(bX*(a22*a33-a32*a23)+bY*(a32*a13-a12*a33)+bZ*(a12*a23-a22*a13)),out.y=det*(a11*(bY*a33-bZ*a23)+a21*(bZ*a13-bX*a33)+a31*(bX*a23-bY*a13)),out.z=det*(a11*(a22*bZ-a32*bY)+a21*(a32*bX-a12*bZ)+a31*(a12*bY-a22*bX)),out},b2Math.b2Math=function(){},b2Math.IsValid=function(x){return void 0===x&&(x=0),isFinite(x)},b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},b2Math.CrossVF=function(a,s){void 0===s&&(s=0);var v=new b2Vec2(s*a.y,-s*a.x);return v},b2Math.CrossFV=function(s,a){void 0===s&&(s=0);var v=new b2Vec2(-s*a.y,s*a.x);return v},b2Math.MulMV=function(A,v){var u=new b2Vec2(A.col1.x*v.x+A.col2.x*v.y,A.col1.y*v.x+A.col2.y*v.y);return u},b2Math.MulTMV=function(A,v){var u=new b2Vec2(b2Math.Dot(v,A.col1),b2Math.Dot(v,A.col2));return u},b2Math.MulX=function(T,v){var a=b2Math.MulMV(T.R,v);return a.x+=T.position.x,a.y+=T.position.y,a},b2Math.MulXT=function(T,v){var a=b2Math.SubtractVV(v,T.position),tX=a.x*T.R.col1.x+a.y*T.R.col1.y;return a.y=a.x*T.R.col2.x+a.y*T.R.col2.y,a.x=tX,a},b2Math.AddVV=function(a,b){var v=new b2Vec2(a.x+b.x,a.y+b.y);return v},b2Math.SubtractVV=function(a,b){var v=new b2Vec2(a.x-b.x,a.y-b.y);return v},b2Math.Distance=function(a,b){var cX=a.x-b.x,cY=a.y-b.y;return Math.sqrt(cX*cX+cY*cY)},b2Math.DistanceSquared=function(a,b){var cX=a.x-b.x,cY=a.y-b.y;return cX*cX+cY*cY},b2Math.MulFV=function(s,a){void 0===s&&(s=0);var v=new b2Vec2(s*a.x,s*a.y);return v},b2Math.AddMM=function(A,B){var C=b2Mat22.FromVV(b2Math.AddVV(A.col1,B.col1),b2Math.AddVV(A.col2,B.col2));return C},b2Math.MulMM=function(A,B){var C=b2Mat22.FromVV(b2Math.MulMV(A,B.col1),b2Math.MulMV(A,B.col2));return C},b2Math.MulTMM=function(A,B){var c1=new b2Vec2(b2Math.Dot(A.col1,B.col1),b2Math.Dot(A.col2,B.col1)),c2=new b2Vec2(b2Math.Dot(A.col1,B.col2),b2Math.Dot(A.col2,B.col2)),C=b2Mat22.FromVV(c1,c2);return C},b2Math.Abs=function(a){return void 0===a&&(a=0),a>0?a:-a},b2Math.AbsV=function(a){var b=new b2Vec2(b2Math.Abs(a.x),b2Math.Abs(a.y));return b},b2Math.AbsM=function(A){var B=b2Mat22.FromVV(b2Math.AbsV(A.col1),b2Math.AbsV(A.col2));return B},b2Math.Min=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),b>a?a:b},b2Math.MinV=function(a,b){var c=new b2Vec2(b2Math.Min(a.x,b.x),b2Math.Min(a.y,b.y));return c},b2Math.Max=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},b2Math.MaxV=function(a,b){var c=new b2Vec2(b2Math.Max(a.x,b.x),b2Math.Max(a.y,b.y));return c},b2Math.Clamp=function(a,low,high){return void 0===a&&(a=0),void 0===low&&(low=0),void 0===high&&(high=0),low>a?low:a>high?high:a},b2Math.ClampV=function(a,low,high){return b2Math.MaxV(low,b2Math.MinV(a,high))},b2Math.Swap=function(a,b){var tmp=a[0];a[0]=b[0],b[0]=tmp},b2Math.Random=function(){return 2*Math.random()-1},b2Math.RandomRange=function(lo,hi){void 0===lo&&(lo=0),void 0===hi&&(hi=0);var r=Math.random();return r=(hi-lo)*r+lo},b2Math.NextPowerOfTwo=function(x){
return void 0===x&&(x=0),x|=x>>1&2147483647,x|=x>>2&1073741823,x|=x>>4&268435455,x|=x>>8&16777215,x|=x>>16&65535,x+1},b2Math.IsPowerOfTwo=function(x){void 0===x&&(x=0);var result=x>0&&0==(x&x-1);return result},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new b2Vec2(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity)}),b2Sweep.b2Sweep=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(other){this.localCenter.SetV(other.localCenter),this.c0.SetV(other.c0),this.c.SetV(other.c),this.a0=other.a0,this.a=other.a,this.t0=other.t0},b2Sweep.prototype.Copy=function(){var copy=new b2Sweep;return copy.localCenter.SetV(this.localCenter),copy.c0.SetV(this.c0),copy.c.SetV(this.c),copy.a0=this.a0,copy.a=this.a,copy.t0=this.t0,copy},b2Sweep.prototype.GetTransform=function(xf,alpha){void 0===alpha&&(alpha=0),xf.position.x=(1-alpha)*this.c0.x+alpha*this.c.x,xf.position.y=(1-alpha)*this.c0.y+alpha*this.c.y;var angle=(1-alpha)*this.a0+alpha*this.a;xf.R.Set(angle);var tMat=xf.R;xf.position.x-=tMat.col1.x*this.localCenter.x+tMat.col2.x*this.localCenter.y,xf.position.y-=tMat.col1.y*this.localCenter.x+tMat.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var alpha=(t-this.t0)/(1-this.t0);this.c0.x=(1-alpha)*this.c0.x+alpha*this.c.x,this.c0.y=(1-alpha)*this.c0.y+alpha*this.c.y,this.a0=(1-alpha)*this.a0+alpha*this.a,this.t0=t}},b2Transform.b2Transform=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.b2Transform=function(pos,r){void 0===pos&&(pos=null),void 0===r&&(r=null),pos&&(this.position.SetV(pos),this.R.SetM(r))},b2Transform.prototype.Initialize=function(pos,r){this.position.SetV(pos),this.R.SetM(r)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(x){this.position.SetV(x.position),this.R.SetM(x.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Vec2.b2Vec2=function(){},b2Vec2.prototype.b2Vec2=function(x_,y_){void 0===x_&&(x_=0),void 0===y_&&(y_=0),this.x=x_,this.y=y_},b2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},b2Vec2.prototype.Set=function(x_,y_){void 0===x_&&(x_=0),void 0===y_&&(y_=0),this.x=x_,this.y=y_},b2Vec2.prototype.SetV=function(v){this.x=v.x,this.y=v.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.Make=function(x_,y_){return void 0===x_&&(x_=0),void 0===y_&&(y_=0),new b2Vec2(x_,y_)},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(v){this.x+=v.x,this.y+=v.y},b2Vec2.prototype.Subtract=function(v){this.x-=v.x,this.y-=v.y},b2Vec2.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a},b2Vec2.prototype.MulM=function(A){var tX=this.x;this.x=A.col1.x*tX+A.col2.x*this.y,this.y=A.col1.y*tX+A.col2.y*this.y},b2Vec2.prototype.MulTM=function(A){var tX=b2Math.Dot(this,A.col1);this.y=b2Math.Dot(this,A.col2),this.x=tX},b2Vec2.prototype.CrossVF=function(s){void 0===s&&(s=0);var tX=this.x;this.x=s*this.y,this.y=-s*tX},b2Vec2.prototype.CrossFV=function(s){void 0===s&&(s=0);var tX=this.x;this.x=-s*this.y,this.y=s*tX},b2Vec2.prototype.MinV=function(b){this.x=this.x<b.x?this.x:b.x,this.y=this.y<b.y?this.y:b.y},b2Vec2.prototype.MaxV=function(b){this.x=this.x>b.x?this.x:b.x,this.y=this.y>b.y?this.y:b.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var length=Math.sqrt(this.x*this.x+this.y*this.y);if(length<Number.MIN_VALUE)return 0;var invLength=1/length;return this.x*=invLength,this.y*=invLength,length},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec3.b2Vec3=function(){},b2Vec3.prototype.b2Vec3=function(x,y,z){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0),this.x=x,this.y=y,this.z=z},b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(x,y,z){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0),this.x=x,this.y=y,this.z=z},b2Vec3.prototype.SetV=function(v){this.x=v.x,this.y=v.y,this.z=v.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(v){this.x+=v.x,this.y+=v.y,this.z+=v.z},b2Vec3.prototype.Subtract=function(v){this.x-=v.x,this.y-=v.y,this.z-=v.z},b2Vec3.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a,this.z*=a}}(),function(){{var b2Math=(Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b2Sweep=Box2D.Common.Math.b2Sweep,b2Transform=Box2D.Common.Math.b2Transform,b2Vec2=Box2D.Common.Math.b2Vec2,b2Color=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),b2Settings=(Box2D.Common.b2internal,Box2D.Common.b2Settings),b2AABB=Box2D.Collision.b2AABB,b2ContactPoint=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),b2DynamicTreeBroadPhase=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),b2RayCastInput=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),b2RayCastOutput=Box2D.Collision.b2RayCastOutput,b2CircleShape=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),b2EdgeShape=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2Shape=Box2D.Collision.Shapes.b2Shape,b2Body=Box2D.Dynamics.b2Body,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2ContactFilter=Box2D.Dynamics.b2ContactFilter,b2ContactImpulse=Box2D.Dynamics.b2ContactImpulse,b2ContactListener=Box2D.Dynamics.b2ContactListener,b2ContactManager=Box2D.Dynamics.b2ContactManager,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2DestructionListener=Box2D.Dynamics.b2DestructionListener,b2FilterData=Box2D.Dynamics.b2FilterData,b2Fixture=Box2D.Dynamics.b2Fixture,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Island=Box2D.Dynamics.b2Island,b2TimeStep=Box2D.Dynamics.b2TimeStep,b2World=Box2D.Dynamics.b2World,b2Contact=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),b2ContactFactory=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),b2ContactSolver=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver),b2Joint=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),b2PulleyJoint=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef}b2Body.b2Body=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2},b2Body.prototype.connectEdges=function(s1,s2,angle1){void 0===angle1&&(angle1=0);var angle2=Math.atan2(s2.GetDirectionVector().y,s2.GetDirectionVector().x),coreOffset=Math.tan(.5*(angle2-angle1)),core=b2Math.MulFV(coreOffset,s2.GetDirectionVector());core=b2Math.SubtractVV(core,s2.GetNormalVector()),core=b2Math.MulFV(b2Settings.b2_toiSlop,core),core=b2Math.AddVV(core,s2.GetVertex1());var cornerDir=b2Math.AddVV(s1.GetDirectionVector(),s2.GetDirectionVector());cornerDir.Normalize();var convex=b2Math.Dot(s1.GetDirectionVector(),s2.GetNormalVector())>0;return s1.SetNextEdge(s2,core,cornerDir,convex),s2.SetPrevEdge(s1,core,cornerDir,convex),angle2},b2Body.prototype.CreateFixture=function(def){if(1==this.m_world.IsLocked())return null;var fixture=new b2Fixture;if(fixture.Create(this,this.m_xf,def),this.m_flags&b2Body.e_activeFlag){var broadPhase=this.m_world.m_contactManager.m_broadPhase;fixture.CreateProxy(broadPhase,this.m_xf)}return fixture.m_next=this.m_fixtureList,this.m_fixtureList=fixture,++this.m_fixtureCount,fixture.m_body=this,fixture.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,fixture},b2Body.prototype.CreateFixture2=function(shape,density){void 0===density&&(density=0);var def=new b2FixtureDef;return def.shape=shape,def.density=density,this.CreateFixture(def)},b2Body.prototype.DestroyFixture=function(fixture){if(1!=this.m_world.IsLocked()){for(var node=this.m_fixtureList,ppF=null,found=!1;null!=node;){if(node==fixture){ppF?ppF.m_next=fixture.m_next:this.m_fixtureList=fixture.m_next,found=!0;break}ppF=node,node=node.m_next}for(var edge=this.m_contactList;edge;){var c=edge.contact;edge=edge.next;var fixtureA=c.GetFixtureA(),fixtureB=c.GetFixtureB();(fixture==fixtureA||fixture==fixtureB)&&this.m_world.m_contactManager.Destroy(c)}if(this.m_flags&b2Body.e_activeFlag){var broadPhase=this.m_world.m_contactManager.m_broadPhase;fixture.DestroyProxy(broadPhase)}fixture.Destroy(),fixture.m_body=null,fixture.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(position,angle){void 0===angle&&(angle=0);var f;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(angle),this.m_xf.position.SetV(position);var tMat=this.m_xf.R,tVec=this.m_sweep.localCenter;this.m_sweep.c.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,this.m_sweep.c.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=angle;var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(f=this.m_fixtureList;f;f=f.m_next)f.Synchronize(broadPhase,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b2Body.prototype.SetTransform=function(xf){this.SetPositionAndAngle(xf.position,xf.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(position){this.SetPositionAndAngle(position,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(angle){void 0===angle&&(angle=0),this.SetPositionAndAngle(this.GetPosition(),angle)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(v){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(v)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(omega){void 0===omega&&(omega=0),this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=omega)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var bd=new b2BodyDef;return bd.type=this.GetType(),bd.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,bd.angle=this.GetAngle(),bd.angularDamping=this.m_angularDamping,bd.angularVelocity=this.m_angularVelocity,bd.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,bd.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,bd.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,bd.linearDamping=this.m_linearDamping,bd.linearVelocity.SetV(this.GetLinearVelocity()),bd.position=this.GetPosition(),bd.userData=this.GetUserData(),bd},b2Body.prototype.ApplyForce=function(force,point){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=force.x,this.m_force.y+=force.y,this.m_torque+=(point.x-this.m_sweep.c.x)*force.y-(point.y-this.m_sweep.c.y)*force.x)},b2Body.prototype.ApplyTorque=function(torque){void 0===torque&&(torque=0),this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=torque)},b2Body.prototype.ApplyImpulse=function(impulse,point){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*impulse.x,this.m_linearVelocity.y+=this.m_invMass*impulse.y,this.m_angularVelocity+=this.m_invI*((point.x-this.m_sweep.c.x)*impulse.y-(point.y-this.m_sweep.c.y)*impulse.x))},b2Body.prototype.Split=function(callback){for(var prev,linearVelocity=this.GetLinearVelocity().Copy(),angularVelocity=this.GetAngularVelocity(),center=this.GetWorldCenter(),body1=this,body2=this.m_world.CreateBody(this.GetDefinition()),f=body1.m_fixtureList;f;)if(callback(f)){var next=f.m_next;prev?prev.m_next=next:body1.m_fixtureList=next,body1.m_fixtureCount--,f.m_next=body2.m_fixtureList,body2.m_fixtureList=f,body2.m_fixtureCount++,f.m_body=body2,f=next}else prev=f,f=f.m_next;body1.ResetMassData(),body2.ResetMassData();var center1=body1.GetWorldCenter(),center2=body2.GetWorldCenter(),velocity1=b2Math.AddVV(linearVelocity,b2Math.CrossFV(angularVelocity,b2Math.SubtractVV(center1,center))),velocity2=b2Math.AddVV(linearVelocity,b2Math.CrossFV(angularVelocity,b2Math.SubtractVV(center2,center)));return body1.SetLinearVelocity(velocity1),body2.SetLinearVelocity(velocity2),body1.SetAngularVelocity(angularVelocity),body2.SetAngularVelocity(angularVelocity),body1.SynchronizeFixtures(),body2.SynchronizeFixtures(),body2},b2Body.prototype.Merge=function(other){var f;for(f=other.m_fixtureList;f;){var next=f.m_next;other.m_fixtureCount--,f.m_next=this.m_fixtureList,this.m_fixtureList=f,this.m_fixtureCount++,f.m_body=body2,f=next}body1.m_fixtureCount=0;{var body1=this,body2=other;body1.GetWorldCenter(),body2.GetWorldCenter(),body1.GetLinearVelocity().Copy(),body2.GetLinearVelocity().Copy(),body1.GetAngularVelocity(),body2.GetAngularVelocity()}body1.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(data){data.mass=this.m_mass,data.I=this.m_I,data.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(massData){if(b2Settings.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==b2Body.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=massData.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,massData.I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)&&(this.m_I=massData.I-this.m_mass*(massData.center.x*massData.center.x+massData.center.y*massData.center.y),this.m_invI=1/this.m_I);var oldCenter=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(massData.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-oldCenter.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-oldCenter.x)}},b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var center=b2Vec2.Make(0,0),f=this.m_fixtureList;f;f=f.m_next)if(0!=f.m_density){var massData=f.GetMassData();this.m_mass+=massData.mass,center.x+=massData.center.x*massData.mass,center.y+=massData.center.y*massData.mass,this.m_I+=massData.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,center.x*=this.m_invMass,center.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(center.x*center.x+center.y*center.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var oldCenter=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-oldCenter.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-oldCenter.x)}},b2Body.prototype.GetWorldPoint=function(localPoint){var A=this.m_xf.R,u=new b2Vec2(A.col1.x*localPoint.x+A.col2.x*localPoint.y,A.col1.y*localPoint.x+A.col2.y*localPoint.y);return u.x+=this.m_xf.position.x,u.y+=this.m_xf.position.y,u},b2Body.prototype.GetWorldVector=function(localVector){return b2Math.MulMV(this.m_xf.R,localVector)},b2Body.prototype.GetLocalPoint=function(worldPoint){return b2Math.MulXT(this.m_xf,worldPoint)},b2Body.prototype.GetLocalVector=function(worldVector){return b2Math.MulTMV(this.m_xf.R,worldVector)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(worldPoint){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(worldPoint.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(worldPoint.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(localPoint){var A=this.m_xf.R,worldPoint=new b2Vec2(A.col1.x*localPoint.x+A.col2.x*localPoint.y,A.col1.y*localPoint.x+A.col2.y*localPoint.y);return worldPoint.x+=this.m_xf.position.x,worldPoint.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(worldPoint.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(worldPoint.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(linearDamping){void 0===linearDamping&&(linearDamping=0),this.m_linearDamping=linearDamping},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(angularDamping){void 0===angularDamping&&(angularDamping=0),this.m_angularDamping=angularDamping},b2Body.prototype.SetType=function(type){if(void 0===type&&(type=0),this.m_type!=type){this.m_type=type,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var ce=this.m_contactList;ce;ce=ce.next)ce.contact.FlagForFiltering()}},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(flag){flag?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(flag){flag?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(flag){flag?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(fixed){fixed?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(flag){if(flag!=this.IsActive()){var broadPhase,f;if(flag)for(this.m_flags|=b2Body.e_activeFlag,broadPhase=this.m_world.m_contactManager.m_broadPhase,f=this.m_fixtureList;f;f=f.m_next)f.CreateProxy(broadPhase,this.m_xf);else{for(this.m_flags&=~b2Body.e_activeFlag,broadPhase=this.m_world.m_contactManager.m_broadPhase,f=this.m_fixtureList;f;f=f.m_next)f.DestroyProxy(broadPhase);for(var ce=this.m_contactList;ce;){var ce0=ce;ce=ce.next,this.m_world.m_contactManager.Destroy(ce0.contact)}this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(data){this.m_userData=data},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.b2Body=function(bd,world){this.m_flags=0,bd.bullet&&(this.m_flags|=b2Body.e_bulletFlag),bd.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),bd.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),bd.awake&&(this.m_flags|=b2Body.e_awakeFlag),bd.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=world,this.m_xf.position.SetV(bd.position),this.m_xf.R.Set(bd.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=bd.angle;var tMat=this.m_xf.R,tVec=this.m_sweep.localCenter;this.m_sweep.c.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,this.m_sweep.c.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(bd.linearVelocity),this.m_angularVelocity=bd.angularVelocity,this.m_linearDamping=bd.linearDamping,this.m_angularDamping=bd.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=bd.type,this.m_type==b2Body.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=bd.inertiaScale,this.m_userData=bd.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.SynchronizeFixtures=function(){var xf1=b2Body.s_xf1;xf1.R.Set(this.m_sweep.a0);var tMat=xf1.R,tVec=this.m_sweep.localCenter;xf1.position.x=this.m_sweep.c0.x-(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),xf1.position.y=this.m_sweep.c0.y-(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);var f,broadPhase=this.m_world.m_contactManager.m_broadPhase;for(f=this.m_fixtureList;f;f=f.m_next)f.Synchronize(broadPhase,xf1,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var tMat=this.m_xf.R,tVec=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),this.m_xf.position.y=this.m_sweep.c.y-(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y)},b2Body.prototype.ShouldCollide=function(other){if(this.m_type!=b2Body.b2_dynamicBody&&other.m_type!=b2Body.b2_dynamicBody)return!1;for(var jn=this.m_jointList;jn;jn=jn.next)if(jn.other==other&&0==jn.joint.m_collideConnected)return!1;return!0},b2Body.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new b2Transform,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),b2BodyDef.b2BodyDef=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2ContactFilter.b2ContactFilter=function(){},b2ContactFilter.prototype.ShouldCollide=function(fixtureA,fixtureB){var filter1=fixtureA.GetFilterData(),filter2=fixtureB.GetFilterData();if(filter1.groupIndex==filter2.groupIndex&&0!=filter1.groupIndex)return filter1.groupIndex>0;var collide=0!=(filter1.maskBits&filter2.categoryBits)&&0!=(filter1.categoryBits&filter2.maskBits);return collide},b2ContactFilter.prototype.RayCollide=function(userData,fixture){return userData?this.ShouldCollide(userData instanceof b2Fixture?userData:null,fixture):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new b2ContactFilter}),b2ContactImpulse.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints)},b2ContactListener.b2ContactListener=function(){},b2ContactListener.prototype.BeginContact=function(contact){},b2ContactListener.prototype.EndContact=function(contact){},b2ContactListener.prototype.PreSolve=function(contact,oldManifold){},b2ContactListener.prototype.PostSolve=function(contact,impulse){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new b2ContactListener}),b2ContactManager.b2ContactManager=function(){},b2ContactManager.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.AddPair=function(proxyUserDataA,proxyUserDataB){var fixtureA=proxyUserDataA instanceof b2Fixture?proxyUserDataA:null,fixtureB=proxyUserDataB instanceof b2Fixture?proxyUserDataB:null,bodyA=fixtureA.GetBody(),bodyB=fixtureB.GetBody();if(bodyA!=bodyB){for(var edge=bodyB.GetContactList();edge;){if(edge.other==bodyA){var fA=edge.contact.GetFixtureA(),fB=edge.contact.GetFixtureB();if(fA==fixtureA&&fB==fixtureB)return;if(fA==fixtureB&&fB==fixtureA)return}edge=edge.next}if(0!=bodyB.ShouldCollide(bodyA)&&0!=this.m_contactFilter.ShouldCollide(fixtureA,fixtureB)){var c=this.m_contactFactory.Create(fixtureA,fixtureB);fixtureA=c.GetFixtureA(),fixtureB=c.GetFixtureB(),bodyA=fixtureA.m_body,bodyB=fixtureB.m_body,c.m_prev=null,c.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=c),this.m_world.m_contactList=c,c.m_nodeA.contact=c,c.m_nodeA.other=bodyB,c.m_nodeA.prev=null,c.m_nodeA.next=bodyA.m_contactList,null!=bodyA.m_contactList&&(bodyA.m_contactList.prev=c.m_nodeA),bodyA.m_contactList=c.m_nodeA,c.m_nodeB.contact=c,c.m_nodeB.other=bodyA,c.m_nodeB.prev=null,c.m_nodeB.next=bodyB.m_contactList,null!=bodyB.m_contactList&&(bodyB.m_contactList.prev=c.m_nodeB),bodyB.m_contactList=c.m_nodeB,++this.m_world.m_contactCount}}},b2ContactManager.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},b2ContactManager.prototype.Destroy=function(c){var fixtureA=c.GetFixtureA(),fixtureB=c.GetFixtureB(),bodyA=fixtureA.GetBody(),bodyB=fixtureB.GetBody();c.IsTouching()&&this.m_contactListener.EndContact(c),c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),c==this.m_world.m_contactList&&(this.m_world.m_contactList=c.m_next),c.m_nodeA.prev&&(c.m_nodeA.prev.next=c.m_nodeA.next),c.m_nodeA.next&&(c.m_nodeA.next.prev=c.m_nodeA.prev),c.m_nodeA==bodyA.m_contactList&&(bodyA.m_contactList=c.m_nodeA.next),c.m_nodeB.prev&&(c.m_nodeB.prev.next=c.m_nodeB.next),c.m_nodeB.next&&(c.m_nodeB.next.prev=c.m_nodeB.prev),c.m_nodeB==bodyB.m_contactList&&(bodyB.m_contactList=c.m_nodeB.next),this.m_contactFactory.Destroy(c),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var c=this.m_world.m_contactList;c;){var fixtureA=c.GetFixtureA(),fixtureB=c.GetFixtureB(),bodyA=fixtureA.GetBody(),bodyB=fixtureB.GetBody();if(0!=bodyA.IsAwake()||0!=bodyB.IsAwake()){if(c.m_flags&b2Contact.e_filterFlag){if(0==bodyB.ShouldCollide(bodyA)){var cNuke=c;c=cNuke.GetNext(),this.Destroy(cNuke);continue}if(0==this.m_contactFilter.ShouldCollide(fixtureA,fixtureB)){cNuke=c,c=cNuke.GetNext(),this.Destroy(cNuke);continue}c.m_flags&=~b2Contact.e_filterFlag}var proxyA=fixtureA.m_proxy,proxyB=fixtureB.m_proxy,overlap=this.m_broadPhase.TestOverlap(proxyA,proxyB);0!=overlap?(c.Update(this.m_contactListener),c=c.GetNext()):(cNuke=c,c=cNuke.GetNext(),this.Destroy(cNuke))}else c=c.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new b2ContactPoint}),b2DebugDraw.b2DebugDraw=function(){},b2DebugDraw.prototype.b2DebugDraw=function(){},b2DebugDraw.prototype.SetFlags=function(flags){void 0===flags&&(flags=0)},b2DebugDraw.prototype.GetFlags=function(){},b2DebugDraw.prototype.AppendFlags=function(flags){void 0===flags&&(flags=0)},b2DebugDraw.prototype.ClearFlags=function(flags){void 0===flags&&(flags=0)},b2DebugDraw.prototype.SetSprite=function(sprite){},b2DebugDraw.prototype.GetSprite=function(){},b2DebugDraw.prototype.SetDrawScale=function(drawScale){void 0===drawScale&&(drawScale=0)},b2DebugDraw.prototype.GetDrawScale=function(){},b2DebugDraw.prototype.SetLineThickness=function(lineThickness){void 0===lineThickness&&(lineThickness=0)},b2DebugDraw.prototype.GetLineThickness=function(){},b2DebugDraw.prototype.SetAlpha=function(alpha){void 0===alpha&&(alpha=0)},b2DebugDraw.prototype.GetAlpha=function(){},b2DebugDraw.prototype.SetFillAlpha=function(alpha){void 0===alpha&&(alpha=0)},b2DebugDraw.prototype.GetFillAlpha=function(){},b2DebugDraw.prototype.SetXFormScale=function(xformScale){void 0===xformScale&&(xformScale=0)},b2DebugDraw.prototype.GetXFormScale=function(){},b2DebugDraw.prototype.DrawPolygon=function(vertices,vertexCount,color){void 0===vertexCount&&(vertexCount=0)},b2DebugDraw.prototype.DrawSolidPolygon=function(vertices,vertexCount,color){void 0===vertexCount&&(vertexCount=0)},b2DebugDraw.prototype.DrawCircle=function(center,radius,color){void 0===radius&&(radius=0)},b2DebugDraw.prototype.DrawSolidCircle=function(center,radius,axis,color){void 0===radius&&(radius=0)},b2DebugDraw.prototype.DrawSegment=function(p1,p2,color){},b2DebugDraw.prototype.DrawTransform=function(xf){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,
Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),b2DestructionListener.b2DestructionListener=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(joint){},b2DestructionListener.prototype.SayGoodbyeFixture=function(fixture){},b2FilterData.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},b2FilterData.prototype.Copy=function(){var copy=new b2FilterData;return copy.categoryBits=this.categoryBits,copy.maskBits=this.maskBits,copy.groupIndex=this.groupIndex,copy},b2Fixture.b2Fixture=function(){this.m_filter=new b2FilterData},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(sensor){if(this.m_isSensor!=sensor&&(this.m_isSensor=sensor,null!=this.m_body))for(var edge=this.m_body.GetContactList();edge;){var contact=edge.contact,fixtureA=contact.GetFixtureA(),fixtureB=contact.GetFixtureB();(fixtureA==this||fixtureB==this)&&contact.SetSensor(fixtureA.IsSensor()||fixtureB.IsSensor()),edge=edge.next}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(filter){if(this.m_filter=filter.Copy(),!this.m_body)for(var edge=this.m_body.GetContactList();edge;){var contact=edge.contact,fixtureA=contact.GetFixtureA(),fixtureB=contact.GetFixtureB();(fixtureA==this||fixtureB==this)&&contact.FlagForFiltering(),edge=edge.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(data){this.m_userData=data},b2Fixture.prototype.TestPoint=function(p){return this.m_shape.TestPoint(this.m_body.GetTransform(),p)},b2Fixture.prototype.RayCast=function(output,input){return this.m_shape.RayCast(output,input,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(massData){return void 0===massData&&(massData=null),null==massData&&(massData=new b2MassData),this.m_shape.ComputeMass(massData,this.m_density),massData},b2Fixture.prototype.SetDensity=function(density){void 0===density&&(density=0),this.m_density=density},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(friction){void 0===friction&&(friction=0),this.m_friction=friction},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(restitution){void 0===restitution&&(restitution=0),this.m_restitution=restitution},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.b2Fixture=function(){this.m_aabb=new b2AABB,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},b2Fixture.prototype.Create=function(body,xf,def){this.m_userData=def.userData,this.m_friction=def.friction,this.m_restitution=def.restitution,this.m_body=body,this.m_next=null,this.m_filter=def.filter.Copy(),this.m_isSensor=def.isSensor,this.m_shape=def.shape.Copy(),this.m_density=def.density},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(broadPhase,xf){this.m_shape.ComputeAABB(this.m_aabb,xf),this.m_proxy=broadPhase.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(broadPhase){null!=this.m_proxy&&(broadPhase.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(broadPhase,transform1,transform2){if(this.m_proxy){var aabb1=new b2AABB,aabb2=new b2AABB;this.m_shape.ComputeAABB(aabb1,transform1),this.m_shape.ComputeAABB(aabb2,transform2),this.m_aabb.Combine(aabb1,aabb2);var displacement=b2Math.SubtractVV(transform2.position,transform1.position);broadPhase.MoveProxy(this.m_proxy,this.m_aabb,displacement)}},b2FixtureDef.b2FixtureDef=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2Island.b2Island=function(){},b2Island.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},b2Island.prototype.Initialize=function(bodyCapacity,contactCapacity,jointCapacity,allocator,listener,contactSolver){void 0===bodyCapacity&&(bodyCapacity=0),void 0===contactCapacity&&(contactCapacity=0),void 0===jointCapacity&&(jointCapacity=0);var i=0;for(this.m_bodyCapacity=bodyCapacity,this.m_contactCapacity=contactCapacity,this.m_jointCapacity=jointCapacity,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=allocator,this.m_listener=listener,this.m_contactSolver=contactSolver,i=this.m_bodies.length;bodyCapacity>i;i++)this.m_bodies[i]=null;for(i=this.m_contacts.length;contactCapacity>i;i++)this.m_contacts[i]=null;for(i=this.m_joints.length;jointCapacity>i;i++)this.m_joints[i]=null},b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},b2Island.prototype.Solve=function(step,gravity,allowSleep){var b,joint,i=0,j=0;for(i=0;i<this.m_bodyCount;++i)b=this.m_bodies[i],b.GetType()==b2Body.b2_dynamicBody&&(b.m_linearVelocity.x+=step.dt*(gravity.x+b.m_invMass*b.m_force.x),b.m_linearVelocity.y+=step.dt*(gravity.y+b.m_invMass*b.m_force.y),b.m_angularVelocity+=step.dt*b.m_invI*b.m_torque,b.m_linearVelocity.Multiply(b2Math.Clamp(1-step.dt*b.m_linearDamping,0,1)),b.m_angularVelocity*=b2Math.Clamp(1-step.dt*b.m_angularDamping,0,1));this.m_contactSolver.Initialize(step,this.m_contacts,this.m_contactCount,this.m_allocator);var contactSolver=this.m_contactSolver;for(contactSolver.InitVelocityConstraints(step),i=0;i<this.m_jointCount;++i)joint=this.m_joints[i],joint.InitVelocityConstraints(step);for(i=0;i<step.velocityIterations;++i){for(j=0;j<this.m_jointCount;++j)joint=this.m_joints[j],joint.SolveVelocityConstraints(step);contactSolver.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i)joint=this.m_joints[i],joint.FinalizeVelocityConstraints();for(contactSolver.FinalizeVelocityConstraints(),i=0;i<this.m_bodyCount;++i)if(b=this.m_bodies[i],b.GetType()!=b2Body.b2_staticBody){var translationX=step.dt*b.m_linearVelocity.x,translationY=step.dt*b.m_linearVelocity.y;translationX*translationX+translationY*translationY>b2Settings.b2_maxTranslationSquared&&(b.m_linearVelocity.Normalize(),b.m_linearVelocity.x*=b2Settings.b2_maxTranslation*step.inv_dt,b.m_linearVelocity.y*=b2Settings.b2_maxTranslation*step.inv_dt);var rotation=step.dt*b.m_angularVelocity;rotation*rotation>b2Settings.b2_maxRotationSquared&&(b.m_angularVelocity=b.m_angularVelocity<0?-b2Settings.b2_maxRotation*step.inv_dt:b2Settings.b2_maxRotation*step.inv_dt),b.m_sweep.c0.SetV(b.m_sweep.c),b.m_sweep.a0=b.m_sweep.a,b.m_sweep.c.x+=step.dt*b.m_linearVelocity.x,b.m_sweep.c.y+=step.dt*b.m_linearVelocity.y,b.m_sweep.a+=step.dt*b.m_angularVelocity,b.SynchronizeTransform()}for(i=0;i<step.positionIterations;++i){var contactsOkay=contactSolver.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),jointsOkay=!0;for(j=0;j<this.m_jointCount;++j){joint=this.m_joints[j];var jointOkay=joint.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);jointsOkay=jointsOkay&&jointOkay}if(contactsOkay&&jointsOkay)break}if(this.Report(contactSolver.m_constraints),allowSleep){var minSleepTime=Number.MAX_VALUE,linTolSqr=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,angTolSqr=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)b=this.m_bodies[i],b.GetType()!=b2Body.b2_staticBody&&(0==(b.m_flags&b2Body.e_allowSleepFlag)&&(b.m_sleepTime=0,minSleepTime=0),0==(b.m_flags&b2Body.e_allowSleepFlag)||b.m_angularVelocity*b.m_angularVelocity>angTolSqr||b2Math.Dot(b.m_linearVelocity,b.m_linearVelocity)>linTolSqr?(b.m_sleepTime=0,minSleepTime=0):(b.m_sleepTime+=step.dt,minSleepTime=b2Math.Min(minSleepTime,b.m_sleepTime)));if(minSleepTime>=b2Settings.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)b=this.m_bodies[i],b.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(subStep){var i=0,j=0;this.m_contactSolver.Initialize(subStep,this.m_contacts,this.m_contactCount,this.m_allocator);var contactSolver=this.m_contactSolver;for(i=0;i<this.m_jointCount;++i)this.m_joints[i].InitVelocityConstraints(subStep);for(i=0;i<subStep.velocityIterations;++i)for(contactSolver.SolveVelocityConstraints(),j=0;j<this.m_jointCount;++j)this.m_joints[j].SolveVelocityConstraints(subStep);for(i=0;i<this.m_bodyCount;++i){var b=this.m_bodies[i];if(b.GetType()!=b2Body.b2_staticBody){var translationX=subStep.dt*b.m_linearVelocity.x,translationY=subStep.dt*b.m_linearVelocity.y;translationX*translationX+translationY*translationY>b2Settings.b2_maxTranslationSquared&&(b.m_linearVelocity.Normalize(),b.m_linearVelocity.x*=b2Settings.b2_maxTranslation*subStep.inv_dt,b.m_linearVelocity.y*=b2Settings.b2_maxTranslation*subStep.inv_dt);var rotation=subStep.dt*b.m_angularVelocity;rotation*rotation>b2Settings.b2_maxRotationSquared&&(b.m_angularVelocity=b.m_angularVelocity<0?-b2Settings.b2_maxRotation*subStep.inv_dt:b2Settings.b2_maxRotation*subStep.inv_dt),b.m_sweep.c0.SetV(b.m_sweep.c),b.m_sweep.a0=b.m_sweep.a,b.m_sweep.c.x+=subStep.dt*b.m_linearVelocity.x,b.m_sweep.c.y+=subStep.dt*b.m_linearVelocity.y,b.m_sweep.a+=subStep.dt*b.m_angularVelocity,b.SynchronizeTransform()}}var k_toiBaumgarte=.75;for(i=0;i<subStep.positionIterations;++i){var contactsOkay=contactSolver.SolvePositionConstraints(k_toiBaumgarte),jointsOkay=!0;for(j=0;j<this.m_jointCount;++j){var jointOkay=this.m_joints[j].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);jointsOkay=jointsOkay&&jointOkay}if(contactsOkay&&jointsOkay)break}this.Report(contactSolver.m_constraints)},b2Island.prototype.Report=function(constraints){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){for(var c=this.m_contacts[i],cc=constraints[i],j=0;j<cc.pointCount;++j)b2Island.s_impulse.normalImpulses[j]=cc.points[j].normalImpulse,b2Island.s_impulse.tangentImpulses[j]=cc.points[j].tangentImpulse;this.m_listener.PostSolve(c,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(body){body.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=body},b2Island.prototype.AddContact=function(contact){this.m_contacts[this.m_contactCount++]=contact},b2Island.prototype.AddJoint=function(joint){this.m_joints[this.m_jointCount++]=joint},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new b2ContactImpulse}),b2TimeStep.b2TimeStep=function(){},b2TimeStep.prototype.Set=function(step){this.dt=step.dt,this.inv_dt=step.inv_dt,this.positionIterations=step.positionIterations,this.velocityIterations=step.velocityIterations,this.warmStarting=step.warmStarting},b2World.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.prototype.b2World=function(gravity,doSleep){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=doSleep,this.m_gravity=gravity,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var bd=new b2BodyDef;this.m_groundBody=this.CreateBody(bd)},b2World.prototype.SetDestructionListener=function(listener){this.m_destructionListener=listener},b2World.prototype.SetContactFilter=function(filter){this.m_contactManager.m_contactFilter=filter},b2World.prototype.SetContactListener=function(listener){this.m_contactManager.m_contactListener=listener},b2World.prototype.SetDebugDraw=function(debugDraw){this.m_debugDraw=debugDraw},b2World.prototype.SetBroadPhase=function(broadPhase){var oldBroadPhase=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=broadPhase;for(var b=this.m_bodyList;b;b=b.m_next)for(var f=b.m_fixtureList;f;f=f.m_next)f.m_proxy=broadPhase.CreateProxy(oldBroadPhase.GetFatAABB(f.m_proxy),f)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(def){if(1==this.IsLocked())return null;var b=new b2Body(def,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},b2World.prototype.DestroyBody=function(b){if(1!=this.IsLocked()){for(var jn=b.m_jointList;jn;){var jn0=jn;jn=jn.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(jn0.joint),this.DestroyJoint(jn0.joint)}for(var coe=b.m_controllerList;coe;){var coe0=coe;coe=coe.nextController,coe0.controller.RemoveBody(b)}for(var ce=b.m_contactList;ce;){var ce0=ce;ce=ce.next,this.m_contactManager.Destroy(ce0.contact)}b.m_contactList=null;for(var f=b.m_fixtureList;f;){var f0=f;f=f.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(f0),f0.DestroyProxy(this.m_contactManager.m_broadPhase),f0.Destroy()}b.m_fixtureList=null,b.m_fixtureCount=0,b.m_prev&&(b.m_prev.m_next=b.m_next),b.m_next&&(b.m_next.m_prev=b.m_prev),b==this.m_bodyList&&(this.m_bodyList=b.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(def){var j=b2Joint.Create(def,null);j.m_prev=null,j.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=j),this.m_jointList=j,++this.m_jointCount,j.m_edgeA.joint=j,j.m_edgeA.other=j.m_bodyB,j.m_edgeA.prev=null,j.m_edgeA.next=j.m_bodyA.m_jointList,j.m_bodyA.m_jointList&&(j.m_bodyA.m_jointList.prev=j.m_edgeA),j.m_bodyA.m_jointList=j.m_edgeA,j.m_edgeB.joint=j,j.m_edgeB.other=j.m_bodyA,j.m_edgeB.prev=null,j.m_edgeB.next=j.m_bodyB.m_jointList,j.m_bodyB.m_jointList&&(j.m_bodyB.m_jointList.prev=j.m_edgeB),j.m_bodyB.m_jointList=j.m_edgeB;var bodyA=def.bodyA,bodyB=def.bodyB;if(0==def.collideConnected)for(var edge=bodyB.GetContactList();edge;)edge.other==bodyA&&edge.contact.FlagForFiltering(),edge=edge.next;return j},b2World.prototype.DestroyJoint=function(j){var collideConnected=j.m_collideConnected;j.m_prev&&(j.m_prev.m_next=j.m_next),j.m_next&&(j.m_next.m_prev=j.m_prev),j==this.m_jointList&&(this.m_jointList=j.m_next);var bodyA=j.m_bodyA,bodyB=j.m_bodyB;if(bodyA.SetAwake(!0),bodyB.SetAwake(!0),j.m_edgeA.prev&&(j.m_edgeA.prev.next=j.m_edgeA.next),j.m_edgeA.next&&(j.m_edgeA.next.prev=j.m_edgeA.prev),j.m_edgeA==bodyA.m_jointList&&(bodyA.m_jointList=j.m_edgeA.next),j.m_edgeA.prev=null,j.m_edgeA.next=null,j.m_edgeB.prev&&(j.m_edgeB.prev.next=j.m_edgeB.next),j.m_edgeB.next&&(j.m_edgeB.next.prev=j.m_edgeB.prev),j.m_edgeB==bodyB.m_jointList&&(bodyB.m_jointList=j.m_edgeB.next),j.m_edgeB.prev=null,j.m_edgeB.next=null,b2Joint.Destroy(j,null),--this.m_jointCount,0==collideConnected)for(var edge=bodyB.GetContactList();edge;)edge.other==bodyA&&edge.contact.FlagForFiltering(),edge=edge.next},b2World.prototype.AddController=function(c){return c.m_next=this.m_controllerList,c.m_prev=null,this.m_controllerList=c,c.m_world=this,this.m_controllerCount++,c},b2World.prototype.RemoveController=function(c){c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),this.m_controllerList==c&&(this.m_controllerList=c.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(controller){if(controller.m_world!=this)throw new Error("Controller can only be a member of one world");return controller.m_next=this.m_controllerList,controller.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=controller),this.m_controllerList=controller,++this.m_controllerCount,controller.m_world=this,controller},b2World.prototype.DestroyController=function(controller){controller.Clear(),controller.m_next&&(controller.m_next.m_prev=controller.m_prev),controller.m_prev&&(controller.m_prev.m_next=controller.m_next),controller==this.m_controllerList&&(this.m_controllerList=controller.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(flag){b2World.m_warmStarting=flag},b2World.prototype.SetContinuousPhysics=function(flag){b2World.m_continuousPhysics=flag},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(gravity){this.m_gravity=gravity},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(dt,velocityIterations,positionIterations){void 0===dt&&(dt=0),void 0===velocityIterations&&(velocityIterations=0),void 0===positionIterations&&(positionIterations=0),this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var step=b2World.s_timestep2;step.dt=dt,step.velocityIterations=velocityIterations,step.positionIterations=positionIterations,step.inv_dt=dt>0?1/dt:0,step.dtRatio=this.m_inv_dt0*dt,step.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),step.dt>0&&this.Solve(step),b2World.m_continuousPhysics&&step.dt>0&&this.SolveTOI(step),step.dt>0&&(this.m_inv_dt0=step.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var body=this.m_bodyList;body;body=body.m_next)body.m_force.SetZero(),body.m_torque=0},b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var b,f,s,j,bp,xf,flags=this.m_debugDraw.GetFlags(),vs=(new b2Vec2,new b2Vec2,new b2Vec2,new b2AABB,new b2AABB,[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2]),color=new b2Color(0,0,0);if(flags&b2DebugDraw.e_shapeBit)for(b=this.m_bodyList;b;b=b.m_next)for(xf=b.m_xf,f=b.GetFixtureList();f;f=f.m_next)s=f.GetShape(),0==b.IsActive()?(color.Set(.5,.5,.3),this.DrawShape(s,xf,color)):b.GetType()==b2Body.b2_staticBody?(color.Set(.5,.9,.5),this.DrawShape(s,xf,color)):b.GetType()==b2Body.b2_kinematicBody?(color.Set(.5,.5,.9),this.DrawShape(s,xf,color)):0==b.IsAwake()?(color.Set(.6,.6,.6),this.DrawShape(s,xf,color)):(color.Set(.9,.7,.7),this.DrawShape(s,xf,color));if(flags&b2DebugDraw.e_jointBit)for(j=this.m_jointList;j;j=j.m_next)this.DrawJoint(j);if(flags&b2DebugDraw.e_controllerBit)for(var c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw);if(flags&b2DebugDraw.e_pairBit){color.Set(.3,.9,.9);for(var contact=this.m_contactManager.m_contactList;contact;contact=contact.GetNext()){var fixtureA=contact.GetFixtureA(),fixtureB=contact.GetFixtureB(),cA=fixtureA.GetAABB().GetCenter(),cB=fixtureB.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(cA,cB,color)}}if(flags&b2DebugDraw.e_aabbBit)for(bp=this.m_contactManager.m_broadPhase,vs=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2],b=this.m_bodyList;b;b=b.GetNext())if(0!=b.IsActive())for(f=b.GetFixtureList();f;f=f.GetNext()){var aabb=bp.GetFatAABB(f.m_proxy);vs[0].Set(aabb.lowerBound.x,aabb.lowerBound.y),vs[1].Set(aabb.upperBound.x,aabb.lowerBound.y),vs[2].Set(aabb.upperBound.x,aabb.upperBound.y),vs[3].Set(aabb.lowerBound.x,aabb.upperBound.y),this.m_debugDraw.DrawPolygon(vs,4,color)}if(flags&b2DebugDraw.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)xf=b2World.s_xf,xf.R=b.m_xf.R,xf.position=b.GetWorldCenter(),this.m_debugDraw.DrawTransform(xf)}},b2World.prototype.QueryAABB=function(callback,aabb){function WorldQueryWrapper(proxy){return callback(broadPhase.GetUserData(proxy))}var __this=this,broadPhase=__this.m_contactManager.m_broadPhase;broadPhase.Query(WorldQueryWrapper,aabb)},b2World.prototype.QueryShape=function(callback,shape,transform){function WorldQueryWrapper(proxy){var fixture=broadPhase.GetUserData(proxy)instanceof b2Fixture?broadPhase.GetUserData(proxy):null;return b2Shape.TestOverlap(shape,transform,fixture.GetShape(),fixture.GetBody().GetTransform())?callback(fixture):!0}var __this=this;void 0===transform&&(transform=null),null==transform&&(transform=new b2Transform,transform.SetIdentity());var broadPhase=__this.m_contactManager.m_broadPhase,aabb=new b2AABB;shape.ComputeAABB(aabb,transform),broadPhase.Query(WorldQueryWrapper,aabb)},b2World.prototype.QueryPoint=function(callback,p){function WorldQueryWrapper(proxy){var fixture=broadPhase.GetUserData(proxy)instanceof b2Fixture?broadPhase.GetUserData(proxy):null;return fixture.TestPoint(p)?callback(fixture):!0}var __this=this,broadPhase=__this.m_contactManager.m_broadPhase,aabb=new b2AABB;aabb.lowerBound.Set(p.x-b2Settings.b2_linearSlop,p.y-b2Settings.b2_linearSlop),aabb.upperBound.Set(p.x+b2Settings.b2_linearSlop,p.y+b2Settings.b2_linearSlop),broadPhase.Query(WorldQueryWrapper,aabb)},b2World.prototype.RayCast=function(callback,point1,point2){function RayCastWrapper(input,proxy){var userData=broadPhase.GetUserData(proxy),fixture=userData instanceof b2Fixture?userData:null,hit=fixture.RayCast(output,input);if(hit){var fraction=output.fraction,point=new b2Vec2((1-fraction)*point1.x+fraction*point2.x,(1-fraction)*point1.y+fraction*point2.y);return callback(fixture,point,output.normal,fraction)}return input.maxFraction}var __this=this,broadPhase=__this.m_contactManager.m_broadPhase,output=new b2RayCastOutput,input=new b2RayCastInput(point1,point2);broadPhase.RayCast(RayCastWrapper,input)},b2World.prototype.RayCastOne=function(point1,point2){function RayCastOneWrapper(fixture,point,normal,fraction){return void 0===fraction&&(fraction=0),result=fixture,fraction}var result,__this=this;return __this.RayCast(RayCastOneWrapper,point1,point2),result},b2World.prototype.RayCastAll=function(point1,point2){function RayCastAllWrapper(fixture,point,normal,fraction){return void 0===fraction&&(fraction=0),result[result.length]=fixture,1}var __this=this,result=new Vector;return __this.RayCast(RayCastAllWrapper,point1,point2),result},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.Solve=function(step){for(var b,controller=this.m_controllerList;controller;controller=controller.m_next)controller.Step(step);var island=this.m_island;for(island.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag;for(var c=this.m_contactList;c;c=c.m_next)c.m_flags&=~b2Contact.e_islandFlag;for(var j=this.m_jointList;j;j=j.m_next)j.m_islandFlag=!1;for(var stack=(parseInt(this.m_bodyCount),this.s_stack),seed=this.m_bodyList;seed;seed=seed.m_next)if(!(seed.m_flags&b2Body.e_islandFlag)&&0!=seed.IsAwake()&&0!=seed.IsActive()&&seed.GetType()!=b2Body.b2_staticBody){island.Clear();var stackCount=0;for(stack[stackCount++]=seed,seed.m_flags|=b2Body.e_islandFlag;stackCount>0;)if(b=stack[--stackCount],island.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=b2Body.b2_staticBody){for(var other,ce=b.m_contactList;ce;ce=ce.next)ce.contact.m_flags&b2Contact.e_islandFlag||1!=ce.contact.IsSensor()&&0!=ce.contact.IsEnabled()&&0!=ce.contact.IsTouching()&&(island.AddContact(ce.contact),ce.contact.m_flags|=b2Contact.e_islandFlag,other=ce.other,other.m_flags&b2Body.e_islandFlag||(stack[stackCount++]=other,other.m_flags|=b2Body.e_islandFlag));for(var jn=b.m_jointList;jn;jn=jn.next)1!=jn.joint.m_islandFlag&&(other=jn.other,0!=other.IsActive()&&(island.AddJoint(jn.joint),jn.joint.m_islandFlag=!0,other.m_flags&b2Body.e_islandFlag||(stack[stackCount++]=other,other.m_flags|=b2Body.e_islandFlag)))}island.Solve(step,this.m_gravity,this.m_allowSleep);for(var i=0;i<island.m_bodyCount;++i)b=island.m_bodies[i],b.GetType()==b2Body.b2_staticBody&&(b.m_flags&=~b2Body.e_islandFlag)}for(i=0;i<stack.length&&stack[i];++i)stack[i]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=b2Body.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(step){var b,fA,fB,bA,bB,cEdge,j,island=this.m_island;island.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var queue=b2World.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag,b.m_sweep.t0=0;var c;for(c=this.m_contactList;c;c=c.m_next)c.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(j=this.m_jointList;j;j=j.m_next)j.m_islandFlag=!1;for(;;){var minContact=null,minTOI=1;for(c=this.m_contactList;c;c=c.m_next)if(1!=c.IsSensor()&&0!=c.IsEnabled()&&0!=c.IsContinuous()){var toi=1;if(c.m_flags&b2Contact.e_toiFlag)toi=c.m_toi;else{if(fA=c.m_fixtureA,fB=c.m_fixtureB,bA=fA.m_body,bB=fB.m_body,!(bA.GetType()==b2Body.b2_dynamicBody&&0!=bA.IsAwake()||bB.GetType()==b2Body.b2_dynamicBody&&0!=bB.IsAwake()))continue;var t0=bA.m_sweep.t0;bA.m_sweep.t0<bB.m_sweep.t0?(t0=bB.m_sweep.t0,bA.m_sweep.Advance(t0)):bB.m_sweep.t0<bA.m_sweep.t0&&(t0=bA.m_sweep.t0,bB.m_sweep.Advance(t0)),toi=c.ComputeTOI(bA.m_sweep,bB.m_sweep),b2Settings.b2Assert(toi>=0&&1>=toi),toi>0&&1>toi&&(toi=(1-toi)*t0+toi,toi>1&&(toi=1)),c.m_toi=toi,c.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<toi&&minTOI>toi&&(minContact=c,minTOI=toi)}if(null==minContact||1-100*Number.MIN_VALUE<minTOI)break;if(fA=minContact.m_fixtureA,fB=minContact.m_fixtureB,bA=fA.m_body,bB=fB.m_body,b2World.s_backupA.Set(bA.m_sweep),b2World.s_backupB.Set(bB.m_sweep),bA.Advance(minTOI),bB.Advance(minTOI),minContact.Update(this.m_contactManager.m_contactListener),minContact.m_flags&=~b2Contact.e_toiFlag,1!=minContact.IsSensor()&&0!=minContact.IsEnabled()){if(0!=minContact.IsTouching()){var seed=bA;seed.GetType()!=b2Body.b2_dynamicBody&&(seed=bB),island.Clear();var queueStart=0,queueSize=0;for(queue[queueStart+queueSize++]=seed,seed.m_flags|=b2Body.e_islandFlag;queueSize>0;)if(b=queue[queueStart++],--queueSize,island.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==b2Body.b2_dynamicBody){for(cEdge=b.m_contactList;cEdge&&island.m_contactCount!=island.m_contactCapacity;cEdge=cEdge.next)if(!(cEdge.contact.m_flags&b2Contact.e_islandFlag)&&1!=cEdge.contact.IsSensor()&&0!=cEdge.contact.IsEnabled()&&0!=cEdge.contact.IsTouching()){island.AddContact(cEdge.contact),cEdge.contact.m_flags|=b2Contact.e_islandFlag;var other=cEdge.other;other.m_flags&b2Body.e_islandFlag||(other.GetType()!=b2Body.b2_staticBody&&(other.Advance(minTOI),other.SetAwake(!0)),queue[queueStart+queueSize]=other,++queueSize,other.m_flags|=b2Body.e_islandFlag)}for(var jEdge=b.m_jointList;jEdge;jEdge=jEdge.next)island.m_jointCount!=island.m_jointCapacity&&1!=jEdge.joint.m_islandFlag&&(other=jEdge.other,0!=other.IsActive()&&(island.AddJoint(jEdge.joint),jEdge.joint.m_islandFlag=!0,other.m_flags&b2Body.e_islandFlag||(other.GetType()!=b2Body.b2_staticBody&&(other.Advance(minTOI),other.SetAwake(!0)),queue[queueStart+queueSize]=other,++queueSize,other.m_flags|=b2Body.e_islandFlag)))}var subStep=b2World.s_timestep;subStep.warmStarting=!1,subStep.dt=(1-minTOI)*step.dt,subStep.inv_dt=1/subStep.dt,subStep.dtRatio=0,subStep.velocityIterations=step.velocityIterations,subStep.positionIterations=step.positionIterations,island.SolveTOI(subStep);var i=0;for(i=0;i<island.m_bodyCount;++i)if(b=island.m_bodies[i],b.m_flags&=~b2Body.e_islandFlag,0!=b.IsAwake()&&b.GetType()==b2Body.b2_dynamicBody)for(b.SynchronizeFixtures(),cEdge=b.m_contactList;cEdge;cEdge=cEdge.next)cEdge.contact.m_flags&=~b2Contact.e_toiFlag;for(i=0;i<island.m_contactCount;++i)c=island.m_contacts[i],c.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(i=0;i<island.m_jointCount;++i)j=island.m_joints[i],j.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else bA.m_sweep.Set(b2World.s_backupA),bB.m_sweep.Set(b2World.s_backupB),bA.SynchronizeTransform(),bB.SynchronizeTransform()}},b2World.prototype.DrawJoint=function(joint){var b1=joint.GetBodyA(),b2=joint.GetBodyB(),xf1=b1.m_xf,xf2=b2.m_xf,x1=xf1.position,x2=xf2.position,p1=joint.GetAnchorA(),p2=joint.GetAnchorB(),color=b2World.s_jointColor;switch(joint.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(p1,p2,color);break;case b2Joint.e_pulleyJoint:var pulley=joint instanceof b2PulleyJoint?joint:null,s1=pulley.GetGroundAnchorA(),s2=pulley.GetGroundAnchorB();this.m_debugDraw.DrawSegment(s1,p1,color),this.m_debugDraw.DrawSegment(s2,p2,color),this.m_debugDraw.DrawSegment(s1,s2,color);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(p1,p2,color);break;default:b1!=this.m_groundBody&&this.m_debugDraw.DrawSegment(x1,p1,color),this.m_debugDraw.DrawSegment(p1,p2,color),b2!=this.m_groundBody&&this.m_debugDraw.DrawSegment(x2,p2,color)}},b2World.prototype.DrawShape=function(shape,xf,color){switch(shape.m_type){case b2Shape.e_circleShape:var circle=shape instanceof b2CircleShape?shape:null,center=b2Math.MulX(xf,circle.m_p),radius=circle.m_radius,axis=xf.R.col1;this.m_debugDraw.DrawSolidCircle(center,radius,axis,color);break;case b2Shape.e_polygonShape:var i=0,poly=shape instanceof b2PolygonShape?shape:null,vertexCount=parseInt(poly.GetVertexCount()),localVertices=poly.GetVertices(),vertices=new Vector(vertexCount);for(i=0;vertexCount>i;++i)vertices[i]=b2Math.MulX(xf,localVertices[i]);this.m_debugDraw.DrawSolidPolygon(vertices,vertexCount,color);break;case b2Shape.e_edgeShape:var edge=shape instanceof b2EdgeShape?shape:null;this.m_debugDraw.DrawSegment(b2Math.MulX(xf,edge.GetVertex1()),b2Math.MulX(xf,edge.GetVertex2()),color)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new b2TimeStep,Box2D.Dynamics.b2World.s_xf=new b2Transform,Box2D.Dynamics.b2World.s_backupA=new b2Sweep,Box2D.Dynamics.b2World.s_backupB=new b2Sweep,Box2D.Dynamics.b2World.s_timestep=new b2TimeStep,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new b2Color(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){{var b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2EdgeShape=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),b2PolygonShape=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),b2Shape=Box2D.Collision.Shapes.b2Shape,b2CircleContact=Box2D.Dynamics.Contacts.b2CircleContact,b2Contact=Box2D.Dynamics.Contacts.b2Contact,b2ContactConstraint=Box2D.Dynamics.Contacts.b2ContactConstraint,b2ContactConstraintPoint=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,b2ContactEdge=Box2D.Dynamics.Contacts.b2ContactEdge,b2ContactFactory=Box2D.Dynamics.Contacts.b2ContactFactory,b2ContactRegister=Box2D.Dynamics.Contacts.b2ContactRegister,b2ContactResult=Box2D.Dynamics.Contacts.b2ContactResult,b2ContactSolver=Box2D.Dynamics.Contacts.b2ContactSolver,b2EdgeAndCircleContact=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,b2NullContact=Box2D.Dynamics.Contacts.b2NullContact,b2PolyAndCircleContact=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,b2PolyAndEdgeContact=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,b2PolygonContact=Box2D.Dynamics.Contacts.b2PolygonContact,b2PositionSolverManifold=Box2D.Dynamics.Contacts.b2PositionSolverManifold,b2Body=Box2D.Dynamics.b2Body,b2TimeStep=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,
Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),b2Settings=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b2Mat22=Box2D.Common.Math.b2Mat22,b2Math=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b2Vec2=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),b2Collision=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),b2ContactID=Box2D.Collision.b2ContactID,b2Manifold=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),b2TimeOfImpact=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),b2TOIInput=Box2D.Collision.b2TOIInput,b2WorldManifold=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase}Box2D.inherit(b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),b2CircleContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2CircleContact.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2CircleContact.Create=function(allocator){return new b2CircleContact},b2CircleContact.Destroy=function(contact,allocator){},b2CircleContact.prototype.Reset=function(fixtureA,fixtureB){this.__super.Reset.call(this,fixtureA,fixtureB)},b2CircleContact.prototype.Evaluate=function(){var bA=this.m_fixtureA.GetBody(),bB=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof b2CircleShape?this.m_fixtureA.GetShape():null,bA.m_xf,this.m_fixtureB.GetShape()instanceof b2CircleShape?this.m_fixtureB.GetShape():null,bB.m_xf)},b2Contact.b2Contact=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(worldManifold){var bodyA=this.m_fixtureA.GetBody(),bodyB=this.m_fixtureB.GetBody(),shapeA=this.m_fixtureA.GetShape(),shapeB=this.m_fixtureB.GetShape();worldManifold.Initialize(this.m_manifold,bodyA.GetTransform(),shapeA.m_radius,bodyB.GetTransform(),shapeB.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(sensor){sensor?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(flag){flag?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.b2Contact=function(){},b2Contact.prototype.Reset=function(fixtureA,fixtureB){if(void 0===fixtureA&&(fixtureA=null),void 0===fixtureB&&(fixtureB=null),this.m_flags=b2Contact.e_enabledFlag,!fixtureA||!fixtureB)return this.m_fixtureA=null,void(this.m_fixtureB=null);(fixtureA.IsSensor()||fixtureB.IsSensor())&&(this.m_flags|=b2Contact.e_sensorFlag);var bodyA=fixtureA.GetBody(),bodyB=fixtureB.GetBody();(bodyA.GetType()!=b2Body.b2_dynamicBody||bodyA.IsBullet()||bodyB.GetType()!=b2Body.b2_dynamicBody||bodyB.IsBullet())&&(this.m_flags|=b2Contact.e_continuousFlag),this.m_fixtureA=fixtureA,this.m_fixtureB=fixtureB,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},b2Contact.prototype.Update=function(listener){var tManifold=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=tManifold,this.m_flags|=b2Contact.e_enabledFlag;var touching=!1,wasTouching=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag,bodyA=this.m_fixtureA.m_body,bodyB=this.m_fixtureB.m_body,aabbOverlap=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag){if(aabbOverlap){var shapeA=this.m_fixtureA.GetShape(),shapeB=this.m_fixtureB.GetShape(),xfA=bodyA.GetTransform(),xfB=bodyB.GetTransform();touching=b2Shape.TestOverlap(shapeA,xfA,shapeB,xfB)}this.m_manifold.m_pointCount=0}else{if(bodyA.GetType()!=b2Body.b2_dynamicBody||bodyA.IsBullet()||bodyB.GetType()!=b2Body.b2_dynamicBody||bodyB.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag,aabbOverlap){this.Evaluate(),touching=this.m_manifold.m_pointCount>0;for(var i=0;i<this.m_manifold.m_pointCount;++i){var mp2=this.m_manifold.m_points[i];mp2.m_normalImpulse=0,mp2.m_tangentImpulse=0;for(var id2=mp2.m_id,j=0;j<this.m_oldManifold.m_pointCount;++j){var mp1=this.m_oldManifold.m_points[j];if(mp1.m_id.key==id2.key){mp2.m_normalImpulse=mp1.m_normalImpulse,mp2.m_tangentImpulse=mp1.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;touching!=wasTouching&&(bodyA.SetAwake(!0),bodyB.SetAwake(!0))}touching?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,0==wasTouching&&1==touching&&listener.BeginContact(this),1==wasTouching&&0==touching&&listener.EndContact(this),0==(this.m_flags&b2Contact.e_sensorFlag)&&listener.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(sweepA,sweepB){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=sweepA,b2Contact.s_input.sweepB=sweepB,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new b2TOIInput}),b2ContactConstraint.b2ContactConstraint=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.b2ContactConstraint=function(){this.points=new Vector(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)this.points[i]=new b2ContactConstraintPoint},b2ContactConstraintPoint.b2ContactConstraintPoint=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactEdge.b2ContactEdge=function(){},b2ContactFactory.b2ContactFactory=function(){},b2ContactFactory.prototype.b2ContactFactory=function(allocator){this.m_allocator=allocator,this.InitializeRegisters()},b2ContactFactory.prototype.AddType=function(createFcn,destroyFcn,type1,type2){void 0===type1&&(type1=0),void 0===type2&&(type2=0),this.m_registers[type1][type2].createFcn=createFcn,this.m_registers[type1][type2].destroyFcn=destroyFcn,this.m_registers[type1][type2].primary=!0,type1!=type2&&(this.m_registers[type2][type1].createFcn=createFcn,this.m_registers[type2][type1].destroyFcn=destroyFcn,this.m_registers[type2][type1].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Vector(b2Shape.e_shapeTypeCount);for(var i=0;i<b2Shape.e_shapeTypeCount;i++){this.m_registers[i]=new Vector(b2Shape.e_shapeTypeCount);for(var j=0;j<b2Shape.e_shapeTypeCount;j++)this.m_registers[i][j]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(fixtureA,fixtureB){var c,type1=parseInt(fixtureA.GetType()),type2=parseInt(fixtureB.GetType()),reg=this.m_registers[type1][type2];if(reg.pool)return c=reg.pool,reg.pool=c.m_next,reg.poolCount--,c.Reset(fixtureA,fixtureB),c;var createFcn=reg.createFcn;return null!=createFcn?reg.primary?(c=createFcn(this.m_allocator),c.Reset(fixtureA,fixtureB),c):(c=createFcn(this.m_allocator),c.Reset(fixtureB,fixtureA),c):null},b2ContactFactory.prototype.Destroy=function(contact){contact.m_manifold.m_pointCount>0&&(contact.m_fixtureA.m_body.SetAwake(!0),contact.m_fixtureB.m_body.SetAwake(!0));var type1=parseInt(contact.m_fixtureA.GetType()),type2=parseInt(contact.m_fixtureB.GetType()),reg=this.m_registers[type1][type2];reg.poolCount++,contact.m_next=reg.pool,reg.pool=contact;var destroyFcn=reg.destroyFcn;destroyFcn(contact,this.m_allocator)},b2ContactRegister.b2ContactRegister=function(){},b2ContactResult.b2ContactResult=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactSolver.b2ContactSolver=function(){this.m_step=new b2TimeStep,this.m_constraints=new Vector},b2ContactSolver.prototype.b2ContactSolver=function(){},b2ContactSolver.prototype.Initialize=function(step,contacts,contactCount,allocator){void 0===contactCount&&(contactCount=0);var contact;this.m_step.Set(step),this.m_allocator=allocator;var i=0;for(this.m_constraintCount=contactCount;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(i=0;contactCount>i;++i){contact=contacts[i];var fixtureA=contact.m_fixtureA,fixtureB=contact.m_fixtureB,shapeA=fixtureA.m_shape,shapeB=fixtureB.m_shape,radiusA=shapeA.m_radius,radiusB=shapeB.m_radius,bodyA=fixtureA.m_body,bodyB=fixtureB.m_body,manifold=contact.GetManifold(),friction=b2Settings.b2MixFriction(fixtureA.GetFriction(),fixtureB.GetFriction()),restitution=b2Settings.b2MixRestitution(fixtureA.GetRestitution(),fixtureB.GetRestitution()),vAX=bodyA.m_linearVelocity.x,vAY=bodyA.m_linearVelocity.y,vBX=bodyB.m_linearVelocity.x,vBY=bodyB.m_linearVelocity.y,wA=bodyA.m_angularVelocity,wB=bodyB.m_angularVelocity;b2Settings.b2Assert(manifold.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(manifold,bodyA.m_xf,radiusA,bodyB.m_xf,radiusB);var normalX=b2ContactSolver.s_worldManifold.m_normal.x,normalY=b2ContactSolver.s_worldManifold.m_normal.y,cc=this.m_constraints[i];cc.bodyA=bodyA,cc.bodyB=bodyB,cc.manifold=manifold,cc.normal.x=normalX,cc.normal.y=normalY,cc.pointCount=manifold.m_pointCount,cc.friction=friction,cc.restitution=restitution,cc.localPlaneNormal.x=manifold.m_localPlaneNormal.x,cc.localPlaneNormal.y=manifold.m_localPlaneNormal.y,cc.localPoint.x=manifold.m_localPoint.x,cc.localPoint.y=manifold.m_localPoint.y,cc.radius=radiusA+radiusB,cc.type=manifold.m_type;for(var k=0;k<cc.pointCount;++k){var cp=manifold.m_points[k],ccp=cc.points[k];ccp.normalImpulse=cp.m_normalImpulse,ccp.tangentImpulse=cp.m_tangentImpulse,ccp.localPoint.SetV(cp.m_localPoint);var rAX=ccp.rA.x=b2ContactSolver.s_worldManifold.m_points[k].x-bodyA.m_sweep.c.x,rAY=ccp.rA.y=b2ContactSolver.s_worldManifold.m_points[k].y-bodyA.m_sweep.c.y,rBX=ccp.rB.x=b2ContactSolver.s_worldManifold.m_points[k].x-bodyB.m_sweep.c.x,rBY=ccp.rB.y=b2ContactSolver.s_worldManifold.m_points[k].y-bodyB.m_sweep.c.y,rnA=rAX*normalY-rAY*normalX,rnB=rBX*normalY-rBY*normalX;rnA*=rnA,rnB*=rnB;var kNormal=bodyA.m_invMass+bodyB.m_invMass+bodyA.m_invI*rnA+bodyB.m_invI*rnB;ccp.normalMass=1/kNormal;var kEqualized=bodyA.m_mass*bodyA.m_invMass+bodyB.m_mass*bodyB.m_invMass;kEqualized+=bodyA.m_mass*bodyA.m_invI*rnA+bodyB.m_mass*bodyB.m_invI*rnB,ccp.equalizedMass=1/kEqualized;var tangentX=normalY,tangentY=-normalX,rtA=rAX*tangentY-rAY*tangentX,rtB=rBX*tangentY-rBY*tangentX;rtA*=rtA,rtB*=rtB;var kTangent=bodyA.m_invMass+bodyB.m_invMass+bodyA.m_invI*rtA+bodyB.m_invI*rtB;ccp.tangentMass=1/kTangent,ccp.velocityBias=0;var tX=vBX+-wB*rBY-vAX- -wA*rAY,tY=vBY+wB*rBX-vAY-wA*rAX,vRel=cc.normal.x*tX+cc.normal.y*tY;vRel<-b2Settings.b2_velocityThreshold&&(ccp.velocityBias+=-cc.restitution*vRel)}if(2==cc.pointCount){var ccp1=cc.points[0],ccp2=cc.points[1],invMassA=bodyA.m_invMass,invIA=bodyA.m_invI,invMassB=bodyB.m_invMass,invIB=bodyB.m_invI,rn1A=ccp1.rA.x*normalY-ccp1.rA.y*normalX,rn1B=ccp1.rB.x*normalY-ccp1.rB.y*normalX,rn2A=ccp2.rA.x*normalY-ccp2.rA.y*normalX,rn2B=ccp2.rB.x*normalY-ccp2.rB.y*normalX,k11=invMassA+invMassB+invIA*rn1A*rn1A+invIB*rn1B*rn1B,k22=invMassA+invMassB+invIA*rn2A*rn2A+invIB*rn2B*rn2B,k12=invMassA+invMassB+invIA*rn1A*rn2A+invIB*rn1B*rn2B,k_maxConditionNumber=100;k_maxConditionNumber*(k11*k22-k12*k12)>k11*k11?(cc.K.col1.Set(k11,k12),cc.K.col2.Set(k12,k22),cc.K.GetInverse(cc.normalMass)):cc.pointCount=1}}},b2ContactSolver.prototype.InitVelocityConstraints=function(step){for(var i=0;i<this.m_constraintCount;++i){var c=this.m_constraints[i],bodyA=c.bodyA,bodyB=c.bodyB,invMassA=bodyA.m_invMass,invIA=bodyA.m_invI,invMassB=bodyB.m_invMass,invIB=bodyB.m_invI,normalX=c.normal.x,normalY=c.normal.y,tangentX=normalY,tangentY=-normalX,j=0,tCount=0;if(step.warmStarting)for(tCount=c.pointCount,j=0;tCount>j;++j){var ccp=c.points[j];ccp.normalImpulse*=step.dtRatio,ccp.tangentImpulse*=step.dtRatio;var PX=ccp.normalImpulse*normalX+ccp.tangentImpulse*tangentX,PY=ccp.normalImpulse*normalY+ccp.tangentImpulse*tangentY;bodyA.m_angularVelocity-=invIA*(ccp.rA.x*PY-ccp.rA.y*PX),bodyA.m_linearVelocity.x-=invMassA*PX,bodyA.m_linearVelocity.y-=invMassA*PY,bodyB.m_angularVelocity+=invIB*(ccp.rB.x*PY-ccp.rB.y*PX),bodyB.m_linearVelocity.x+=invMassB*PX,bodyB.m_linearVelocity.y+=invMassB*PY}else for(tCount=c.pointCount,j=0;tCount>j;++j){var ccp2=c.points[j];ccp2.normalImpulse=0,ccp2.tangentImpulse=0}}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var ccp,tMat,j=0,dvX=0,dvY=0,vn=0,vt=0,lambda=0,maxFriction=0,newImpulse=0,PX=0,PY=0,dX=0,dY=0,P1X=0,P1Y=0,P2X=0,P2Y=0,i=0;i<this.m_constraintCount;++i){var c=this.m_constraints[i],bodyA=c.bodyA,bodyB=c.bodyB,wA=bodyA.m_angularVelocity,wB=bodyB.m_angularVelocity,vA=bodyA.m_linearVelocity,vB=bodyB.m_linearVelocity,invMassA=bodyA.m_invMass,invIA=bodyA.m_invI,invMassB=bodyB.m_invMass,invIB=bodyB.m_invI,normalX=c.normal.x,normalY=c.normal.y,tangentX=normalY,tangentY=-normalX,friction=c.friction;for(j=0;j<c.pointCount;j++)ccp=c.points[j],dvX=vB.x-wB*ccp.rB.y-vA.x+wA*ccp.rA.y,dvY=vB.y+wB*ccp.rB.x-vA.y-wA*ccp.rA.x,vt=dvX*tangentX+dvY*tangentY,lambda=ccp.tangentMass*-vt,maxFriction=friction*ccp.normalImpulse,newImpulse=b2Math.Clamp(ccp.tangentImpulse+lambda,-maxFriction,maxFriction),lambda=newImpulse-ccp.tangentImpulse,PX=lambda*tangentX,PY=lambda*tangentY,vA.x-=invMassA*PX,vA.y-=invMassA*PY,wA-=invIA*(ccp.rA.x*PY-ccp.rA.y*PX),vB.x+=invMassB*PX,vB.y+=invMassB*PY,wB+=invIB*(ccp.rB.x*PY-ccp.rB.y*PX),ccp.tangentImpulse=newImpulse;{parseInt(c.pointCount)}if(1==c.pointCount)ccp=c.points[0],dvX=vB.x+-wB*ccp.rB.y-vA.x- -wA*ccp.rA.y,dvY=vB.y+wB*ccp.rB.x-vA.y-wA*ccp.rA.x,vn=dvX*normalX+dvY*normalY,lambda=-ccp.normalMass*(vn-ccp.velocityBias),newImpulse=ccp.normalImpulse+lambda,newImpulse=newImpulse>0?newImpulse:0,lambda=newImpulse-ccp.normalImpulse,PX=lambda*normalX,PY=lambda*normalY,vA.x-=invMassA*PX,vA.y-=invMassA*PY,wA-=invIA*(ccp.rA.x*PY-ccp.rA.y*PX),vB.x+=invMassB*PX,vB.y+=invMassB*PY,wB+=invIB*(ccp.rB.x*PY-ccp.rB.y*PX),ccp.normalImpulse=newImpulse;else{var cp1=c.points[0],cp2=c.points[1],aX=cp1.normalImpulse,aY=cp2.normalImpulse,dv1X=vB.x-wB*cp1.rB.y-vA.x+wA*cp1.rA.y,dv1Y=vB.y+wB*cp1.rB.x-vA.y-wA*cp1.rA.x,dv2X=vB.x-wB*cp2.rB.y-vA.x+wA*cp2.rA.y,dv2Y=vB.y+wB*cp2.rB.x-vA.y-wA*cp2.rA.x,vn1=dv1X*normalX+dv1Y*normalY,vn2=dv2X*normalX+dv2Y*normalY,bX=vn1-cp1.velocityBias,bY=vn2-cp2.velocityBias;tMat=c.K,bX-=tMat.col1.x*aX+tMat.col2.x*aY,bY-=tMat.col1.y*aX+tMat.col2.y*aY;for(;;){tMat=c.normalMass;var xX=-(tMat.col1.x*bX+tMat.col2.x*bY),xY=-(tMat.col1.y*bX+tMat.col2.y*bY);if(xX>=0&&xY>=0){dX=xX-aX,dY=xY-aY,P1X=dX*normalX,P1Y=dX*normalY,P2X=dY*normalX,P2Y=dY*normalY,vA.x-=invMassA*(P1X+P2X),vA.y-=invMassA*(P1Y+P2Y),wA-=invIA*(cp1.rA.x*P1Y-cp1.rA.y*P1X+cp2.rA.x*P2Y-cp2.rA.y*P2X),vB.x+=invMassB*(P1X+P2X),vB.y+=invMassB*(P1Y+P2Y),wB+=invIB*(cp1.rB.x*P1Y-cp1.rB.y*P1X+cp2.rB.x*P2Y-cp2.rB.y*P2X),cp1.normalImpulse=xX,cp2.normalImpulse=xY;break}if(xX=-cp1.normalMass*bX,xY=0,vn1=0,vn2=c.K.col1.y*xX+bY,xX>=0&&vn2>=0){dX=xX-aX,dY=xY-aY,P1X=dX*normalX,P1Y=dX*normalY,P2X=dY*normalX,P2Y=dY*normalY,vA.x-=invMassA*(P1X+P2X),vA.y-=invMassA*(P1Y+P2Y),wA-=invIA*(cp1.rA.x*P1Y-cp1.rA.y*P1X+cp2.rA.x*P2Y-cp2.rA.y*P2X),vB.x+=invMassB*(P1X+P2X),vB.y+=invMassB*(P1Y+P2Y),wB+=invIB*(cp1.rB.x*P1Y-cp1.rB.y*P1X+cp2.rB.x*P2Y-cp2.rB.y*P2X),cp1.normalImpulse=xX,cp2.normalImpulse=xY;break}if(xX=0,xY=-cp2.normalMass*bY,vn1=c.K.col2.x*xY+bX,vn2=0,xY>=0&&vn1>=0){dX=xX-aX,dY=xY-aY,P1X=dX*normalX,P1Y=dX*normalY,P2X=dY*normalX,P2Y=dY*normalY,vA.x-=invMassA*(P1X+P2X),vA.y-=invMassA*(P1Y+P2Y),wA-=invIA*(cp1.rA.x*P1Y-cp1.rA.y*P1X+cp2.rA.x*P2Y-cp2.rA.y*P2X),vB.x+=invMassB*(P1X+P2X),vB.y+=invMassB*(P1Y+P2Y),wB+=invIB*(cp1.rB.x*P1Y-cp1.rB.y*P1X+cp2.rB.x*P2Y-cp2.rB.y*P2X),cp1.normalImpulse=xX,cp2.normalImpulse=xY;break}if(xX=0,xY=0,vn1=bX,vn2=bY,vn1>=0&&vn2>=0){dX=xX-aX,dY=xY-aY,P1X=dX*normalX,P1Y=dX*normalY,P2X=dY*normalX,P2Y=dY*normalY,vA.x-=invMassA*(P1X+P2X),vA.y-=invMassA*(P1Y+P2Y),wA-=invIA*(cp1.rA.x*P1Y-cp1.rA.y*P1X+cp2.rA.x*P2Y-cp2.rA.y*P2X),vB.x+=invMassB*(P1X+P2X),vB.y+=invMassB*(P1Y+P2Y),wB+=invIB*(cp1.rB.x*P1Y-cp1.rB.y*P1X+cp2.rB.x*P2Y-cp2.rB.y*P2X),cp1.normalImpulse=xX,cp2.normalImpulse=xY;break}break}}bodyA.m_angularVelocity=wA,bodyB.m_angularVelocity=wB}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var i=0;i<this.m_constraintCount;++i)for(var c=this.m_constraints[i],m=c.manifold,j=0;j<c.pointCount;++j){var point1=m.m_points[j],point2=c.points[j];point1.m_normalImpulse=point2.normalImpulse,point1.m_tangentImpulse=point2.tangentImpulse}},b2ContactSolver.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);for(var minSeparation=0,i=0;i<this.m_constraintCount;i++){var c=this.m_constraints[i],bodyA=c.bodyA,bodyB=c.bodyB,invMassA=bodyA.m_mass*bodyA.m_invMass,invIA=bodyA.m_mass*bodyA.m_invI,invMassB=bodyB.m_mass*bodyB.m_invMass,invIB=bodyB.m_mass*bodyB.m_invI;b2ContactSolver.s_psm.Initialize(c);for(var normal=b2ContactSolver.s_psm.m_normal,j=0;j<c.pointCount;j++){var ccp=c.points[j],point=b2ContactSolver.s_psm.m_points[j],separation=b2ContactSolver.s_psm.m_separations[j],rAX=point.x-bodyA.m_sweep.c.x,rAY=point.y-bodyA.m_sweep.c.y,rBX=point.x-bodyB.m_sweep.c.x,rBY=point.y-bodyB.m_sweep.c.y;minSeparation=separation>minSeparation?minSeparation:separation;var C=b2Math.Clamp(baumgarte*(separation+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),impulse=-ccp.equalizedMass*C,PX=impulse*normal.x,PY=impulse*normal.y;bodyA.m_sweep.c.x-=invMassA*PX,bodyA.m_sweep.c.y-=invMassA*PY,bodyA.m_sweep.a-=invIA*(rAX*PY-rAY*PX),bodyA.SynchronizeTransform(),bodyB.m_sweep.c.x+=invMassB*PX,bodyB.m_sweep.c.y+=invMassB*PY,bodyB.m_sweep.a+=invIB*(rBX*PY-rBY*PX),bodyB.SynchronizeTransform()}}return minSeparation>-1.5*b2Settings.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new b2PositionSolverManifold}),Box2D.inherit(b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),b2EdgeAndCircleContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2EdgeAndCircleContact.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2EdgeAndCircleContact.Create=function(allocator){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(contact,allocator){},b2EdgeAndCircleContact.prototype.Reset=function(fixtureA,fixtureB){this.__super.Reset.call(this,fixtureA,fixtureB)},b2EdgeAndCircleContact.prototype.Evaluate=function(){var bA=this.m_fixtureA.GetBody(),bB=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof b2EdgeShape?this.m_fixtureA.GetShape():null,bA.m_xf,this.m_fixtureB.GetShape()instanceof b2CircleShape?this.m_fixtureB.GetShape():null,bB.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(manifold,edge,xf1,circle,xf2){},Box2D.inherit(b2NullContact,Box2D.Dynamics.Contacts.b2Contact),b2NullContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2NullContact.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2NullContact.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},b2NullContact.prototype.Evaluate=function(){},Box2D.inherit(b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),b2PolyAndCircleContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2PolyAndCircleContact.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2PolyAndCircleContact.Create=function(allocator){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(contact,allocator){},b2PolyAndCircleContact.prototype.Reset=function(fixtureA,fixtureB){this.__super.Reset.call(this,fixtureA,fixtureB),b2Settings.b2Assert(fixtureA.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(fixtureB.GetType()==b2Shape.e_circleShape)},b2PolyAndCircleContact.prototype.Evaluate=function(){var bA=this.m_fixtureA.m_body,bB=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof b2PolygonShape?this.m_fixtureA.GetShape():null,bA.m_xf,this.m_fixtureB.GetShape()instanceof b2CircleShape?this.m_fixtureB.GetShape():null,bB.m_xf)},Box2D.inherit(b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),b2PolyAndEdgeContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2PolyAndEdgeContact.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2PolyAndEdgeContact.Create=function(allocator){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(contact,allocator){},b2PolyAndEdgeContact.prototype.Reset=function(fixtureA,fixtureB){this.__super.Reset.call(this,fixtureA,fixtureB),b2Settings.b2Assert(fixtureA.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(fixtureB.GetType()==b2Shape.e_edgeShape)},b2PolyAndEdgeContact.prototype.Evaluate=function(){var bA=this.m_fixtureA.GetBody(),bB=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof b2PolygonShape?this.m_fixtureA.GetShape():null,bA.m_xf,this.m_fixtureB.GetShape()instanceof b2EdgeShape?this.m_fixtureB.GetShape():null,bB.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(manifold,polygon,xf1,edge,xf2){},Box2D.inherit(b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),b2PolygonContact.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b2PolygonContact.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b2PolygonContact.Create=function(allocator){return new b2PolygonContact},b2PolygonContact.Destroy=function(contact,allocator){},b2PolygonContact.prototype.Reset=function(fixtureA,fixtureB){this.__super.Reset.call(this,fixtureA,fixtureB)},b2PolygonContact.prototype.Evaluate=function(){var bA=this.m_fixtureA.GetBody(),bB=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof b2PolygonShape?this.m_fixtureA.GetShape():null,bA.m_xf,this.m_fixtureB.GetShape()instanceof b2PolygonShape?this.m_fixtureB.GetShape():null,bB.m_xf)},b2PositionSolverManifold.b2PositionSolverManifold=function(){},b2PositionSolverManifold.prototype.b2PositionSolverManifold=function(){this.m_normal=new b2Vec2,this.m_separations=new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints),this.m_points=new Vector(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++)this.m_points[i]=new b2Vec2},b2PositionSolverManifold.prototype.Initialize=function(cc){b2Settings.b2Assert(cc.pointCount>0);var tMat,tVec,i=0,clipPointX=0,clipPointY=0,planePointX=0,planePointY=0;switch(cc.type){case b2Manifold.e_circles:tMat=cc.bodyA.m_xf.R,tVec=cc.localPoint;var pointAX=cc.bodyA.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointAY=cc.bodyA.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y);tMat=cc.bodyB.m_xf.R,tVec=cc.points[0].localPoint;var pointBX=cc.bodyB.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),pointBY=cc.bodyB.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),dX=pointBX-pointAX,dY=pointBY-pointAY,d2=dX*dX+dY*dY;if(d2>Number.MIN_VALUE*Number.MIN_VALUE){var d=Math.sqrt(d2);this.m_normal.x=dX/d,this.m_normal.y=dY/d}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(pointAX+pointBX),this.m_points[0].y=.5*(pointAY+pointBY),this.m_separations[0]=dX*this.m_normal.x+dY*this.m_normal.y-cc.radius;break;case b2Manifold.e_faceA:for(tMat=cc.bodyA.m_xf.R,tVec=cc.localPlaneNormal,this.m_normal.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,this.m_normal.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=cc.bodyA.m_xf.R,tVec=cc.localPoint,planePointX=cc.bodyA.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),planePointY=cc.bodyA.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tMat=cc.bodyB.m_xf.R,i=0;i<cc.pointCount;++i)tVec=cc.points[i].localPoint,clipPointX=cc.bodyB.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),clipPointY=cc.bodyB.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),this.m_separations[i]=(clipPointX-planePointX)*this.m_normal.x+(clipPointY-planePointY)*this.m_normal.y-cc.radius,this.m_points[i].x=clipPointX,this.m_points[i].y=clipPointY;break;case b2Manifold.e_faceB:for(tMat=cc.bodyB.m_xf.R,tVec=cc.localPlaneNormal,this.m_normal.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,this.m_normal.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=cc.bodyB.m_xf.R,tVec=cc.localPoint,planePointX=cc.bodyB.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),planePointY=cc.bodyB.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),tMat=cc.bodyA.m_xf.R,i=0;i<cc.pointCount;++i)tVec=cc.points[i].localPoint,clipPointX=cc.bodyA.m_xf.position.x+(tMat.col1.x*tVec.x+tMat.col2.x*tVec.y),clipPointY=cc.bodyA.m_xf.position.y+(tMat.col1.y*tVec.x+tMat.col2.y*tVec.y),this.m_separations[i]=(clipPointX-planePointX)*this.m_normal.x+(clipPointY-planePointY)*this.m_normal.y-cc.radius,this.m_points[i].Set(clipPointX,clipPointY);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new b2Vec2,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new b2Vec2})}(),function(){var b2Mat22=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Common.Math.b2Mat22),b2Math=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b2Vec2=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),b2Color=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),b2BuoyancyController=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),b2ConstantAccelController=Box2D.Dynamics.Controllers.b2ConstantAccelController,b2ConstantForceController=Box2D.Dynamics.Controllers.b2ConstantForceController,b2Controller=Box2D.Dynamics.Controllers.b2Controller,b2ControllerEdge=Box2D.Dynamics.Controllers.b2ControllerEdge,b2GravityController=Box2D.Dynamics.Controllers.b2GravityController,b2TensorDampingController=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),b2BuoyancyController.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,b2BuoyancyController.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new b2Vec2(0,-1),this.offset=0,this.density=0,this.velocity=new b2Vec2(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},b2BuoyancyController.prototype.Step=function(step){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(0!=body.IsAwake()){for(var areac=new b2Vec2,massc=new b2Vec2,area=0,mass=0,fixture=body.GetFixtureList();fixture;fixture=fixture.GetNext()){var sc=new b2Vec2,sarea=fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,body.GetTransform(),sc);area+=sarea,areac.x+=sarea*sc.x,areac.y+=sarea*sc.y;var shapeDensity=0;shapeDensity=(this.useDensity,1),mass+=sarea*shapeDensity,massc.x+=sarea*sc.x*shapeDensity,massc.y+=sarea*sc.y*shapeDensity}if(areac.x/=area,areac.y/=area,massc.x/=mass,massc.y/=mass,!(area<Number.MIN_VALUE)){var buoyancyForce=this.gravity.GetNegative();buoyancyForce.Multiply(this.density*area),body.ApplyForce(buoyancyForce,massc);var dragForce=body.GetLinearVelocityFromWorldPoint(areac);dragForce.Subtract(this.velocity),dragForce.Multiply(-this.linearDrag*area),body.ApplyForce(dragForce,areac),body.ApplyTorque(-body.GetInertia()/body.GetMass()*area*body.GetAngularVelocity()*this.angularDrag)}}}}},b2BuoyancyController.prototype.Draw=function(debugDraw){var r=1e3,p1=new b2Vec2,p2=new b2Vec2;p1.x=this.normal.x*this.offset+this.normal.y*r,p1.y=this.normal.y*this.offset-this.normal.x*r,p2.x=this.normal.x*this.offset-this.normal.y*r,p2.y=this.normal.y*this.offset+this.normal.x*r;var color=new b2Color(0,0,1);debugDraw.DrawSegment(p1,p2,color)},Box2D.inherit(b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),b2ConstantAccelController.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,b2ConstantAccelController.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(step){for(var smallA=new b2Vec2(this.A.x*step.dt,this.A.y*step.dt),i=this.m_bodyList;i;i=i.nextBody){var body=i.body;body.IsAwake()&&body.SetLinearVelocity(new b2Vec2(body.GetLinearVelocity().x+smallA.x,body.GetLinearVelocity().y+smallA.y))}},Box2D.inherit(b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),b2ConstantForceController.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,
b2ConstantForceController.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(step){for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;body.IsAwake()&&body.ApplyForce(this.F,body.GetWorldCenter())}},b2Controller.b2Controller=function(){},b2Controller.prototype.Step=function(step){},b2Controller.prototype.Draw=function(debugDraw){},b2Controller.prototype.AddBody=function(body){var edge=new b2ControllerEdge;edge.controller=this,edge.body=body,edge.nextBody=this.m_bodyList,edge.prevBody=null,this.m_bodyList=edge,edge.nextBody&&(edge.nextBody.prevBody=edge),this.m_bodyCount++,edge.nextController=body.m_controllerList,edge.prevController=null,body.m_controllerList=edge,edge.nextController&&(edge.nextController.prevController=edge),body.m_controllerCount++},b2Controller.prototype.RemoveBody=function(body){for(var edge=body.m_controllerList;edge&&edge.controller!=this;)edge=edge.nextController;edge.prevBody&&(edge.prevBody.nextBody=edge.nextBody),edge.nextBody&&(edge.nextBody.prevBody=edge.prevBody),edge.nextController&&(edge.nextController.prevController=edge.prevController),edge.prevController&&(edge.prevController.nextController=edge.nextController),this.m_bodyList==edge&&(this.m_bodyList=edge.nextBody),body.m_controllerList==edge&&(body.m_controllerList=edge.nextController),body.m_controllerCount--,this.m_bodyCount--},b2Controller.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return this.m_bodyList},b2ControllerEdge.b2ControllerEdge=function(){},Box2D.inherit(b2GravityController,Box2D.Dynamics.Controllers.b2Controller),b2GravityController.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,b2GravityController.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},b2GravityController.prototype.Step=function(step){var i=null,body1=null,p1=null,mass1=0,j=null,body2=null,p2=null,dx=0,dy=0,r2=0,f=null;if(this.invSqr)for(i=this.m_bodyList;i;i=i.nextBody)for(body1=i.body,p1=body1.GetWorldCenter(),mass1=body1.GetMass(),j=this.m_bodyList;j!=i;j=j.nextBody)body2=j.body,p2=body2.GetWorldCenter(),dx=p2.x-p1.x,dy=p2.y-p1.y,r2=dx*dx+dy*dy,r2<Number.MIN_VALUE||(f=new b2Vec2(dx,dy),f.Multiply(this.G/r2/Math.sqrt(r2)*mass1*body2.GetMass()),body1.IsAwake()&&body1.ApplyForce(f,p1),f.Multiply(-1),body2.IsAwake()&&body2.ApplyForce(f,p2));else for(i=this.m_bodyList;i;i=i.nextBody)for(body1=i.body,p1=body1.GetWorldCenter(),mass1=body1.GetMass(),j=this.m_bodyList;j!=i;j=j.nextBody)body2=j.body,p2=body2.GetWorldCenter(),dx=p2.x-p1.x,dy=p2.y-p1.y,r2=dx*dx+dy*dy,r2<Number.MIN_VALUE||(f=new b2Vec2(dx,dy),f.Multiply(this.G/r2*mass1*body2.GetMass()),body1.IsAwake()&&body1.ApplyForce(f,p1),f.Multiply(-1),body2.IsAwake()&&body2.ApplyForce(f,p2))},Box2D.inherit(b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),b2TensorDampingController.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,b2TensorDampingController.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new b2Mat22,this.maxTimestep=0},b2TensorDampingController.prototype.SetAxisAligned=function(xDamping,yDamping){void 0===xDamping&&(xDamping=0),void 0===yDamping&&(yDamping=0),this.T.col1.x=-xDamping,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-yDamping,this.maxTimestep=xDamping>0||yDamping>0?1/Math.max(xDamping,yDamping):0},b2TensorDampingController.prototype.Step=function(step){var timestep=step.dt;if(!(timestep<=Number.MIN_VALUE)){timestep>this.maxTimestep&&this.maxTimestep>0&&(timestep=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(body.IsAwake()){var damping=body.GetWorldVector(b2Math.MulMV(this.T,body.GetLocalVector(body.GetLinearVelocity())));body.SetLinearVelocity(new b2Vec2(body.GetLinearVelocity().x+damping.x*timestep,body.GetLinearVelocity().y+damping.y*timestep))}}}}}(),function(){{var b2Settings=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b2Mat22=Box2D.Common.Math.b2Mat22,b2Mat33=Box2D.Common.Math.b2Mat33,b2Math=Box2D.Common.Math.b2Math,b2Vec2=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),b2Vec3=Box2D.Common.Math.b2Vec3,b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,b2FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,b2FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef,b2GearJoint=Box2D.Dynamics.Joints.b2GearJoint,b2GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef,b2Jacobian=Box2D.Dynamics.Joints.b2Jacobian,b2Joint=Box2D.Dynamics.Joints.b2Joint,b2JointDef=Box2D.Dynamics.Joints.b2JointDef,b2JointEdge=Box2D.Dynamics.Joints.b2JointEdge,b2LineJoint=Box2D.Dynamics.Joints.b2LineJoint,b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,b2MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,b2PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,b2RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,b2WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World}Box2D.inherit(b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),b2DistanceJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2DistanceJoint.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse*this.m_u.x,inv_dt*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(length){void 0===length&&(length=0),this.m_length=length},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(hz){void 0===hz&&(hz=0),this.m_frequencyHz=hz},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(ratio){void 0===ratio&&(ratio=0),this.m_dampingRatio=ratio},b2DistanceJoint.prototype.b2DistanceJoint=function(def){this.__super.b2Joint.call(this,def);this.m_localAnchor1.SetV(def.localAnchorA),this.m_localAnchor2.SetV(def.localAnchorB),this.m_length=def.length,this.m_frequencyHz=def.frequencyHz,this.m_dampingRatio=def.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},b2DistanceJoint.prototype.InitVelocityConstraints=function(step){var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX,this.m_u.x=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,this.m_u.y=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y;var length=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);length>b2Settings.b2_linearSlop?this.m_u.Multiply(1/length):this.m_u.SetZero();var cr1u=r1X*this.m_u.y-r1Y*this.m_u.x,cr2u=r2X*this.m_u.y-r2Y*this.m_u.x,invMass=bA.m_invMass+bA.m_invI*cr1u*cr1u+bB.m_invMass+bB.m_invI*cr2u*cr2u;if(this.m_mass=0!=invMass?1/invMass:0,this.m_frequencyHz>0){var C=length-this.m_length,omega=2*Math.PI*this.m_frequencyHz,d=2*this.m_mass*this.m_dampingRatio*omega,k=this.m_mass*omega*omega;this.m_gamma=step.dt*(d+step.dt*k),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=C*step.dt*k*this.m_gamma,this.m_mass=invMass+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(step.warmStarting){this.m_impulse*=step.dtRatio;var PX=this.m_impulse*this.m_u.x,PY=this.m_impulse*this.m_u.y;bA.m_linearVelocity.x-=bA.m_invMass*PX,bA.m_linearVelocity.y-=bA.m_invMass*PY,bA.m_angularVelocity-=bA.m_invI*(r1X*PY-r1Y*PX),bB.m_linearVelocity.x+=bB.m_invMass*PX,bB.m_linearVelocity.y+=bB.m_invMass*PY,bB.m_angularVelocity+=bB.m_invI*(r2X*PY-r2Y*PX)}else this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var v1X=bA.m_linearVelocity.x+-bA.m_angularVelocity*r1Y,v1Y=bA.m_linearVelocity.y+bA.m_angularVelocity*r1X,v2X=bB.m_linearVelocity.x+-bB.m_angularVelocity*r2Y,v2Y=bB.m_linearVelocity.y+bB.m_angularVelocity*r2X,Cdot=this.m_u.x*(v2X-v1X)+this.m_u.y*(v2Y-v1Y),impulse=-this.m_mass*(Cdot+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=impulse;var PX=impulse*this.m_u.x,PY=impulse*this.m_u.y;bA.m_linearVelocity.x-=bA.m_invMass*PX,bA.m_linearVelocity.y-=bA.m_invMass*PY,bA.m_angularVelocity-=bA.m_invI*(r1X*PY-r1Y*PX),bB.m_linearVelocity.x+=bB.m_invMass*PX,bB.m_linearVelocity.y+=bB.m_invMass*PY,bB.m_angularVelocity+=bB.m_invI*(r2X*PY-r2Y*PX)},b2DistanceJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat;if(this.m_frequencyHz>0)return!0;var bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var dX=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,dY=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y,length=Math.sqrt(dX*dX+dY*dY);dX/=length,dY/=length;var C=length-this.m_length;C=b2Math.Clamp(C,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var impulse=-this.m_mass*C;this.m_u.Set(dX,dY);var PX=impulse*this.m_u.x,PY=impulse*this.m_u.y;return bA.m_sweep.c.x-=bA.m_invMass*PX,bA.m_sweep.c.y-=bA.m_invMass*PY,bA.m_sweep.a-=bA.m_invI*(r1X*PY-r1Y*PX),bB.m_sweep.c.x+=bB.m_invMass*PX,bB.m_sweep.c.y+=bB.m_invMass*PY,bB.m_sweep.a+=bB.m_invI*(r2X*PY-r2Y*PX),bA.SynchronizeTransform(),bB.SynchronizeTransform(),b2Math.Abs(C)<b2Settings.b2_linearSlop},Box2D.inherit(b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),b2DistanceJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2DistanceJointDef.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},b2DistanceJointDef.prototype.Initialize=function(bA,bB,anchorA,anchorB){this.bodyA=bA,this.bodyB=bB,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchorA)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchorB));var dX=anchorB.x-anchorA.x,dY=anchorB.y-anchorA.y;this.length=Math.sqrt(dX*dX+dY*dY),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),b2FrictionJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2FrictionJoint.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearMass=new b2Mat22,this.m_linearImpulse=new b2Vec2},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_linearImpulse.x,inv_dt*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),inv_dt*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(force){void 0===force&&(force=0),this.m_maxForce=force},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(torque){void 0===torque&&(torque=0),this.m_maxTorque=torque},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.b2FrictionJoint=function(def){this.__super.b2Joint.call(this,def),this.m_localAnchorA.SetV(def.localAnchorA),this.m_localAnchorB.SetV(def.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=def.maxForce,this.m_maxTorque=def.maxTorque},b2FrictionJoint.prototype.InitVelocityConstraints=function(step){var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var rAX=this.m_localAnchorA.x-bA.m_sweep.localCenter.x,rAY=this.m_localAnchorA.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*rAX+tMat.col2.x*rAY,rAY=tMat.col1.y*rAX+tMat.col2.y*rAY,rAX=tX,tMat=bB.m_xf.R;var rBX=this.m_localAnchorB.x-bB.m_sweep.localCenter.x,rBY=this.m_localAnchorB.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*rBX+tMat.col2.x*rBY,rBY=tMat.col1.y*rBX+tMat.col2.y*rBY,rBX=tX;var mA=bA.m_invMass,mB=bB.m_invMass,iA=bA.m_invI,iB=bB.m_invI,K=new b2Mat22;if(K.col1.x=mA+mB,K.col2.x=0,K.col1.y=0,K.col2.y=mA+mB,K.col1.x+=iA*rAY*rAY,K.col2.x+=-iA*rAX*rAY,K.col1.y+=-iA*rAX*rAY,K.col2.y+=iA*rAX*rAX,K.col1.x+=iB*rBY*rBY,K.col2.x+=-iB*rBX*rBY,K.col1.y+=-iB*rBX*rBY,K.col2.y+=iB*rBX*rBX,K.GetInverse(this.m_linearMass),this.m_angularMass=iA+iB,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),step.warmStarting){this.m_linearImpulse.x*=step.dtRatio,this.m_linearImpulse.y*=step.dtRatio,this.m_angularImpulse*=step.dtRatio;var P=this.m_linearImpulse;bA.m_linearVelocity.x-=mA*P.x,bA.m_linearVelocity.y-=mA*P.y,bA.m_angularVelocity-=iA*(rAX*P.y-rAY*P.x+this.m_angularImpulse),bB.m_linearVelocity.x+=mB*P.x,bB.m_linearVelocity.y+=mB*P.y,bB.m_angularVelocity+=iB*(rBX*P.y-rBY*P.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},b2FrictionJoint.prototype.SolveVelocityConstraints=function(step){var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB,vA=bA.m_linearVelocity,wA=bA.m_angularVelocity,vB=bB.m_linearVelocity,wB=bB.m_angularVelocity,mA=bA.m_invMass,mB=bB.m_invMass,iA=bA.m_invI,iB=bB.m_invI;tMat=bA.m_xf.R;var rAX=this.m_localAnchorA.x-bA.m_sweep.localCenter.x,rAY=this.m_localAnchorA.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*rAX+tMat.col2.x*rAY,rAY=tMat.col1.y*rAX+tMat.col2.y*rAY,rAX=tX,tMat=bB.m_xf.R;var rBX=this.m_localAnchorB.x-bB.m_sweep.localCenter.x,rBY=this.m_localAnchorB.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*rBX+tMat.col2.x*rBY,rBY=tMat.col1.y*rBX+tMat.col2.y*rBY,rBX=tX;var maxImpulse=0,Cdot=wB-wA,impulse=-this.m_angularMass*Cdot,oldImpulse=this.m_angularImpulse;maxImpulse=step.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+impulse,-maxImpulse,maxImpulse),impulse=this.m_angularImpulse-oldImpulse,wA-=iA*impulse,wB+=iB*impulse;var CdotX=vB.x-wB*rBY-vA.x+wA*rAY,CdotY=vB.y+wB*rBX-vA.y-wA*rAX,impulseV=b2Math.MulMV(this.m_linearMass,new b2Vec2(-CdotX,-CdotY)),oldImpulseV=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(impulseV),maxImpulse=step.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>maxImpulse*maxImpulse&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(maxImpulse)),impulseV=b2Math.SubtractVV(this.m_linearImpulse,oldImpulseV),vA.x-=mA*impulseV.x,vA.y-=mA*impulseV.y,wA-=iA*(rAX*impulseV.y-rAY*impulseV.x),vB.x+=mB*impulseV.x,vB.y+=mB*impulseV.y,wB+=iB*(rBX*impulseV.y-rBY*impulseV.x),bA.m_angularVelocity=wA,bB.m_angularVelocity=wB},b2FrictionJoint.prototype.SolvePositionConstraints=function(baumgarte){return void 0===baumgarte&&(baumgarte=0),!0},Box2D.inherit(b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),b2FrictionJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2FrictionJointDef.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},b2FrictionJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA,this.bodyB=bB,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchor)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchor))},Box2D.inherit(b2GearJoint,Box2D.Dynamics.Joints.b2Joint),b2GearJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2GearJoint.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse*this.m_J.linearB.x,inv_dt*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(inv_dt){void 0===inv_dt&&(inv_dt=0);var tMat=this.m_bodyB.m_xf.R,rX=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,rY=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,tX=tMat.col1.x*rX+tMat.col2.x*rY;rY=tMat.col1.y*rX+tMat.col2.y*rY,rX=tX;var PX=this.m_impulse*this.m_J.linearB.x,PY=this.m_impulse*this.m_J.linearB.y;return inv_dt*(this.m_impulse*this.m_J.angularB-rX*PY+rY*PX)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(ratio){void 0===ratio&&(ratio=0),this.m_ratio=ratio},b2GearJoint.prototype.b2GearJoint=function(def){this.__super.b2Joint.call(this,def);var type1=parseInt(def.joint1.m_type),type2=parseInt(def.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var coordinate1=0,coordinate2=0;this.m_ground1=def.joint1.GetBodyA(),this.m_bodyA=def.joint1.GetBodyB(),type1==b2Joint.e_revoluteJoint?(this.m_revolute1=def.joint1 instanceof b2RevoluteJoint?def.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),coordinate1=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=def.joint1 instanceof b2PrismaticJoint?def.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),coordinate1=this.m_prismatic1.GetJointTranslation()),this.m_ground2=def.joint2.GetBodyA(),this.m_bodyB=def.joint2.GetBodyB(),type2==b2Joint.e_revoluteJoint?(this.m_revolute2=def.joint2 instanceof b2RevoluteJoint?def.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),coordinate2=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=def.joint2 instanceof b2PrismaticJoint?def.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),coordinate2=this.m_prismatic2.GetJointTranslation()),this.m_ratio=def.ratio,this.m_constant=coordinate1+this.m_ratio*coordinate2,this.m_impulse=0},b2GearJoint.prototype.InitVelocityConstraints=function(step){var tMat,tVec,g1=this.m_ground1,g2=this.m_ground2,bA=this.m_bodyA,bB=this.m_bodyB,ugX=0,ugY=0,rX=0,rY=0,crug=0,tX=0,K=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,K+=bA.m_invI):(tMat=g1.m_xf.R,tVec=this.m_prismatic1.m_localXAxis1,ugX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,ugY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=bA.m_xf.R,rX=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,rY=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*rX+tMat.col2.x*rY,rY=tMat.col1.y*rX+tMat.col2.y*rY,rX=tX,crug=rX*ugY-rY*ugX,this.m_J.linearA.Set(-ugX,-ugY),this.m_J.angularA=-crug,K+=bA.m_invMass+bA.m_invI*crug*crug),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,K+=this.m_ratio*this.m_ratio*bB.m_invI):(tMat=g2.m_xf.R,tVec=this.m_prismatic2.m_localXAxis1,ugX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y,ugY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y,tMat=bB.m_xf.R,rX=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,rY=this.m_localAnchor2.y-bB.m_sweep.localCenter.y,tX=tMat.col1.x*rX+tMat.col2.x*rY,rY=tMat.col1.y*rX+tMat.col2.y*rY,rX=tX,crug=rX*ugY-rY*ugX,this.m_J.linearB.Set(-this.m_ratio*ugX,-this.m_ratio*ugY),this.m_J.angularB=-this.m_ratio*crug,K+=this.m_ratio*this.m_ratio*(bB.m_invMass+bB.m_invI*crug*crug)),this.m_mass=K>0?1/K:0,step.warmStarting?(bA.m_linearVelocity.x+=bA.m_invMass*this.m_impulse*this.m_J.linearA.x,bA.m_linearVelocity.y+=bA.m_invMass*this.m_impulse*this.m_J.linearA.y,bA.m_angularVelocity+=bA.m_invI*this.m_impulse*this.m_J.angularA,bB.m_linearVelocity.x+=bB.m_invMass*this.m_impulse*this.m_J.linearB.x,bB.m_linearVelocity.y+=bB.m_invMass*this.m_impulse*this.m_J.linearB.y,bB.m_angularVelocity+=bB.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(step){var bA=this.m_bodyA,bB=this.m_bodyB,Cdot=this.m_J.Compute(bA.m_linearVelocity,bA.m_angularVelocity,bB.m_linearVelocity,bB.m_angularVelocity),impulse=-this.m_mass*Cdot;this.m_impulse+=impulse,bA.m_linearVelocity.x+=bA.m_invMass*impulse*this.m_J.linearA.x,bA.m_linearVelocity.y+=bA.m_invMass*impulse*this.m_J.linearA.y,bA.m_angularVelocity+=bA.m_invI*impulse*this.m_J.angularA,bB.m_linearVelocity.x+=bB.m_invMass*impulse*this.m_J.linearB.x,bB.m_linearVelocity.y+=bB.m_invMass*impulse*this.m_J.linearB.y,bB.m_angularVelocity+=bB.m_invI*impulse*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var linearError=0,bA=this.m_bodyA,bB=this.m_bodyB,coordinate1=0,coordinate2=0;coordinate1=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),coordinate2=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var C=this.m_constant-(coordinate1+this.m_ratio*coordinate2),impulse=-this.m_mass*C;return bA.m_sweep.c.x+=bA.m_invMass*impulse*this.m_J.linearA.x,bA.m_sweep.c.y+=bA.m_invMass*impulse*this.m_J.linearA.y,bA.m_sweep.a+=bA.m_invI*impulse*this.m_J.angularA,bB.m_sweep.c.x+=bB.m_invMass*impulse*this.m_J.linearB.x,bB.m_sweep.c.y+=bB.m_invMass*impulse*this.m_J.linearB.y,bB.m_sweep.a+=bB.m_invI*impulse*this.m_J.angularB,bA.SynchronizeTransform(),bB.SynchronizeTransform(),linearError<b2Settings.b2_linearSlop},Box2D.inherit(b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),b2GearJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2GearJointDef.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},b2GearJointDef.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},b2Jacobian.b2Jacobian=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(x1,a1,x2,a2){void 0===a1&&(a1=0),void 0===a2&&(a2=0),this.linearA.SetV(x1),this.angularA=a1,this.linearB.SetV(x2),this.angularB=a2},b2Jacobian.prototype.Compute=function(x1,a1,x2,a2){return void 0===a1&&(a1=0),void 0===a2&&(a2=0),this.linearA.x*x1.x+this.linearA.y*x1.y+this.angularA*a1+(this.linearB.x*x2.x+this.linearB.y*x2.y)+this.angularB*a2},b2Joint.b2Joint=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),null},b2Joint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(data){this.m_userData=data},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.Create=function(def,allocator){var joint=null;switch(def.type){case b2Joint.e_distanceJoint:joint=new b2DistanceJoint(def instanceof b2DistanceJointDef?def:null);break;case b2Joint.e_mouseJoint:joint=new b2MouseJoint(def instanceof b2MouseJointDef?def:null);break;case b2Joint.e_prismaticJoint:joint=new b2PrismaticJoint(def instanceof b2PrismaticJointDef?def:null);break;case b2Joint.e_revoluteJoint:joint=new b2RevoluteJoint(def instanceof b2RevoluteJointDef?def:null);break;case b2Joint.e_pulleyJoint:joint=new b2PulleyJoint(def instanceof b2PulleyJointDef?def:null);break;case b2Joint.e_gearJoint:joint=new b2GearJoint(def instanceof b2GearJointDef?def:null);break;case b2Joint.e_lineJoint:joint=new b2LineJoint(def instanceof b2LineJointDef?def:null);break;case b2Joint.e_weldJoint:joint=new b2WeldJoint(def instanceof b2WeldJointDef?def:null);break;case b2Joint.e_frictionJoint:joint=new b2FrictionJoint(def instanceof b2FrictionJointDef?def:null)}return joint},b2Joint.Destroy=function(joint,allocator){},b2Joint.prototype.b2Joint=function(def){b2Settings.b2Assert(def.bodyA!=def.bodyB),this.m_type=def.type,this.m_prev=null,this.m_next=null,this.m_bodyA=def.bodyA,this.m_bodyB=def.bodyB,this.m_collideConnected=def.collideConnected,this.m_islandFlag=!1,this.m_userData=def.userData},b2Joint.prototype.InitVelocityConstraints=function(step){},b2Joint.prototype.SolveVelocityConstraints=function(step){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(baumgarte){return void 0===baumgarte&&(baumgarte=0),!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),b2JointDef.b2JointDef=function(){},b2JointDef.prototype.b2JointDef=function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},b2JointEdge.b2JointEdge=function(){},Box2D.inherit(b2LineJoint,Box2D.Dynamics.Joints.b2Joint),b2LineJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2LineJoint.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),inv_dt*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),inv_dt*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var bA=this.m_bodyA,bB=this.m_bodyB,p1=bA.GetWorldPoint(this.m_localAnchor1),p2=bB.GetWorldPoint(this.m_localAnchor2),dX=p2.x-p1.x,dY=p2.y-p1.y,axis=bA.GetWorldVector(this.m_localXAxis1),translation=axis.x*dX+axis.y*dY;return translation},b2LineJoint.prototype.GetJointSpeed=function(){var tMat,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var p1X=bA.m_sweep.c.x+r1X,p1Y=bA.m_sweep.c.y+r1Y,p2X=bB.m_sweep.c.x+r2X,p2Y=bB.m_sweep.c.y+r2Y,dX=p2X-p1X,dY=p2Y-p1Y,axis=bA.GetWorldVector(this.m_localXAxis1),v1=bA.m_linearVelocity,v2=bB.m_linearVelocity,w1=bA.m_angularVelocity,w2=bB.m_angularVelocity,speed=dX*-w1*axis.y+dY*w1*axis.x+(axis.x*(v2.x+-w2*r2Y-v1.x- -w1*r1Y)+axis.y*(v2.y+w2*r2X-v1.y-w1*r1X));return speed},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(flag){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=flag},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(lower,upper){void 0===lower&&(lower=0),void 0===upper&&(upper=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=lower,this.m_upperTranslation=upper},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(flag){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=flag},b2LineJoint.prototype.SetMotorSpeed=function(speed){void 0===speed&&(speed=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=speed},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(force){void 0===force&&(force=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=force},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce;

},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.b2LineJoint=function(def){this.__super.b2Joint.call(this,def);this.m_localAnchor1.SetV(def.localAnchorA),this.m_localAnchor2.SetV(def.localAnchorB),this.m_localXAxis1.SetV(def.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=def.lowerTranslation,this.m_upperTranslation=def.upperTranslation,this.m_maxMotorForce=def.maxMotorForce,this.m_motorSpeed=def.motorSpeed,this.m_enableLimit=def.enableLimit,this.m_enableMotor=def.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.InitVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB,tX=0;this.m_localCenterA.SetV(bA.GetLocalCenter()),this.m_localCenterB.SetV(bB.GetLocalCenter());{var xf1=bA.GetTransform();bB.GetTransform()}tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-this.m_localCenterA.x,r1Y=this.m_localAnchor1.y-this.m_localCenterA.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-this.m_localCenterB.x,r2Y=this.m_localAnchor2.y-this.m_localCenterB.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var dX=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,dY=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y;this.m_invMassA=bA.m_invMass,this.m_invMassB=bB.m_invMass,this.m_invIA=bA.m_invI,this.m_invIB=bB.m_invI,this.m_axis.SetV(b2Math.MulMV(xf1.R,this.m_localXAxis1)),this.m_a1=(dX+r1X)*this.m_axis.y-(dY+r1Y)*this.m_axis.x,this.m_a2=r2X*this.m_axis.y-r2Y*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(xf1.R,this.m_localYAxis1)),this.m_s1=(dX+r1X)*this.m_perp.y-(dY+r1Y)*this.m_perp.x,this.m_s2=r2X*this.m_perp.y-r2Y*this.m_perp.x;var m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB;if(this.m_K.col1.x=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,this.m_K.col1.y=i1*this.m_s1*this.m_a1+i2*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m1+m2+i1*this.m_a1*this.m_a1+i2*this.m_a2*this.m_a2,this.m_enableLimit){var jointTransition=this.m_axis.x*dX+this.m_axis.y*dY;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:jointTransition<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.y=0):jointTransition>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),step.warmStarting){this.m_impulse.x*=step.dtRatio,this.m_impulse.y*=step.dtRatio,this.m_motorImpulse*=step.dtRatio;var PX=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,PY=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,L1=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,L2=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;bA.m_linearVelocity.x-=this.m_invMassA*PX,bA.m_linearVelocity.y-=this.m_invMassA*PY,bA.m_angularVelocity-=this.m_invIA*L1,bB.m_linearVelocity.x+=this.m_invMassB*PX,bB.m_linearVelocity.y+=this.m_invMassB*PY,bB.m_angularVelocity+=this.m_invIB*L2}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2LineJoint.prototype.SolveVelocityConstraints=function(step){var bA=this.m_bodyA,bB=this.m_bodyB,v1=bA.m_linearVelocity,w1=bA.m_angularVelocity,v2=bB.m_linearVelocity,w2=bB.m_angularVelocity,PX=0,PY=0,L1=0,L2=0;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var Cdot=this.m_axis.x*(v2.x-v1.x)+this.m_axis.y*(v2.y-v1.y)+this.m_a2*w2-this.m_a1*w1,impulse=this.m_motorMass*(this.m_motorSpeed-Cdot),oldImpulse=this.m_motorImpulse,maxImpulse=step.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+impulse,-maxImpulse,maxImpulse),impulse=this.m_motorImpulse-oldImpulse,PX=impulse*this.m_axis.x,PY=impulse*this.m_axis.y,L1=impulse*this.m_a1,L2=impulse*this.m_a2,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}var Cdot1=this.m_perp.x*(v2.x-v1.x)+this.m_perp.y*(v2.y-v1.y)+this.m_s2*w2-this.m_s1*w1;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var Cdot2=this.m_axis.x*(v2.x-v1.x)+this.m_axis.y*(v2.y-v1.y)+this.m_a2*w2-this.m_a1*w1,f1=this.m_impulse.Copy(),df=this.m_K.Solve(new b2Vec2,-Cdot1,-Cdot2);this.m_impulse.Add(df),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0));var b=-Cdot1-(this.m_impulse.y-f1.y)*this.m_K.col2.x,f2r=0;f2r=0!=this.m_K.col1.x?b/this.m_K.col1.x+f1.x:f1.x,this.m_impulse.x=f2r,df.x=this.m_impulse.x-f1.x,df.y=this.m_impulse.y-f1.y,PX=df.x*this.m_perp.x+df.y*this.m_axis.x,PY=df.x*this.m_perp.y+df.y*this.m_axis.y,L1=df.x*this.m_s1+df.y*this.m_a1,L2=df.x*this.m_s2+df.y*this.m_a2,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}else{var df2=0;df2=0!=this.m_K.col1.x?-Cdot1/this.m_K.col1.x:0,this.m_impulse.x+=df2,PX=df2*this.m_perp.x,PY=df2*this.m_perp.y,L1=df2*this.m_s1,L2=df2*this.m_s2,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}bA.m_linearVelocity.SetV(v1),bA.m_angularVelocity=w1,bB.m_linearVelocity.SetV(v2),bB.m_angularVelocity=w2},b2LineJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat,bA=this.m_bodyA,bB=this.m_bodyB,c1=bA.m_sweep.c,a1=bA.m_sweep.a,c2=bB.m_sweep.c,a2=bB.m_sweep.a,tX=0,m1=0,m2=0,i1=0,i2=0,linearError=0,angularError=0,active=!1,C2=0,R1=b2Mat22.FromAngle(a1),R2=b2Mat22.FromAngle(a2);tMat=R1;var r1X=this.m_localAnchor1.x-this.m_localCenterA.x,r1Y=this.m_localAnchor1.y-this.m_localCenterA.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=R2;var r2X=this.m_localAnchor2.x-this.m_localCenterB.x,r2Y=this.m_localAnchor2.y-this.m_localCenterB.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var dX=c2.x+r2X-c1.x-r1X,dY=c2.y+r2Y-c1.y-r1Y;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(R1,this.m_localXAxis1),this.m_a1=(dX+r1X)*this.m_axis.y-(dY+r1Y)*this.m_axis.x,this.m_a2=r2X*this.m_axis.y-r2Y*this.m_axis.x;var translation=this.m_axis.x*dX+this.m_axis.y*dY;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(C2=b2Math.Clamp(translation,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),linearError=b2Math.Abs(translation),active=!0):translation<=this.m_lowerTranslation?(C2=b2Math.Clamp(translation-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),linearError=this.m_lowerTranslation-translation,active=!0):translation>=this.m_upperTranslation&&(C2=b2Math.Clamp(translation-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),linearError=translation-this.m_upperTranslation,active=!0)}this.m_perp=b2Math.MulMV(R1,this.m_localYAxis1),this.m_s1=(dX+r1X)*this.m_perp.y-(dY+r1Y)*this.m_perp.x,this.m_s2=r2X*this.m_perp.y-r2Y*this.m_perp.x;var impulse=new b2Vec2,C1=this.m_perp.x*dX+this.m_perp.y*dY;if(linearError=b2Math.Max(linearError,b2Math.Abs(C1)),angularError=0,active)m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB,this.m_K.col1.x=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,this.m_K.col1.y=i1*this.m_s1*this.m_a1+i2*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m1+m2+i1*this.m_a1*this.m_a1+i2*this.m_a2*this.m_a2,this.m_K.Solve(impulse,-C1,-C2);else{m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB;var k11=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,impulse1=0;impulse1=0!=k11?-C1/k11:0,impulse.x=impulse1,impulse.y=0}var PX=impulse.x*this.m_perp.x+impulse.y*this.m_axis.x,PY=impulse.x*this.m_perp.y+impulse.y*this.m_axis.y,L1=impulse.x*this.m_s1+impulse.y*this.m_a1,L2=impulse.x*this.m_s2+impulse.y*this.m_a2;return c1.x-=this.m_invMassA*PX,c1.y-=this.m_invMassA*PY,a1-=this.m_invIA*L1,c2.x+=this.m_invMassB*PX,c2.y+=this.m_invMassB*PY,a2+=this.m_invIB*L2,bA.m_sweep.a=a1,bB.m_sweep.a=a2,bA.SynchronizeTransform(),bB.SynchronizeTransform(),linearError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop},Box2D.inherit(b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),b2LineJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2LineJointDef.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2LineJointDef.prototype.Initialize=function(bA,bB,anchor,axis){this.bodyA=bA,this.bodyB=bB,this.localAnchorA=this.bodyA.GetLocalPoint(anchor),this.localAnchorB=this.bodyB.GetLocalPoint(anchor),this.localAxisA=this.bodyA.GetLocalVector(axis)},Box2D.inherit(b2MouseJoint,Box2D.Dynamics.Joints.b2Joint),b2MouseJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2MouseJoint.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse.x,inv_dt*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(target){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=target},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(maxForce){void 0===maxForce&&(maxForce=0),this.m_maxForce=maxForce},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(hz){void 0===hz&&(hz=0),this.m_frequencyHz=hz},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(ratio){void 0===ratio&&(ratio=0),this.m_dampingRatio=ratio},b2MouseJoint.prototype.b2MouseJoint=function(def){this.__super.b2Joint.call(this,def),this.m_target.SetV(def.target);var tX=this.m_target.x-this.m_bodyB.m_xf.position.x,tY=this.m_target.y-this.m_bodyB.m_xf.position.y,tMat=this.m_bodyB.m_xf.R;this.m_localAnchor.x=tX*tMat.col1.x+tY*tMat.col1.y,this.m_localAnchor.y=tX*tMat.col2.x+tY*tMat.col2.y,this.m_maxForce=def.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=def.frequencyHz,this.m_dampingRatio=def.dampingRatio,this.m_beta=0,this.m_gamma=0},b2MouseJoint.prototype.InitVelocityConstraints=function(step){var b=this.m_bodyB,mass=b.GetMass(),omega=2*Math.PI*this.m_frequencyHz,d=2*mass*this.m_dampingRatio*omega,k=mass*omega*omega;this.m_gamma=step.dt*(d+step.dt*k),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=step.dt*k*this.m_gamma;var tMat;tMat=b.m_xf.R;var rX=this.m_localAnchor.x-b.m_sweep.localCenter.x,rY=this.m_localAnchor.y-b.m_sweep.localCenter.y,tX=tMat.col1.x*rX+tMat.col2.x*rY;rY=tMat.col1.y*rX+tMat.col2.y*rY,rX=tX;var invMass=b.m_invMass,invI=b.m_invI;this.K1.col1.x=invMass,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=invMass,this.K2.col1.x=invI*rY*rY,this.K2.col2.x=-invI*rX*rY,this.K2.col1.y=-invI*rX*rY,this.K2.col2.y=invI*rX*rX,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+rX-this.m_target.x,this.m_C.y=b.m_sweep.c.y+rY-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=step.dtRatio,this.m_impulse.y*=step.dtRatio,b.m_linearVelocity.x+=invMass*this.m_impulse.x,b.m_linearVelocity.y+=invMass*this.m_impulse.y,b.m_angularVelocity+=invI*(rX*this.m_impulse.y-rY*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(step){var tMat,b=this.m_bodyB,tX=0,tY=0;tMat=b.m_xf.R;var rX=this.m_localAnchor.x-b.m_sweep.localCenter.x,rY=this.m_localAnchor.y-b.m_sweep.localCenter.y;tX=tMat.col1.x*rX+tMat.col2.x*rY,rY=tMat.col1.y*rX+tMat.col2.y*rY,rX=tX;var CdotX=b.m_linearVelocity.x+-b.m_angularVelocity*rY,CdotY=b.m_linearVelocity.y+b.m_angularVelocity*rX;tMat=this.m_mass,tX=CdotX+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,tY=CdotY+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var impulseX=-(tMat.col1.x*tX+tMat.col2.x*tY),impulseY=-(tMat.col1.y*tX+tMat.col2.y*tY),oldImpulseX=this.m_impulse.x,oldImpulseY=this.m_impulse.y;this.m_impulse.x+=impulseX,this.m_impulse.y+=impulseY;var maxImpulse=step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>maxImpulse*maxImpulse&&this.m_impulse.Multiply(maxImpulse/this.m_impulse.Length()),impulseX=this.m_impulse.x-oldImpulseX,impulseY=this.m_impulse.y-oldImpulseY,b.m_linearVelocity.x+=b.m_invMass*impulseX,b.m_linearVelocity.y+=b.m_invMass*impulseY,b.m_angularVelocity+=b.m_invI*(rX*impulseY-rY*impulseX)},b2MouseJoint.prototype.SolvePositionConstraints=function(baumgarte){return void 0===baumgarte&&(baumgarte=0),!0},Box2D.inherit(b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef),b2MouseJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2MouseJointDef.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new b2Vec2},b2MouseJointDef.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),b2PrismaticJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2PrismaticJoint.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),inv_dt*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),inv_dt*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var bA=this.m_bodyA,bB=this.m_bodyB,p1=bA.GetWorldPoint(this.m_localAnchor1),p2=bB.GetWorldPoint(this.m_localAnchor2),dX=p2.x-p1.x,dY=p2.y-p1.y,axis=bA.GetWorldVector(this.m_localXAxis1),translation=axis.x*dX+axis.y*dY;return translation},b2PrismaticJoint.prototype.GetJointSpeed=function(){var tMat,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var p1X=bA.m_sweep.c.x+r1X,p1Y=bA.m_sweep.c.y+r1Y,p2X=bB.m_sweep.c.x+r2X,p2Y=bB.m_sweep.c.y+r2Y,dX=p2X-p1X,dY=p2Y-p1Y,axis=bA.GetWorldVector(this.m_localXAxis1),v1=bA.m_linearVelocity,v2=bB.m_linearVelocity,w1=bA.m_angularVelocity,w2=bB.m_angularVelocity,speed=dX*-w1*axis.y+dY*w1*axis.x+(axis.x*(v2.x+-w2*r2Y-v1.x- -w1*r1Y)+axis.y*(v2.y+w2*r2X-v1.y-w1*r1X));return speed},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(flag){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=flag},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(lower,upper){void 0===lower&&(lower=0),void 0===upper&&(upper=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=lower,this.m_upperTranslation=upper},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(flag){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=flag},b2PrismaticJoint.prototype.SetMotorSpeed=function(speed){void 0===speed&&(speed=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=speed},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(force){void 0===force&&(force=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=force},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.b2PrismaticJoint=function(def){this.__super.b2Joint.call(this,def);this.m_localAnchor1.SetV(def.localAnchorA),this.m_localAnchor2.SetV(def.localAnchorB),this.m_localXAxis1.SetV(def.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=def.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=def.lowerTranslation,this.m_upperTranslation=def.upperTranslation,this.m_maxMotorForce=def.maxMotorForce,this.m_motorSpeed=def.motorSpeed,this.m_enableLimit=def.enableLimit,this.m_enableMotor=def.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.InitVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB,tX=0;this.m_localCenterA.SetV(bA.GetLocalCenter()),this.m_localCenterB.SetV(bB.GetLocalCenter());{var xf1=bA.GetTransform();bB.GetTransform()}tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-this.m_localCenterA.x,r1Y=this.m_localAnchor1.y-this.m_localCenterA.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-this.m_localCenterB.x,r2Y=this.m_localAnchor2.y-this.m_localCenterB.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var dX=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,dY=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y;this.m_invMassA=bA.m_invMass,this.m_invMassB=bB.m_invMass,this.m_invIA=bA.m_invI,this.m_invIB=bB.m_invI,this.m_axis.SetV(b2Math.MulMV(xf1.R,this.m_localXAxis1)),this.m_a1=(dX+r1X)*this.m_axis.y-(dY+r1Y)*this.m_axis.x,this.m_a2=r2X*this.m_axis.y-r2Y*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(xf1.R,this.m_localYAxis1)),this.m_s1=(dX+r1X)*this.m_perp.y-(dY+r1Y)*this.m_perp.x,this.m_s2=r2X*this.m_perp.y-r2Y*this.m_perp.x;var m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB;if(this.m_K.col1.x=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,this.m_K.col1.y=i1*this.m_s1+i2*this.m_s2,this.m_K.col1.z=i1*this.m_s1*this.m_a1+i2*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=i1+i2,this.m_K.col2.z=i1*this.m_a1+i2*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m1+m2+i1*this.m_a1*this.m_a1+i2*this.m_a2*this.m_a2,this.m_enableLimit){var jointTransition=this.m_axis.x*dX+this.m_axis.y*dY;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:jointTransition<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):jointTransition>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),step.warmStarting){this.m_impulse.x*=step.dtRatio,this.m_impulse.y*=step.dtRatio,this.m_motorImpulse*=step.dtRatio;var PX=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,PY=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,L1=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,L2=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;bA.m_linearVelocity.x-=this.m_invMassA*PX,bA.m_linearVelocity.y-=this.m_invMassA*PY,bA.m_angularVelocity-=this.m_invIA*L1,bB.m_linearVelocity.x+=this.m_invMassB*PX,bB.m_linearVelocity.y+=this.m_invMassB*PY,bB.m_angularVelocity+=this.m_invIB*L2}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(step){var bA=this.m_bodyA,bB=this.m_bodyB,v1=bA.m_linearVelocity,w1=bA.m_angularVelocity,v2=bB.m_linearVelocity,w2=bB.m_angularVelocity,PX=0,PY=0,L1=0,L2=0;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var Cdot=this.m_axis.x*(v2.x-v1.x)+this.m_axis.y*(v2.y-v1.y)+this.m_a2*w2-this.m_a1*w1,impulse=this.m_motorMass*(this.m_motorSpeed-Cdot),oldImpulse=this.m_motorImpulse,maxImpulse=step.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+impulse,-maxImpulse,maxImpulse),impulse=this.m_motorImpulse-oldImpulse,PX=impulse*this.m_axis.x,PY=impulse*this.m_axis.y,L1=impulse*this.m_a1,L2=impulse*this.m_a2,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}var Cdot1X=this.m_perp.x*(v2.x-v1.x)+this.m_perp.y*(v2.y-v1.y)+this.m_s2*w2-this.m_s1*w1,Cdot1Y=w2-w1;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var Cdot2=this.m_axis.x*(v2.x-v1.x)+this.m_axis.y*(v2.y-v1.y)+this.m_a2*w2-this.m_a1*w1,f1=this.m_impulse.Copy(),df=this.m_K.Solve33(new b2Vec3,-Cdot1X,-Cdot1Y,-Cdot2);this.m_impulse.Add(df),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0));var bX=-Cdot1X-(this.m_impulse.z-f1.z)*this.m_K.col3.x,bY=-Cdot1Y-(this.m_impulse.z-f1.z)*this.m_K.col3.y,f2r=this.m_K.Solve22(new b2Vec2,bX,bY);f2r.x+=f1.x,f2r.y+=f1.y,this.m_impulse.x=f2r.x,this.m_impulse.y=f2r.y,df.x=this.m_impulse.x-f1.x,df.y=this.m_impulse.y-f1.y,df.z=this.m_impulse.z-f1.z,PX=df.x*this.m_perp.x+df.z*this.m_axis.x,PY=df.x*this.m_perp.y+df.z*this.m_axis.y,L1=df.x*this.m_s1+df.y+df.z*this.m_a1,L2=df.x*this.m_s2+df.y+df.z*this.m_a2,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}else{var df2=this.m_K.Solve22(new b2Vec2,-Cdot1X,-Cdot1Y);this.m_impulse.x+=df2.x,this.m_impulse.y+=df2.y,PX=df2.x*this.m_perp.x,PY=df2.x*this.m_perp.y,L1=df2.x*this.m_s1+df2.y,L2=df2.x*this.m_s2+df2.y,v1.x-=this.m_invMassA*PX,v1.y-=this.m_invMassA*PY,w1-=this.m_invIA*L1,v2.x+=this.m_invMassB*PX,v2.y+=this.m_invMassB*PY,w2+=this.m_invIB*L2}bA.m_linearVelocity.SetV(v1),bA.m_angularVelocity=w1,bB.m_linearVelocity.SetV(v2),bB.m_angularVelocity=w2},b2PrismaticJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat,bA=this.m_bodyA,bB=this.m_bodyB,c1=bA.m_sweep.c,a1=bA.m_sweep.a,c2=bB.m_sweep.c,a2=bB.m_sweep.a,tX=0,m1=0,m2=0,i1=0,i2=0,linearError=0,angularError=0,active=!1,C2=0,R1=b2Mat22.FromAngle(a1),R2=b2Mat22.FromAngle(a2);tMat=R1;var r1X=this.m_localAnchor1.x-this.m_localCenterA.x,r1Y=this.m_localAnchor1.y-this.m_localCenterA.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=R2;var r2X=this.m_localAnchor2.x-this.m_localCenterB.x,r2Y=this.m_localAnchor2.y-this.m_localCenterB.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var dX=c2.x+r2X-c1.x-r1X,dY=c2.y+r2Y-c1.y-r1Y;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(R1,this.m_localXAxis1),this.m_a1=(dX+r1X)*this.m_axis.y-(dY+r1Y)*this.m_axis.x,this.m_a2=r2X*this.m_axis.y-r2Y*this.m_axis.x;var translation=this.m_axis.x*dX+this.m_axis.y*dY;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(C2=b2Math.Clamp(translation,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),linearError=b2Math.Abs(translation),active=!0):translation<=this.m_lowerTranslation?(C2=b2Math.Clamp(translation-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),linearError=this.m_lowerTranslation-translation,active=!0):translation>=this.m_upperTranslation&&(C2=b2Math.Clamp(translation-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),linearError=translation-this.m_upperTranslation,active=!0)}this.m_perp=b2Math.MulMV(R1,this.m_localYAxis1),this.m_s1=(dX+r1X)*this.m_perp.y-(dY+r1Y)*this.m_perp.x,this.m_s2=r2X*this.m_perp.y-r2Y*this.m_perp.x;var impulse=new b2Vec3,C1X=this.m_perp.x*dX+this.m_perp.y*dY,C1Y=a2-a1-this.m_refAngle;if(linearError=b2Math.Max(linearError,b2Math.Abs(C1X)),angularError=b2Math.Abs(C1Y),active)m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB,this.m_K.col1.x=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,this.m_K.col1.y=i1*this.m_s1+i2*this.m_s2,this.m_K.col1.z=i1*this.m_s1*this.m_a1+i2*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=i1+i2,this.m_K.col2.z=i1*this.m_a1+i2*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m1+m2+i1*this.m_a1*this.m_a1+i2*this.m_a2*this.m_a2,this.m_K.Solve33(impulse,-C1X,-C1Y,-C2);else{m1=this.m_invMassA,m2=this.m_invMassB,i1=this.m_invIA,i2=this.m_invIB;var k11=m1+m2+i1*this.m_s1*this.m_s1+i2*this.m_s2*this.m_s2,k12=i1*this.m_s1+i2*this.m_s2,k22=i1+i2;this.m_K.col1.Set(k11,k12,0),this.m_K.col2.Set(k12,k22,0);var impulse1=this.m_K.Solve22(new b2Vec2,-C1X,-C1Y);impulse.x=impulse1.x,impulse.y=impulse1.y,impulse.z=0}var PX=impulse.x*this.m_perp.x+impulse.z*this.m_axis.x,PY=impulse.x*this.m_perp.y+impulse.z*this.m_axis.y,L1=impulse.x*this.m_s1+impulse.y+impulse.z*this.m_a1,L2=impulse.x*this.m_s2+impulse.y+impulse.z*this.m_a2;return c1.x-=this.m_invMassA*PX,c1.y-=this.m_invMassA*PY,a1-=this.m_invIA*L1,c2.x+=this.m_invMassB*PX,c2.y+=this.m_invMassB*PY,a2+=this.m_invIB*L2,bA.m_sweep.a=a1,bB.m_sweep.a=a2,bA.SynchronizeTransform(),bB.SynchronizeTransform(),linearError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop},Box2D.inherit(b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),b2PrismaticJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2PrismaticJointDef.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2PrismaticJointDef.prototype.Initialize=function(bA,bB,anchor,axis){this.bodyA=bA,this.bodyB=bB,this.localAnchorA=this.bodyA.GetLocalPoint(anchor),this.localAnchorB=this.bodyB.GetLocalPoint(anchor),this.localAxisA=this.bodyA.GetLocalVector(axis),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),b2PulleyJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2PulleyJoint.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse*this.m_u2.x,inv_dt*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},b2PulleyJoint.prototype.GetLength1=function(){var p=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),sX=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,sY=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,dX=p.x-sX,dY=p.y-sY;return Math.sqrt(dX*dX+dY*dY)},b2PulleyJoint.prototype.GetLength2=function(){var p=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),sX=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,sY=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,dX=p.x-sX,dY=p.y-sY;return Math.sqrt(dX*dX+dY*dY)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.b2PulleyJoint=function(def){this.__super.b2Joint.call(this,def);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=def.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=def.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=def.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=def.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(def.localAnchorA),this.m_localAnchor2.SetV(def.localAnchorB),this.m_ratio=def.ratio,this.m_constant=def.lengthA+this.m_ratio*def.lengthB,this.m_maxLength1=b2Math.Min(def.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.Min(def.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.InitVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,
r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var p1X=bA.m_sweep.c.x+r1X,p1Y=bA.m_sweep.c.y+r1Y,p2X=bB.m_sweep.c.x+r2X,p2Y=bB.m_sweep.c.y+r2Y,s1X=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s1Y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s2X=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,s2Y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(p1X-s1X,p1Y-s1Y),this.m_u2.Set(p2X-s2X,p2Y-s2Y);var length1=this.m_u1.Length(),length2=this.m_u2.Length();length1>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/length1):this.m_u1.SetZero(),length2>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/length2):this.m_u2.SetZero();var C=this.m_constant-length1-this.m_ratio*length2;C>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,length1<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,length2<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit;var cr1u1=r1X*this.m_u1.y-r1Y*this.m_u1.x,cr2u2=r2X*this.m_u2.y-r2Y*this.m_u2.x;if(this.m_limitMass1=bA.m_invMass+bA.m_invI*cr1u1*cr1u1,this.m_limitMass2=bB.m_invMass+bB.m_invI*cr2u2*cr2u2,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,step.warmStarting){this.m_impulse*=step.dtRatio,this.m_limitImpulse1*=step.dtRatio,this.m_limitImpulse2*=step.dtRatio;var P1X=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,P1Y=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,P2X=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,P2Y=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;bA.m_linearVelocity.x+=bA.m_invMass*P1X,bA.m_linearVelocity.y+=bA.m_invMass*P1Y,bA.m_angularVelocity+=bA.m_invI*(r1X*P1Y-r1Y*P1X),bB.m_linearVelocity.x+=bB.m_invMass*P2X,bB.m_linearVelocity.y+=bB.m_invMass*P2Y,bB.m_angularVelocity+=bB.m_invI*(r2X*P2Y-r2Y*P2X)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y;r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var v1X=0,v1Y=0,v2X=0,v2Y=0,P1X=0,P1Y=0,P2X=0,P2Y=0,Cdot=0,impulse=0,oldImpulse=0;this.m_state==b2Joint.e_atUpperLimit&&(v1X=bA.m_linearVelocity.x+-bA.m_angularVelocity*r1Y,v1Y=bA.m_linearVelocity.y+bA.m_angularVelocity*r1X,v2X=bB.m_linearVelocity.x+-bB.m_angularVelocity*r2Y,v2Y=bB.m_linearVelocity.y+bB.m_angularVelocity*r2X,Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y)-this.m_ratio*(this.m_u2.x*v2X+this.m_u2.y*v2Y),impulse=this.m_pulleyMass*-Cdot,oldImpulse=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+impulse),impulse=this.m_impulse-oldImpulse,P1X=-impulse*this.m_u1.x,P1Y=-impulse*this.m_u1.y,P2X=-this.m_ratio*impulse*this.m_u2.x,P2Y=-this.m_ratio*impulse*this.m_u2.y,bA.m_linearVelocity.x+=bA.m_invMass*P1X,bA.m_linearVelocity.y+=bA.m_invMass*P1Y,bA.m_angularVelocity+=bA.m_invI*(r1X*P1Y-r1Y*P1X),bB.m_linearVelocity.x+=bB.m_invMass*P2X,bB.m_linearVelocity.y+=bB.m_invMass*P2Y,bB.m_angularVelocity+=bB.m_invI*(r2X*P2Y-r2Y*P2X)),this.m_limitState1==b2Joint.e_atUpperLimit&&(v1X=bA.m_linearVelocity.x+-bA.m_angularVelocity*r1Y,v1Y=bA.m_linearVelocity.y+bA.m_angularVelocity*r1X,Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y),impulse=-this.m_limitMass1*Cdot,oldImpulse=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+impulse),impulse=this.m_limitImpulse1-oldImpulse,P1X=-impulse*this.m_u1.x,P1Y=-impulse*this.m_u1.y,bA.m_linearVelocity.x+=bA.m_invMass*P1X,bA.m_linearVelocity.y+=bA.m_invMass*P1Y,bA.m_angularVelocity+=bA.m_invI*(r1X*P1Y-r1Y*P1X)),this.m_limitState2==b2Joint.e_atUpperLimit&&(v2X=bB.m_linearVelocity.x+-bB.m_angularVelocity*r2Y,v2Y=bB.m_linearVelocity.y+bB.m_angularVelocity*r2X,Cdot=-(this.m_u2.x*v2X+this.m_u2.y*v2Y),impulse=-this.m_limitMass2*Cdot,oldImpulse=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+impulse),impulse=this.m_limitImpulse2-oldImpulse,P2X=-impulse*this.m_u2.x,P2Y=-impulse*this.m_u2.y,bB.m_linearVelocity.x+=bB.m_invMass*P2X,bB.m_linearVelocity.y+=bB.m_invMass*P2Y,bB.m_angularVelocity+=bB.m_invI*(r2X*P2Y-r2Y*P2X))},b2PulleyJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat,bA=this.m_bodyA,bB=this.m_bodyB,s1X=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s1Y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s2X=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,s2Y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,r1X=0,r1Y=0,r2X=0,r2Y=0,p1X=0,p1Y=0,p2X=0,p2Y=0,length1=0,length2=0,C=0,impulse=0,tX=0,linearError=0;return this.m_state==b2Joint.e_atUpperLimit&&(tMat=bA.m_xf.R,r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R,r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y,tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX,p1X=bA.m_sweep.c.x+r1X,p1Y=bA.m_sweep.c.y+r1Y,p2X=bB.m_sweep.c.x+r2X,p2Y=bB.m_sweep.c.y+r2Y,this.m_u1.Set(p1X-s1X,p1Y-s1Y),this.m_u2.Set(p2X-s2X,p2Y-s2Y),length1=this.m_u1.Length(),length2=this.m_u2.Length(),length1>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/length1):this.m_u1.SetZero(),length2>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/length2):this.m_u2.SetZero(),C=this.m_constant-length1-this.m_ratio*length2,linearError=b2Math.Max(linearError,-C),C=b2Math.Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),impulse=-this.m_pulleyMass*C,p1X=-impulse*this.m_u1.x,p1Y=-impulse*this.m_u1.y,p2X=-this.m_ratio*impulse*this.m_u2.x,p2Y=-this.m_ratio*impulse*this.m_u2.y,bA.m_sweep.c.x+=bA.m_invMass*p1X,bA.m_sweep.c.y+=bA.m_invMass*p1Y,bA.m_sweep.a+=bA.m_invI*(r1X*p1Y-r1Y*p1X),bB.m_sweep.c.x+=bB.m_invMass*p2X,bB.m_sweep.c.y+=bB.m_invMass*p2Y,bB.m_sweep.a+=bB.m_invI*(r2X*p2Y-r2Y*p2X),bA.SynchronizeTransform(),bB.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(tMat=bA.m_xf.R,r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,p1X=bA.m_sweep.c.x+r1X,p1Y=bA.m_sweep.c.y+r1Y,this.m_u1.Set(p1X-s1X,p1Y-s1Y),length1=this.m_u1.Length(),length1>b2Settings.b2_linearSlop?(this.m_u1.x*=1/length1,this.m_u1.y*=1/length1):this.m_u1.SetZero(),C=this.m_maxLength1-length1,linearError=b2Math.Max(linearError,-C),C=b2Math.Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),impulse=-this.m_limitMass1*C,p1X=-impulse*this.m_u1.x,p1Y=-impulse*this.m_u1.y,bA.m_sweep.c.x+=bA.m_invMass*p1X,bA.m_sweep.c.y+=bA.m_invMass*p1Y,bA.m_sweep.a+=bA.m_invI*(r1X*p1Y-r1Y*p1X),bA.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(tMat=bB.m_xf.R,r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y,tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX,p2X=bB.m_sweep.c.x+r2X,p2Y=bB.m_sweep.c.y+r2Y,this.m_u2.Set(p2X-s2X,p2Y-s2Y),length2=this.m_u2.Length(),length2>b2Settings.b2_linearSlop?(this.m_u2.x*=1/length2,this.m_u2.y*=1/length2):this.m_u2.SetZero(),C=this.m_maxLength2-length2,linearError=b2Math.Max(linearError,-C),C=b2Math.Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),impulse=-this.m_limitMass2*C,p2X=-impulse*this.m_u2.x,p2Y=-impulse*this.m_u2.y,bB.m_sweep.c.x+=bB.m_invMass*p2X,bB.m_sweep.c.y+=bB.m_invMass*p2Y,bB.m_sweep.a+=bB.m_invI*(r2X*p2Y-r2Y*p2X),bB.SynchronizeTransform()),linearError<b2Settings.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),b2PulleyJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2PulleyJointDef.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.Initialize=function(bA,bB,gaA,gaB,anchorA,anchorB,r){void 0===r&&(r=0),this.bodyA=bA,this.bodyB=bB,this.groundAnchorA.SetV(gaA),this.groundAnchorB.SetV(gaB),this.localAnchorA=this.bodyA.GetLocalPoint(anchorA),this.localAnchorB=this.bodyB.GetLocalPoint(anchorB);var d1X=anchorA.x-gaA.x,d1Y=anchorA.y-gaA.y;this.lengthA=Math.sqrt(d1X*d1X+d1Y*d1Y);var d2X=anchorB.x-gaB.x,d2Y=anchorB.y-gaB.y;this.lengthB=Math.sqrt(d2X*d2X+d2Y*d2Y),this.ratio=r;var C=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=C-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(C-b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.inherit(b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),b2RevoluteJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2RevoluteJoint.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse.x,inv_dt*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),inv_dt*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(flag){this.m_enableLimit=flag},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(lower,upper){void 0===lower&&(lower=0),void 0===upper&&(upper=0),this.m_lowerAngle=lower,this.m_upperAngle=upper},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(flag){this.m_enableMotor=flag},b2RevoluteJoint.prototype.SetMotorSpeed=function(speed){void 0===speed&&(speed=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=speed},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(torque){void 0===torque&&(torque=0),this.m_maxMotorTorque=torque},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.b2RevoluteJoint=function(def){this.__super.b2Joint.call(this,def),this.m_localAnchor1.SetV(def.localAnchorA),this.m_localAnchor2.SetV(def.localAnchorB),this.m_referenceAngle=def.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=def.lowerAngle,this.m_upperAngle=def.upperAngle,this.m_maxMotorTorque=def.maxMotorTorque,this.m_motorSpeed=def.motorSpeed,this.m_enableLimit=def.enableLimit,this.m_enableMotor=def.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.InitVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB,tX=0;this.m_enableMotor||this.m_enableLimit,tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var m1=bA.m_invMass,m2=bB.m_invMass,i1=bA.m_invI,i2=bB.m_invI;if(this.m_mass.col1.x=m1+m2+r1Y*r1Y*i1+r2Y*r2Y*i2,this.m_mass.col2.x=-r1Y*r1X*i1-r2Y*r2X*i2,this.m_mass.col3.x=-r1Y*i1-r2Y*i2,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m1+m2+r1X*r1X*i1+r2X*r2X*i2,this.m_mass.col3.y=r1X*i1+r2X*i2,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=i1+i2,this.m_motorMass=1/(i1+i2),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var jointAngle=bB.m_sweep.a-bA.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:jointAngle<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):jointAngle>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(step.warmStarting){this.m_impulse.x*=step.dtRatio,this.m_impulse.y*=step.dtRatio,this.m_motorImpulse*=step.dtRatio;var PX=this.m_impulse.x,PY=this.m_impulse.y;bA.m_linearVelocity.x-=m1*PX,bA.m_linearVelocity.y-=m1*PY,bA.m_angularVelocity-=i1*(r1X*PY-r1Y*PX+this.m_motorImpulse+this.m_impulse.z),bB.m_linearVelocity.x+=m2*PX,bB.m_linearVelocity.y+=m2*PY,bB.m_angularVelocity+=i2*(r2X*PY-r2Y*PX+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(step){var tMat,bA=this.m_bodyA,bB=this.m_bodyB,tX=0,newImpulse=0,r1X=0,r1Y=0,r2X=0,r2Y=0,v1=bA.m_linearVelocity,w1=bA.m_angularVelocity,v2=bB.m_linearVelocity,w2=bB.m_angularVelocity,m1=bA.m_invMass,m2=bB.m_invMass,i1=bA.m_invI,i2=bB.m_invI;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var Cdot=w2-w1-this.m_motorSpeed,impulse=this.m_motorMass*-Cdot,oldImpulse=this.m_motorImpulse,maxImpulse=step.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+impulse,-maxImpulse,maxImpulse),impulse=this.m_motorImpulse-oldImpulse,w1-=i1*impulse,w2+=i2*impulse}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){tMat=bA.m_xf.R,r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R,r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y,tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var Cdot1X=v2.x+-w2*r2Y-v1.x- -w1*r1Y,Cdot1Y=v2.y+w2*r2X-v1.y-w1*r1X,Cdot2=w2-w1;this.m_mass.Solve33(this.impulse3,-Cdot1X,-Cdot1Y,-Cdot2),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(newImpulse=this.m_impulse.z+this.impulse3.z,0>newImpulse&&(this.m_mass.Solve22(this.reduced,-Cdot1X,-Cdot1Y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(newImpulse=this.m_impulse.z+this.impulse3.z,newImpulse>0&&(this.m_mass.Solve22(this.reduced,-Cdot1X,-Cdot1Y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),v1.x-=m1*this.impulse3.x,v1.y-=m1*this.impulse3.y,w1-=i1*(r1X*this.impulse3.y-r1Y*this.impulse3.x+this.impulse3.z),v2.x+=m2*this.impulse3.x,v2.y+=m2*this.impulse3.y,w2+=i2*(r2X*this.impulse3.y-r2Y*this.impulse3.x+this.impulse3.z)}else{tMat=bA.m_xf.R,r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y,tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R,r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y,tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var CdotX=v2.x+-w2*r2Y-v1.x- -w1*r1Y,CdotY=v2.y+w2*r2X-v1.y-w1*r1X;this.m_mass.Solve22(this.impulse2,-CdotX,-CdotY),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,v1.x-=m1*this.impulse2.x,v1.y-=m1*this.impulse2.y,w1-=i1*(r1X*this.impulse2.y-r1Y*this.impulse2.x),v2.x+=m2*this.impulse2.x,v2.y+=m2*this.impulse2.y,w2+=i2*(r2X*this.impulse2.y-r2Y*this.impulse2.x)}bA.m_linearVelocity.SetV(v1),bA.m_angularVelocity=w1,bB.m_linearVelocity.SetV(v2),bB.m_angularVelocity=w2},b2RevoluteJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat,C=0,bA=this.m_bodyA,bB=this.m_bodyB,angularError=0,positionError=0,tX=0,impulseX=0,impulseY=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var angle=bB.m_sweep.a-bA.m_sweep.a-this.m_referenceAngle,limitImpulse=0;this.m_limitState==b2Joint.e_equalLimits?(C=b2Math.Clamp(angle-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),limitImpulse=-this.m_motorMass*C,angularError=b2Math.Abs(C)):this.m_limitState==b2Joint.e_atLowerLimit?(C=angle-this.m_lowerAngle,angularError=-C,C=b2Math.Clamp(C+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),limitImpulse=-this.m_motorMass*C):this.m_limitState==b2Joint.e_atUpperLimit&&(C=angle-this.m_upperAngle,angularError=C,C=b2Math.Clamp(C-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),limitImpulse=-this.m_motorMass*C),bA.m_sweep.a-=bA.m_invI*limitImpulse,bB.m_sweep.a+=bB.m_invI*limitImpulse,bA.SynchronizeTransform(),bB.SynchronizeTransform()}tMat=bA.m_xf.R;var r1X=this.m_localAnchor1.x-bA.m_sweep.localCenter.x,r1Y=this.m_localAnchor1.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*r1X+tMat.col2.x*r1Y,r1Y=tMat.col1.y*r1X+tMat.col2.y*r1Y,r1X=tX,tMat=bB.m_xf.R;var r2X=this.m_localAnchor2.x-bB.m_sweep.localCenter.x,r2Y=this.m_localAnchor2.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*r2X+tMat.col2.x*r2Y,r2Y=tMat.col1.y*r2X+tMat.col2.y*r2Y,r2X=tX;var CX=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,CY=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y,CLengthSquared=CX*CX+CY*CY,CLength=Math.sqrt(CLengthSquared);positionError=CLength;var invMass1=bA.m_invMass,invMass2=bB.m_invMass,invI1=bA.m_invI,invI2=bB.m_invI,k_allowedStretch=10*b2Settings.b2_linearSlop;if(CLengthSquared>k_allowedStretch*k_allowedStretch){var k=invMass1+invMass2,m=1/k;impulseX=m*-CX,impulseY=m*-CY;var k_beta=.5;bA.m_sweep.c.x-=k_beta*invMass1*impulseX,bA.m_sweep.c.y-=k_beta*invMass1*impulseY,bB.m_sweep.c.x+=k_beta*invMass2*impulseX,bB.m_sweep.c.y+=k_beta*invMass2*impulseY,CX=bB.m_sweep.c.x+r2X-bA.m_sweep.c.x-r1X,CY=bB.m_sweep.c.y+r2Y-bA.m_sweep.c.y-r1Y}return this.K1.col1.x=invMass1+invMass2,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=invMass1+invMass2,this.K2.col1.x=invI1*r1Y*r1Y,this.K2.col2.x=-invI1*r1X*r1Y,this.K2.col1.y=-invI1*r1X*r1Y,this.K2.col2.y=invI1*r1X*r1X,this.K3.col1.x=invI2*r2Y*r2Y,this.K3.col2.x=-invI2*r2X*r2Y,this.K3.col1.y=-invI2*r2X*r2Y,this.K3.col2.y=invI2*r2X*r2X,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-CX,-CY),impulseX=b2RevoluteJoint.tImpulse.x,impulseY=b2RevoluteJoint.tImpulse.y,bA.m_sweep.c.x-=bA.m_invMass*impulseX,bA.m_sweep.c.y-=bA.m_invMass*impulseY,bA.m_sweep.a-=bA.m_invI*(r1X*impulseY-r1Y*impulseX),bB.m_sweep.c.x+=bB.m_invMass*impulseX,bB.m_sweep.c.y+=bB.m_invMass*impulseY,bB.m_sweep.a+=bB.m_invI*(r2X*impulseY-r2Y*impulseX),bA.SynchronizeTransform(),bB.SynchronizeTransform(),positionError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new b2Vec2}),Box2D.inherit(b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),b2RevoluteJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2RevoluteJointDef.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},b2RevoluteJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA,this.bodyB=bB,this.localAnchorA=this.bodyA.GetLocalPoint(anchor),this.localAnchorB=this.bodyB.GetLocalPoint(anchor),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),b2WeldJoint.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b2WeldJoint.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),new b2Vec2(inv_dt*this.m_impulse.x,inv_dt*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(inv_dt){return void 0===inv_dt&&(inv_dt=0),inv_dt*this.m_impulse.z},b2WeldJoint.prototype.b2WeldJoint=function(def){this.__super.b2Joint.call(this,def),this.m_localAnchorA.SetV(def.localAnchorA),this.m_localAnchorB.SetV(def.localAnchorB),this.m_referenceAngle=def.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(step){var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var rAX=this.m_localAnchorA.x-bA.m_sweep.localCenter.x,rAY=this.m_localAnchorA.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*rAX+tMat.col2.x*rAY,rAY=tMat.col1.y*rAX+tMat.col2.y*rAY,rAX=tX,tMat=bB.m_xf.R;var rBX=this.m_localAnchorB.x-bB.m_sweep.localCenter.x,rBY=this.m_localAnchorB.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*rBX+tMat.col2.x*rBY,rBY=tMat.col1.y*rBX+tMat.col2.y*rBY,rBX=tX;var mA=bA.m_invMass,mB=bB.m_invMass,iA=bA.m_invI,iB=bB.m_invI;this.m_mass.col1.x=mA+mB+rAY*rAY*iA+rBY*rBY*iB,this.m_mass.col2.x=-rAY*rAX*iA-rBY*rBX*iB,this.m_mass.col3.x=-rAY*iA-rBY*iB,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=mA+mB+rAX*rAX*iA+rBX*rBX*iB,this.m_mass.col3.y=rAX*iA+rBX*iB,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=iA+iB,step.warmStarting?(this.m_impulse.x*=step.dtRatio,this.m_impulse.y*=step.dtRatio,this.m_impulse.z*=step.dtRatio,bA.m_linearVelocity.x-=mA*this.m_impulse.x,bA.m_linearVelocity.y-=mA*this.m_impulse.y,bA.m_angularVelocity-=iA*(rAX*this.m_impulse.y-rAY*this.m_impulse.x+this.m_impulse.z),bB.m_linearVelocity.x+=mB*this.m_impulse.x,bB.m_linearVelocity.y+=mB*this.m_impulse.y,bB.m_angularVelocity+=iB*(rBX*this.m_impulse.y-rBY*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(step){var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB,vA=bA.m_linearVelocity,wA=bA.m_angularVelocity,vB=bB.m_linearVelocity,wB=bB.m_angularVelocity,mA=bA.m_invMass,mB=bB.m_invMass,iA=bA.m_invI,iB=bB.m_invI;tMat=bA.m_xf.R;var rAX=this.m_localAnchorA.x-bA.m_sweep.localCenter.x,rAY=this.m_localAnchorA.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*rAX+tMat.col2.x*rAY,rAY=tMat.col1.y*rAX+tMat.col2.y*rAY,rAX=tX,tMat=bB.m_xf.R;var rBX=this.m_localAnchorB.x-bB.m_sweep.localCenter.x,rBY=this.m_localAnchorB.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*rBX+tMat.col2.x*rBY,rBY=tMat.col1.y*rBX+tMat.col2.y*rBY,rBX=tX;var Cdot1X=vB.x-wB*rBY-vA.x+wA*rAY,Cdot1Y=vB.y+wB*rBX-vA.y-wA*rAX,Cdot2=wB-wA,impulse=new b2Vec3;this.m_mass.Solve33(impulse,-Cdot1X,-Cdot1Y,-Cdot2),this.m_impulse.Add(impulse),vA.x-=mA*impulse.x,vA.y-=mA*impulse.y,wA-=iA*(rAX*impulse.y-rAY*impulse.x+impulse.z),vB.x+=mB*impulse.x,vB.y+=mB*impulse.y,wB+=iB*(rBX*impulse.y-rBY*impulse.x+impulse.z),bA.m_angularVelocity=wA,bB.m_angularVelocity=wB},b2WeldJoint.prototype.SolvePositionConstraints=function(baumgarte){void 0===baumgarte&&(baumgarte=0);var tMat,tX=0,bA=this.m_bodyA,bB=this.m_bodyB;tMat=bA.m_xf.R;var rAX=this.m_localAnchorA.x-bA.m_sweep.localCenter.x,rAY=this.m_localAnchorA.y-bA.m_sweep.localCenter.y;tX=tMat.col1.x*rAX+tMat.col2.x*rAY,rAY=tMat.col1.y*rAX+tMat.col2.y*rAY,rAX=tX,tMat=bB.m_xf.R;var rBX=this.m_localAnchorB.x-bB.m_sweep.localCenter.x,rBY=this.m_localAnchorB.y-bB.m_sweep.localCenter.y;tX=tMat.col1.x*rBX+tMat.col2.x*rBY,rBY=tMat.col1.y*rBX+tMat.col2.y*rBY,rBX=tX;var mA=bA.m_invMass,mB=bB.m_invMass,iA=bA.m_invI,iB=bB.m_invI,C1X=bB.m_sweep.c.x+rBX-bA.m_sweep.c.x-rAX,C1Y=bB.m_sweep.c.y+rBY-bA.m_sweep.c.y-rAY,C2=bB.m_sweep.a-bA.m_sweep.a-this.m_referenceAngle,k_allowedStretch=10*b2Settings.b2_linearSlop,positionError=Math.sqrt(C1X*C1X+C1Y*C1Y),angularError=b2Math.Abs(C2);positionError>k_allowedStretch&&(iA*=1,iB*=1),this.m_mass.col1.x=mA+mB+rAY*rAY*iA+rBY*rBY*iB,this.m_mass.col2.x=-rAY*rAX*iA-rBY*rBX*iB,this.m_mass.col3.x=-rAY*iA-rBY*iB,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=mA+mB+rAX*rAX*iA+rBX*rBX*iB,this.m_mass.col3.y=rAX*iA+rBX*iB,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=iA+iB;var impulse=new b2Vec3;return this.m_mass.Solve33(impulse,-C1X,-C1Y,-C2),bA.m_sweep.c.x-=mA*impulse.x,bA.m_sweep.c.y-=mA*impulse.y,bA.m_sweep.a-=iA*(rAX*impulse.y-rAY*impulse.x+impulse.z),bB.m_sweep.c.x+=mB*impulse.x,bB.m_sweep.c.y+=mB*impulse.y,bB.m_sweep.a+=iB*(rBX*impulse.y-rBY*impulse.x+impulse.z),bA.SynchronizeTransform(),bB.SynchronizeTransform(),positionError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop},Box2D.inherit(b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),b2WeldJointDef.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b2WeldJointDef.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA,this.bodyB=bB,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchor)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchor)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var b2DebugDraw=Box2D.Dynamics.b2DebugDraw;b2DebugDraw.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var __this=this;this.m_sprite={graphics:{clear:function(){__this.m_ctx.clearRect(0,0,__this.m_ctx.canvas.width,__this.m_ctx.canvas.height)}}}},b2DebugDraw.prototype._color=function(color,alpha){return"rgba("+((16711680&color)>>16)+","+((65280&color)>>8)+","+(255&color)+","+alpha+")"},b2DebugDraw.prototype.b2DebugDraw=function(){this.m_drawFlags=0},b2DebugDraw.prototype.SetFlags=function(flags){void 0===flags&&(flags=0),this.m_drawFlags=flags},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(flags){void 0===flags&&(flags=0),this.m_drawFlags|=flags},b2DebugDraw.prototype.ClearFlags=function(flags){void 0===flags&&(flags=0),this.m_drawFlags&=~flags},b2DebugDraw.prototype.SetSprite=function(sprite){this.m_ctx=sprite},b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx},b2DebugDraw.prototype.SetDrawScale=function(drawScale){void 0===drawScale&&(drawScale=0),this.m_drawScale=drawScale},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(lineThickness){void 0===lineThickness&&(lineThickness=0),this.m_lineThickness=lineThickness,this.m_ctx.strokeWidth=lineThickness},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(alpha){void 0===alpha&&(alpha=0),this.m_alpha=alpha},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(alpha){void 0===alpha&&(alpha=0),this.m_fillAlpha=alpha},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(xformScale){void 0===xformScale&&(xformScale=0),this.m_xformScale=xformScale},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.DrawPolygon=function(vertices,vertexCount,color){if(vertexCount){var s=this.m_ctx,drawScale=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(color.color,this.m_alpha),s.moveTo(vertices[0].x*drawScale,vertices[0].y*drawScale);for(var i=1;vertexCount>i;i++)s.lineTo(vertices[i].x*drawScale,vertices[i].y*drawScale);s.lineTo(vertices[0].x*drawScale,vertices[0].y*drawScale),s.closePath(),s.stroke()}},b2DebugDraw.prototype.DrawSolidPolygon=function(vertices,vertexCount,color){if(vertexCount){var s=this.m_ctx,drawScale=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(color.color,this.m_alpha),s.fillStyle=this._color(color.color,this.m_fillAlpha),s.moveTo(vertices[0].x*drawScale,vertices[0].y*drawScale);for(var i=1;vertexCount>i;i++)s.lineTo(vertices[i].x*drawScale,vertices[i].y*drawScale);s.lineTo(vertices[0].x*drawScale,vertices[0].y*drawScale),s.closePath(),s.fill(),s.stroke()}},b2DebugDraw.prototype.DrawCircle=function(center,radius,color){if(radius){var s=this.m_ctx,drawScale=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(color.color,this.m_alpha),s.arc(center.x*drawScale,center.y*drawScale,radius*drawScale,0,2*Math.PI,!0),s.closePath(),s.stroke()}},b2DebugDraw.prototype.DrawSolidCircle=function(center,radius,axis,color){if(radius){var s=this.m_ctx,drawScale=this.m_drawScale,cx=center.x*drawScale,cy=center.y*drawScale;s.moveTo(0,0),s.beginPath(),s.strokeStyle=this._color(color.color,this.m_alpha),s.fillStyle=this._color(color.color,this.m_fillAlpha),s.arc(cx,cy,radius*drawScale,0,2*Math.PI,!0),s.moveTo(cx,cy),s.lineTo((center.x+axis.x*radius)*drawScale,(center.y+axis.y*radius)*drawScale),s.closePath(),s.fill(),s.stroke()}},b2DebugDraw.prototype.DrawSegment=function(p1,p2,color){var s=this.m_ctx,drawScale=this.m_drawScale;s.strokeStyle=this._color(color.color,this.m_alpha),s.beginPath(),s.moveTo(p1.x*drawScale,p1.y*drawScale),s.lineTo(p2.x*drawScale,p2.y*drawScale),s.closePath(),s.stroke()},b2DebugDraw.prototype.DrawTransform=function(xf){var s=this.m_ctx,drawScale=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(16711680,this.m_alpha),s.moveTo(xf.position.x*drawScale,xf.position.y*drawScale),s.lineTo((xf.position.x+this.m_xformScale*xf.R.col1.x)*drawScale,(xf.position.y+this.m_xformScale*xf.R.col1.y)*drawScale),s.strokeStyle=this._color(65280,this.m_alpha),
s.moveTo(xf.position.x*drawScale,xf.position.y*drawScale),s.lineTo((xf.position.x+this.m_xformScale*xf.R.col2.x)*drawScale,(xf.position.y+this.m_xformScale*xf.R.col2.y)*drawScale),s.closePath(),s.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,function(){var COMPILED=!0,goog=goog||{};goog.global=this,goog.isDef=function(a){return void 0!==a},goog.exportPath_=function(a,b,c){a=a.split("."),c=c||goog.global,a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}},goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a])),goog.exportPath_(a,c)},goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!1,goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(a){if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)},goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(a){if(!goog.isString(a)||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=a,!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}},goog.module.get=function(a){return goog.module.getInternal_(a)},goog.module.getInternal_=function(a){return COMPILED?void 0:goog.isProvided_(a)?a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a):null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."))},goog.forwardDeclare=function(a){},COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(a,b){for(var e,c=a.split("."),d=b||goog.global;e=c.shift();){if(!goog.isDefAndNotNull(d[e]))return null;d=d[e]}return d},goog.globalize=function(a,b){var d,c=b||goog.global;for(d in a)c[d]=a[d]},goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");for(var f=goog.dependencies_,g=0;e=b[g];g++)f.nameToPath[e]=a,f.pathIsModule[a]=!!d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}},goog.ENABLE_DEBUG_LOADER=!0,goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)},goog.require=function(a){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(a),goog.isProvided_(a))return goog.isInModuleLoader_()?goog.module.getInternal_(a):null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,goog.writeScripts_(),null}throw a="goog.require could not find: "+a,goog.logToConsole_(a),Error(a)}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_?a.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a),a.instance_=new a)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("SCRIPT"),b=a.length-1;b>=0;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importModule_=function(a){goog.importScript_("",'goog.retrieveAndExecModule_("'+a+'");')&&(goog.dependencies_.written[a]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(a>0){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;a>c;c++)goog.maybeProcessDeferredPath_(b[c])}},goog.maybeProcessDeferredDep_=function(a){goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)&&(a=goog.getPathFromDeps_(a),goog.maybeProcessDeferredPath_(goog.basePath+a))},goog.isDeferredModule_=function(a){return(a=goog.getPathFromDeps_(a))&&goog.dependencies_.pathIsModule[a]?goog.basePath+a in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(a){if((a=goog.getPathFromDeps_(a))&&a in goog.dependencies_.requires)for(var b in goog.dependencies_.requires[a])if(!goog.isProvided_(b)&&!goog.isDeferredModule_(b))return!1;return!0},goog.maybeProcessDeferredPath_=function(a){if(a in goog.dependencies_.deferred){var b=goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a],goog.globalEval(b)}},goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0};var c;if(goog.isFunction(a))c=a.call(goog.global,{});else{if(!goog.isString(a))throw Error("Invalid module definition");c=goog.loadModuleFromSource_.call(goog.global,a)}var d=goog.moduleLoaderState_.moduleName;if(!goog.isString(d)||!d)throw Error('Invalid module name "'+d+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(c),goog.loadedModules_[d]=c}finally{goog.moduleLoaderState_=b}},goog.loadModuleFromSource_=function(a){return eval(a),{}},goog.writeScriptSrcNode_=function(a){goog.global.document.write('<script type="text/javascript" src="'+a+'"></script>')},goog.appendScriptSrcNode_=function(a){var b=goog.global.document,c=b.createElement("script");c.type="text/javascript",c.src=a,c.defer=!1,c.async=!1,b.head.appendChild(c)},goog.writeScriptTag_=function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load')}var d=goog.IS_OLD_IE_;return void 0===b?d?(d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",c.write('<script type="text/javascript" src="'+a+'"'+d+"></script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(a):goog.writeScriptSrcNode_(a):c.write('<script type="text/javascript">'+b+"</script>"),!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(a,b){return"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var f in d.requires[e])if(!goog.isProvided_(f)){if(!(f in d.nameToPath))throw Error("Undefined nameToPath for "+f);a(d.nameToPath[f])}e in c||(c[e]=!0,b.push(e))}}var e,b=[],c={},d=goog.dependencies_;for(e in goog.included_)d.written[e]||a(e);for(var f=0;f<b.length;f++)e=b[f],goog.dependencies_.written[e]=!0;var g=goog.moduleLoaderState_;for(goog.moduleLoaderState_=null,f=0;f<b.length;f++){if(!(e=b[f]))throw goog.moduleLoaderState_=g,Error("Undefined script input");d.pathIsModule[e]?goog.importModule_(goog.basePath+e):goog.importScript_(goog.basePath+e)}goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")},goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);var b=new goog.global.XMLHttpRequest;return b.open("get",a,!1),b.send(),b.responseText},goog.retrieveAndExecModule_=function(a){if(!COMPILED){var b=a;a=goog.normalizePath_(a);var c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,d=goog.loadFileSync_(a);if(null==d)throw Error("load of "+a+"failed");d=goog.wrapModule_(a,d),goog.IS_OLD_IE_?(goog.dependencies_.deferred[b]=d,goog.queuedModules_.push(b)):c(a,d)}},goog.typeOf=function(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b},goog.isNull=function(a){return null===a},goog.isDefAndNotNull=function(a){return null!=a},goog.isArray=function(a){return"array"==goog.typeOf(a)},goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length},goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear},goog.isString=function(a){return"string"==typeof a},goog.isBoolean=function(a){return"boolean"==typeof a},goog.isNumber=function(a){return"number"==typeof a},goog.isFunction=function(a){return"function"==goog.typeOf(a)},goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]},goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var c,b="array"==b?[]:{};for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a},goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)},goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}},goog.bind=function(a,b,c){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();return b.push.apply(b,arguments),a.apply(this,b)}},goog.mixin=function(a,b){for(var c in b)a[c]=b[c]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(b){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(a);else{var c=goog.global.document,d=c.createElement("SCRIPT");d.type="text/javascript",d.defer=!1,d.appendChild(c.createTextNode(a)),c.body.appendChild(d),c.body.removeChild(d)}}},goog.evalWorksForGlobals_=null,goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)},goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a,goog.cssNameMappingStyle_=b},!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(a,b){return b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return d in b?b[d]:a})),a},goog.getMsgWithFallback=function(a,b){return a},goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)},goog.exportProperty=function(a,b,c){a[b]=c},goog.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.base=function(a,c,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[c].apply(a,g)}},goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d.superClass_.constructor.apply(a,e)}for(e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];for(var f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(a){a.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;return c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),c=goog.defineClass.createSealingConstructor_(c,a),a&&goog.inherits(c,a),delete b.constructor,delete b.statics,goog.defineClass.applyProperties_(c.prototype,b),null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d)),c},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(a,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return a;var c=function(){var b=a.apply(this,arguments)||this;return b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_],this.constructor===c&&Object.seal(b),b};return c}return a},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])},goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.async={},goog.async.FreeList=function(a,b,c){this.limit_=c,this.create_=a,this.reset_=b,this.occupants_=0,this.head_=null},goog.async.FreeList.prototype.get=function(){var a;return 0<this.occupants_?(this.occupants_--,a=this.head_,this.head_=a.next,a.next=null):a=this.create_(),a},goog.async.FreeList.prototype.put=function(a){this.reset_(a),this.occupants_<this.limit_&&(this.occupants_++,a.next=this.head_,this.head_=a)},goog.async.FreeList.prototype.occupants=function(){return this.occupants_},goog.debug={},goog.debug.Error=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a)),this.reportErrorToServer=!0},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.disposable={},goog.disposable.IDisposable=function(){},goog.Disposable=function(){goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF&&(goog.Disposable.INCLUDE_STACK_ON_CREATION&&(this.creationStack=Error().stack),goog.Disposable.instances_[goog.getUid(this)]=this),this.disposed_=this.disposed_,this.onDisposeCallbacks_=this.onDisposeCallbacks_},goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2},goog.Disposable.MONITORING_MODE=0,goog.Disposable.INCLUDE_STACK_ON_CREATION=!0,goog.Disposable.instances_={},goog.Disposable.getUndisposedObjects=function(){var b,a=[];for(b in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(b)&&a.push(goog.Disposable.instances_[Number(b)]);return a},goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}},goog.Disposable.prototype.disposed_=!1,goog.Disposable.prototype.isDisposed=function(){return this.disposed_},goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed,goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF)){var a=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(a))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[a]}},goog.Disposable.prototype.registerDisposable=function(a){this.addOnDisposeCallback(goog.partial(goog.dispose,a))},goog.Disposable.prototype.addOnDisposeCallback=function(a,b){this.disposed_?a.call(b):(this.onDisposeCallbacks_||(this.onDisposeCallbacks_=[]),this.onDisposeCallbacks_.push(goog.isDef(b)?goog.bind(a,b):a))},goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()},goog.Disposable.isDisposed=function(a){return a&&"function"==typeof a.isDisposed?a.isDisposed():!1},goog.dispose=function(a){a&&"function"==typeof a.dispose&&a.dispose()},goog.disposeAll=function(a){for(var b=0,c=arguments.length;c>b;++b){var d=arguments[b];goog.isArrayLike(d)?goog.disposeAll.apply(null,d):goog.dispose(d)}},goog.dom={},goog.dom.InputType={BUTTON:"button",CHECKBOX:"checkbox",COLOR:"color",DATE:"date",DATETIME:"datetime",DATETIME_LOCAL:"datetime-local",EMAIL:"email",FILE:"file",HIDDEN:"hidden",IMAGE:"image",MENU:"menu",MONTH:"month",NUMBER:"number",PASSWORD:"password",RADIO:"radio",RANGE:"range",RESET:"reset",SEARCH:"search",SELECT_MULTIPLE:"select-multiple",SELECT_ONE:"select-one",SUBMIT:"submit",TEL:"tel",TEXT:"text",TEXTAREA:"textarea",TIME:"time",URL:"url",WEEK:"week"},goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.dom.TagName={A:"A",ABBR:"ABBR",ACRONYM:"ACRONYM",ADDRESS:"ADDRESS",APPLET:"APPLET",AREA:"AREA",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",B:"B",BASE:"BASE",BASEFONT:"BASEFONT",BDI:"BDI",BDO:"BDO",BIG:"BIG",BLOCKQUOTE:"BLOCKQUOTE",BODY:"BODY",BR:"BR",BUTTON:"BUTTON",CANVAS:"CANVAS",CAPTION:"CAPTION",CENTER:"CENTER",CITE:"CITE",CODE:"CODE",COL:"COL",COLGROUP:"COLGROUP",COMMAND:"COMMAND",DATA:"DATA",DATALIST:"DATALIST",DD:"DD",DEL:"DEL",DETAILS:"DETAILS",DFN:"DFN",DIALOG:"DIALOG",DIR:"DIR",DIV:"DIV",DL:"DL",DT:"DT",EM:"EM",EMBED:"EMBED",FIELDSET:"FIELDSET",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FONT:"FONT",FOOTER:"FOOTER",FORM:"FORM",FRAME:"FRAME",FRAMESET:"FRAMESET",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEAD:"HEAD",HEADER:"HEADER",HGROUP:"HGROUP",HR:"HR",HTML:"HTML",I:"I",IFRAME:"IFRAME",IMG:"IMG",INPUT:"INPUT",INS:"INS",ISINDEX:"ISINDEX",KBD:"KBD",KEYGEN:"KEYGEN",LABEL:"LABEL",LEGEND:"LEGEND",LI:"LI",LINK:"LINK",MAP:"MAP",MARK:"MARK",MATH:"MATH",MENU:"MENU",META:"META",METER:"METER",NAV:"NAV",NOFRAMES:"NOFRAMES",NOSCRIPT:"NOSCRIPT",OBJECT:"OBJECT",OL:"OL",OPTGROUP:"OPTGROUP",OPTION:"OPTION",OUTPUT:"OUTPUT",P:"P",PARAM:"PARAM",PRE:"PRE",PROGRESS:"PROGRESS",Q:"Q",RP:"RP",RT:"RT",RUBY:"RUBY",S:"S",SAMP:"SAMP",SCRIPT:"SCRIPT",SECTION:"SECTION",SELECT:"SELECT",SMALL:"SMALL",SOURCE:"SOURCE",SPAN:"SPAN",STRIKE:"STRIKE",STRONG:"STRONG",STYLE:"STYLE",SUB:"SUB",SUMMARY:"SUMMARY",SUP:"SUP",SVG:"SVG",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TEMPLATE:"TEMPLATE",TEXTAREA:"TEXTAREA",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",TIME:"TIME",TITLE:"TITLE",TR:"TR",TRACK:"TRACK",TT:"TT",U:"U",UL:"UL",VAR:"VAR",VIDEO:"VIDEO",WBR:"WBR"},goog.events={},goog.events.EventId=function(a){this.id=a},goog.events.EventId.prototype.toString=function(){return this.id},goog.events.Event=function(a,b){this.type=a instanceof goog.events.EventId?String(a):a,this.currentTarget=this.target=b,this.defaultPrevented=this.propagationStopped_=!1,this.returnValue_=!0},goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0},goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0,this.returnValue_=!1},goog.events.Event.stopPropagation=function(a){a.stopPropagation()},goog.events.Event.preventDefault=function(a){a.preventDefault()},goog.events.Listenable=function(){},goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+(1e6*Math.random()|0),goog.events.Listenable.addImplementation=function(a){a.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=!0},goog.events.Listenable.isImplementedBy=function(a){return!(!a||!a[goog.events.Listenable.IMPLEMENTED_BY_PROP])},goog.events.ListenableKey=function(){},goog.events.ListenableKey.counter_=0,goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_},goog.events.Listener=function(a,b,c,d,e,f){goog.events.Listener.ENABLE_MONITORING&&(this.creationStack=Error().stack),this.listener=a,this.proxy=b,this.src=c,this.type=d,this.capture=!!e,this.handler=f,this.key=goog.events.ListenableKey.reserveKey(),this.removed=this.callOnce=!1},goog.events.Listener.ENABLE_MONITORING=!1,goog.events.Listener.prototype.markAsRemoved=function(){this.removed=!0,this.handler=this.src=this.proxy=this.listener=null},goog.fs={},goog.fs.url={},goog.fs.url.createObjectUrl=function(a){return goog.fs.url.getUrlObject_().createObjectURL(a)},goog.fs.url.revokeObjectUrl=function(a){goog.fs.url.getUrlObject_().revokeObjectURL(a)},goog.fs.url.getUrlObject_=function(){var a=goog.fs.url.findUrlObject_();if(null!=a)return a;throw Error("This browser doesn't seem to support blob URLs")},goog.fs.url.findUrlObject_=function(){return goog.isDef(goog.global.URL)&&goog.isDef(goog.global.URL.createObjectURL)?goog.global.URL:goog.isDef(goog.global.webkitURL)&&goog.isDef(goog.global.webkitURL.createObjectURL)?goog.global.webkitURL:goog.isDef(goog.global.createObjectURL)?goog.global:null},goog.fs.url.browserSupportsObjectUrls=function(){return null!=goog.fs.url.findUrlObject_()},goog.functions={},goog.functions.constant=function(a){return function(){return a}},goog.functions.FALSE=goog.functions.constant(!1),goog.functions.TRUE=goog.functions.constant(!0),goog.functions.NULL=goog.functions.constant(null),goog.functions.identity=function(a,b){return a},goog.functions.error=function(a){return function(){throw Error(a)}},goog.functions.fail=function(a){return function(){throw a}},goog.functions.lock=function(a,b){return b=b||0,function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}},goog.functions.nth=function(a){return function(){return arguments[a]}},goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))},goog.functions.equalTo=function(a,b){return function(c){return b?a==c:a===c}},goog.functions.compose=function(a,b){var c=arguments,d=c.length;return function(){var a;d&&(a=c[d-1].apply(this,arguments));for(var b=d-2;b>=0;b--)a=c[b].call(this,a);return a}},goog.functions.sequence=function(a){var b=arguments,c=b.length;return function(){for(var a,e=0;c>e;e++)a=b[e].apply(this,arguments);return a}},goog.functions.and=function(a){var b=arguments,c=b.length;return function(){for(var a=0;c>a;a++)if(!b[a].apply(this,arguments))return!1;return!0}},goog.functions.or=function(a){var b=arguments,c=b.length;return function(){for(var a=0;c>a;a++)if(b[a].apply(this,arguments))return!0;return!1}},goog.functions.not=function(a){return function(){return!a.apply(this,arguments)}},goog.functions.create=function(a,b){var c=function(){};return c.prototype=a.prototype,c=new c,a.apply(c,Array.prototype.slice.call(arguments,1)),c},goog.functions.CACHE_RETURN_VALUE=!0,goog.functions.cacheReturnValue=function(a){var c,b=!1;return function(){return goog.functions.CACHE_RETURN_VALUE?(b||(c=a(),b=!0),c):a()}},goog.functions.once=function(a){var b=a;return function(){if(b){var a=b;b=null,a()}}},goog.history={},goog.history.EventType={NAVIGATE:"navigate"},goog.history.Event=function(a,b){goog.events.Event.call(this,goog.history.EventType.NAVIGATE),this.token=a,this.isNavigation=b},goog.inherits(goog.history.Event,goog.events.Event),goog.i18n={},goog.i18n.bidi={},goog.i18n.bidi.FORCE_RTL=!1,goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||("ar"==goog.LOCALE.substring(0,2).toLowerCase()||"fa"==goog.LOCALE.substring(0,2).toLowerCase()||"he"==goog.LOCALE.substring(0,2).toLowerCase()||"iw"==goog.LOCALE.substring(0,2).toLowerCase()||"ps"==goog.LOCALE.substring(0,2).toLowerCase()||"sd"==goog.LOCALE.substring(0,2).toLowerCase()||"ug"==goog.LOCALE.substring(0,2).toLowerCase()||"ur"==goog.LOCALE.substring(0,2).toLowerCase()||"yi"==goog.LOCALE.substring(0,2).toLowerCase())&&(2==goog.LOCALE.length||"-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3))||3<=goog.LOCALE.length&&"ckb"==goog.LOCALE.substring(0,3).toLowerCase()&&(3==goog.LOCALE.length||"-"==goog.LOCALE.substring(3,4)||"_"==goog.LOCALE.substring(3,4)),goog.i18n.bidi.Format={LRE:"",RLE:"",PDF:"",LRM:"",RLM:""},goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0},goog.i18n.bidi.RIGHT="right",goog.i18n.bidi.LEFT="left",goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT,goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,goog.i18n.bidi.toDir=function(a,b){return"number"==typeof a?a>0?goog.i18n.bidi.Dir.LTR:0>a?goog.i18n.bidi.Dir.RTL:b?null:goog.i18n.bidi.Dir.NEUTRAL:null==a?null:a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.ltrChars_="A-Za-z--------",goog.i18n.bidi.rtlChars_="----",goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g,goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_,""):a},goog.i18n.bidi.rtlCharReg_=new RegExp("["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.ltrCharReg_=new RegExp("["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.hasAnyRtl=function(a,b){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl,goog.i18n.bidi.hasAnyLtr=function(a,b){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.ltrRe_=new RegExp("^["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlRe_=new RegExp("^["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)},goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)},goog.i18n.bidi.isNeutralChar=function(a){return!goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)},goog.i18n.bidi.ltrDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.startsWithRtl=function(a,b){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl,goog.i18n.bidi.startsWithLtr=function(a,b){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr,goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/,goog.i18n.bidi.isNeutralText=function(a,b){return a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b),goog.i18n.bidi.isRequiredLtrRe_.test(a)||!goog.i18n.bidi.hasAnyLtr(a)&&!goog.i18n.bidi.hasAnyRtl(a)},goog.i18n.bidi.ltrExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$"),goog.i18n.bidi.rtlExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$"),goog.i18n.bidi.endsWithLtr=function(a,b){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr,goog.i18n.bidi.endsWithRtl=function(a,b){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))},goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl,goog.i18n.bidi.rtlLocalesRe_=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Arab|Hebr|Thaa|Nkoo|Tfng))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i,goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)},goog.i18n.bidi.bracketGuardHtmlRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(&lt;.*?(&gt;)+)/g,goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g,goog.i18n.bidi.guardBracketInHtml=function(a,b){return(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=rtl>$&</span>"):a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=ltr>$&</span>")},goog.i18n.bidi.guardBracketInText=function(a,b){var c=(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return a.replace(goog.i18n.bidi.bracketGuardTextRe_,c+"$&"+c)},goog.i18n.bidi.enforceRtlInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=rtl"):"\n<span dir=rtl>"+a+"</span>"},goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.enforceLtrInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=ltr"):"\n<span dir=ltr>"+a+"</span>"},goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g,goog.i18n.bidi.leftRe_=/left/gi,
goog.i18n.bidi.rightRe_=/right/gi,goog.i18n.bidi.tempRe_=/%%%%/g,goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)},goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g,goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g,goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1")},goog.i18n.bidi.wordSeparatorRe_=/\s+/,goog.i18n.bidi.hasNumeralsRe_=/[\d\u06f0-\u06f9]/,goog.i18n.bidi.rtlDetectionThreshold_=.4,goog.i18n.bidi.estimateDirection=function(a,b){for(var c=0,d=0,e=!1,f=goog.i18n.bidi.stripHtmlIfNeeded_(a,b).split(goog.i18n.bidi.wordSeparatorRe_),g=0;g<f.length;g++){var h=f[g];goog.i18n.bidi.startsWithRtl(h)?(c++,d++):goog.i18n.bidi.isRequiredLtrRe_.test(h)?e=!0:goog.i18n.bidi.hasAnyLtr(h)?d++:goog.i18n.bidi.hasNumeralsRe_.test(h)&&(e=!0)}return 0==d?e?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:c/d>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.detectRtlDirectionality=function(a,b){return goog.i18n.bidi.estimateDirection(a,b)==goog.i18n.bidi.Dir.RTL},goog.i18n.bidi.setElementDirAndAlign=function(a,b){a&&(b=goog.i18n.bidi.toDir(b))&&(a.style.textAlign=b==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,a.dir=b==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")},goog.i18n.bidi.setElementDirByTextDirectionality=function(a,b){switch(goog.i18n.bidi.estimateDirection(b)){case goog.i18n.bidi.Dir.LTR:a.dir="ltr";break;case goog.i18n.bidi.Dir.RTL:a.dir="rtl";break;default:a.removeAttribute("dir")}},goog.i18n.bidi.DirectionalString=function(){},goog.math={},goog.math.Size=function(a,b){this.width=a,this.height=b},goog.math.Size.equals=function(a,b){return a==b?!0:a&&b?a.width==b.width&&a.height==b.height:!1},goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)},goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"}),goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)},goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)},goog.math.Size.prototype.area=function(){return this.width*this.height},goog.math.Size.prototype.perimeter=function(){return 2*(this.width+this.height)},goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height},goog.math.Size.prototype.isEmpty=function(){return!this.area()},goog.math.Size.prototype.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},goog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height},goog.math.Size.prototype.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},goog.math.Size.prototype.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},goog.math.Size.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;return this.width*=a,this.height*=c,this},goog.math.Size.prototype.scaleToCover=function(a){return a=this.aspectRatio()<=a.aspectRatio()?a.width/this.width:a.height/this.height,this.scale(a)},goog.math.Size.prototype.scaleToFit=function(a){return a=this.aspectRatio()>a.aspectRatio()?a.width/this.width:a.height/this.height,this.scale(a)},goog.memoize=function(a,b){var c=b||goog.memoize.simpleSerializer;return function(){if(goog.memoize.ENABLE_MEMOIZE){var b=this||goog.global,b=b[goog.memoize.CACHE_PROPERTY_]||(b[goog.memoize.CACHE_PROPERTY_]={}),e=c(goog.getUid(a),arguments);return b.hasOwnProperty(e)?b[e]:b[e]=a.apply(this,arguments)}return a.apply(this,arguments)}},goog.memoize.ENABLE_MEMOIZE=!0,goog.memoize.clearCache=function(a){a[goog.memoize.CACHE_PROPERTY_]={}},goog.memoize.CACHE_PROPERTY_="closure_memoize_cache_",goog.memoize.simpleSerializer=function(a,b){for(var c=[a],d=b.length-1;d>=0;--d)c.push(typeof b[d],b[d]);return c.join("")},goog.object={},goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},goog.object.filter=function(a,b,c){var e,d={};for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d},goog.object.map=function(a,b,c){var e,d={};for(e in a)d[e]=b.call(c,a[e],e,a);return d},goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1},goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0},goog.object.getCount=function(a){var c,b=0;for(c in a)b++;return b},goog.object.getAnyKey=function(a){for(var b in a)return b},goog.object.getAnyValue=function(a){for(var b in a)return a[b]},goog.object.contains=function(a,b){return goog.object.containsValue(a,b)},goog.object.getValues=function(a){var d,b=[],c=0;for(d in a)b[c++]=a[d];return b},goog.object.getKeys=function(a){var d,b=[],c=0;for(d in a)b[c++]=d;return b},goog.object.getValueByKeys=function(a,b){for(var c=goog.isArrayLike(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],goog.isDef(a));c++);return a},goog.object.containsKey=function(a,b){return b in a},goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1},goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d},goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]},goog.object.isEmpty=function(a){for(var b in a)return!1;return!0},goog.object.clear=function(a){for(var b in a)delete a[b]},goog.object.remove=function(a,b){var c;return(c=b in a)&&delete a[b],c},goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)},goog.object.get=function(a,b,c){return b in a?a[b]:c},goog.object.set=function(a,b,c){a[b]=c},goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c},goog.object.setWithReturnValueIfNotSet=function(a,b,c){return b in a?a[b]:(c=c(),a[b]=c)},goog.object.equals=function(a,b){for(var c in a)if(!(c in b)||a[c]!==b[c])return!1;for(c in b)if(!(c in a))return!1;return!0},goog.object.clone=function(a){var c,b={};for(c in a)b[c]=a[c];return b},goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var c,b="array"==b?[]:{};for(c in a)b[c]=goog.object.unsafeClone(a[c]);return b}return a},goog.object.transpose=function(a){var c,b={};for(c in a)b[a[c]]=c;return b},goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}},goog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;b>d;d+=2)c[arguments[d]]=arguments[d+1];return c},goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;b>d;d++)c[arguments[d]]=!0;return c},goog.object.createImmutableView=function(a){var b=a;return Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b)),b},goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)},goog.dom.tags={},goog.dom.tags.VOID_TAGS_=goog.object.createSet("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),goog.dom.tags.isVoidTag=function(a){return!0===goog.dom.tags.VOID_TAGS_[a]},goog.promise={},goog.promise.Resolver=function(){},goog.Thenable=function(){},goog.Thenable.prototype.then=function(a,b,c){},goog.Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable",goog.Thenable.addImplementation=function(a){goog.exportProperty(a.prototype,"then",a.prototype.then),COMPILED?a.prototype[goog.Thenable.IMPLEMENTED_BY_PROP]=!0:a.prototype.$goog_Thenable=!0},goog.Thenable.isImplementedBy=function(a){if(!a)return!1;try{return COMPILED?!!a[goog.Thenable.IMPLEMENTED_BY_PROP]:!!a.$goog_Thenable}catch(b){return!1}},goog.reflect={},goog.reflect.object=function(a,b){return b},goog.reflect.sinkValue=function(a){return goog.reflect.sinkValue[" "](a),a},goog.reflect.sinkValue[" "]=goog.nullFunction,goog.reflect.canAccessProperty=function(a,b){try{return goog.reflect.sinkValue(a[b]),!0}catch(c){}return!1},goog.string={},goog.string.DETECT_DOUBLE_ESCAPING=!1,goog.string.FORCE_NON_DOM_HTML_UNESCAPING=!1,goog.string.Unicode={NBSP:""},goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)},goog.string.endsWith=function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)==c},goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))},goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))},goog.string.caseInsensitiveEquals=function(a,b){return a.toLowerCase()==b.toLowerCase()},goog.string.subs=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")},goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=function(a){return/^[\s\xa0]*$/.test(a)},goog.string.isEmptyString=function(a){return 0==a.length},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(a){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(a))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)},goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)},goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)},goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)},goog.string.isSpace=function(a){return" "==a},goog.string.isUnicodeChar=function(a){return 1==a.length&&a>=" "&&"~">=a||a>=""&&"">=a},goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return d>c?-1:c==d?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;e>f;f++){var g=c[f],h=d[f];if(g!=h)return c=parseInt(g,10),!isNaN(c)&&(d=parseInt(h,10),!isNaN(d)&&c-d)?c-d:h>g?-1:1}return c.length!=d.length?c.length-d.length:b>a?-1:1},goog.string.urlEncode=function(a){return encodeURIComponent(String(a))},goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))},goog.string.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")},goog.string.htmlEscape=function(a,b){if(b)a=a.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(a=a.replace(goog.string.E_RE_,"&#101;"));else{if(!goog.string.ALL_RE_.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(goog.string.AMP_RE_,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(goog.string.LT_RE_,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(goog.string.GT_RE_,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(goog.string.QUOT_RE_,"&quot;")),-1!=a.indexOf("'")&&(a=a.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;")),-1!=a.indexOf("\x00")&&(a=a.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&-1!=a.indexOf("e")&&(a=a.replace(goog.string.E_RE_,"&#101;"))}return a},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a},goog.string.unescapeEntitiesWithDocument=function(a,b){return goog.string.contains(a,"&")?goog.string.unescapeEntitiesUsingDom_(a,b):a},goog.string.unescapeEntitiesUsingDom_=function(a,b){var d,c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};return d=b?b.createElement("div"):goog.global.document.createElement("div"),a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,b){var g=c[a];if(g)return g;if("#"==b.charAt(0)){var h=Number("0"+b.substr(1));isNaN(h)||(g=String.fromCharCode(h))}return g||(d.innerHTML=a+" ",g=d.firstChild.nodeValue.slice(0,-1)),c[a]=g})},goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,c){switch(c){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==c.charAt(0)){var d=Number("0"+c.substr(1));if(!isNaN(d))return String.fromCharCode(d)}return a}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)},goog.string.preserveSpaces=function(a){return a.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;c>d;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a},goog.string.truncate=function(a,b,c){return c&&(a=goog.string.unescapeEntities(a)),a.length>b&&(a=a.substring(0,b-3)+"..."),c&&(a=goog.string.htmlEscape(a)),a},goog.string.truncateMiddle=function(a,b,c,d){if(c&&(a=goog.string.unescapeEntities(a)),d&&a.length>b){d>b&&(d=b);var e=a.length-d;a=a.substring(0,b-d)+"..."+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+"..."+a.substring(e));return c&&(a=goog.string.htmlEscape(a)),a},goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(a){if(a=String(a),a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(e>31&&127>e?d:goog.string.escapeChar(d))}return b.push('"'),b.join("")},goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")},goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);return c>31&&127>c?b=a:(256>c?(b="\\x",(16>c||c>256)&&(b+="0")):(b="\\u",4096>c&&(b+="0")),b+=c.toString(16).toUpperCase()),goog.string.jsEscapeCache_[a]=b},goog.string.contains=function(a,b){return-1!=a.indexOf(b)},goog.string.caseInsensitiveContains=function(a,b){return goog.string.contains(a.toLowerCase(),b.toLowerCase())},goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0},goog.string.removeAt=function(a,b,c){var d=a;return b>=0&&b<a.length&&c>0&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c)),d},goog.string.remove=function(a,b){var c=new RegExp(goog.string.regExpEscape(b),"");return a.replace(c,"")},goog.string.removeAll=function(a,b){var c=new RegExp(goog.string.regExpEscape(b),"g");return a.replace(c,"")},goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(a,b){return Array(b+1).join(a)},goog.string.padNumber=function(a,b,c){return a=goog.isDef(c)?a.toFixed(c):String(a),c=a.indexOf("."),-1==c&&(c=a.length),goog.string.repeat("0",Math.max(0,b-c))+a},goog.string.makeSafe=function(a){return null==a?"":String(a)},goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(String(a)).split("."),e=goog.string.trim(String(b)).split("."),f=Math.max(d.length,e.length),g=0;0==c&&f>g;g++){var h=d[g]||"",k=e[g]||"",l=RegExp("(\\d*)(\\D*)","g"),p=RegExp("(\\d*)(\\D*)","g");do{var m=l.exec(h)||["","",""],n=p.exec(k)||["","",""];if(0==m[0].length&&0==n[0].length)break;var c=0==m[1].length?0:parseInt(m[1],10),q=0==n[1].length?0:parseInt(n[1],10),c=goog.string.compareElements_(c,q)||goog.string.compareElements_(0==m[2].length,0==n[2].length)||goog.string.compareElements_(m[2],n[2])}while(0==c)}return c},goog.string.compareElements_=function(a,b){return b>a?-1:a>b?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmptyOrWhitespace(a)?0/0:b},goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)},goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)},goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})},goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";return a.replace(new RegExp("(^"+(c?"|["+c+"]+":"")+")([a-z])","g"),function(a,b,c){return b+c.toUpperCase()})},goog.string.capitalize=function(a){return String(a.charAt(0)).toUpperCase()+String(a.substr(1)).toLowerCase()},goog.string.parseInt=function(a){return isFinite(a)&&(a=String(a)),goog.isString(a)?/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):0/0},goog.string.splitLimit=function(a,b,c){a=a.split(b);for(var d=[];c>0&&a.length;)d.push(a.shift()),c--;return a.length&&d.push(a.join(b)),d},goog.string.editDistance=function(a,b){var c=[],d=[];if(a==b)return 0;if(!a.length||!b.length)return Math.max(a.length,b.length);for(var e=0;e<b.length+1;e++)c[e]=e;for(e=0;e<a.length;e++){d[0]=e+1;for(var f=0;f<b.length;f++)d[f+1]=Math.min(d[f]+1,c[f+1]+1,c[f]+(a[e]!=b[f]));for(f=0;f<c.length;f++)c[f]=d[f]}return d[b.length]},goog.asserts={},goog.asserts.ENABLE_ASSERTS=goog.DEBUG,goog.asserts.AssertionError=function(a,b){b.unshift(a),goog.debug.Error.call(this,goog.string.subs.apply(null,b)),b.shift(),this.messagePattern=a},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(a){throw a},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.doAssertFailure_=function(a,b,c,d){var e="Assertion failed";if(c)var e=e+(": "+c),f=d;else a&&(e+=": "+a,f=b);a=new goog.asserts.AssertionError(""+e,f||[]),goog.asserts.errorHandler_(a)},goog.asserts.setErrorHandler=function(a){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=a)},goog.asserts.assert=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.fail=function(a,b){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertString=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertFunction=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertObject=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertArray=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertBoolean=function(a,b,c){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertElement=function(a,b,c){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertInstanceof=function(a,b,c,d){return!goog.asserts.ENABLE_ASSERTS||a instanceof b||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(b),goog.asserts.getType_(a)],c,Array.prototype.slice.call(arguments,3)),a},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype)goog.asserts.fail(a+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(a){return a instanceof Function?a.displayName||a.name||"unknown type name":a instanceof Object?a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a):null===a?"null":typeof a},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE,goog.array.ASSUME_NATIVE_FUNCTIONS=!1,goog.array.peek=function(a){return a[a.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){if(c=null==c?0:0>c?Math.max(0,a.length+c):c,goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){if(c=null==c?a.length-1:c,0>c&&(c=Math.max(0,a.length+c)),goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;c>=0;c--)if(c in a&&a[c]===b)return c;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(a,b,c){goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)f in e&&b.call(c,e[f],f,a)},goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;d>=0;--d)d in e&&b.call(c,e[d],d,a)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;d>h;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;d>g;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(a,b,c,d){return goog.asserts.assert(null!=a.length),d&&(b=goog.bind(b,d)),goog.array.ARRAY_PROTOTYPE_.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;return goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)}),e},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(a,b,c,d){return goog.asserts.assert(null!=a.length),d&&(b=goog.bind(b,d)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(a,b,c)}:function(a,b,c,d){var e=c;return goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)}),e},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},goog.array.count=function(a,b,c){var d=0;return goog.array.forEach(a,function(a,f,g){b.call(c,a,f,g)&&++d},c),d},goog.array.find=function(a,b,c){return b=goog.array.findIndex(a,b,c),0>b?null:goog.isString(a)?a.charAt(b):a[b]},goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1},goog.array.findRight=function(a,b,c){return b=goog.array.findIndexRight(a,b,c),0>b?null:goog.isString(a)?a.charAt(b):a[b]},goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;d>=0;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1},goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)},goog.array.isEmpty=function(a){return 0==a.length},goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;b>=0;b--)delete a[b];a.length=0},goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)},goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)},goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)},goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)},goog.array.remove=function(a,b){var d,c=goog.array.indexOf(a,b);return(d=c>=0)&&goog.array.removeAt(a,c),d},goog.array.removeAt=function(a,b){return goog.asserts.assert(null!=a.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length},goog.array.removeIf=function(a,b,c){return b=goog.array.findIndex(a,b,c),b>=0?(goog.array.removeAt(a,b),!0):!1},goog.array.removeAllIf=function(a,b,c){var d=0;return goog.array.forEachRight(a,function(e,f){b.call(c,e,f,a)&&goog.array.removeAt(a,f)&&d++}),d},goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(a){var b=a.length;if(b>0){for(var c=Array(b),d=0;b>d;d++)c[d]=a[d];return c}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(goog.isArrayLike(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;f>g;g++)a[e+g]=d[g]}else a.push(d)}},goog.array.splice=function(a,b,c,d){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))},goog.array.slice=function(a,b,c){return goog.asserts.assert(null!=a.length),2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)},goog.array.removeDuplicates=function(a,b,c){b=b||a;var d=function(a){return goog.isObject(a)?"o"+goog.getUid(a):(typeof a).charAt(0)+a};c=c||d;for(var d={},e=0,f=0;f<a.length;){var g=a[f++],h=c(g);Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,b[e++]=g)}b.length=e},goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)},goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)},goog.array.binarySearch_=function(a,b,c,d,e){for(var h,f=0,g=a.length;g>f;){var l,k=f+g>>1;l=c?b.call(e,a[k],k,a):b(d,a[k]),l>0?f=k+1:(g=k,h=!l)}return h?f:~f},goog.array.sort=function(a,b){a.sort(b||goog.array.defaultCompare)},goog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;for(goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index}),c=0;c<a.length;c++)a[c]=a[c].value},goog.array.sortByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(b(a),b(c))})},goog.array.sortObjectsByKey=function(a,b,c){goog.array.sortByKey(a,function(a){return a[b]},c)},goog.array.isSorted=function(a,b,c){b=b||goog.array.defaultCompare;for(var d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(e>0||0==e&&c)return!1}return!0},goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;d>e;e++)if(!c(a[e],b[e]))return!1;return!0},goog.array.compare3=function(a,b,c){c=c||goog.array.defaultCompare;for(var d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c(a[e],b[e]);if(0!=f)return f}return goog.array.defaultCompare(a.length,b.length)},goog.array.defaultCompare=function(a,b){return a>b?1:b>a?-1:0},goog.array.inverseDefaultCompare=function(a,b){return-goog.array.defaultCompare(a,b)},goog.array.defaultCompareEquality=function(a,b){return a===b},goog.array.binaryInsert=function(a,b,c){return c=goog.array.binarySearch(a,b,c),0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1},goog.array.binaryRemove=function(a,b,c){return b=goog.array.binarySearch(a,b,c),b>=0?goog.array.removeAt(a,b):!1},goog.array.bucket=function(a,b,c){for(var d={},e=0;e<a.length;e++){var f=a[e],g=b.call(c,f,e,a);goog.isDef(g)&&(d[g]||(d[g]=[])).push(f)}return d},goog.array.toObject=function(a,b,c){var d={};return goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e}),d},goog.array.range=function(a,b,c){var d=[],e=0,f=a;if(c=c||1,void 0!==b&&(e=a,f=b),0>c*(f-e))return[];

if(c>0)for(a=e;f>a;a+=c)d.push(a);else for(a=e;a>f;a+=c)d.push(a);return d},goog.array.repeat=function(a,b){for(var c=[],d=0;b>d;d++)c[d]=a;return c},goog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];if(goog.isArray(d))for(var e=0;e<d.length;e+=8192)for(var f=goog.array.slice(d,e,e+8192),f=goog.array.flatten.apply(null,f),g=0;g<f.length;g++)b.push(f[g]);else b.push(d)}return b},goog.array.rotate=function(a,b){return goog.asserts.assert(null!=a.length),a.length&&(b%=a.length,b>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b))),a},goog.array.moveItem=function(a,b,c){goog.asserts.assert(b>=0&&b<a.length),goog.asserts.assert(c>=0&&c<a.length),b=goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1),goog.array.ARRAY_PROTOTYPE_.splice.call(a,c,0,b[0])},goog.array.zip=function(a){if(!arguments.length)return[];for(var b=[],c=0;;c++){for(var d=[],e=0;e<arguments.length;e++){var f=arguments[e];if(c>=f.length)return b;d.push(f[c])}b.push(d)}},goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;d>0;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e],a[e]=f}},goog.array.copyByIndex=function(a,b){var c=[];return goog.array.forEach(b,function(b){c.push(a[b])}),c},goog.async.WorkQueue=function(){this.workTail_=this.workHead_=null},goog.async.WorkQueue.DEFAULT_MAX_UNUSED=100,goog.async.WorkQueue.freelist_=new goog.async.FreeList(function(){return new goog.async.WorkItem},function(a){a.reset()},goog.async.WorkQueue.DEFAULT_MAX_UNUSED),goog.async.WorkQueue.prototype.add=function(a,b){var c=this.getUnusedItem_();c.set(a,b),this.workTail_?this.workTail_.next=c:(goog.asserts.assert(!this.workHead_),this.workHead_=c),this.workTail_=c},goog.async.WorkQueue.prototype.remove=function(){var a=null;return this.workHead_&&(a=this.workHead_,this.workHead_=this.workHead_.next,this.workHead_||(this.workTail_=null),a.next=null),a},goog.async.WorkQueue.prototype.returnUnused=function(a){goog.async.WorkQueue.freelist_.put(a)},goog.async.WorkQueue.prototype.getUnusedItem_=function(){return goog.async.WorkQueue.freelist_.get()},goog.async.WorkItem=function(){this.next=this.scope=this.fn=null},goog.async.WorkItem.prototype.set=function(a,b){this.fn=a,this.scope=b,this.next=null},goog.async.WorkItem.prototype.reset=function(){this.next=this.scope=this.fn=null},goog.debug.entryPointRegistry={},goog.debug.EntryPointMonitor=function(){},goog.debug.entryPointRegistry.refList_=[],goog.debug.entryPointRegistry.monitors_=[],goog.debug.entryPointRegistry.monitorsMayExist_=!1,goog.debug.entryPointRegistry.register=function(a){if(goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=a,goog.debug.entryPointRegistry.monitorsMayExist_)for(var b=goog.debug.entryPointRegistry.monitors_,c=0;c<b.length;c++)a(goog.bind(b[c].wrap,b[c]))},goog.debug.entryPointRegistry.monitorAll=function(a){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var b=goog.bind(a.wrap,a),c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](b);goog.debug.entryPointRegistry.monitors_.push(a)},goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(a){var b=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(a==b[b.length-1],"Only the most recent monitor can be unwrapped."),a=goog.bind(a.unwrap,a);for(var c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](a);b.length--},goog.dom.classlist={},goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST=!1,goog.dom.classlist.get=function(a){return goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList?a.classList:(a=a.className,goog.isString(a)&&a.match(/\S+/g)||[])},goog.dom.classlist.set=function(a,b){a.className=b},goog.dom.classlist.contains=function(a,b){return goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList?a.classList.contains(b):goog.array.contains(goog.dom.classlist.get(a),b)},goog.dom.classlist.add=function(a,b){goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList?a.classList.add(b):goog.dom.classlist.contains(a,b)||(a.className+=0<a.className.length?" "+b:b)},goog.dom.classlist.addAll=function(a,b){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList)goog.array.forEach(b,function(b){goog.dom.classlist.add(a,b)});else{var c={};goog.array.forEach(goog.dom.classlist.get(a),function(a){c[a]=!0}),goog.array.forEach(b,function(a){c[a]=!0}),a.className="";for(var d in c)a.className+=0<a.className.length?" "+d:d}},goog.dom.classlist.remove=function(a,b){goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList?a.classList.remove(b):goog.dom.classlist.contains(a,b)&&(a.className=goog.array.filter(goog.dom.classlist.get(a),function(a){return a!=b}).join(" "))},goog.dom.classlist.removeAll=function(a,b){goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList?goog.array.forEach(b,function(b){goog.dom.classlist.remove(a,b)}):a.className=goog.array.filter(goog.dom.classlist.get(a),function(a){return!goog.array.contains(b,a)}).join(" ")},goog.dom.classlist.enable=function(a,b,c){c?goog.dom.classlist.add(a,b):goog.dom.classlist.remove(a,b)},goog.dom.classlist.enableAll=function(a,b,c){(c?goog.dom.classlist.addAll:goog.dom.classlist.removeAll)(a,b)},goog.dom.classlist.swap=function(a,b,c){return goog.dom.classlist.contains(a,b)?(goog.dom.classlist.remove(a,b),goog.dom.classlist.add(a,c),!0):!1},goog.dom.classlist.toggle=function(a,b){var c=!goog.dom.classlist.contains(a,b);return goog.dom.classlist.enable(a,b,c),c},goog.dom.classlist.addRemove=function(a,b,c){goog.dom.classlist.remove(a,b),goog.dom.classlist.add(a,c)},goog.events.ListenerMap=function(a){this.src=a,this.listeners={},this.typeCount_=0},goog.events.ListenerMap.prototype.getTypeCount=function(){return this.typeCount_},goog.events.ListenerMap.prototype.getListenerCount=function(){var b,a=0;for(b in this.listeners)a+=this.listeners[b].length;return a},goog.events.ListenerMap.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.listeners[f],a||(a=this.listeners[f]=[],this.typeCount_++);var g=goog.events.ListenerMap.findListenerIndex_(a,b,d,e);return g>-1?(b=a[g],c||(b.callOnce=!1)):(b=new goog.events.Listener(b,null,this.src,f,!!d,e),b.callOnce=c,a.push(b)),b},goog.events.ListenerMap.prototype.remove=function(a,b,c,d){if(a=a.toString(),!(a in this.listeners))return!1;var e=this.listeners[a];return b=goog.events.ListenerMap.findListenerIndex_(e,b,c,d),b>-1?(e[b].markAsRemoved(),goog.array.removeAt(e,b),0==e.length&&(delete this.listeners[a],this.typeCount_--),!0):!1},goog.events.ListenerMap.prototype.removeByKey=function(a){var b=a.type;if(!(b in this.listeners))return!1;var c=goog.array.remove(this.listeners[b],a);return c&&(a.markAsRemoved(),0==this.listeners[b].length&&(delete this.listeners[b],this.typeCount_--)),c},goog.events.ListenerMap.prototype.removeAll=function(a){a=a&&a.toString();var c,b=0;for(c in this.listeners)if(!a||c==a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,d[e].markAsRemoved();delete this.listeners[c],this.typeCount_--}return b},goog.events.ListenerMap.prototype.getListeners=function(a,b){var c=this.listeners[a.toString()],d=[];if(c)for(var e=0;e<c.length;++e){var f=c[e];f.capture==b&&d.push(f)}return d},goog.events.ListenerMap.prototype.getListener=function(a,b,c,d){a=this.listeners[a.toString()];var e=-1;return a&&(e=goog.events.ListenerMap.findListenerIndex_(a,b,c,d)),e>-1?a[e]:null},goog.events.ListenerMap.prototype.hasListener=function(a,b){var c=goog.isDef(a),d=c?a.toString():"",e=goog.isDef(b);return goog.object.some(this.listeners,function(a,g){for(var h=0;h<a.length;++h)if(!(c&&a[h].type!=d||e&&a[h].capture!=b))return!0;return!1})},goog.events.ListenerMap.findListenerIndex_=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener==b&&f.capture==!!c&&f.handler==d)return e}return-1},goog.labs={},goog.labs.userAgent={},goog.labs.userAgent.util={},goog.labs.userAgent.util.getNativeUserAgentString_=function(){var a=goog.labs.userAgent.util.getNavigator_();return a&&(a=a.userAgent)?a:""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(a){goog.labs.userAgent.util.userAgent_=a||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(b,a)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(b,a)},goog.labs.userAgent.util.extractVersionTuples=function(a){for(var d,b=RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),c=[];d=b.exec(a);)c.push([d[1],d[2],d[3]||void 0]);return c},goog.labs.userAgent.browser={},goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchEdge_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchEdge_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchOpera_()&&!goog.labs.userAgent.browser.matchEdge_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isEdge=goog.labs.userAgent.browser.matchEdge_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function a(a){return a=goog.array.find(a,d),c[a]||""}var b=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(b);var b=goog.labs.userAgent.util.extractVersionTuples(b),c={};goog.array.forEach(b,function(a){c[a[0]]=a[1]});var d=goog.partial(goog.object.containsKey,c);return goog.labs.userAgent.browser.isOpera()?a(["Version","Opera","OPR"]):goog.labs.userAgent.browser.isEdge()?a(["Edge"]):goog.labs.userAgent.browser.isChrome()?a(["Chrome","CriOS"]):(b=b[2])&&b[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),a)},goog.labs.userAgent.browser.getIEVersion_=function(a){var b=/rv: *([\d\.]*)/.exec(a);if(b&&b[1])return b[1];var b="",c=/MSIE +([\d\.]+)/.exec(a);if(c&&c[1])if(a=/Trident\/(\d.\d)/.exec(a),"7.0"==c[1])if(a&&a[1])switch(a[1]){case"4.0":b="8.0";break;case"5.0":b="9.0";break;case"6.0":b="10.0";break;case"7.0":b="11.0"}else b="7.0";else b=c[1];return b},goog.labs.userAgent.device={},goog.labs.userAgent.device.isMobile=function(){return!goog.labs.userAgent.device.isTablet()&&(goog.labs.userAgent.util.matchUserAgent("iPod")||goog.labs.userAgent.util.matchUserAgent("iPhone")||goog.labs.userAgent.util.matchUserAgent("Android")||goog.labs.userAgent.util.matchUserAgent("IEMobile"))},goog.labs.userAgent.device.isTablet=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("Android")&&!goog.labs.userAgent.util.matchUserAgent("Mobile")||goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.device.isDesktop=function(){return!goog.labs.userAgent.device.isMobile()&&!goog.labs.userAgent.device.isTablet()},goog.labs.userAgent.engine={},goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent();if(a){var a=goog.labs.userAgent.util.extractVersionTuples(a),b=goog.labs.userAgent.engine.getEngineTuple_(a);if(b)return"Gecko"==b[0]?goog.labs.userAgent.engine.getVersionForKey_(a,"Firefox"):b[1];var c,a=a[0];if(a&&(c=a[2])&&(c=/Trident\/([^\s;]+)/.exec(c)))return c[1]}return""},goog.labs.userAgent.engine.getEngineTuple_=function(a){if(!goog.labs.userAgent.engine.isEdge())return a[1];for(var b=0;b<a.length;b++){var c=a[b];if("Edge"==c[0])return c}},goog.labs.userAgent.engine.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),a)},goog.labs.userAgent.engine.getVersionForKey_=function(a,b){var c=goog.array.find(a,function(a){return b==a[0]});return c&&c[1]||""},goog.async.throwException=function(a){goog.global.setTimeout(function(){throw a},0)},goog.async.nextTick=function(a,b,c){var d=a;b&&(d=goog.bind(a,b)),d=goog.async.nextTick.wrapCallback_(d),!goog.isFunction(goog.global.setImmediate)||!c&&goog.global.Window&&goog.global.Window.prototype&&goog.global.Window.prototype.setImmediate==goog.global.setImmediate?(goog.async.nextTick.setImmediate_||(goog.async.nextTick.setImmediate_=goog.async.nextTick.getSetImmediateEmulator_()),goog.async.nextTick.setImmediate_(d)):goog.global.setImmediate(d)},goog.async.nextTick.getSetImmediateEmulator_=function(){var a=goog.global.MessageChannel;if("undefined"==typeof a&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!goog.labs.userAgent.engine.isPresto()&&(a=function(){var a=document.createElement(goog.dom.TagName.IFRAME);a.style.display="none",a.src="",document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open(),a.write(""),a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=goog.bind(function(a){"*"!=d&&a.origin!=d||a.data!=c||this.port1.onmessage()},this);b.addEventListener("message",a,!1),this.port1={},this.port2={postMessage:function(){b.postMessage(c,d)}}}),"undefined"!=typeof a&&!goog.labs.userAgent.browser.isIE()){var b=new a,c={},d=c;return b.port1.onmessage=function(){if(goog.isDef(c.next)){c=c.next;var a=c.cb;c.cb=null,a()}},function(a){d.next={cb:a},d=d.next,b.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement(goog.dom.TagName.SCRIPT)?function(a){var b=document.createElement(goog.dom.TagName.SCRIPT);b.onreadystatechange=function(){b.onreadystatechange=null,b.parentNode.removeChild(b),b=null,a(),a=null},document.documentElement.appendChild(b)}:function(a){goog.global.setTimeout(a,0)}},goog.async.nextTick.wrapCallback_=goog.functions.identity,goog.debug.entryPointRegistry.register(function(a){goog.async.nextTick.wrapCallback_=a}),goog.labs.userAgent.platform={},goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent(),b="";return goog.labs.userAgent.platform.isWindows()?(b=/Windows (?:NT|Phone) ([0-9.]+)/,b=(a=b.exec(a))?a[1]:"0.0"):goog.labs.userAgent.platform.isIos()?(b=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/,b=(a=b.exec(a))&&a[1].replace(/_/g,".")):goog.labs.userAgent.platform.isMacintosh()?(b=/Mac OS X ([0-9_.]+)/,b=(a=b.exec(a))?a[1].replace(/_/g,"."):"10"):goog.labs.userAgent.platform.isAndroid()?(b=/Android\s+([^\);]+)(\)|;)/,b=(a=b.exec(a))&&a[1]):goog.labs.userAgent.platform.isChromeOS()&&(b=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/,b=(a=b.exec(a))&&a[1]),b||""},goog.labs.userAgent.platform.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),a)},goog.math.randomInt=function(a){return Math.floor(Math.random()*a)},goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)},goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c},goog.math.lerp=function(a,b,c){return a+c*(b-a)},goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1e-6)},goog.math.standardAngle=function(a){return goog.math.modulo(a,360)},goog.math.standardAngleInRadians=function(a){return goog.math.modulo(a,2*Math.PI)},goog.math.toRadians=function(a){return a*Math.PI/180},goog.math.toDegrees=function(a){return 180*a/Math.PI},goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))},goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))},goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))},goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);return c>180?c-=360:-180>=c&&(c=360+c),c},goog.math.sign=Math.sign||function(a){return a>0?1:0>a?-1:a},goog.math.longestCommonSubsequence=function(a,b,c,d){c=c||function(a,b){return a==b},d=d||function(b,c){return a[b]};for(var e=a.length,f=b.length,g=[],h=0;e+1>h;h++)g[h]=[],g[h][0]=0;for(var k=0;f+1>k;k++)g[0][k]=0;for(h=1;e>=h;h++)for(k=1;f>=k;k++)g[h][k]=c(a[h-1],b[k-1])?g[h-1][k-1]+1:Math.max(g[h-1][k],g[h][k-1]);for(var l=[],h=e,k=f;h>0&&k>0;)c(a[h-1],b[k-1])?(l.unshift(d(h-1,k-1)),h--,k--):g[h-1][k]>g[h][k-1]?h--:k--;return l},goog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)},goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length},goog.math.sampleVariance=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments);return goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1)},goog.math.standardDeviation=function(a){return Math.sqrt(goog.math.sampleVariance.apply(null,arguments))},goog.math.isInt=function(a){return isFinite(a)&&0==a%1},goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)},goog.math.isNegativeZero=function(a){return 0==a&&0>1/a},goog.math.log10Floor=function(a){if(a>0){var b=Math.round(Math.log(a)*Math.LOG10E);return b-(parseFloat("1e"+b)>a)}return 0==a?-(1/0):0/0},goog.math.safeFloor=function(a,b){return goog.asserts.assert(!goog.isDef(b)||b>0),Math.floor(a+(b||2e-15))},goog.math.safeCeil=function(a,b){return goog.asserts.assert(!goog.isDef(b)||b>0),Math.ceil(a-(b||2e-15))},goog.iter={},goog.iter.StopIteration="StopIteration"in goog.global?goog.global.StopIteration:{message:"StopIteration",stack:""},goog.iter.Iterator=function(){},goog.iter.Iterator.prototype.next=function(){throw goog.iter.StopIteration},goog.iter.Iterator.prototype.__iterator__=function(a){return this},goog.iter.toIterator=function(a){if(a instanceof goog.iter.Iterator)return a;if("function"==typeof a.__iterator__)return a.__iterator__(!1);if(goog.isArrayLike(a)){var b=0,c=new goog.iter.Iterator;return c.next=function(){for(;;){if(b>=a.length)throw goog.iter.StopIteration;if(b in a)return a[b++];b++}},c}throw Error("Not implemented")},goog.iter.forEach=function(a,b,c){if(goog.isArrayLike(a))try{goog.array.forEach(a,b,c)}catch(d){if(d!==goog.iter.StopIteration)throw d}else{a=goog.iter.toIterator(a);try{for(;;)b.call(c,a.next(),void 0,a)}catch(e){if(e!==goog.iter.StopIteration)throw e}}},goog.iter.filter=function(a,b,c){var d=goog.iter.toIterator(a);return a=new goog.iter.Iterator,a.next=function(){for(;;){var a=d.next();if(b.call(c,a,void 0,d))return a}},a},goog.iter.filterFalse=function(a,b,c){return goog.iter.filter(a,goog.functions.not(b),c)},goog.iter.range=function(a,b,c){var d=0,e=a,f=c||1;if(1<arguments.length&&(d=a,e=b),0==f)throw Error("Range step argument must not be zero");var g=new goog.iter.Iterator;return g.next=function(){if(f>0&&d>=e||0>f&&e>=d)throw goog.iter.StopIteration;var a=d;return d+=f,a},g},goog.iter.join=function(a,b){return goog.iter.toArray(a).join(b)},goog.iter.map=function(a,b,c){var d=goog.iter.toIterator(a);return a=new goog.iter.Iterator,a.next=function(){var a=d.next();return b.call(c,a,void 0,d)},a},goog.iter.reduce=function(a,b,c,d){var e=c;return goog.iter.forEach(a,function(a){e=b.call(d,e,a)}),e},goog.iter.some=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(b.call(c,a.next(),void 0,a))return!0}catch(d){if(d!==goog.iter.StopIteration)throw d}return!1},goog.iter.every=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(!b.call(c,a.next(),void 0,a))return!1}catch(d){if(d!==goog.iter.StopIteration)throw d}return!0},goog.iter.chain=function(a){return goog.iter.chainFromIterable(arguments)},goog.iter.chainFromIterable=function(a){var b=goog.iter.toIterator(a);a=new goog.iter.Iterator;var c=null;return a.next=function(){for(;;){if(null==c){var a=b.next();c=goog.iter.toIterator(a)}try{return c.next()}catch(e){if(e!==goog.iter.StopIteration)throw e;c=null}}},a},goog.iter.dropWhile=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;var e=!0;return a.next=function(){for(;;){var a=d.next();if(!e||!b.call(c,a,void 0,d))return e=!1,a}},a},goog.iter.takeWhile=function(a,b,c){var d=goog.iter.toIterator(a);return a=new goog.iter.Iterator,a.next=function(){var a=d.next();if(b.call(c,a,void 0,d))return a;throw goog.iter.StopIteration},a},goog.iter.toArray=function(a){if(goog.isArrayLike(a))return goog.array.toArray(a);a=goog.iter.toIterator(a);var b=[];return goog.iter.forEach(a,function(a){b.push(a)}),b},goog.iter.equals=function(a,b,c){a=goog.iter.zipLongest({},a,b);var d=c||goog.array.defaultCompareEquality;return goog.iter.every(a,function(a){return d(a[0],a[1])})},goog.iter.nextOrValue=function(a,b){try{return goog.iter.toIterator(a).next()}catch(c){if(c!=goog.iter.StopIteration)throw c;return b}},goog.iter.product=function(a){if(goog.array.some(arguments,function(a){return!a.length})||!arguments.length)return new goog.iter.Iterator;var b=new goog.iter.Iterator,c=arguments,d=goog.array.repeat(0,c.length);return b.next=function(){if(d){for(var a=goog.array.map(d,function(a,b){return c[b][a]}),b=d.length-1;b>=0;b--){if(goog.asserts.assert(d),d[b]<c[b].length-1){d[b]++;break}if(0==b){d=null;break}d[b]=0}return a}throw goog.iter.StopIteration},b},goog.iter.cycle=function(a){var b=goog.iter.toIterator(a),c=[],d=0;a=new goog.iter.Iterator;var e=!1;return a.next=function(){var a=null;if(!e)try{return a=b.next(),c.push(a),a}catch(g){if(g!=goog.iter.StopIteration||goog.array.isEmpty(c))throw g;e=!0}return a=c[d],d=(d+1)%c.length,a},a},goog.iter.count=function(a,b){var c=a||0,d=goog.isDef(b)?b:1,e=new goog.iter.Iterator;return e.next=function(){var a=c;return c+=d,a},e},goog.iter.repeat=function(a){var b=new goog.iter.Iterator;return b.next=goog.functions.constant(a),b},goog.iter.accumulate=function(a){var b=goog.iter.toIterator(a),c=0;return a=new goog.iter.Iterator,a.next=function(){return c+=b.next()},a},goog.iter.zip=function(a){var b=arguments,c=new goog.iter.Iterator;if(0<b.length){var d=goog.array.map(b,goog.iter.toIterator);c.next=function(){return goog.array.map(d,function(a){return a.next()})}}return c},goog.iter.zipLongest=function(a,b){var c=goog.array.slice(arguments,1),d=new goog.iter.Iterator;if(0<c.length){var e=goog.array.map(c,goog.iter.toIterator);d.next=function(){var b=!1,c=goog.array.map(e,function(c){var d;try{d=c.next(),b=!0}catch(e){if(e!==goog.iter.StopIteration)throw e;d=a}return d});if(!b)throw goog.iter.StopIteration;return c}}return d},goog.iter.compress=function(a,b){var c=goog.iter.toIterator(b);return goog.iter.filter(a,function(){return!!c.next()})},goog.iter.GroupByIterator_=function(a,b){this.iterator=goog.iter.toIterator(a),this.keyFunc=b||goog.functions.identity},goog.inherits(goog.iter.GroupByIterator_,goog.iter.Iterator),goog.iter.GroupByIterator_.prototype.next=function(){for(;this.currentKey==this.targetKey;)this.currentValue=this.iterator.next(),this.currentKey=this.keyFunc(this.currentValue);return this.targetKey=this.currentKey,[this.currentKey,this.groupItems_(this.targetKey)]},goog.iter.GroupByIterator_.prototype.groupItems_=function(a){for(var b=[];this.currentKey==a;){b.push(this.currentValue);try{this.currentValue=this.iterator.next()}catch(c){if(c!==goog.iter.StopIteration)throw c;break}this.currentKey=this.keyFunc(this.currentValue)}return b},goog.iter.groupBy=function(a,b){return new goog.iter.GroupByIterator_(a,b)},goog.iter.starMap=function(a,b,c){var d=goog.iter.toIterator(a);return a=new goog.iter.Iterator,a.next=function(){var a=goog.iter.toArray(d.next());return b.apply(c,goog.array.concat(a,void 0,d))},a},goog.iter.tee=function(a,b){var c=goog.iter.toIterator(a),d=goog.isNumber(b)?b:2,e=goog.array.map(goog.array.range(d),function(){return[]}),f=function(){var a=c.next();goog.array.forEach(e,function(b){b.push(a)})};return goog.array.map(e,function(a){var b=new goog.iter.Iterator;return b.next=function(){return goog.array.isEmpty(a)&&f(),goog.asserts.assert(!goog.array.isEmpty(a)),a.shift()},b})},goog.iter.enumerate=function(a,b){return goog.iter.zip(goog.iter.count(b),a)},goog.iter.limit=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&b>=0);var c=goog.iter.toIterator(a),d=new goog.iter.Iterator,e=b;return d.next=function(){if(0<e--)return c.next();throw goog.iter.StopIteration},d},goog.iter.consume=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&b>=0);for(var c=goog.iter.toIterator(a);0<b--;)goog.iter.nextOrValue(c,null);return c},goog.iter.slice=function(a,b,c){return goog.asserts.assert(goog.math.isInt(b)&&b>=0),a=goog.iter.consume(a,b),goog.isNumber(c)&&(goog.asserts.assert(goog.math.isInt(c)&&c>=b),a=goog.iter.limit(a,c-b)),a},goog.iter.hasDuplicates_=function(a){var b=[];return goog.array.removeDuplicates(a,b),a.length!=b.length},goog.iter.permutations=function(a,b){var c=goog.iter.toArray(a),d=goog.isNumber(b)?b:c.length,c=goog.array.repeat(c,d),c=goog.iter.product.apply(void 0,c);return goog.iter.filter(c,function(a){return!goog.iter.hasDuplicates_(a)})},goog.iter.combinations=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.iter.range(d.length),e=goog.iter.permutations(e,b),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;return e.next=function(){return goog.array.map(f.next(),c)},e},goog.iter.combinationsWithReplacement=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.array.range(d.length),e=goog.array.repeat(e,b),e=goog.iter.product.apply(void 0,e),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;return e.next=function(){return goog.array.map(f.next(),c)},e},goog.math.Coordinate=function(a,b){this.x=goog.isDef(a)?a:0,this.y=goog.isDef(b)?b:0},goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)},goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"}),goog.math.Coordinate.equals=function(a,b){return a==b?!0:a&&b?a.x==b.x&&a.y==b.y:!1},goog.math.Coordinate.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},goog.math.Coordinate.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},goog.math.Coordinate.azimuth=function(a){return goog.math.angle(0,0,a.x,a.y)},goog.math.Coordinate.squaredDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},goog.math.Coordinate.difference=function(a,b){return new goog.math.Coordinate(a.x-b.x,a.y-b.y)},goog.math.Coordinate.sum=function(a,b){return new goog.math.Coordinate(a.x+b.x,a.y+b.y)},goog.math.Coordinate.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},goog.math.Coordinate.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},goog.math.Coordinate.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},goog.math.Coordinate.prototype.translate=function(a,b){return a instanceof goog.math.Coordinate?(this.x+=a.x,this.y+=a.y):(this.x+=a,goog.isNumber(b)&&(this.y+=b)),this},goog.math.Coordinate.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;return this.x*=a,this.y*=c,this},goog.math.Coordinate.prototype.rotateRadians=function(a,b){var c=b||new goog.math.Coordinate(0,0),d=this.x,e=this.y,f=Math.cos(a),g=Math.sin(a);this.x=(d-c.x)*f-(e-c.y)*g+c.x,this.y=(d-c.x)*g+(e-c.y)*f+c.y},goog.math.Coordinate.prototype.rotateDegrees=function(a,b){this.rotateRadians(goog.math.toRadians(a),b)},goog.math.Box=function(a,b,c,d){this.top=a,this.right=b,this.bottom=c,this.left=d},goog.math.Box.boundingBox=function(a){for(var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),c=1;c<arguments.length;c++){var d=arguments[c];b.top=Math.min(b.top,d.y),b.right=Math.max(b.right,d.x),b.bottom=Math.max(b.bottom,d.y),
b.left=Math.min(b.left,d.x)}return b},goog.math.Box.prototype.getWidth=function(){return this.right-this.left},goog.math.Box.prototype.getHeight=function(){return this.bottom-this.top},goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)},goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"}),goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)},goog.math.Box.prototype.expand=function(a,b,c,d){return goog.isObject(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=b,this.bottom+=c,this.left-=d),this},goog.math.Box.prototype.expandToInclude=function(a){this.left=Math.min(this.left,a.left),this.top=Math.min(this.top,a.top),this.right=Math.max(this.right,a.right),this.bottom=Math.max(this.bottom,a.bottom)},goog.math.Box.equals=function(a,b){return a==b?!0:a&&b?a.top==b.top&&a.right==b.right&&a.bottom==b.bottom&&a.left==b.left:!1},goog.math.Box.contains=function(a,b){return a&&b?b instanceof goog.math.Box?b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom:b.x>=a.left&&b.x<=a.right&&b.y>=a.top&&b.y<=a.bottom:!1},goog.math.Box.relativePositionX=function(a,b){return b.x<a.left?b.x-a.left:b.x>a.right?b.x-a.right:0},goog.math.Box.relativePositionY=function(a,b){return b.y<a.top?b.y-a.top:b.y>a.bottom?b.y-a.bottom:0},goog.math.Box.distance=function(a,b){var c=goog.math.Box.relativePositionX(a,b),d=goog.math.Box.relativePositionY(a,b);return Math.sqrt(c*c+d*d)},goog.math.Box.intersects=function(a,b){return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom},goog.math.Box.intersectsWithPadding=function(a,b,c){return a.left<=b.right+c&&b.left<=a.right+c&&a.top<=b.bottom+c&&b.top<=a.bottom+c},goog.math.Box.prototype.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},goog.math.Box.prototype.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},goog.math.Box.prototype.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this},goog.math.Box.prototype.translate=function(a,b){return a instanceof goog.math.Coordinate?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,goog.isNumber(b)&&(this.top+=b,this.bottom+=b)),this},goog.math.Box.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;return this.left*=a,this.right*=a,this.top*=c,this.bottom*=c,this},goog.math.Rect=function(a,b,c,d){this.left=a,this.top=b,this.width=c,this.height=d},goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)},goog.math.Rect.prototype.toBox=function(){return new goog.math.Box(this.top,this.left+this.width,this.top+this.height,this.left)},goog.math.Rect.createFromPositionAndSize=function(a,b){return new goog.math.Rect(a.x,a.y,b.width,b.height)},goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)},goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"}),goog.math.Rect.equals=function(a,b){return a==b?!0:a&&b?a.left==b.left&&a.width==b.width&&a.top==b.top&&a.height==b.height:!1},goog.math.Rect.prototype.intersection=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(c>=b){var d=Math.max(this.top,a.top);if(a=Math.min(this.top+this.height,a.top+a.height),a>=d)return this.left=b,this.top=d,this.width=c-b,this.height=a-d,!0}return!1},goog.math.Rect.intersection=function(a,b){var c=Math.max(a.left,b.left),d=Math.min(a.left+a.width,b.left+b.width);if(d>=c){var e=Math.max(a.top,b.top),f=Math.min(a.top+a.height,b.top+b.height);if(f>=e)return new goog.math.Rect(c,e,d-c,f-e)}return null},goog.math.Rect.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height},goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)},goog.math.Rect.difference=function(a,b){var c=goog.math.Rect.intersection(a,b);if(!c||!c.height||!c.width)return[a.clone()];var c=[],d=a.top,e=a.height,f=a.left+a.width,g=a.top+a.height,h=b.left+b.width,k=b.top+b.height;return b.top>a.top&&(c.push(new goog.math.Rect(a.left,a.top,a.width,b.top-a.top)),d=b.top,e-=b.top-a.top),g>k&&(c.push(new goog.math.Rect(a.left,k,a.width,g-k)),e=k-d),b.left>a.left&&c.push(new goog.math.Rect(a.left,d,b.left-a.left,e)),f>h&&c.push(new goog.math.Rect(h,d,f-h,e)),c},goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)},goog.math.Rect.prototype.boundingRect=function(a){var b=Math.max(this.left+this.width,a.left+a.width),c=Math.max(this.top+this.height,a.top+a.height);this.left=Math.min(this.left,a.left),this.top=Math.min(this.top,a.top),this.width=b-this.left,this.height=c-this.top},goog.math.Rect.boundingRect=function(a,b){if(!a||!b)return null;var c=a.clone();return c.boundingRect(b),c},goog.math.Rect.prototype.contains=function(a){return a instanceof goog.math.Rect?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height},goog.math.Rect.prototype.squaredDistance=function(a){var b=a.x<this.left?this.left-a.x:Math.max(a.x-(this.left+this.width),0);return a=a.y<this.top?this.top-a.y:Math.max(a.y-(this.top+this.height),0),b*b+a*a},goog.math.Rect.prototype.distance=function(a){return Math.sqrt(this.squaredDistance(a))},goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)},goog.math.Rect.prototype.getTopLeft=function(){return new goog.math.Coordinate(this.left,this.top)},goog.math.Rect.prototype.getCenter=function(){return new goog.math.Coordinate(this.left+this.width/2,this.top+this.height/2)},goog.math.Rect.prototype.getBottomRight=function(){return new goog.math.Coordinate(this.left+this.width,this.top+this.height)},goog.math.Rect.prototype.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},goog.math.Rect.prototype.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},goog.math.Rect.prototype.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this},goog.math.Rect.prototype.translate=function(a,b){return a instanceof goog.math.Coordinate?(this.left+=a.x,this.top+=a.y):(this.left+=a,goog.isNumber(b)&&(this.top+=b)),this},goog.math.Rect.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;return this.left*=a,this.width*=a,this.top*=c,this.height*=c,this},goog.pubsub={},goog.pubsub.PubSub=function(){goog.Disposable.call(this),this.key_=1,this.pendingKeys_=[],this.publishDepth_=0,this.subscriptions_=[],this.topics_={}},goog.inherits(goog.pubsub.PubSub,goog.Disposable),goog.pubsub.PubSub.prototype.subscribe=function(a,b,c){var d=this.topics_[a];d||(d=this.topics_[a]=[]);var e=this.key_;return this.subscriptions_[e]=a,this.subscriptions_[e+1]=b,this.subscriptions_[e+2]=c,this.key_=e+3,d.push(e),e},goog.pubsub.PubSub.prototype.subscribeOnce=function(a,b,c){var d=this.subscribe(a,function(a){b.apply(c,arguments),this.unsubscribeByKey(d)},this);return d},goog.pubsub.PubSub.prototype.unsubscribe=function(a,b,c){if(a=this.topics_[a]){var d=this.subscriptions_;if(a=goog.array.find(a,function(a){return d[a+1]==b&&d[a+2]==c}))return this.unsubscribeByKey(a)}return!1},goog.pubsub.PubSub.prototype.unsubscribeByKey=function(a){if(0!=this.publishDepth_)return this.pendingKeys_.push(a),!1;var b=this.subscriptions_[a];if(b){var c=this.topics_[b];c&&goog.array.remove(c,a),delete this.subscriptions_[a],delete this.subscriptions_[a+1],delete this.subscriptions_[a+2]}return!!b},goog.pubsub.PubSub.prototype.publish=function(a,b){var c=this.topics_[a];if(c){this.publishDepth_++;for(var d=Array(arguments.length-1),e=1,f=arguments.length;f>e;e++)d[e-1]=arguments[e];for(e=0,f=c.length;f>e;e++){var g=c[e];this.subscriptions_[g+1].apply(this.subscriptions_[g+2],d)}if(this.publishDepth_--,0<this.pendingKeys_.length&&0==this.publishDepth_)for(;c=this.pendingKeys_.pop();)this.unsubscribeByKey(c);return 0!=e}return!1},goog.pubsub.PubSub.prototype.clear=function(a){if(a){var b=this.topics_[a];b&&(goog.array.forEach(b,this.unsubscribeByKey,this),delete this.topics_[a])}else this.subscriptions_.length=0,this.topics_={}},goog.pubsub.PubSub.prototype.getCount=function(a){if(a){var b=this.topics_[a];return b?b.length:0}a=0;for(b in this.topics_)a+=this.getCount(b);return a},goog.pubsub.PubSub.prototype.disposeInternal=function(){goog.pubsub.PubSub.superClass_.disposeInternal.call(this),this.clear(),this.pendingKeys_.length=0},goog.string.TypedString=function(){},goog.string.Const=function(){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_="",this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_},goog.string.Const.prototype.implementsGoogStringTypedString=!0,goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_},goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"},goog.string.Const.unwrap=function(a){return a instanceof goog.string.Const&&a.constructor===goog.string.Const&&a.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_?a.stringConstValueWithSecurityContract__googStringSecurityPrivate_:(goog.asserts.fail("expected object of type Const, got '"+a+"'"),"type_error:Const")},goog.string.Const.from=function(a){return goog.string.Const.create__googStringSecurityPrivate_(a)},goog.string.Const.TYPE_MARKER_={},goog.string.Const.create__googStringSecurityPrivate_=function(a){var b=new goog.string.Const;return b.stringConstValueWithSecurityContract__googStringSecurityPrivate_=a,b},goog.html={},goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="",this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyle.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyle.fromConstant=function(a){return a=goog.string.Const.unwrap(a),0===a.length?goog.html.SafeStyle.EMPTY:(goog.html.SafeStyle.checkStyle_(a),goog.asserts.assert(goog.string.endsWith(a,";"),"Last character of style string is not ';': "+a),goog.asserts.assert(goog.string.contains(a,":"),"Style string must contain at least one ':', to specify a \"name: value\" pair: "+a),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a))},goog.html.SafeStyle.checkStyle_=function(a){goog.asserts.assert(!/[<>]/.test(a),"Forbidden characters in style string: "+a)},goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_},goog.DEBUG&&(goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"}),goog.html.SafeStyle.unwrap=function(a){return a instanceof goog.html.SafeStyle&&a.constructor===goog.html.SafeStyle&&a.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?a.privateDoNotAccessOrElseSafeStyleWrappedValue_:(goog.asserts.fail("expected object of type SafeStyle, got '"+a+"'"),"type_error:SafeStyle")},goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(a){return(new goog.html.SafeStyle).initSecurityPrivateDoNotAccessOrElse_(a)},goog.html.SafeStyle.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_=a,this},goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(""),goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez",goog.html.SafeStyle.create=function(a){var c,b="";for(c in a){if(!/^[-_a-zA-Z0-9]+$/.test(c))throw Error("Name allows only [-_a-zA-Z0-9], got: "+c);var d=a[c];null!=d&&(d instanceof goog.string.Const?(d=goog.string.Const.unwrap(d),goog.asserts.assert(!/[{;}]/.test(d),"Value does not allow [{;}].")):goog.html.SafeStyle.VALUE_RE_.test(d)?goog.html.SafeStyle.hasBalancedQuotes_(d)||(goog.asserts.fail("String value requires balanced quotes, got: "+d),d=goog.html.SafeStyle.INNOCUOUS_STRING):(goog.asserts.fail("String value allows only [-,.\"'%_!# a-zA-Z0-9], got: "+d),d=goog.html.SafeStyle.INNOCUOUS_STRING),b+=c+":"+d+";")}return b?(goog.html.SafeStyle.checkStyle_(b),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)):goog.html.SafeStyle.EMPTY},goog.html.SafeStyle.hasBalancedQuotes_=function(a){for(var b=!0,c=!0,d=0;d<a.length;d++){var e=a.charAt(d);"'"==e&&c?b=!b:'"'==e&&b&&(c=!c)}return b&&c},goog.html.SafeStyle.VALUE_RE_=/^[-,."'%_!# a-zA-Z0-9]+$/,goog.html.SafeStyle.concat=function(a){var b="",c=function(a){goog.isArray(a)?goog.array.forEach(a,c):b+=goog.html.SafeStyle.unwrap(a)};return goog.array.forEach(arguments,c),b?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b):goog.html.SafeStyle.EMPTY},goog.html.SafeStyleSheet=function(){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_="",this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyleSheet.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyleSheet.concat=function(a){var b="",c=function(a){goog.isArray(a)?goog.array.forEach(a,c):b+=goog.html.SafeStyleSheet.unwrap(a)};return goog.array.forEach(arguments,c),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(b)},goog.html.SafeStyleSheet.fromConstant=function(a){return a=goog.string.Const.unwrap(a),0===a.length?goog.html.SafeStyleSheet.EMPTY:(goog.asserts.assert(!goog.string.contains(a,"<"),"Forbidden '<' character in style sheet string: "+a),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(a))},goog.html.SafeStyleSheet.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_},goog.DEBUG&&(goog.html.SafeStyleSheet.prototype.toString=function(){return"SafeStyleSheet{"+this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_+"}"}),goog.html.SafeStyleSheet.unwrap=function(a){return a instanceof goog.html.SafeStyleSheet&&a.constructor===goog.html.SafeStyleSheet&&a.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?a.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_:(goog.asserts.fail("expected object of type SafeStyleSheet, got '"+a+"'"),"type_error:SafeStyleSheet")},goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse=function(a){return(new goog.html.SafeStyleSheet).initSecurityPrivateDoNotAccessOrElse_(a)},goog.html.SafeStyleSheet.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_=a,this},goog.html.SafeStyleSheet.EMPTY=goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(""),goog.html.SafeUrl=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="",this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez",goog.html.SafeUrl.prototype.implementsGoogStringTypedString=!0,goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_},goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.DEBUG&&(goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}),goog.html.SafeUrl.unwrap=function(a){return a instanceof goog.html.SafeUrl&&a.constructor===goog.html.SafeUrl&&a.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?a.privateDoNotAccessOrElseSafeHtmlWrappedValue_:(goog.asserts.fail("expected object of type SafeUrl, got '"+a+"'"),"type_error:SafeUrl")},goog.html.SafeUrl.fromConstant=function(a){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))},goog.html.SAFE_MIME_TYPE_PATTERN_=/^(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm))$/i,goog.html.SafeUrl.fromBlob=function(a){return a=goog.html.SAFE_MIME_TYPE_PATTERN_.test(a.type)?goog.fs.url.createObjectUrl(a):goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)},goog.html.DATA_URL_PATTERN_=/^data:([^;,]*);base64,[a-z0-9+\/]+=*$/i,goog.html.SafeUrl.fromDataUrl=function(a){var b=a.match(goog.html.DATA_URL_PATTERN_),b=b&&goog.html.SAFE_MIME_TYPE_PATTERN_.test(b[1]);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(b?a:goog.html.SafeUrl.INNOCUOUS_STRING)},goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto|ftp):|[^&:\/?#]*(?:[\/?#]|$))/i,goog.html.SafeUrl.sanitize=function(a){return a instanceof goog.html.SafeUrl?a:(a=a.implementsGoogStringTypedString?a.getTypedStringValue():String(a),goog.html.SAFE_URL_PATTERN_.test(a)||(a=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a))},goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.SafeUrl;return b.privateDoNotAccessOrElseSafeHtmlWrappedValue_=a,b},goog.html.TrustedResourceUrl=function(){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_="",this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=!0,goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_},goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.DEBUG&&(goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"}),goog.html.TrustedResourceUrl.unwrap=function(a){return a instanceof goog.html.TrustedResourceUrl&&a.constructor===goog.html.TrustedResourceUrl&&a.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?a.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_:(goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+a+"'"),"type_error:TrustedResourceUrl")},goog.html.TrustedResourceUrl.fromConstant=function(a){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))},goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.TrustedResourceUrl;return b.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=a,b},goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="",this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_,this.dir_=null},goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_},goog.html.SafeHtml.prototype.implementsGoogStringTypedString=!0,goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_},goog.DEBUG&&(goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}),goog.html.SafeHtml.unwrap=function(a){return a instanceof goog.html.SafeHtml&&a.constructor===goog.html.SafeHtml&&a.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?a.privateDoNotAccessOrElseSafeHtmlWrappedValue_:(goog.asserts.fail("expected object of type SafeHtml, got '"+a+"'"),"type_error:SafeHtml")},goog.html.SafeHtml.htmlEscape=function(a){if(a instanceof goog.html.SafeHtml)return a;var b=null;return a.implementsGoogI18nBidiDirectionalString&&(b=a.getDirection()),a=a.implementsGoogStringTypedString?a.getTypedStringValue():String(a),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.htmlEscape(a),b)},goog.html.SafeHtml.htmlEscapePreservingNewlines=function(a){return a instanceof goog.html.SafeHtml?a:(a=goog.html.SafeHtml.htmlEscape(a),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.newLineToBr(goog.html.SafeHtml.unwrap(a)),a.getDirection()))},goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(a){return a instanceof goog.html.SafeHtml?a:(a=goog.html.SafeHtml.htmlEscape(a),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.whitespaceEscape(goog.html.SafeHtml.unwrap(a)),a.getDirection()))},goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape,goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/,goog.html.SafeHtml.URL_ATTRIBUTES_={action:!0,cite:!0,data:!0,formaction:!0,href:!0,manifest:!0,poster:!0,src:!0},goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_=goog.object.createSet(goog.dom.TagName.EMBED,goog.dom.TagName.IFRAME,goog.dom.TagName.LINK,goog.dom.TagName.OBJECT,goog.dom.TagName.SCRIPT,goog.dom.TagName.STYLE,goog.dom.TagName.TEMPLATE),goog.html.SafeHtml.create=function(a,b,c){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(a))throw Error("Invalid tag name <"+a+">.");if(a.toUpperCase()in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_)throw Error("Tag name <"+a+"> is not allowed for SafeHtml.");return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(a,b,c)},goog.html.SafeHtml.createIframe=function(a,b,c,d){var e={};return e.src=a||null,e.srcdoc=b||null,a=goog.html.SafeHtml.combineAttributes(e,{sandbox:""},c),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",a,d)},goog.html.SafeHtml.createStyle=function(a,b){var c=goog.html.SafeHtml.combineAttributes({type:"text/css"},{},b),d="";a=goog.array.concat(a);for(var e=0;e<a.length;e++)d+=goog.html.SafeStyleSheet.unwrap(a[e]);return d=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(d,goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("style",c,d)},goog.html.SafeHtml.getAttrNameAndValue_=function(a,b,c){if(c instanceof goog.string.Const)c=goog.string.Const.unwrap(c);else if("style"==b.toLowerCase())c=goog.html.SafeHtml.getStyleValue_(c);else{if(/^on/i.test(b))throw Error('Attribute "'+b+'" requires goog.string.Const value, "'+c+'" given.');if(b.toLowerCase()in goog.html.SafeHtml.URL_ATTRIBUTES_)if(c instanceof goog.html.TrustedResourceUrl)c=goog.html.TrustedResourceUrl.unwrap(c);else if(c instanceof goog.html.SafeUrl)c=goog.html.SafeUrl.unwrap(c);else{if(!goog.isString(c))throw Error('Attribute "'+b+'" on tag "'+a+'" requires goog.html.SafeUrl, goog.string.Const, or string, value "'+c+'" given.');c=goog.html.SafeUrl.sanitize(c).getTypedStringValue()}}return c.implementsGoogStringTypedString&&(c=c.getTypedStringValue()),goog.asserts.assert(goog.isString(c)||goog.isNumber(c),"String or number value expected, got "+typeof c+" with value: "+c),b+'="'+goog.string.htmlEscape(String(c))+'"'},goog.html.SafeHtml.getStyleValue_=function(a){if(!goog.isObject(a))throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof a+" given: "+a);return a instanceof goog.html.SafeStyle||(a=goog.html.SafeStyle.create(a)),goog.html.SafeStyle.unwrap(a)},goog.html.SafeHtml.createWithDir=function(a,b,c,d){return b=goog.html.SafeHtml.create(b,c,d),b.dir_=a,b},goog.html.SafeHtml.concat=function(a){var b=goog.i18n.bidi.Dir.NEUTRAL,c="",d=function(a){goog.isArray(a)?goog.array.forEach(a,d):(a=goog.html.SafeHtml.htmlEscape(a),c+=goog.html.SafeHtml.unwrap(a),a=a.getDirection(),b==goog.i18n.bidi.Dir.NEUTRAL?b=a:a!=goog.i18n.bidi.Dir.NEUTRAL&&b!=a&&(b=null))};return goog.array.forEach(arguments,d),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,b)},goog.html.SafeHtml.concatWithDir=function(a,b){var c=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));return c.dir_=a,c},goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(a,b){return(new goog.html.SafeHtml).initSecurityPrivateDoNotAccessOrElse_(a,b)},goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a,b){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=a,this.dir_=b,this},goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse=function(a,b,c){var d=null,e="<"+a;if(b)for(var f in b){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(f))throw Error('Invalid attribute name "'+f+'".');var g=b[f];goog.isDefAndNotNull(g)&&(e+=" "+goog.html.SafeHtml.getAttrNameAndValue_(a,f,g))}return goog.isDefAndNotNull(c)?goog.isArray(c)||(c=[c]):c=[],goog.dom.tags.isVoidTag(a.toLowerCase())?(goog.asserts.assert(!c.length,"Void tag <"+a+"> does not allow content."),e+=">"):(d=goog.html.SafeHtml.concat(c),e+=">"+goog.html.SafeHtml.unwrap(d)+"</"+a+">",d=d.getDirection()),(a=b&&b.dir)&&(d=/^(ltr|rtl|auto)$/i.test(a)?goog.i18n.bidi.Dir.NEUTRAL:null),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(e,d)},goog.html.SafeHtml.combineAttributes=function(a,b,c){var e,d={};for(e in a)goog.asserts.assert(e.toLowerCase()==e,"Must be lower case"),d[e]=a[e];for(e in b)goog.asserts.assert(e.toLowerCase()==e,"Must be lower case"),d[e]=b[e];for(e in c){var f=e.toLowerCase();if(f in a)throw Error('Cannot override "'+f+'" attribute, got "'+e+'" with value "'+c[e]+'"');f in b&&delete d[f],d[e]=c[e]}return d},goog.html.SafeHtml.DOCTYPE_HTML=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!DOCTYPE html>",goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL),goog.dom.safe={},goog.dom.safe.InsertAdjacentHtmlPosition={AFTERBEGIN:"afterbegin",AFTEREND:"afterend",BEFOREBEGIN:"beforebegin",BEFOREEND:"beforeend"},goog.dom.safe.insertAdjacentHtml=function(a,b,c){a.insertAdjacentHTML(b,goog.html.SafeHtml.unwrap(c))},goog.dom.safe.setInnerHtml=function(a,b){a.innerHTML=goog.html.SafeHtml.unwrap(b)},goog.dom.safe.setOuterHtml=function(a,b){a.outerHTML=goog.html.SafeHtml.unwrap(b)},goog.dom.safe.documentWrite=function(a,b){a.write(goog.html.SafeHtml.unwrap(b))},goog.dom.safe.setAnchorHref=function(a,b){var c;c=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitize(b),a.href=goog.html.SafeUrl.unwrap(c)},goog.dom.safe.setEmbedSrc=function(a,b){a.src=goog.html.TrustedResourceUrl.unwrap(b)},goog.dom.safe.setFrameSrc=function(a,b){a.src=goog.html.TrustedResourceUrl.unwrap(b)},goog.dom.safe.setIframeSrc=function(a,b){a.src=goog.html.TrustedResourceUrl.unwrap(b)},goog.dom.safe.setLinkHrefAndRel=function(a,b,c){a.rel=c,goog.string.caseInsensitiveContains(c,"stylesheet")?(goog.asserts.assert(b instanceof goog.html.TrustedResourceUrl,'URL must be TrustedResourceUrl because "rel" contains "stylesheet"'),a.href=goog.html.TrustedResourceUrl.unwrap(b)):a.href=b instanceof goog.html.TrustedResourceUrl?goog.html.TrustedResourceUrl.unwrap(b):b instanceof goog.html.SafeUrl?goog.html.SafeUrl.unwrap(b):goog.html.SafeUrl.sanitize(b).getTypedStringValue()},goog.dom.safe.setObjectData=function(a,b){a.data=goog.html.TrustedResourceUrl.unwrap(b)},goog.dom.safe.setScriptSrc=function(a,b){a.src=goog.html.TrustedResourceUrl.unwrap(b)},goog.dom.safe.setLocationHref=function(a,b){var c;c=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitize(b),a.href=goog.html.SafeUrl.unwrap(c)},goog.dom.safe.openInWindow=function(a,b,c,d,e){return a=a instanceof goog.html.SafeUrl?a:goog.html.SafeUrl.sanitize(a),(b||window).open(goog.html.SafeUrl.unwrap(a),c?goog.string.Const.unwrap(c):"",d,e)},goog.html.legacyconversions={},goog.html.legacyconversions.ALLOW_LEGACY_CONVERSIONS=!0,goog.html.legacyconversions.safeHtmlFromString=function(a){return goog.html.legacyconversions.throwIfConversionsDisallowed(),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(a,null)},goog.html.legacyconversions.safeStyleFromString=function(a){return goog.html.legacyconversions.throwIfConversionsDisallowed(),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a)},goog.html.legacyconversions.trustedResourceUrlFromString=function(a){return goog.html.legacyconversions.throwIfConversionsDisallowed(),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(a)},goog.html.legacyconversions.safeUrlFromString=function(a){return goog.html.legacyconversions.throwIfConversionsDisallowed(),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)},goog.html.legacyconversions.reportCallback_=goog.nullFunction,goog.html.legacyconversions.setReportCallback=function(a){goog.html.legacyconversions.reportCallback_=a},goog.html.legacyconversions.throwIfConversionsDisallowed=function(){if(!goog.html.legacyconversions.ALLOW_LEGACY_CONVERSIONS)throw Error("Error: Legacy conversion from string to goog.html types is disabled");goog.html.legacyconversions.reportCallback_()},goog.structs={},goog.structs.Map=function(a,b){this.map_={},this.keys_=[],this.version_=this.count_=0;var c=arguments.length;if(c>1){if(c%2)throw Error("Uneven number of arguments");for(var d=0;c>d;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)},goog.structs.Map.prototype.getCount=function(){return this.count_},goog.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();for(var a=[],b=0;b<this.keys_.length;b++)a.push(this.map_[this.keys_[b]]);return a},goog.structs.Map.prototype.getKeys=function(){return this.cleanupKeysArray_(),this.keys_.concat()},goog.structs.Map.prototype.containsKey=function(a){return goog.structs.Map.hasKey_(this.map_,a)},goog.structs.Map.prototype.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if(goog.structs.Map.hasKey_(this.map_,c)&&this.map_[c]==a)return!0}return!1},goog.structs.Map.prototype.equals=function(a,b){if(this===a)return!0;if(this.count_!=a.getCount())return!1;var c=b||goog.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var d,e=0;d=this.keys_[e];e++)if(!c(this.get(d),a.get(d)))return!1;return!0},goog.structs.Map.defaultEquals=function(a,b){return a===b},goog.structs.Map.prototype.isEmpty=function(){return 0==this.count_},goog.structs.Map.prototype.clear=function(){this.map_={},this.version_=this.count_=this.keys_.length=0},goog.structs.Map.prototype.remove=function(a){return goog.structs.Map.hasKey_(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&this.cleanupKeysArray_(),!0):!1},goog.structs.Map.prototype.cleanupKeysArray_=function(){
if(this.count_!=this.keys_.length){for(var a=0,b=0;a<this.keys_.length;){var c=this.keys_[a];goog.structs.Map.hasKey_(this.map_,c)&&(this.keys_[b++]=c),a++}this.keys_.length=b}if(this.count_!=this.keys_.length){for(var d={},b=a=0;a<this.keys_.length;)c=this.keys_[a],goog.structs.Map.hasKey_(d,c)||(this.keys_[b++]=c,d[c]=1),a++;this.keys_.length=b}},goog.structs.Map.prototype.get=function(a,b){return goog.structs.Map.hasKey_(this.map_,a)?this.map_[a]:b},goog.structs.Map.prototype.set=function(a,b){goog.structs.Map.hasKey_(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++),this.map_[a]=b},goog.structs.Map.prototype.addAll=function(a){var b;a instanceof goog.structs.Map?(b=a.getKeys(),a=a.getValues()):(b=goog.object.getKeys(a),a=goog.object.getValues(a));for(var c=0;c<b.length;c++)this.set(b[c],a[c])},goog.structs.Map.prototype.forEach=function(a,b){for(var c=this.getKeys(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}},goog.structs.Map.prototype.clone=function(){return new goog.structs.Map(this)},goog.structs.Map.prototype.transpose=function(){for(var a=new goog.structs.Map,b=0;b<this.keys_.length;b++){var c=this.keys_[b];a.set(this.map_[c],c)}return a},goog.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();for(var a={},b=0;b<this.keys_.length;b++){var c=this.keys_[b];a[c]=this.map_[c]}return a},goog.structs.Map.prototype.getKeyIterator=function(){return this.__iterator__(!0)},goog.structs.Map.prototype.getValueIterator=function(){return this.__iterator__(!1)},goog.structs.Map.prototype.__iterator__=function(a){this.cleanupKeysArray_();var b=0,c=this.version_,d=this,e=new goog.iter.Iterator;return e.next=function(){if(c!=d.version_)throw Error("The map has changed since the iterator was created");if(b>=d.keys_.length)throw goog.iter.StopIteration;var e=d.keys_[b++];return a?e:d.map_[e]},e},goog.structs.Map.hasKey_=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},goog.structs.getCount=function(a){return"function"==typeof a.getCount?a.getCount():goog.isArrayLike(a)||goog.isString(a)?a.length:goog.object.getCount(a)},goog.structs.getValues=function(a){if("function"==typeof a.getValues)return a.getValues();if(goog.isString(a))return a.split("");if(goog.isArrayLike(a)){for(var b=[],c=a.length,d=0;c>d;d++)b.push(a[d]);return b}return goog.object.getValues(a)},goog.structs.getKeys=function(a){if("function"==typeof a.getKeys)return a.getKeys();if("function"!=typeof a.getValues){if(goog.isArrayLike(a)||goog.isString(a)){var b=[];a=a.length;for(var c=0;a>c;c++)b.push(c);return b}return goog.object.getKeys(a)}},goog.structs.contains=function(a,b){return"function"==typeof a.contains?a.contains(b):"function"==typeof a.containsValue?a.containsValue(b):goog.isArrayLike(a)||goog.isString(a)?goog.array.contains(a,b):goog.object.containsValue(a,b)},goog.structs.isEmpty=function(a){return"function"==typeof a.isEmpty?a.isEmpty():goog.isArrayLike(a)||goog.isString(a)?goog.array.isEmpty(a):goog.object.isEmpty(a)},goog.structs.clear=function(a){"function"==typeof a.clear?a.clear():goog.isArrayLike(a)?goog.array.clear(a):goog.object.clear(a)},goog.structs.forEach=function(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(goog.isArrayLike(a)||goog.isString(a))goog.array.forEach(a,b,c);else for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;f>g;g++)b.call(c,e[g],d&&d[g],a)},goog.structs.filter=function(a,b,c){if("function"==typeof a.filter)return a.filter(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.filter(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;g>h;h++)b.call(c,f[h],e[h],a)&&(d[e[h]]=f[h])}else for(d=[],h=0;g>h;h++)b.call(c,f[h],void 0,a)&&d.push(f[h]);return d},goog.structs.map=function(a,b,c){if("function"==typeof a.map)return a.map(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.map(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;g>h;h++)d[e[h]]=b.call(c,f[h],e[h],a)}else for(d=[],h=0;g>h;h++)d[h]=b.call(c,f[h],void 0,a);return d},goog.structs.some=function(a,b,c){if("function"==typeof a.some)return a.some(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.some(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;f>g;g++)if(b.call(c,e[g],d&&d[g],a))return!0;return!1},goog.structs.every=function(a,b,c){if("function"==typeof a.every)return a.every(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.every(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;f>g;g++)if(!b.call(c,e[g],d&&d[g],a))return!1;return!0},goog.testing={},goog.testing.watchers={},goog.testing.watchers.resetWatchers_=[],goog.testing.watchers.signalClockReset=function(){for(var a=goog.testing.watchers.resetWatchers_,b=0;b<a.length;b++)goog.testing.watchers.resetWatchers_[b]()},goog.testing.watchers.watchClockReset=function(a){goog.testing.watchers.resetWatchers_.push(a)},goog.async.run=function(a,b){goog.async.run.schedule_||goog.async.run.initializeRunner_(),goog.async.run.workQueueScheduled_||(goog.async.run.schedule_(),goog.async.run.workQueueScheduled_=!0),goog.async.run.workQueue_.add(a,b)},goog.async.run.initializeRunner_=function(){if(goog.global.Promise&&goog.global.Promise.resolve){var a=goog.global.Promise.resolve(void 0);goog.async.run.schedule_=function(){a.then(goog.async.run.processWorkQueue)}}else goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}},goog.async.run.forceNextTick=function(a){goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue),a&&a(goog.async.run.processWorkQueue)}},goog.async.run.workQueueScheduled_=!1,goog.async.run.workQueue_=new goog.async.WorkQueue,goog.DEBUG&&(goog.async.run.resetQueue_=function(){goog.async.run.workQueueScheduled_=!1,goog.async.run.workQueue_=new goog.async.WorkQueue},goog.testing.watchers.watchClockReset(goog.async.run.resetQueue_)),goog.async.run.processWorkQueue=function(){for(var a=null;a=goog.async.run.workQueue_.remove();){try{a.fn.call(a.scope)}catch(b){goog.async.throwException(b)}goog.async.run.workQueue_.returnUnused(a)}goog.async.run.workQueueScheduled_=!1},goog.Promise=function(a,b){if(this.state_=goog.Promise.State_.PENDING,this.result_=void 0,this.callbackEntriesTail_=this.callbackEntries_=this.parent_=null,this.executing_=!1,0<goog.Promise.UNHANDLED_REJECTION_DELAY?this.unhandledRejectionId_=0:0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1),goog.Promise.LONG_STACK_TRACES&&(this.stack_=[],this.addStackTrace_(Error("created")),this.currentStep_=0),a!=goog.nullFunction)try{var c=this;a.call(b,function(a){c.resolve_(goog.Promise.State_.FULFILLED,a)},function(a){if(goog.DEBUG&&!(a instanceof goog.Promise.CancellationError))try{if(a instanceof Error)throw a;throw Error("Promise rejected.")}catch(b){}c.resolve_(goog.Promise.State_.REJECTED,a)})}catch(d){this.resolve_(goog.Promise.State_.REJECTED,d)}},goog.Promise.LONG_STACK_TRACES=!1,goog.Promise.UNHANDLED_REJECTION_DELAY=0,goog.Promise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3},goog.Promise.CallbackEntry_=function(){this.next=this.context=this.onRejected=this.onFulfilled=this.child=null,this.always=!1},goog.Promise.CallbackEntry_.prototype.reset=function(){this.context=this.onRejected=this.onFulfilled=this.child=null,this.always=!1},goog.Promise.DEFAULT_MAX_UNUSED=100,goog.Promise.freelist_=new goog.async.FreeList(function(){return new goog.Promise.CallbackEntry_},function(a){a.reset()},goog.Promise.DEFAULT_MAX_UNUSED),goog.Promise.getCallbackEntry_=function(a,b,c){var d=goog.Promise.freelist_.get();return d.onFulfilled=a,d.onRejected=b,d.context=c,d},goog.Promise.returnEntry_=function(a){goog.Promise.freelist_.put(a)},goog.Promise.resolve=function(a){if(a instanceof goog.Promise)return a;var b=new goog.Promise(goog.nullFunction);return b.resolve_(goog.Promise.State_.FULFILLED,a),b},goog.Promise.reject=function(a){return new goog.Promise(function(b,c){c(a)})},goog.Promise.resolveThen_=function(a,b,c){goog.Promise.maybeThen_(a,b,c,null)||goog.async.run(goog.partial(b,a))},goog.Promise.race=function(a){return new goog.Promise(function(b,c){a.length||b(void 0);for(var e,d=0;d<a.length;d++)e=a[d],goog.Promise.resolveThen_(e,b,c)})},goog.Promise.all=function(a){return new goog.Promise(function(b,c){var d=a.length,e=[];if(d)for(var k,f=function(a,c){d--,e[a]=c,0==d&&b(e)},g=function(a){c(a)},h=0;h<a.length;h++)k=a[h],goog.Promise.resolveThen_(k,goog.partial(f,h),g);else b(e)})},goog.Promise.allSettled=function(a){return new goog.Promise(function(b,c){var d=a.length,e=[];if(d)for(var h,f=function(a,c,f){d--,e[a]=c?{fulfilled:!0,value:f}:{fulfilled:!1,reason:f},0==d&&b(e)},g=0;g<a.length;g++)h=a[g],goog.Promise.resolveThen_(h,goog.partial(f,g,!0),goog.partial(f,g,!1));else b(e)})},goog.Promise.firstFulfilled=function(a){return new goog.Promise(function(b,c){var d=a.length,e=[];if(d)for(var k,f=function(a){b(a)},g=function(a,b){d--,e[a]=b,0==d&&c(e)},h=0;h<a.length;h++)k=a[h],goog.Promise.resolveThen_(k,f,goog.partial(g,h));else b(void 0)})},goog.Promise.withResolver=function(){var a,b,c=new goog.Promise(function(c,e){a=c,b=e});return new goog.Promise.Resolver_(c,a,b)},goog.Promise.prototype.then=function(a,b,c){return null!=a&&goog.asserts.assertFunction(a,"opt_onFulfilled should be a function."),null!=b&&goog.asserts.assertFunction(b,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?"),goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("then")),this.addChildPromise_(goog.isFunction(a)?a:null,goog.isFunction(b)?b:null,c)},goog.Thenable.addImplementation(goog.Promise),goog.Promise.prototype.thenVoid=function(a,b,c){null!=a&&goog.asserts.assertFunction(a,"opt_onFulfilled should be a function."),null!=b&&goog.asserts.assertFunction(b,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?"),goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("then")),this.addCallbackEntry_(goog.Promise.getCallbackEntry_(a||goog.nullFunction,b||null,c))},goog.Promise.prototype.thenAlways=function(a,b){goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("thenAlways"));var c=goog.Promise.getCallbackEntry_(a,a,b);return c.always=!0,this.addCallbackEntry_(c),this},goog.Promise.prototype.thenCatch=function(a,b){return goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("thenCatch")),this.addChildPromise_(null,a,b)},goog.Promise.prototype.cancel=function(a){this.state_==goog.Promise.State_.PENDING&&goog.async.run(function(){var b=new goog.Promise.CancellationError(a);this.cancelInternal_(b)},this)},goog.Promise.prototype.cancelInternal_=function(a){this.state_==goog.Promise.State_.PENDING&&(this.parent_?(this.parent_.cancelChild_(this,a),this.parent_=null):this.resolve_(goog.Promise.State_.REJECTED,a))},goog.Promise.prototype.cancelChild_=function(a,b){if(this.callbackEntries_){for(var c=0,d=null,e=null,f=this.callbackEntries_;f&&(f.always||(c++,f.child==a&&(d=f),!(d&&c>1)));f=f.next)d||(e=f);d&&(this.state_==goog.Promise.State_.PENDING&&1==c?this.cancelInternal_(b):(e?this.removeEntryAfter_(e):this.popEntry_(),this.executeCallback_(d,goog.Promise.State_.REJECTED,b)))}},goog.Promise.prototype.addCallbackEntry_=function(a){this.hasEntry_()||this.state_!=goog.Promise.State_.FULFILLED&&this.state_!=goog.Promise.State_.REJECTED||this.scheduleCallbacks_(),this.queueEntry_(a)},goog.Promise.prototype.addChildPromise_=function(a,b,c){var d=goog.Promise.getCallbackEntry_(null,null,null);return d.child=new goog.Promise(function(e,f){d.onFulfilled=a?function(b){try{var d=a.call(c,b);e(d)}catch(k){f(k)}}:e,d.onRejected=b?function(a){try{var d=b.call(c,a);!goog.isDef(d)&&a instanceof goog.Promise.CancellationError?f(a):e(d)}catch(k){f(k)}}:f}),d.child.parent_=this,this.addCallbackEntry_(d),d.child},goog.Promise.prototype.unblockAndFulfill_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED),this.state_=goog.Promise.State_.PENDING,this.resolve_(goog.Promise.State_.FULFILLED,a)},goog.Promise.prototype.unblockAndReject_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED),this.state_=goog.Promise.State_.PENDING,this.resolve_(goog.Promise.State_.REJECTED,a)},goog.Promise.prototype.resolve_=function(a,b){this.state_==goog.Promise.State_.PENDING&&(this==b&&(a=goog.Promise.State_.REJECTED,b=new TypeError("Promise cannot resolve to itself")),this.state_=goog.Promise.State_.BLOCKED,goog.Promise.maybeThen_(b,this.unblockAndFulfill_,this.unblockAndReject_,this)||(this.result_=b,this.state_=a,this.parent_=null,this.scheduleCallbacks_(),a!=goog.Promise.State_.REJECTED||b instanceof goog.Promise.CancellationError||goog.Promise.addUnhandledRejection_(this,b)))},goog.Promise.maybeThen_=function(a,b,c,d){if(a instanceof goog.Promise)return a.thenVoid(b,c,d),!0;if(goog.Thenable.isImplementedBy(a))return a.then(b,c,d),!0;if(goog.isObject(a))try{var e=a.then;if(goog.isFunction(e))return goog.Promise.tryThen_(a,e,b,c,d),!0}catch(f){return c.call(d,f),!0}return!1},goog.Promise.tryThen_=function(a,b,c,d,e){var f=!1,g=function(a){f||(f=!0,c.call(e,a))},h=function(a){f||(f=!0,d.call(e,a))};try{b.call(a,g,h)}catch(k){h(k)}},goog.Promise.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,goog.async.run(this.executeCallbacks_,this))},goog.Promise.prototype.hasEntry_=function(){return!!this.callbackEntries_},goog.Promise.prototype.queueEntry_=function(a){goog.asserts.assert(null!=a.onFulfilled),this.callbackEntriesTail_?this.callbackEntriesTail_.next=a:this.callbackEntries_=a,this.callbackEntriesTail_=a},goog.Promise.prototype.popEntry_=function(){var a=null;return this.callbackEntries_&&(a=this.callbackEntries_,this.callbackEntries_=a.next,a.next=null),this.callbackEntries_||(this.callbackEntriesTail_=null),null!=a&&goog.asserts.assert(null!=a.onFulfilled),a},goog.Promise.prototype.removeEntryAfter_=function(a){goog.asserts.assert(this.callbackEntries_),goog.asserts.assert(null!=a),a.next==this.callbackEntriesTail_&&(this.callbackEntriesTail_=a),a.next=a.next.next},goog.Promise.prototype.executeCallbacks_=function(){for(var a=null;a=this.popEntry_();)goog.Promise.LONG_STACK_TRACES&&this.currentStep_++,this.executeCallback_(a,this.state_,this.result_);this.executing_=!1},goog.Promise.prototype.executeCallback_=function(a,b,c){if(b==goog.Promise.State_.REJECTED&&a.onRejected&&!a.always&&this.removeUnhandledRejection_(),a.child)a.child.parent_=null,goog.Promise.invokeCallback_(a,b,c);else try{a.always?a.onFulfilled.call(a.context):goog.Promise.invokeCallback_(a,b,c)}catch(d){goog.Promise.handleRejection_.call(null,d)}goog.Promise.returnEntry_(a)},goog.Promise.invokeCallback_=function(a,b,c){b==goog.Promise.State_.FULFILLED?a.onFulfilled.call(a.context,c):a.onRejected&&a.onRejected.call(a.context,c)},goog.Promise.prototype.addStackTrace_=function(a){if(goog.Promise.LONG_STACK_TRACES&&goog.isString(a.stack)){var b=a.stack.split("\n",4)[3];a=a.message,a+=Array(11-a.length).join(" "),this.stack_.push(a+b)}},goog.Promise.prototype.appendLongStack_=function(a){if(goog.Promise.LONG_STACK_TRACES&&a&&goog.isString(a.stack)&&this.stack_.length){for(var b=["Promise trace:"],c=this;c;c=c.parent_){for(var d=this.currentStep_;d>=0;d--)b.push(c.stack_[d]);b.push("Value: ["+(c.state_==goog.Promise.State_.REJECTED?"REJECTED":"FULFILLED")+"] <"+String(c.result_)+">")}a.stack+="\n\n"+b.join("\n")}},goog.Promise.prototype.removeUnhandledRejection_=function(){if(0<goog.Promise.UNHANDLED_REJECTION_DELAY)for(var a=this;a&&a.unhandledRejectionId_;a=a.parent_)goog.global.clearTimeout(a.unhandledRejectionId_),a.unhandledRejectionId_=0;else if(0==goog.Promise.UNHANDLED_REJECTION_DELAY)for(a=this;a&&a.hadUnhandledRejection_;a=a.parent_)a.hadUnhandledRejection_=!1},goog.Promise.addUnhandledRejection_=function(a,b){0<goog.Promise.UNHANDLED_REJECTION_DELAY?a.unhandledRejectionId_=goog.global.setTimeout(function(){a.appendLongStack_(b),goog.Promise.handleRejection_.call(null,b)},goog.Promise.UNHANDLED_REJECTION_DELAY):0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(a.hadUnhandledRejection_=!0,goog.async.run(function(){a.hadUnhandledRejection_&&(a.appendLongStack_(b),goog.Promise.handleRejection_.call(null,b))}))},goog.Promise.handleRejection_=goog.async.throwException,goog.Promise.setUnhandledRejectionHandler=function(a){goog.Promise.handleRejection_=a},goog.Promise.CancellationError=function(a){goog.debug.Error.call(this,a)},goog.inherits(goog.Promise.CancellationError,goog.debug.Error),goog.Promise.CancellationError.prototype.name="cancel",goog.Promise.Resolver_=function(a,b,c){this.promise=a,this.resolve=b,this.reject=c},goog.userAgent={},goog.userAgent.ASSUME_IE=!1,goog.userAgent.ASSUME_EDGE=!1,goog.userAgent.ASSUME_GECKO=!1,goog.userAgent.ASSUME_WEBKIT=!1,goog.userAgent.ASSUME_MOBILE_WEBKIT=!1,goog.userAgent.ASSUME_OPERA=!1,goog.userAgent.ASSUME_ANY_VERSION=!1,goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.EDGE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_EDGE:goog.labs.userAgent.engine.isEdge(),goog.userAgent.EDGE_OR_IE=goog.userAgent.EDGE||goog.userAgent.IE,goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.userAgent.ASSUME_MAC=!1,goog.userAgent.ASSUME_WINDOWS=!1,goog.userAgent.ASSUME_LINUX=!1,goog.userAgent.ASSUME_X11=!1,goog.userAgent.ASSUME_ANDROID=!1,goog.userAgent.ASSUME_IPHONE=!1,goog.userAgent.ASSUME_IPAD=!1,goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var a=goog.userAgent.getNavigator();return!!a&&goog.string.contains(a.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.determineVersion_=function(){if(goog.userAgent.OPERA&&goog.global.opera){var a=goog.global.opera.version;return goog.isFunction(a)?a():a}var a="",b=goog.userAgent.getVersionRegexResult_();return b&&(a=b?b[1]:""),goog.userAgent.IE&&(b=goog.userAgent.getDocumentMode_(),b>parseFloat(a))?String(b):a},goog.userAgent.getVersionRegexResult_=function(){var a=goog.userAgent.getUserAgentString();return goog.userAgent.GECKO?/rv\:([^\);]+)(\)|;)/.exec(a):goog.userAgent.EDGE?/Edge\/([\d\.]+)/.exec(a):goog.userAgent.IE?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):goog.userAgent.WEBKIT?/WebKit\/(\S+)/.exec(a):void 0},goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[a]||(goog.userAgent.isVersionOrHigherCache_[a]=0<=goog.string.compareVersions(goog.userAgent.VERSION,a))},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(a){return goog.userAgent.DOCUMENT_MODE>=a},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var a=goog.global.document,b=goog.userAgent.getDocumentMode_();return a&&goog.userAgent.IE?b||("CSS1Compat"==a.compatMode?parseInt(goog.userAgent.VERSION,10):5):void 0}(),goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentModeOrHigher(9)||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.1"),CAN_USE_INNER_TEXT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE,LEGACY_IE_RANGES:goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)},goog.dom.ASSUME_QUIRKS_MODE=!1,goog.dom.ASSUME_STANDARDS_MODE=!1,goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE,goog.dom.getDomHelper=function(a){return a?new goog.dom.DomHelper(goog.dom.getOwnerDocument(a)):goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper)},goog.dom.getDocument=function(){return document},goog.dom.getElement=function(a){return goog.dom.getElementHelper_(document,a)},goog.dom.getElementHelper_=function(a,b){return goog.isString(b)?a.getElementById(b):b},goog.dom.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(document,a)},goog.dom.getRequiredElementHelper_=function(a,b){goog.asserts.assertString(b);var c=goog.dom.getElementHelper_(a,b);return c=goog.asserts.assertElement(c,"No element found with id: "+b)},goog.dom.$=goog.dom.getElement,goog.dom.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(document,a,b,c)},goog.dom.getElementsByClass=function(a,b){var c=b||document;return goog.dom.canUseQuerySelector_(c)?c.querySelectorAll("."+a):goog.dom.getElementsByTagNameAndClass_(document,"*",a,b)},goog.dom.getElementByClass=function(a,b){var c=b||document,d=null;return(d=c.getElementsByClassName?c.getElementsByClassName(a)[0]:goog.dom.canUseQuerySelector_(c)?c.querySelector("."+a):goog.dom.getElementsByTagNameAndClass_(document,"*",a,b)[0])||null},goog.dom.getRequiredElementByClass=function(a,b){var c=goog.dom.getElementByClass(a,b);return goog.asserts.assert(c,"No element found with className: "+a)},goog.dom.canUseQuerySelector_=function(a){return!(!a.querySelectorAll||!a.querySelector)},goog.dom.getElementsByTagNameAndClass_=function(a,b,c,d){if(a=d||a,b=b&&"*"!=b?b.toUpperCase():"",goog.dom.canUseQuerySelector_(a)&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){if(a=a.getElementsByClassName(c),b){d={};for(var g,e=0,f=0;g=a[f];f++)b==g.nodeName&&(d[e++]=g);return d.length=e,d}return a}if(a=a.getElementsByTagName(b||"*"),c){for(d={},f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&goog.array.contains(b.split(/\s+/),c)&&(d[e++]=g);return d.length=e,d}return a},goog.dom.$$=goog.dom.getElementsByTagNameAndClass,goog.dom.setProperties=function(a,b){goog.object.forEach(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:goog.dom.DIRECT_ATTRIBUTE_MAP_.hasOwnProperty(d)?a.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[d],b):goog.string.startsWith(d,"aria-")||goog.string.startsWith(d,"data-")?a.setAttribute(d,b):a[d]=b})},goog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"},goog.dom.getViewportSize=function(a){return goog.dom.getViewportSize_(a||window)},goog.dom.getViewportSize_=function(a){return a=a.document,a=goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body,new goog.math.Size(a.clientWidth,a.clientHeight)},goog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)},goog.dom.getDocumentHeight_=function(a){var b=a.document,c=0;if(b){var c=b.body,d=b.documentElement;if(!d||!c)return 0;if(a=goog.dom.getViewportSize_(a).height,goog.dom.isCss1CompatMode_(b)&&d.scrollHeight)c=d.scrollHeight!=a?d.scrollHeight:d.offsetHeight;else{var b=d.scrollHeight,e=d.offsetHeight;d.clientHeight!=e&&(b=c.scrollHeight,e=c.offsetHeight),c=b>a?b>e?b:e:e>b?b:e}}return c},goog.dom.getPageScroll=function(a){return goog.dom.getDomHelper((a||goog.global||window).document).getDocumentScroll()},goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)},goog.dom.getDocumentScroll_=function(a){var b=goog.dom.getDocumentScrollElement_(a);return a=goog.dom.getWindow_(a),goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("10")&&a.pageYOffset!=b.scrollTop?new goog.math.Coordinate(b.scrollLeft,b.scrollTop):new goog.math.Coordinate(a.pageXOffset||b.scrollLeft,a.pageYOffset||b.scrollTop)},goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)},goog.dom.getDocumentScrollElement_=function(a){return a.scrollingElement?a.scrollingElement:!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body||a.documentElement},goog.dom.getWindow=function(a){return a?goog.dom.getWindow_(a):window},goog.dom.getWindow_=function(a){return a.parentWindow||a.defaultView},goog.dom.createDom=function(a,b,c){return goog.dom.createDom_(document,arguments)},goog.dom.createDom_=function(a,b){var c=b[0],d=b[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&d&&(d.name||d.type)){if(c=["<",c],d.name&&c.push(' name="',goog.string.htmlEscape(d.name),'"'),d.type){c.push(' type="',goog.string.htmlEscape(d.type),'"');var e={};goog.object.extend(e,d),delete e.type,d=e}c.push(">"),c=c.join("")}return c=a.createElement(c),d&&(goog.isString(d)?c.className=d:goog.isArray(d)?c.className=d.join(" "):goog.dom.setProperties(c,d)),2<b.length&&goog.dom.append_(a,c,b,2),c},goog.dom.append_=function(a,b,c,d){function e(c){c&&b.appendChild(goog.isString(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];goog.isArrayLike(f)&&!goog.dom.isNodeLike(f)?goog.array.forEach(goog.dom.isNodeList(f)?goog.array.toArray(f):f,e):e(f)}},goog.dom.$dom=goog.dom.createDom,goog.dom.createElement=function(a){return document.createElement(a)},goog.dom.createTextNode=function(a){return document.createTextNode(String(a))},goog.dom.createTable=function(a,b,c){return goog.dom.createTable_(document,a,b,!!c)},goog.dom.createTable_=function(a,b,c,d){for(var e=a.createElement(goog.dom.TagName.TABLE),f=e.appendChild(a.createElement(goog.dom.TagName.TBODY)),g=0;b>g;g++){for(var h=a.createElement(goog.dom.TagName.TR),k=0;c>k;k++){var l=a.createElement(goog.dom.TagName.TD);d&&goog.dom.setTextContent(l,goog.string.Unicode.NBSP),h.appendChild(l)}f.appendChild(h)}return e},goog.dom.safeHtmlToNode=function(a){return goog.dom.safeHtmlToNode_(document,a)},goog.dom.safeHtmlToNode_=function(a,b){var c=a.createElement(goog.dom.TagName.DIV);return goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(goog.dom.safe.setInnerHtml(c,goog.html.SafeHtml.concat(goog.html.SafeHtml.create("br"),b)),c.removeChild(c.firstChild)):goog.dom.safe.setInnerHtml(c,b),goog.dom.childrenToNode_(a,c)},goog.dom.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(document,a)},goog.dom.htmlToDocumentFragment_=function(a,b){var c=a.createElement(goog.dom.TagName.DIV);return goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(c.innerHTML="<br>"+b,c.removeChild(c.firstChild)):c.innerHTML=b,goog.dom.childrenToNode_(a,c)},goog.dom.childrenToNode_=function(a,b){if(1==b.childNodes.length)return b.removeChild(b.firstChild);for(var c=a.createDocumentFragment();b.firstChild;)c.appendChild(b.firstChild);return c},goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)},goog.dom.isCss1CompatMode_=function(a){return goog.dom.COMPAT_MODE_KNOWN_?goog.dom.ASSUME_STANDARDS_MODE:"CSS1Compat"==a.compatMode},goog.dom.canHaveChildren=function(a){if(a.nodeType!=goog.dom.NodeType.ELEMENT)return!1;switch(a.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return!1}return!0},goog.dom.appendChild=function(a,b){a.appendChild(b)},goog.dom.append=function(a,b){goog.dom.append_(goog.dom.getOwnerDocument(a),a,arguments,1)},goog.dom.removeChildren=function(a){for(var b;b=a.firstChild;)a.removeChild(b)},goog.dom.insertSiblingBefore=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)},goog.dom.insertSiblingAfter=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b.nextSibling)},goog.dom.insertChildAt=function(a,b,c){a.insertBefore(b,a.childNodes[c]||null)},goog.dom.removeNode=function(a){return a&&a.parentNode?a.parentNode.removeChild(a):null},goog.dom.replaceNode=function(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)},goog.dom.flattenElement=function(a){var b,c=a.parentNode;if(c&&c.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(a.removeNode)return a.removeNode(!1);for(;b=a.firstChild;)c.insertBefore(b,a);return goog.dom.removeNode(a)}},goog.dom.getChildren=function(a){return goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&void 0!=a.children?a.children:goog.array.filter(a.childNodes,function(a){return a.nodeType==goog.dom.NodeType.ELEMENT})},goog.dom.getFirstElementChild=function(a){return goog.isDef(a.firstElementChild)?a.firstElementChild:goog.dom.getNextElementNode_(a.firstChild,!0)},goog.dom.getLastElementChild=function(a){return goog.isDef(a.lastElementChild)?a.lastElementChild:goog.dom.getNextElementNode_(a.lastChild,!1)},goog.dom.getNextElementSibling=function(a){return goog.isDef(a.nextElementSibling)?a.nextElementSibling:goog.dom.getNextElementNode_(a.nextSibling,!0)},goog.dom.getPreviousElementSibling=function(a){return goog.isDef(a.previousElementSibling)?a.previousElementSibling:goog.dom.getNextElementNode_(a.previousSibling,!1)},goog.dom.getNextElementNode_=function(a,b){for(;a&&a.nodeType!=goog.dom.NodeType.ELEMENT;)a=b?a.nextSibling:a.previousSibling;

return a},goog.dom.getNextNode=function(a){if(!a)return null;if(a.firstChild)return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null},goog.dom.getPreviousNode=function(a){if(!a)return null;if(!a.previousSibling)return a.parentNode;for(a=a.previousSibling;a&&a.lastChild;)a=a.lastChild;return a},goog.dom.isNodeLike=function(a){return goog.isObject(a)&&0<a.nodeType},goog.dom.isElement=function(a){return goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT},goog.dom.isWindow=function(a){return goog.isObject(a)&&a.window==a},goog.dom.getParentElement=function(a){var b;return!goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")&&!goog.userAgent.isVersionOrHigher("10")&&goog.global.SVGElement&&a instanceof goog.global.SVGElement||!(b=a.parentElement)?(b=a.parentNode,goog.dom.isElement(b)?b:null):b},goog.dom.contains=function(a,b){if(a.contains&&b.nodeType==goog.dom.NodeType.ELEMENT)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(16&a.compareDocumentPosition(b));for(;b&&a!=b;)b=b.parentNode;return b==a},goog.dom.compareNodeOrder=function(a,b){if(a==b)return 0;if(a.compareDocumentPosition)return 2&a.compareDocumentPosition(b)?1:-1;if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){if(a.nodeType==goog.dom.NodeType.DOCUMENT)return-1;if(b.nodeType==goog.dom.NodeType.DOCUMENT)return 1}if("sourceIndex"in a||a.parentNode&&"sourceIndex"in a.parentNode){var c=a.nodeType==goog.dom.NodeType.ELEMENT,d=b.nodeType==goog.dom.NodeType.ELEMENT;if(c&&d)return a.sourceIndex-b.sourceIndex;var e=a.parentNode,f=b.parentNode;return e==f?goog.dom.compareSiblingOrder_(a,b):!c&&goog.dom.contains(e,b)?-1*goog.dom.compareParentsDescendantNodeIe_(a,b):!d&&goog.dom.contains(f,a)?goog.dom.compareParentsDescendantNodeIe_(b,a):(c?a.sourceIndex:e.sourceIndex)-(d?b.sourceIndex:f.sourceIndex)}return d=goog.dom.getOwnerDocument(a),c=d.createRange(),c.selectNode(a),c.collapse(!0),d=d.createRange(),d.selectNode(b),d.collapse(!0),c.compareBoundaryPoints(goog.global.Range.START_TO_END,d)},goog.dom.compareParentsDescendantNodeIe_=function(a,b){var c=a.parentNode;if(c==b)return-1;for(var d=b;d.parentNode!=c;)d=d.parentNode;return goog.dom.compareSiblingOrder_(d,a)},goog.dom.compareSiblingOrder_=function(a,b){for(var c=b;c=c.previousSibling;)if(c==a)return-1;return 1},goog.dom.findCommonAncestor=function(a){var b,c=arguments.length;if(!c)return null;if(1==c)return arguments[0];var d=[],e=1/0;for(b=0;c>b;b++){for(var f=[],g=arguments[b];g;)f.unshift(g),g=g.parentNode;d.push(f),e=Math.min(e,f.length)}for(f=null,b=0;e>b;b++){for(var g=d[0][b],h=1;c>h;h++)if(g!=d[h][b])return f;f=g}return f},goog.dom.getOwnerDocument=function(a){return goog.asserts.assert(a,"Node cannot be null or undefined."),a.nodeType==goog.dom.NodeType.DOCUMENT?a:a.ownerDocument||a.document},goog.dom.getFrameContentDocument=function(a){return a.contentDocument||a.contentWindow.document},goog.dom.getFrameContentWindow=function(a){return a.contentWindow||goog.dom.getWindow(goog.dom.getFrameContentDocument(a))},goog.dom.setTextContent=function(a,b){if(goog.asserts.assert(null!=a,"goog.dom.setTextContent expects a non-null value for node"),"textContent"in a)a.textContent=b;else if(a.nodeType==goog.dom.NodeType.TEXT)a.data=b;else if(a.firstChild&&a.firstChild.nodeType==goog.dom.NodeType.TEXT){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{goog.dom.removeChildren(a);var c=goog.dom.getOwnerDocument(a);a.appendChild(c.createTextNode(String(b)))}},goog.dom.getOuterHtml=function(a){if("outerHTML"in a)return a.outerHTML;var b=goog.dom.getOwnerDocument(a).createElement(goog.dom.TagName.DIV);return b.appendChild(a.cloneNode(!0)),b.innerHTML},goog.dom.findNode=function(a,b){var c=[];return goog.dom.findNodes_(a,b,c,!0)?c[0]:void 0},goog.dom.findNodes=function(a,b){var c=[];return goog.dom.findNodes_(a,b,c,!1),c},goog.dom.findNodes_=function(a,b,c,d){if(null!=a)for(a=a.firstChild;a;){if(b(a)&&(c.push(a),d)||goog.dom.findNodes_(a,b,c,d))return!0;a=a.nextSibling}return!1},goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},goog.dom.PREDEFINED_TAG_VALUES_={IMG:" ",BR:"\n"},goog.dom.isFocusableTabIndex=function(a){return goog.dom.hasSpecifiedTabIndex_(a)&&goog.dom.isTabIndexFocusable_(a)},goog.dom.setFocusableTabIndex=function(a,b){b?a.tabIndex=0:(a.tabIndex=-1,a.removeAttribute("tabIndex"))},goog.dom.isFocusable=function(a){var b;return(b=goog.dom.nativelySupportsFocus_(a)?!a.disabled&&(!goog.dom.hasSpecifiedTabIndex_(a)||goog.dom.isTabIndexFocusable_(a)):goog.dom.isFocusableTabIndex(a))&&goog.userAgent.IE?goog.dom.hasNonZeroBoundingRect_(a):b},goog.dom.hasSpecifiedTabIndex_=function(a){return a=a.getAttributeNode("tabindex"),goog.isDefAndNotNull(a)&&a.specified},goog.dom.isTabIndexFocusable_=function(a){return a=a.tabIndex,goog.isNumber(a)&&a>=0&&32768>a},goog.dom.nativelySupportsFocus_=function(a){return a.tagName==goog.dom.TagName.A||a.tagName==goog.dom.TagName.INPUT||a.tagName==goog.dom.TagName.TEXTAREA||a.tagName==goog.dom.TagName.SELECT||a.tagName==goog.dom.TagName.BUTTON},goog.dom.hasNonZeroBoundingRect_=function(a){return a=goog.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():{height:a.offsetHeight,width:a.offsetWidth},goog.isDefAndNotNull(a)&&0<a.height&&0<a.width},goog.dom.getTextContent=function(a){if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&"innerText"in a)a=goog.string.canonicalizeNewlines(a.innerText);else{var b=[];goog.dom.getTextContent_(a,b,!0),a=b.join("")}return a=a.replace(/ \xAD /g," ").replace(/\xAD/g,""),a=a.replace(/\u200B/g,""),goog.dom.BrowserFeature.CAN_USE_INNER_TEXT||(a=a.replace(/ +/g," "))," "!=a&&(a=a.replace(/^\s*/,"")),a},goog.dom.getRawTextContent=function(a){var b=[];return goog.dom.getTextContent_(a,b,!1),b.join("")},goog.dom.getTextContent_=function(a,b,c){if(!(a.nodeName in goog.dom.TAGS_TO_IGNORE_))if(a.nodeType==goog.dom.NodeType.TEXT)b.push(c?String(a.nodeValue).replace(/(\r\n|\r|\n)/g,""):a.nodeValue);else if(a.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)b.push(goog.dom.PREDEFINED_TAG_VALUES_[a.nodeName]);else for(a=a.firstChild;a;)goog.dom.getTextContent_(a,b,c),a=a.nextSibling},goog.dom.getNodeTextLength=function(a){return goog.dom.getTextContent(a).length},goog.dom.getNodeTextOffset=function(a,b){for(var c=b||goog.dom.getOwnerDocument(a).body,d=[];a&&a!=c;){for(var e=a;e=e.previousSibling;)d.unshift(goog.dom.getTextContent(e));a=a.parentNode}return goog.string.trimLeft(d.join("")).replace(/ +/g," ").length},goog.dom.getNodeAtOffset=function(a,b,c){a=[a];for(var d=0,e=null;0<a.length&&b>d;)if(e=a.pop(),!(e.nodeName in goog.dom.TAGS_TO_IGNORE_))if(e.nodeType==goog.dom.NodeType.TEXT)var f=e.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," "),d=d+f.length;else if(e.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)d+=goog.dom.PREDEFINED_TAG_VALUES_[e.nodeName].length;else for(f=e.childNodes.length-1;f>=0;f--)a.push(e.childNodes[f]);return goog.isObject(c)&&(c.remainder=e?e.nodeValue.length+b-d-1:0,c.node=e),e},goog.dom.isNodeList=function(a){if(a&&"number"==typeof a.length){if(goog.isObject(a))return"function"==typeof a.item||"string"==typeof a.item;if(goog.isFunction(a))return"function"==typeof a.item}return!1},goog.dom.getAncestorByTagNameAndClass=function(a,b,c,d){if(!b&&!c)return null;var e=b?b.toUpperCase():null;return goog.dom.getAncestor(a,function(a){return(!e||a.nodeName==e)&&(!c||goog.isString(a.className)&&goog.array.contains(a.className.split(/\s+/),c))},!0,d)},goog.dom.getAncestorByClass=function(a,b,c){return goog.dom.getAncestorByTagNameAndClass(a,null,b,c)},goog.dom.getAncestor=function(a,b,c,d){c||(a=a.parentNode),c=null==d;for(var e=0;a&&(c||d>=e);){if(goog.asserts.assert("parentNode"!=a.name),b(a))return a;a=a.parentNode,e++}return null},goog.dom.getActiveElement=function(a){try{return a&&a.activeElement}catch(b){}return null},goog.dom.getPixelRatio=function(){var a=goog.dom.getWindow();return goog.isDef(a.devicePixelRatio)?a.devicePixelRatio:a.matchMedia?goog.dom.matchesPixelRatio_(.75)||goog.dom.matchesPixelRatio_(1.5)||goog.dom.matchesPixelRatio_(2)||goog.dom.matchesPixelRatio_(3)||1:1},goog.dom.matchesPixelRatio_=function(a){return goog.dom.getWindow().matchMedia("(-webkit-min-device-pixel-ratio: "+a+"),(min--moz-device-pixel-ratio: "+a+"),(min-resolution: "+a+"dppx)").matches?a:0},goog.dom.DomHelper=function(a){this.document_=a||goog.global.document||document},goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper,goog.dom.DomHelper.prototype.setDocument=function(a){this.document_=a},goog.dom.DomHelper.prototype.getDocument=function(){return this.document_},goog.dom.DomHelper.prototype.getElement=function(a){return goog.dom.getElementHelper_(this.document_,a)},goog.dom.DomHelper.prototype.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(this.document_,a)},goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement,goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(this.document_,a,b,c)},goog.dom.DomHelper.prototype.getElementsByClass=function(a,b){return goog.dom.getElementsByClass(a,b||this.document_)},goog.dom.DomHelper.prototype.getElementByClass=function(a,b){return goog.dom.getElementByClass(a,b||this.document_)},goog.dom.DomHelper.prototype.getRequiredElementByClass=function(a,b){return goog.dom.getRequiredElementByClass(a,b||this.document_)},goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass,goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties,goog.dom.DomHelper.prototype.getViewportSize=function(a){return goog.dom.getViewportSize(a||this.getWindow())},goog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())},goog.dom.DomHelper.prototype.createDom=function(a,b,c){return goog.dom.createDom_(this.document_,arguments)},goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom,goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)},goog.dom.DomHelper.prototype.createTextNode=function(a){return this.document_.createTextNode(String(a))},goog.dom.DomHelper.prototype.createTable=function(a,b,c){return goog.dom.createTable_(this.document_,a,b,!!c)},goog.dom.DomHelper.prototype.safeHtmlToNode=function(a){return goog.dom.safeHtmlToNode_(this.document_,a)},goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(this.document_,a)},goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)},goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)},goog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)},goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)},goog.dom.DomHelper.prototype.getActiveElement=function(a){return goog.dom.getActiveElement(a||this.document_)},goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild,goog.dom.DomHelper.prototype.append=goog.dom.append,goog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren,goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren,goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore,goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter,goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt,goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode,goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode,goog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement,goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren,goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild,goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild,goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling,goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling,goog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode,goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode,goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike,goog.dom.DomHelper.prototype.isElement=goog.dom.isElement,goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow,goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement,goog.dom.DomHelper.prototype.contains=goog.dom.contains,goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder,goog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor,goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument,goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument,goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow,goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent,goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml,goog.dom.DomHelper.prototype.findNode=goog.dom.findNode,goog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes,goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex,goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex,goog.dom.DomHelper.prototype.isFocusable=goog.dom.isFocusable,goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent,goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength,goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset,goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset,goog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList,goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass,goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass,goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor,goog.dom.vendor={},goog.dom.vendor.getVendorJsPrefix=function(){return goog.userAgent.WEBKIT?"Webkit":goog.userAgent.GECKO?"Moz":goog.userAgent.IE?"ms":goog.userAgent.OPERA?"O":null},goog.dom.vendor.getVendorPrefix=function(){return goog.userAgent.WEBKIT?"-webkit":goog.userAgent.GECKO?"-moz":goog.userAgent.IE?"-ms":goog.userAgent.OPERA?"-o":null},goog.dom.vendor.getPrefixedPropertyName=function(a,b){if(b&&a in b)return a;var c=goog.dom.vendor.getVendorJsPrefix();return c?(c=c.toLowerCase(),c+=goog.string.toTitleCase(a),!goog.isDef(b)||c in b?c:null):null},goog.dom.vendor.getPrefixedEventType=function(a){return((goog.dom.vendor.getVendorJsPrefix()||"")+a).toLowerCase()},goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!goog.global.navigator||!goog.global.navigator.msMaxTouchPoints)},goog.events.getVendorPrefixedName_=function(a){return goog.userAgent.WEBKIT?"webkit"+a:goog.userAgent.OPERA?"o"+a.toLowerCase():a.toLowerCase()},goog.events.EventType={CLICK:"click",RIGHTCLICK:"rightclick",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",SELECTSTART:"selectstart",WHEEL:"wheel",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",RESET:"reset",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:goog.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:goog.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:goog.events.getVendorPrefixedName_("AnimationIteration"),TRANSITIONEND:goog.events.getVendorPrefixedName_("TransitionEnd"),POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXT:"text",TEXTINPUT:"textInput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange",STORAGE:"storage",DOMSUBTREEMODIFIED:"DOMSubtreeModified",DOMNODEINSERTED:"DOMNodeInserted",DOMNODEREMOVED:"DOMNodeRemoved",DOMNODEREMOVEDFROMDOCUMENT:"DOMNodeRemovedFromDocument",DOMNODEINSERTEDINTODOCUMENT:"DOMNodeInsertedIntoDocument",DOMATTRMODIFIED:"DOMAttrModified",DOMCHARACTERDATAMODIFIED:"DOMCharacterDataModified",BEFOREPRINT:"beforeprint",AFTERPRINT:"afterprint"},goog.events.BrowserEvent=function(a,b){goog.events.Event.call(this,a?a.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.platformModifierKey=!1,this.event_=null,a&&this.init(a,b)},goog.inherits(goog.events.BrowserEvent,goog.events.Event),goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2},goog.events.BrowserEvent.IEButtonMap=[1,4,2],goog.events.BrowserEvent.prototype.init=function(a,b){var c=this.type=a.type;this.target=a.target||a.srcElement,this.currentTarget=b;var d=a.relatedTarget;d?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(d,"nodeName")||(d=null)):c==goog.events.EventType.MOUSEOVER?d=a.fromElement:c==goog.events.EventType.MOUSEOUT&&(d=a.toElement),this.relatedTarget=d,this.offsetX=goog.userAgent.WEBKIT||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=goog.userAgent.WEBKIT||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0,this.button=a.button,this.keyCode=a.keyCode||0,this.charCode=a.charCode||("keypress"==c?a.keyCode:0),this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.platformModifierKey=goog.userAgent.MAC?a.metaKey:a.ctrlKey,this.state=a.state,this.event_=a,a.defaultPrevented&&this.preventDefault()},goog.events.BrowserEvent.prototype.isButton=function(a){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==a:"click"==this.type?a==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[a])},goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)},goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this),this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0},goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(b){}},goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_},goog.events.LISTENER_MAP_PROP_="closure_lm_"+(1e6*Math.random()|0),goog.events.onString_="on",goog.events.onStringMap_={},goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2},goog.events.CAPTURE_SIMULATION_MODE=2,goog.events.listenerCountEstimate_=0,goog.events.listen=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listen(a,b[f],c,d,e);return null}return c=goog.events.wrapListener(c),goog.events.Listenable.isImplementedBy(a)?a.listen(b,c,d,e):goog.events.listen_(a,b,c,!1,d,e)},goog.events.listen_=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e;if(g&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL)return goog.asserts.fail("Can not register capture listener in IE8-."),null;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT)return null}var h=goog.events.getListenerMap_(a);if(h||(a[goog.events.LISTENER_MAP_PROP_]=h=new goog.events.ListenerMap(a)),c=h.add(b,c,d,e,f),c.proxy)return c;if(d=goog.events.getProxy(),c.proxy=d,d.src=a,d.listener=c,a.addEventListener)a.addEventListener(b.toString(),d,g);else{if(!a.attachEvent)throw Error("addEventListener and attachEvent are unavailable.");a.attachEvent(goog.events.getOnString_(b.toString()),d)}return goog.events.listenerCountEstimate_++,c},goog.events.getProxy=function(){var a=goog.events.handleBrowserEvent_,b=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(c){return a.call(b.src,b.listener,c)}:function(c){return c=a.call(b.src,b.listener,c),c?void 0:c};return b},goog.events.listenOnce=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listenOnce(a,b[f],c,d,e);return null}return c=goog.events.wrapListener(c),goog.events.Listenable.isImplementedBy(a)?a.listenOnce(b,c,d,e):goog.events.listen_(a,b,c,!0,d,e)},goog.events.listenWithWrapper=function(a,b,c,d,e){b.listen(a,c,d,e)},goog.events.unlisten=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.unlisten(a,b[f],c,d,e);return null}return c=goog.events.wrapListener(c),goog.events.Listenable.isImplementedBy(a)?a.unlisten(b,c,d,e):a?(d=!!d,(a=goog.events.getListenerMap_(a))&&(b=a.getListener(b,c,d,e))?goog.events.unlistenByKey(b):!1):!1},goog.events.unlistenByKey=function(a){if(goog.isNumber(a)||!a||a.removed)return!1;var b=a.src;if(goog.events.Listenable.isImplementedBy(b))return b.unlistenByKey(a);var c=a.type,d=a.proxy;return b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(goog.events.getOnString_(c),d),goog.events.listenerCountEstimate_--,(c=goog.events.getListenerMap_(b))?(c.removeByKey(a),0==c.getTypeCount()&&(c.src=null,b[goog.events.LISTENER_MAP_PROP_]=null)):a.markAsRemoved(),!0},goog.events.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e)},goog.events.removeAll=function(a,b){if(!a)return 0;if(goog.events.Listenable.isImplementedBy(a))return a.removeAllListeners(b);var c=goog.events.getListenerMap_(a);if(!c)return 0;var f,d=0,e=b&&b.toString();for(f in c.listeners)if(!e||f==e)for(var g=c.listeners[f].concat(),h=0;h<g.length;++h)goog.events.unlistenByKey(g[h])&&++d;return d},goog.events.getListeners=function(a,b,c){return goog.events.Listenable.isImplementedBy(a)?a.getListeners(b,c):a&&(a=goog.events.getListenerMap_(a))?a.getListeners(b,c):[]},goog.events.getListener=function(a,b,c,d,e){return c=goog.events.wrapListener(c),d=!!d,goog.events.Listenable.isImplementedBy(a)?a.getListener(b,c,d,e):a&&(a=goog.events.getListenerMap_(a))?a.getListener(b,c,d,e):null},goog.events.hasListener=function(a,b,c){return goog.events.Listenable.isImplementedBy(a)?a.hasListener(b,c):(a=goog.events.getListenerMap_(a),!!a&&a.hasListener(b,c))},goog.events.expose=function(a){var c,b=[];for(c in a)b.push(a[c]&&a[c].id?c+" = "+a[c]+" ("+a[c].id+")":c+" = "+a[c]);return b.join("\n")},goog.events.getOnString_=function(a){return a in goog.events.onStringMap_?goog.events.onStringMap_[a]:goog.events.onStringMap_[a]=goog.events.onString_+a},goog.events.fireListeners=function(a,b,c,d){return goog.events.Listenable.isImplementedBy(a)?a.fireListeners(b,c,d):goog.events.fireListeners_(a,b,c,d)},goog.events.fireListeners_=function(a,b,c,d){var e=!0;if((a=goog.events.getListenerMap_(a))&&(b=a.listeners[b.toString()]))for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.removed&&(f=goog.events.fireListener(f,d),e=e&&!1!==f)}return e},goog.events.fireListener=function(a,b){var c=a.listener,d=a.handler||a.src;return a.callOnce&&goog.events.unlistenByKey(a),c.call(d,b)},goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_},goog.events.dispatchEvent=function(a,b){return goog.asserts.assert(goog.events.Listenable.isImplementedBy(a),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance."),a.dispatchEvent(b)},goog.events.protectBrowserEventEntryPoint=function(a){goog.events.handleBrowserEvent_=a.protectEntryPoint(goog.events.handleBrowserEvent_)},goog.events.handleBrowserEvent_=function(a,b){if(a.removed)return!0;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var c=b||goog.getObjectByName("window.event"),d=new goog.events.BrowserEvent(c,this),e=!0;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(c)){goog.events.markIeEvent_(c);for(var c=[],f=d.currentTarget;f;f=f.parentNode)c.push(f);for(var f=a.type,g=c.length-1;!d.propagationStopped_&&g>=0;g--){d.currentTarget=c[g];var h=goog.events.fireListeners_(c[g],f,!0,d),e=e&&h}for(g=0;!d.propagationStopped_&&g<c.length;g++)d.currentTarget=c[g],h=goog.events.fireListeners_(c[g],f,!1,d),e=e&&h}}else e=goog.events.fireListener(a,d);return e}return goog.events.fireListener(a,new goog.events.BrowserEvent(b,this))},goog.events.markIeEvent_=function(a){var b=!1;if(0==a.keyCode)try{return void(a.keyCode=-1)}catch(c){b=!0}(b||void 0==a.returnValue)&&(a.returnValue=!0)},goog.events.isMarkedIeEvent_=function(a){return 0>a.keyCode||void 0!=a.returnValue},goog.events.uniqueIdCounter_=0,goog.events.getUniqueId=function(a){return a+"_"+goog.events.uniqueIdCounter_++},goog.events.getListenerMap_=function(a){return a=a[goog.events.LISTENER_MAP_PROP_],a instanceof goog.events.ListenerMap?a:null},goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1e9*Math.random()>>>0),goog.events.wrapListener=function(a){return goog.asserts.assert(a,"Listener can not be null."),goog.isFunction(a)?a:(goog.asserts.assert(a.handleEvent,"An object listener must have handleEvent method."),a[goog.events.LISTENER_WRAPPER_PROP_]||(a[goog.events.LISTENER_WRAPPER_PROP_]=function(b){return a.handleEvent(b)}),a[goog.events.LISTENER_WRAPPER_PROP_])},goog.debug.entryPointRegistry.register(function(a){goog.events.handleBrowserEvent_=a(goog.events.handleBrowserEvent_)}),goog.events.EventHandler=function(a){goog.Disposable.call(this),this.handler_=a,this.keys_={}},goog.inherits(goog.events.EventHandler,goog.Disposable),goog.events.EventHandler.typeArray_=[],goog.events.EventHandler.prototype.listen=function(a,b,c,d){return this.listen_(a,b,c,d)},goog.events.EventHandler.prototype.listenWithScope=function(a,b,c,d,e){return this.listen_(a,b,c,d,e)},goog.events.EventHandler.prototype.listen_=function(a,b,c,d,e){goog.isArray(b)||(b&&(goog.events.EventHandler.typeArray_[0]=b.toString()),b=goog.events.EventHandler.typeArray_);for(var f=0;f<b.length;f++){var g=goog.events.listen(a,b[f],c||this.handleEvent,d||!1,e||this.handler_||this);if(!g)break;this.keys_[g.key]=g}return this},goog.events.EventHandler.prototype.listenOnce=function(a,b,c,d){return this.listenOnce_(a,b,c,d)},goog.events.EventHandler.prototype.listenOnceWithScope=function(a,b,c,d,e){return this.listenOnce_(a,b,c,d,e)},goog.events.EventHandler.prototype.listenOnce_=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.listenOnce_(a,b[f],c,d,e);else{if(a=goog.events.listenOnce(a,b,c||this.handleEvent,d,e||this.handler_||this),!a)return this;this.keys_[a.key]=a}return this},goog.events.EventHandler.prototype.listenWithWrapper=function(a,b,c,d){return this.listenWithWrapper_(a,b,c,d)},goog.events.EventHandler.prototype.listenWithWrapperAndScope=function(a,b,c,d,e){return this.listenWithWrapper_(a,b,c,d,e)},goog.events.EventHandler.prototype.listenWithWrapper_=function(a,b,c,d,e){return b.listen(a,c,d,e||this.handler_||this,this),this},goog.events.EventHandler.prototype.getListenerCount=function(){var b,a=0;for(b in this.keys_)Object.prototype.hasOwnProperty.call(this.keys_,b)&&a++;return a},goog.events.EventHandler.prototype.unlisten=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else(a=goog.events.getListener(a,b,c||this.handleEvent,d,e||this.handler_||this))&&(goog.events.unlistenByKey(a),delete this.keys_[a.key]);return this},goog.events.EventHandler.prototype.unlistenWithWrapper=function(a,b,c,d,e){return b.unlisten(a,c,d,e||this.handler_||this,this),this},goog.events.EventHandler.prototype.removeAll=function(){goog.object.forEach(this.keys_,function(a,b){this.keys_.hasOwnProperty(b)&&goog.events.unlistenByKey(a)},this),this.keys_={}},goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this),this.removeAll()},goog.events.EventHandler.prototype.handleEvent=function(a){throw Error("EventHandler.handleEvent not implemented")},goog.events.EventTarget=function(){goog.Disposable.call(this),this.eventTargetListeners_=new goog.events.ListenerMap(this),this.actualEventTarget_=this,this.parentEventTarget_=null},goog.inherits(goog.events.EventTarget,goog.Disposable),goog.events.Listenable.addImplementation(goog.events.EventTarget),goog.events.EventTarget.MAX_ANCESTORS_=1e3,goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_},goog.events.EventTarget.prototype.setParentEventTarget=function(a){this.parentEventTarget_=a},goog.events.EventTarget.prototype.addEventListener=function(a,b,c,d){goog.events.listen(this,a,b,c,d)},goog.events.EventTarget.prototype.removeEventListener=function(a,b,c,d){
goog.events.unlisten(this,a,b,c,d)},goog.events.EventTarget.prototype.dispatchEvent=function(a){this.assertInitialized_();var b,c=this.getParentEventTarget();if(c){b=[];for(var d=1;c;c=c.getParentEventTarget())b.push(c),goog.asserts.assert(++d<goog.events.EventTarget.MAX_ANCESTORS_,"infinite loop")}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,a,b)},goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this),this.removeAllListeners(),this.parentEventTarget_=null},goog.events.EventTarget.prototype.listen=function(a,b,c,d){return this.assertInitialized_(),this.eventTargetListeners_.add(String(a),b,!1,c,d)},goog.events.EventTarget.prototype.listenOnce=function(a,b,c,d){return this.eventTargetListeners_.add(String(a),b,!0,c,d)},goog.events.EventTarget.prototype.unlisten=function(a,b,c,d){return this.eventTargetListeners_.remove(String(a),b,c,d)},goog.events.EventTarget.prototype.unlistenByKey=function(a){return this.eventTargetListeners_.removeByKey(a)},goog.events.EventTarget.prototype.removeAllListeners=function(a){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(a):0},goog.events.EventTarget.prototype.fireListeners=function(a,b,c){if(a=this.eventTargetListeners_.listeners[String(a)],!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.removed&&f.capture==b){var g=f.listener,h=f.handler||f.src;f.callOnce&&this.unlistenByKey(f),d=!1!==g.call(h,c)&&d}}return d&&0!=c.returnValue_},goog.events.EventTarget.prototype.getListeners=function(a,b){return this.eventTargetListeners_.getListeners(String(a),b)},goog.events.EventTarget.prototype.getListener=function(a,b,c,d){return this.eventTargetListeners_.getListener(String(a),b,c,d)},goog.events.EventTarget.prototype.hasListener=function(a,b){var c=goog.isDef(a)?String(a):void 0;return this.eventTargetListeners_.hasListener(c,b)},goog.events.EventTarget.prototype.setTargetForTesting=function(a){this.actualEventTarget_=a},goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")},goog.events.EventTarget.dispatchEventInternal_=function(a,b,c){var d=b.type||b;if(goog.isString(b))b=new goog.events.Event(b,a);else if(b instanceof goog.events.Event)b.target=b.target||a;else{var e=b;b=new goog.events.Event(d,a),goog.object.extend(b,e)}var f,e=!0;if(c)for(var g=c.length-1;!b.propagationStopped_&&g>=0;g--)f=b.currentTarget=c[g],e=f.fireListeners(d,!0,b)&&e;if(b.propagationStopped_||(f=b.currentTarget=a,e=f.fireListeners(d,!0,b)&&e,b.propagationStopped_||(e=f.fireListeners(d,!1,b)&&e)),c)for(g=0;!b.propagationStopped_&&g<c.length;g++)f=b.currentTarget=c[g],e=f.fireListeners(d,!1,b)&&e;return e},goog.style={},goog.style.setStyle=function(a,b,c){if(goog.isString(b))goog.style.setStyle_(a,c,b);else for(var d in b)goog.style.setStyle_(a,b[d],d)},goog.style.setStyle_=function(a,b,c){(c=goog.style.getVendorJsStyleName_(a,c))&&(a.style[c]=b)},goog.style.styleNameCache_={},goog.style.getVendorJsStyleName_=function(a,b){var c=goog.style.styleNameCache_[b];if(!c){var d=goog.string.toCamelCase(b),c=d;void 0===a.style[d]&&(d=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(d),void 0!==a.style[d]&&(c=d)),goog.style.styleNameCache_[b]=c}return c},goog.style.getVendorStyleName_=function(a,b){var c=goog.string.toCamelCase(b);return void 0===a.style[c]&&(c=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(c),void 0!==a.style[c])?goog.dom.vendor.getVendorPrefix()+"-"+b:b},goog.style.getStyle=function(a,b){var c=a.style[goog.string.toCamelCase(b)];return"undefined"!=typeof c?c:a.style[goog.style.getVendorJsStyleName_(a,b)]||""},goog.style.getComputedStyle=function(a,b){var c=goog.dom.getOwnerDocument(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b)||"":""},goog.style.getCascadedStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:null},goog.style.getStyle_=function(a,b){return goog.style.getComputedStyle(a,b)||goog.style.getCascadedStyle(a,b)||a.style&&a.style[b]},goog.style.getComputedBoxSizing=function(a){return goog.style.getStyle_(a,"boxSizing")||goog.style.getStyle_(a,"MozBoxSizing")||goog.style.getStyle_(a,"WebkitBoxSizing")||null},goog.style.getComputedPosition=function(a){return goog.style.getStyle_(a,"position")},goog.style.getBackgroundColor=function(a){return goog.style.getStyle_(a,"backgroundColor")},goog.style.getComputedOverflowX=function(a){return goog.style.getStyle_(a,"overflowX")},goog.style.getComputedOverflowY=function(a){return goog.style.getStyle_(a,"overflowY")},goog.style.getComputedZIndex=function(a){return goog.style.getStyle_(a,"zIndex")},goog.style.getComputedTextAlign=function(a){return goog.style.getStyle_(a,"textAlign")},goog.style.getComputedCursor=function(a){return goog.style.getStyle_(a,"cursor")},goog.style.getComputedTransform=function(a){var b=goog.style.getVendorStyleName_(a,"transform");return goog.style.getStyle_(a,b)||goog.style.getStyle_(a,"transform")},goog.style.setPosition=function(a,b,c){var d;b instanceof goog.math.Coordinate?(d=b.x,b=b.y):(d=b,b=c),a.style.left=goog.style.getPixelStyleValue_(d,!1),a.style.top=goog.style.getPixelStyleValue_(b,!1)},goog.style.getPosition=function(a){return new goog.math.Coordinate(a.offsetLeft,a.offsetTop)},goog.style.getClientViewportElement=function(a){return a=a?goog.dom.getOwnerDocument(a):goog.dom.getDocument(),!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9)||goog.dom.getDomHelper(a).isCss1CompatMode()?a.documentElement:a.body},goog.style.getViewportPageOffset=function(a){var b=a.body;return a=a.documentElement,new goog.math.Coordinate(b.scrollLeft||a.scrollLeft,b.scrollTop||a.scrollTop)},goog.style.getBoundingClientRect_=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}return goog.userAgent.IE&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop),b},goog.style.getOffsetParent=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8))return a.offsetParent;var b=goog.dom.getOwnerDocument(a),c=goog.style.getStyle_(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(a.nodeType==goog.dom.NodeType.DOCUMENT_FRAGMENT&&a.host&&(a=a.host),c=goog.style.getStyle_(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null},goog.style.getVisibleRectForElement=function(a){for(var b=new goog.math.Box(0,1/0,1/0,0),c=goog.dom.getDomHelper(a),d=c.getDocument().body,e=c.getDocument().documentElement,f=c.getDocumentScrollElement();a=goog.style.getOffsetParent(a);)if(!(goog.userAgent.IE&&0==a.clientWidth||goog.userAgent.WEBKIT&&0==a.clientHeight&&a==d)&&a!=d&&a!=e&&"visible"!=goog.style.getStyle_(a,"overflow")){var g=goog.style.getPageOffset(a),h=goog.style.getClientLeftTop(a);g.x+=h.x,g.y+=h.y,b.top=Math.max(b.top,g.y),b.right=Math.min(b.right,g.x+a.clientWidth),b.bottom=Math.min(b.bottom,g.y+a.clientHeight),b.left=Math.max(b.left,g.x)}return d=f.scrollLeft,f=f.scrollTop,b.left=Math.max(b.left,d),b.top=Math.max(b.top,f),c=c.getViewportSize(),b.right=Math.min(b.right,d+c.width),b.bottom=Math.min(b.bottom,f+c.height),0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null},goog.style.getContainerOffsetToScrollInto=function(a,b,c){var d=goog.style.getPageOffset(a),e=goog.style.getPageOffset(b),f=goog.style.getBorderBox(b),g=d.x-e.x-f.left,d=d.y-e.y-f.top,h=b.clientWidth-a.offsetWidth;a=b.clientHeight-a.offsetHeight;var k=b.scrollLeft,l=b.scrollTop;return(b==goog.dom.getDocument().body||b==goog.dom.getDocument().documentElement)&&(k=e.x+f.left,l=e.y+f.top,goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(10)&&(k+=f.left,l+=f.top)),c?(k+=g-h/2,l+=d-a/2):(k+=Math.min(g,Math.max(g-h,0)),l+=Math.min(d,Math.max(d-a,0))),new goog.math.Coordinate(k,l)},goog.style.scrollIntoContainerView=function(a,b,c){a=goog.style.getContainerOffsetToScrollInto(a,b,c),b.scrollLeft=a.x,b.scrollTop=a.y},goog.style.getClientLeftTop=function(a){return new goog.math.Coordinate(a.clientLeft,a.clientTop)},goog.style.getPageOffset=function(a){var b=goog.dom.getOwnerDocument(a);goog.asserts.assertObject(a,"Parameter is required");var c=new goog.math.Coordinate(0,0),d=goog.style.getClientViewportElement(b);return a==d?c:(a=goog.style.getBoundingClientRect_(a),b=goog.dom.getDomHelper(b).getDocumentScroll(),c.x=a.left+b.x,c.y=a.top+b.y,c)},goog.style.getPageOffsetLeft=function(a){return goog.style.getPageOffset(a).x},goog.style.getPageOffsetTop=function(a){return goog.style.getPageOffset(a).y},goog.style.getFramedPageOffset=function(a,b){var c=new goog.math.Coordinate(0,0),d=goog.dom.getWindow(goog.dom.getOwnerDocument(a)),e=a;do{var f=d==b?goog.style.getPageOffset(e):goog.style.getClientPositionForElement_(goog.asserts.assert(e));c.x+=f.x,c.y+=f.y}while(d&&d!=b&&d!=d.parent&&(e=d.frameElement)&&(d=d.parent));return c},goog.style.translateRectForAnotherFrame=function(a,b,c){if(b.getDocument()!=c.getDocument()){var d=b.getDocument().body;c=goog.style.getFramedPageOffset(d,c.getWindow()),c=goog.math.Coordinate.difference(c,goog.style.getPageOffset(d)),!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9)||b.isCss1CompatMode()||(c=goog.math.Coordinate.difference(c,b.getDocumentScroll())),a.left+=c.x,a.top+=c.y}},goog.style.getRelativePosition=function(a,b){var c=goog.style.getClientPosition(a),d=goog.style.getClientPosition(b);return new goog.math.Coordinate(c.x-d.x,c.y-d.y)},goog.style.getClientPositionForElement_=function(a){return a=goog.style.getBoundingClientRect_(a),new goog.math.Coordinate(a.left,a.top)},goog.style.getClientPosition=function(a){if(goog.asserts.assert(a),a.nodeType==goog.dom.NodeType.ELEMENT)return goog.style.getClientPositionForElement_(a);var b=goog.isFunction(a.getBrowserEvent),c=a;return a.targetTouches&&a.targetTouches.length?c=a.targetTouches[0]:b&&a.getBrowserEvent().targetTouches&&a.getBrowserEvent().targetTouches.length&&(c=a.getBrowserEvent().targetTouches[0]),new goog.math.Coordinate(c.clientX,c.clientY)},goog.style.setPageOffset=function(a,b,c){var d=goog.style.getPageOffset(a);b instanceof goog.math.Coordinate&&(c=b.y,b=b.x),goog.style.setPosition(a,a.offsetLeft+(b-d.x),a.offsetTop+(c-d.y))},goog.style.setSize=function(a,b,c){if(b instanceof goog.math.Size)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");goog.style.setWidth(a,b),goog.style.setHeight(a,c)},goog.style.getPixelStyleValue_=function(a,b){return"number"==typeof a&&(a=(b?Math.round(a):a)+"px"),a},goog.style.setHeight=function(a,b){a.style.height=goog.style.getPixelStyleValue_(b,!0)},goog.style.setWidth=function(a,b){a.style.width=goog.style.getPixelStyleValue_(b,!0)},goog.style.getSize=function(a){return goog.style.evaluateWithTemporaryDisplay_(goog.style.getSizeWithDisplay_,a)},goog.style.evaluateWithTemporaryDisplay_=function(a,b){if("none"!=goog.style.getStyle_(b,"display"))return a(b);var c=b.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden",c.position="absolute",c.display="inline";var g=a(b);return c.display=d,c.position=f,c.visibility=e,g},goog.style.getSizeWithDisplay_=function(a){var b=a.offsetWidth,c=a.offsetHeight,d=goog.userAgent.WEBKIT&&!b&&!c;return goog.isDef(b)&&!d||!a.getBoundingClientRect?new goog.math.Size(b,c):(a=goog.style.getBoundingClientRect_(a),new goog.math.Size(a.right-a.left,a.bottom-a.top))},goog.style.getTransformedSize=function(a){return a.getBoundingClientRect?(a=goog.style.evaluateWithTemporaryDisplay_(goog.style.getBoundingClientRect_,a),new goog.math.Size(a.right-a.left,a.bottom-a.top)):null},goog.style.getBounds=function(a){var b=goog.style.getPageOffset(a);return a=goog.style.getSize(a),new goog.math.Rect(b.x,b.y,a.width,a.height)},goog.style.toCamelCase=function(a){return goog.string.toCamelCase(String(a))},goog.style.toSelectorCase=function(a){return goog.string.toSelectorCase(a)},goog.style.getOpacity=function(a){var b=a.style;return a="","opacity"in b?a=b.opacity:"MozOpacity"in b?a=b.MozOpacity:"filter"in b&&(b=b.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(a=String(b[1]/100)),""==a?a:Number(a)},goog.style.setOpacity=function(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")},goog.style.setTransparentBackgroundImage=function(a,b){var c=a.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?c.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+b+'", sizingMethod="crop")':(c.backgroundImage="url("+b+")",c.backgroundPosition="top left",c.backgroundRepeat="no-repeat")},goog.style.clearTransparentBackgroundImage=function(a){a=a.style,"filter"in a?a.filter="":a.backgroundImage="none"},goog.style.showElement=function(a,b){goog.style.setElementShown(a,b)},goog.style.setElementShown=function(a,b){a.style.display=b?"":"none"},goog.style.isElementShown=function(a){return"none"!=a.style.display},goog.style.installStyles=function(a,b){var c=goog.dom.getDomHelper(b),d=null,e=c.getDocument();return goog.userAgent.IE&&e.createStyleSheet?(d=e.createStyleSheet(),goog.style.setStyles(d,a)):(e=c.getElementsByTagNameAndClass(goog.dom.TagName.HEAD)[0],e||(d=c.getElementsByTagNameAndClass(goog.dom.TagName.BODY)[0],e=c.createDom(goog.dom.TagName.HEAD),d.parentNode.insertBefore(e,d)),d=c.createDom(goog.dom.TagName.STYLE),goog.style.setStyles(d,a),c.appendChild(e,d)),d},goog.style.uninstallStyles=function(a){goog.dom.removeNode(a.ownerNode||a.owningElement||a)},goog.style.setStyles=function(a,b){goog.userAgent.IE&&goog.isDef(a.cssText)?a.cssText=b:a.innerHTML=b},goog.style.setPreWrap=function(a){a=a.style,goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.whiteSpace="pre",a.wordWrap="break-word"):a.whiteSpace=goog.userAgent.GECKO?"-moz-pre-wrap":"pre-wrap"},goog.style.setInlineBlock=function(a){a=a.style,a.position="relative",goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.zoom="1",a.display="inline"):a.display="inline-block"},goog.style.isRightToLeft=function(a){return"rtl"==goog.style.getStyle_(a,"direction")},goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null,goog.style.isUnselectable=function(a){return goog.style.unselectableStyle_?"none"==a.style[goog.style.unselectableStyle_].toLowerCase():goog.userAgent.IE||goog.userAgent.OPERA?"on"==a.getAttribute("unselectable"):!1},goog.style.setUnselectable=function(a,b,c){c=c?null:a.getElementsByTagName("*");var d=goog.style.unselectableStyle_;if(d){if(b=b?"none":"",a.style&&(a.style[d]=b),c){a=0;for(var e;e=c[a];a++)e.style&&(e.style[d]=b)}}else if((goog.userAgent.IE||goog.userAgent.OPERA)&&(b=b?"on":"",a.setAttribute("unselectable",b),c))for(a=0;e=c[a];a++)e.setAttribute("unselectable",b)},goog.style.getBorderBoxSize=function(a){return new goog.math.Size(a.offsetWidth,a.offsetHeight)},goog.style.setBorderBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10")||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"border-box");else if(c=a.style,d){var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width-e.left-d.left-d.right-e.right,c.pixelHeight=b.height-e.top-d.top-d.bottom-e.bottom}else c.pixelWidth=b.width,c.pixelHeight=b.height},goog.style.getContentBoxSize=function(a){var b=goog.dom.getOwnerDocument(a),c=goog.userAgent.IE&&a.currentStyle;return c&&goog.dom.getDomHelper(b).isCss1CompatMode()&&"auto"!=c.width&&"auto"!=c.height&&!c.boxSizing?(b=goog.style.getIePixelValue_(a,c.width,"width","pixelWidth"),a=goog.style.getIePixelValue_(a,c.height,"height","pixelHeight"),new goog.math.Size(b,a)):(c=goog.style.getBorderBoxSize(a),b=goog.style.getPaddingBox(a),a=goog.style.getBorderBox(a),new goog.math.Size(c.width-a.left-b.left-b.right-a.right,c.height-a.top-b.top-b.bottom-a.bottom))},goog.style.setContentBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10")||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"content-box");else if(c=a.style,d)c.pixelWidth=b.width,c.pixelHeight=b.height;else{var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width+e.left+d.left+d.right+e.right,c.pixelHeight=b.height+e.top+d.top+d.bottom+e.bottom}},goog.style.setBoxSizingSize_=function(a,b,c){a=a.style,goog.userAgent.GECKO?a.MozBoxSizing=c:goog.userAgent.WEBKIT?a.WebkitBoxSizing=c:a.boxSizing=c,a.width=Math.max(b.width,0)+"px",a.height=Math.max(b.height,0)+"px"},goog.style.getIePixelValue_=function(a,b,c,d){if(/^\d+px?$/.test(b))return parseInt(b,10);var e=a.style[c],f=a.runtimeStyle[c];return a.runtimeStyle[c]=a.currentStyle[c],a.style[c]=b,b=a.style[d],a.style[c]=e,a.runtimeStyle[c]=f,b},goog.style.getIePixelDistance_=function(a,b){var c=goog.style.getCascadedStyle(a,b);return c?goog.style.getIePixelValue_(a,c,"left","pixelLeft"):0},goog.style.getBox_=function(a,b){if(goog.userAgent.IE){var c=goog.style.getIePixelDistance_(a,b+"Left"),d=goog.style.getIePixelDistance_(a,b+"Right"),e=goog.style.getIePixelDistance_(a,b+"Top"),f=goog.style.getIePixelDistance_(a,b+"Bottom");return new goog.math.Box(e,d,f,c)}return c=goog.style.getComputedStyle(a,b+"Left"),d=goog.style.getComputedStyle(a,b+"Right"),e=goog.style.getComputedStyle(a,b+"Top"),f=goog.style.getComputedStyle(a,b+"Bottom"),new goog.math.Box(parseFloat(e),parseFloat(d),parseFloat(f),parseFloat(c))},goog.style.getPaddingBox=function(a){return goog.style.getBox_(a,"padding")},goog.style.getMarginBox=function(a){return goog.style.getBox_(a,"margin")},goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6},goog.style.getIePixelBorder_=function(a,b){if("none"==goog.style.getCascadedStyle(a,b+"Style"))return 0;var c=goog.style.getCascadedStyle(a,b+"Width");return c in goog.style.ieBorderWidthKeywords_?goog.style.ieBorderWidthKeywords_[c]:goog.style.getIePixelValue_(a,c,"left","pixelLeft")},goog.style.getBorderBox=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){var b=goog.style.getIePixelBorder_(a,"borderLeft"),c=goog.style.getIePixelBorder_(a,"borderRight"),d=goog.style.getIePixelBorder_(a,"borderTop");return a=goog.style.getIePixelBorder_(a,"borderBottom"),new goog.math.Box(d,c,a,b)}return b=goog.style.getComputedStyle(a,"borderLeftWidth"),c=goog.style.getComputedStyle(a,"borderRightWidth"),d=goog.style.getComputedStyle(a,"borderTopWidth"),a=goog.style.getComputedStyle(a,"borderBottomWidth"),new goog.math.Box(parseFloat(d),parseFloat(c),parseFloat(a),parseFloat(b))},goog.style.getFontFamily=function(a){var b=goog.dom.getOwnerDocument(a),c="";if(b.body.createTextRange&&goog.dom.contains(b,a)){b=b.body.createTextRange(),b.moveToElementText(a);try{c=b.queryCommandValue("FontName")}catch(d){c=""}}return c||(c=goog.style.getStyle_(a,"fontFamily")),a=c.split(","),1<a.length&&(c=a[0]),goog.string.stripQuotes(c,"\"'")},goog.style.lengthUnitRegex_=/[^\d]+$/,goog.style.getLengthUnits=function(a){return(a=a.match(goog.style.lengthUnitRegex_))&&a[0]||null},goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1},goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1},goog.style.getFontSize=function(a){var b=goog.style.getStyle_(a,"fontSize"),c=goog.style.getLengthUnits(b);if(b&&"px"==c)return parseInt(b,10);if(goog.userAgent.IE){if(c in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_)return goog.style.getIePixelValue_(a,b,"left","pixelLeft");if(a.parentNode&&a.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&c in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_)return a=a.parentNode,c=goog.style.getStyle_(a,"fontSize"),goog.style.getIePixelValue_(a,b==c?"1em":b,"left","pixelLeft")}return c=goog.dom.createDom(goog.dom.TagName.SPAN,{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"}),goog.dom.appendChild(a,c),b=c.offsetHeight,goog.dom.removeNode(c),b},goog.style.parseStyleAttribute=function(a){var b={};return goog.array.forEach(a.split(/\s*;\s*/),function(a){a=a.split(/\s*:\s*/),2==a.length&&(b[goog.string.toCamelCase(a[0].toLowerCase())]=a[1])}),b},goog.style.toStyleAttribute=function(a){var b=[];return goog.object.forEach(a,function(a,d){b.push(goog.string.toSelectorCase(d),":",a,";")}),b.join("")},goog.style.setFloat=function(a,b){a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=b},goog.style.getFloat=function(a){return a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""},goog.style.getScrollbarWidth=function(a){var b=goog.dom.createElement(goog.dom.TagName.DIV);return a&&(b.className=a),b.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px",a=goog.dom.createElement(goog.dom.TagName.DIV),goog.style.setSize(a,"200px","200px"),b.appendChild(a),goog.dom.appendChild(goog.dom.getDocument().body,b),a=b.offsetWidth-b.clientWidth,goog.dom.removeNode(b),a},goog.style.MATRIX_TRANSLATION_REGEX_=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/,goog.style.getCssTranslation=function(a){return a=goog.style.getComputedTransform(a),a&&(a=a.match(goog.style.MATRIX_TRANSLATION_REGEX_))?new goog.math.Coordinate(parseFloat(a[1]),parseFloat(a[2])):new goog.math.Coordinate(0,0)},goog.Timer=function(a,b){goog.events.EventTarget.call(this),this.interval_=a||1,this.timerObject_=b||goog.Timer.defaultTimerObject,this.boundTick_=goog.bind(this.tick_,this),this.last_=goog.now()},goog.inherits(goog.Timer,goog.events.EventTarget),goog.Timer.MAX_TIMEOUT_=2147483647,goog.Timer.INVALID_TIMEOUT_ID_=-1,goog.Timer.prototype.enabled=!1,goog.Timer.defaultTimerObject=goog.global,goog.Timer.intervalScale=.8,goog.Timer.prototype.timer_=null,goog.Timer.prototype.getInterval=function(){return this.interval_},goog.Timer.prototype.setInterval=function(a){this.interval_=a,this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()},goog.Timer.prototype.tick_=function(){if(this.enabled){var a=goog.now()-this.last_;a>0&&a<this.interval_*goog.Timer.intervalScale?this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a):(this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null),this.dispatchTick(),this.enabled&&(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now()))}},goog.Timer.prototype.dispatchTick=function(){this.dispatchEvent(goog.Timer.TICK)},goog.Timer.prototype.start=function(){this.enabled=!0,this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now())},goog.Timer.prototype.stop=function(){this.enabled=!1,this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)},goog.Timer.prototype.disposeInternal=function(){goog.Timer.superClass_.disposeInternal.call(this),this.stop(),delete this.timerObject_},goog.Timer.TICK="tick",goog.Timer.callOnce=function(a,b,c){if(goog.isFunction(a))c&&(a=goog.bind(a,c));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=goog.bind(a.handleEvent,a)}return b>goog.Timer.MAX_TIMEOUT_?goog.Timer.INVALID_TIMEOUT_ID_:goog.Timer.defaultTimerObject.setTimeout(a,b||0)},goog.Timer.clear=function(a){goog.Timer.defaultTimerObject.clearTimeout(a)},goog.Timer.promise=function(a,b){var c=null;return new goog.Promise(function(d,e){c=goog.Timer.callOnce(function(){d(b)},a),c==goog.Timer.INVALID_TIMEOUT_ID_&&e(Error("Failed to schedule timer."))}).thenCatch(function(a){throw goog.Timer.clear(c),a})},goog.History=function(a,b,c,d){if(goog.events.EventTarget.call(this),a&&!b)throw Error("Can't use invisible history without providing a blank page.");var e;if(c)e=c;else{e="history_state"+goog.History.historyCount_;var f=goog.html.SafeHtml.create("input",{type:goog.dom.InputType.TEXT,name:e,id:e,style:goog.string.Const.from("display:none")});goog.dom.safe.documentWrite(document,f),e=goog.dom.getElement(e)}this.hiddenInput_=e,this.window_=c?goog.dom.getWindow(goog.dom.getOwnerDocument(c)):window,this.iframeSrc_=goog.isString(b)?goog.html.legacyconversions.trustedResourceUrlFromString(b):b,goog.userAgent.IE&&!b&&(this.iframeSrc_=goog.html.TrustedResourceUrl.fromConstant("https"==window.location.protocol?goog.string.Const.from("https:///"):goog.string.Const.from('javascript:""'))),this.timer_=new goog.Timer(goog.History.PollingType.NORMAL),this.registerDisposable(this.timer_),this.userVisible_=!a,this.eventHandler_=new goog.events.EventHandler(this),(a||goog.History.LEGACY_IE)&&(d?a=d:(a="history_iframe"+goog.History.historyCount_,b=goog.html.SafeHtml.createIframe(this.iframeSrc_,null,{id:a,style:goog.string.Const.from("display:none"),sandbox:void 0}),goog.dom.safe.documentWrite(document,b),a=goog.dom.getElement(a)),this.iframe_=a,this.unsetIframe_=!0),goog.History.LEGACY_IE&&(this.eventHandler_.listen(this.window_,goog.events.EventType.LOAD,this.onDocumentLoaded),this.shouldEnable_=this.documentLoaded=!1),this.userVisible_?this.setHash_(this.getToken(),!0):this.setIframeToken_(this.hiddenInput_.value),goog.History.historyCount_++},goog.inherits(goog.History,goog.events.EventTarget),goog.History.prototype.enabled_=!1,goog.History.prototype.longerPolling_=!1,goog.History.prototype.lastToken_=null,goog.History.isOnHashChangeSupported=goog.memoize(function(){return goog.userAgent.IE?goog.userAgent.isDocumentModeOrHigher(8):"onhashchange"in goog.global}),goog.History.LEGACY_IE=goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8),goog.History.HASH_ALWAYS_REQUIRED=goog.History.LEGACY_IE,goog.History.prototype.lockedToken_=null,goog.History.prototype.disposeInternal=function(){goog.History.superClass_.disposeInternal.call(this),this.eventHandler_.dispose(),this.setEnabled(!1)},goog.History.prototype.setEnabled=function(a){a!=this.enabled_&&(goog.History.LEGACY_IE&&!this.documentLoaded?this.shouldEnable_=a:a?(goog.userAgent.OPERA?this.eventHandler_.listen(this.window_.document,goog.History.INPUT_EVENTS_,this.operaDefibrillator_):goog.userAgent.GECKO&&this.eventHandler_.listen(this.window_,"pageshow",this.onShow_),goog.History.isOnHashChangeSupported()&&this.userVisible_?(this.eventHandler_.listen(this.window_,goog.events.EventType.HASHCHANGE,this.onHashChange_),this.enabled_=!0,this.dispatchEvent(new goog.history.Event(this.getToken(),!1))):(!goog.userAgent.IE||goog.labs.userAgent.device.isMobile()||this.documentLoaded)&&(this.eventHandler_.listen(this.timer_,goog.Timer.TICK,goog.bind(this.check_,this,!0)),this.enabled_=!0,goog.History.LEGACY_IE||(this.lastToken_=this.getToken(),this.dispatchEvent(new goog.history.Event(this.getToken(),!1))),this.timer_.start())):(this.enabled_=!1,this.eventHandler_.removeAll(),this.timer_.stop()))},goog.History.prototype.onDocumentLoaded=function(){this.documentLoaded=!0,this.hiddenInput_.value&&this.setIframeToken_(this.hiddenInput_.value,!0),this.setEnabled(this.shouldEnable_)},goog.History.prototype.onShow_=function(a){a.getBrowserEvent().persisted&&(this.setEnabled(!1),this.setEnabled(!0))},goog.History.prototype.onHashChange_=function(a){a=this.getLocationFragment_(this.window_),a!=this.lastToken_&&this.update_(a,!0)},goog.History.prototype.getToken=function(){return null!=this.lockedToken_?this.lockedToken_:this.userVisible_?this.getLocationFragment_(this.window_):this.getIframeToken_()||""},goog.History.prototype.setToken=function(a,b){this.setHistoryState_(a,!1,b)},goog.History.prototype.replaceToken=function(a,b){this.setHistoryState_(a,!0,b)},goog.History.prototype.getLocationFragment_=function(a){a=a.location.href;var b=a.indexOf("#");return 0>b?"":a.substring(b+1)},goog.History.prototype.setHistoryState_=function(a,b,c){this.getToken()!=a&&(this.userVisible_?(this.setHash_(a,b),goog.History.isOnHashChangeSupported()||goog.userAgent.IE&&!goog.labs.userAgent.device.isMobile()&&this.setIframeToken_(a,b,c),this.enabled_&&this.check_(!1)):(this.setIframeToken_(a,b),this.lockedToken_=this.lastToken_=this.hiddenInput_.value=a,this.dispatchEvent(new goog.history.Event(a,!1))))},goog.History.prototype.setHash_=function(a,b){var c=this.window_.location,d=c.href.split("#")[0],e=goog.string.contains(c.href,"#");(goog.History.HASH_ALWAYS_REQUIRED||e||a)&&(d+="#"+a),d!=c.href&&(b?c.replace(d):c.href=d)},goog.History.prototype.setIframeToken_=function(a,b,c){if(this.unsetIframe_||a!=this.getIframeToken_())if(this.unsetIframe_=!1,a=goog.string.urlEncode(a),goog.userAgent.IE){var d=goog.dom.getFrameContentDocument(this.iframe_);d.open("text/html",b?"replace":void 0),b=goog.html.SafeHtml.concat(goog.html.SafeHtml.create("title",{},c||this.window_.document.title),goog.html.SafeHtml.create("body",{},a)),goog.dom.safe.documentWrite(d,b),d.close()}else goog.asserts.assertInstanceof(this.iframeSrc_,goog.html.TrustedResourceUrl,"this.iframeSrc_ must be set on calls to setIframeToken_"),d=goog.html.TrustedResourceUrl.unwrap(this.iframeSrc_)+"#"+a,(a=this.iframe_.contentWindow)&&(b?a.location.replace(d):a.location.href=d)},goog.History.prototype.getIframeToken_=function(){if(goog.userAgent.IE){var a=goog.dom.getFrameContentDocument(this.iframe_);return a.body?goog.string.urlDecode(a.body.innerHTML):null}if(a=this.iframe_.contentWindow){var b;try{b=goog.string.urlDecode(this.getLocationFragment_(a))}catch(c){return this.longerPolling_||this.setLongerPolling_(!0),null}return this.longerPolling_&&this.setLongerPolling_(!1),b||null}return null},goog.History.prototype.check_=function(a){if(this.userVisible_){var b=this.getLocationFragment_(this.window_);b!=this.lastToken_&&this.update_(b,a)}(!this.userVisible_||goog.History.LEGACY_IE)&&(b=this.getIframeToken_()||"",(null==this.lockedToken_||b==this.lockedToken_)&&(this.lockedToken_=null,b!=this.lastToken_&&this.update_(b,a)))},goog.History.prototype.update_=function(a,b){this.lastToken_=this.hiddenInput_.value=a,this.userVisible_?(goog.History.LEGACY_IE&&this.setIframeToken_(a),this.setHash_(a)):this.setIframeToken_(a),this.dispatchEvent(new goog.history.Event(this.getToken(),b))},goog.History.prototype.setLongerPolling_=function(a){this.longerPolling_!=a&&this.timer_.setInterval(a?goog.History.PollingType.LONG:goog.History.PollingType.NORMAL),this.longerPolling_=a},goog.History.prototype.operaDefibrillator_=function(){this.timer_.stop(),this.timer_.start()},goog.History.INPUT_EVENTS_=[goog.events.EventType.MOUSEDOWN,goog.events.EventType.KEYDOWN,goog.events.EventType.MOUSEMOVE],goog.History.historyCount_=0,goog.History.PollingType={NORMAL:150,LONG:1e4},goog.History.EventType=goog.history.EventType,goog.History.Event=goog.history.Event,goog.uri={},goog.uri.utils={},goog.uri.utils.CharCode_={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63},goog.uri.utils.buildFromEncodedParts=function(a,b,c,d,e,f,g){var h="";return a&&(h+=a+":"),c&&(h+="//",b&&(h+=b+"@"),h+=c,d&&(h+=":"+d)),e&&(h+=e),f&&(h+="?"+f),g&&(h+="#"+g),h},goog.uri.utils.splitRe_=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},goog.uri.utils.split=function(a){return goog.uri.utils.phishingProtection_(),a.match(goog.uri.utils.splitRe_)},goog.uri.utils.needsPhishingProtection_=goog.userAgent.WEBKIT,goog.uri.utils.phishingProtection_=function(){if(goog.uri.utils.needsPhishingProtection_){goog.uri.utils.needsPhishingProtection_=!1;var a=goog.global.location;if(a){var b=a.href;if(b&&(b=goog.uri.utils.getDomain(b))&&b!=a.hostname)throw goog.uri.utils.needsPhishingProtection_=!0,Error()}}},goog.uri.utils.decodeIfPossible_=function(a,b){
return a?b?decodeURI(a):decodeURIComponent(a):a},goog.uri.utils.getComponentByIndex_=function(a,b){return goog.uri.utils.split(b)[a]||null},goog.uri.utils.getScheme=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.SCHEME,a)},goog.uri.utils.getEffectiveScheme=function(a){return a=goog.uri.utils.getScheme(a),!a&&goog.global.self&&goog.global.self.location&&(a=goog.global.self.location.protocol,a=a.substr(0,a.length-1)),a?a.toLowerCase():""},goog.uri.utils.getUserInfoEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.USER_INFO,a)},goog.uri.utils.getUserInfo=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getUserInfoEncoded(a))},goog.uri.utils.getDomainEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.DOMAIN,a)},goog.uri.utils.getDomain=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getDomainEncoded(a),!0)},goog.uri.utils.getPort=function(a){return Number(goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PORT,a))||null},goog.uri.utils.getPathEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PATH,a)},goog.uri.utils.getPath=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getPathEncoded(a),!0)},goog.uri.utils.getQueryData=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.QUERY_DATA,a)},goog.uri.utils.getFragmentEncoded=function(a){var b=a.indexOf("#");return 0>b?null:a.substr(b+1)},goog.uri.utils.setFragmentEncoded=function(a,b){return goog.uri.utils.removeFragment(a)+(b?"#"+b:"")},goog.uri.utils.getFragment=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getFragmentEncoded(a))},goog.uri.utils.getHost=function(a){return a=goog.uri.utils.split(a),goog.uri.utils.buildFromEncodedParts(a[goog.uri.utils.ComponentIndex.SCHEME],a[goog.uri.utils.ComponentIndex.USER_INFO],a[goog.uri.utils.ComponentIndex.DOMAIN],a[goog.uri.utils.ComponentIndex.PORT])},goog.uri.utils.getPathAndAfter=function(a){return a=goog.uri.utils.split(a),goog.uri.utils.buildFromEncodedParts(null,null,null,null,a[goog.uri.utils.ComponentIndex.PATH],a[goog.uri.utils.ComponentIndex.QUERY_DATA],a[goog.uri.utils.ComponentIndex.FRAGMENT])},goog.uri.utils.removeFragment=function(a){var b=a.indexOf("#");return 0>b?a:a.substr(0,b)},goog.uri.utils.haveSameDomain=function(a,b){var c=goog.uri.utils.split(a),d=goog.uri.utils.split(b);return c[goog.uri.utils.ComponentIndex.DOMAIN]==d[goog.uri.utils.ComponentIndex.DOMAIN]&&c[goog.uri.utils.ComponentIndex.SCHEME]==d[goog.uri.utils.ComponentIndex.SCHEME]&&c[goog.uri.utils.ComponentIndex.PORT]==d[goog.uri.utils.ComponentIndex.PORT]},goog.uri.utils.assertNoFragmentsOrQueries_=function(a){if(goog.DEBUG&&(0<=a.indexOf("#")||0<=a.indexOf("?")))throw Error("goog.uri.utils: Fragment or query identifiers are not supported: ["+a+"]")},goog.uri.utils.parseQueryData=function(a,b){if(a)for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("="),f=null,g=null;e>=0?(f=c[d].substring(0,e),g=c[d].substring(e+1)):f=c[d],b(f,g?goog.string.urlDecode(g):"")}},goog.uri.utils.appendQueryData_=function(a){if(a[1]){var b=a[0],c=b.indexOf("#");c>=0&&(a.push(b.substr(c)),a[0]=b=b.substr(0,c)),c=b.indexOf("?"),0>c?a[1]="?":c==b.length-1&&(a[1]=void 0)}return a.join("")},goog.uri.utils.appendKeyValuePairs_=function(a,b,c){if(goog.isArray(b)){goog.asserts.assertArray(b);for(var d=0;d<b.length;d++)goog.uri.utils.appendKeyValuePairs_(a,String(b[d]),c)}else null!=b&&c.push("&",a,""===b?"":"=",goog.string.urlEncode(b))},goog.uri.utils.buildQueryDataBuffer_=function(a,b,c){for(goog.asserts.assert(0==Math.max(b.length-(c||0),0)%2,"goog.uri.utils: Key/value lists must be even in length."),c=c||0;c<b.length;c+=2)goog.uri.utils.appendKeyValuePairs_(b[c],b[c+1],a);return a},goog.uri.utils.buildQueryData=function(a,b){var c=goog.uri.utils.buildQueryDataBuffer_([],a,b);return c[0]="",c.join("")},goog.uri.utils.buildQueryDataBufferFromMap_=function(a,b){for(var c in b)goog.uri.utils.appendKeyValuePairs_(c,b[c],a);return a},goog.uri.utils.buildQueryDataFromMap=function(a){return a=goog.uri.utils.buildQueryDataBufferFromMap_([],a),a[0]="",a.join("")},goog.uri.utils.appendParams=function(a,b){return goog.uri.utils.appendQueryData_(2==arguments.length?goog.uri.utils.buildQueryDataBuffer_([a],arguments[1],0):goog.uri.utils.buildQueryDataBuffer_([a],arguments,1))},goog.uri.utils.appendParamsFromMap=function(a,b){return goog.uri.utils.appendQueryData_(goog.uri.utils.buildQueryDataBufferFromMap_([a],b))},goog.uri.utils.appendParam=function(a,b,c){return a=[a,"&",b],goog.isDefAndNotNull(c)&&a.push("=",goog.string.urlEncode(c)),goog.uri.utils.appendQueryData_(a)},goog.uri.utils.findParam_=function(a,b,c,d){for(var e=c.length;0<=(b=a.indexOf(c,b))&&d>b;){var f=a.charCodeAt(b-1);if((f==goog.uri.utils.CharCode_.AMPERSAND||f==goog.uri.utils.CharCode_.QUESTION)&&(f=a.charCodeAt(b+e),!f||f==goog.uri.utils.CharCode_.EQUAL||f==goog.uri.utils.CharCode_.AMPERSAND||f==goog.uri.utils.CharCode_.HASH))return b;b+=e+1}return-1},goog.uri.utils.hashOrEndRe_=/#|$/,goog.uri.utils.hasParam=function(a,b){return 0<=goog.uri.utils.findParam_(a,0,b,a.search(goog.uri.utils.hashOrEndRe_))},goog.uri.utils.getParamValue=function(a,b){var c=a.search(goog.uri.utils.hashOrEndRe_),d=goog.uri.utils.findParam_(a,0,b,c);if(0>d)return null;var e=a.indexOf("&",d);return(0>e||e>c)&&(e=c),d+=b.length+1,goog.string.urlDecode(a.substr(d,e-d))},goog.uri.utils.getParamValues=function(a,b){for(var e,c=a.search(goog.uri.utils.hashOrEndRe_),d=0,f=[];0<=(e=goog.uri.utils.findParam_(a,d,b,c));)d=a.indexOf("&",e),(0>d||d>c)&&(d=c),e+=b.length+1,f.push(goog.string.urlDecode(a.substr(e,d-e)));return f},goog.uri.utils.trailingQueryPunctuationRe_=/[?&]($|#)/,goog.uri.utils.removeParam=function(a,b){for(var e,c=a.search(goog.uri.utils.hashOrEndRe_),d=0,f=[];0<=(e=goog.uri.utils.findParam_(a,d,b,c));)f.push(a.substring(d,e)),d=Math.min(a.indexOf("&",e)+1||c,c);return f.push(a.substr(d)),f.join("").replace(goog.uri.utils.trailingQueryPunctuationRe_,"$1")},goog.uri.utils.setParam=function(a,b,c){return goog.uri.utils.appendParam(goog.uri.utils.removeParam(a,b),b,c)},goog.uri.utils.appendPath=function(a,b){return goog.uri.utils.assertNoFragmentsOrQueries_(a),goog.string.endsWith(a,"/")&&(a=a.substr(0,a.length-1)),goog.string.startsWith(b,"/")&&(b=b.substr(1)),goog.string.buildString(a,"/",b)},goog.uri.utils.setPath=function(a,b){goog.string.startsWith(b,"/")||(b="/"+b);var c=goog.uri.utils.split(a);return goog.uri.utils.buildFromEncodedParts(c[goog.uri.utils.ComponentIndex.SCHEME],c[goog.uri.utils.ComponentIndex.USER_INFO],c[goog.uri.utils.ComponentIndex.DOMAIN],c[goog.uri.utils.ComponentIndex.PORT],b,c[goog.uri.utils.ComponentIndex.QUERY_DATA],c[goog.uri.utils.ComponentIndex.FRAGMENT])},goog.uri.utils.StandardQueryParam={RANDOM:"zx"},goog.uri.utils.makeUnique=function(a){return goog.uri.utils.setParam(a,goog.uri.utils.StandardQueryParam.RANDOM,goog.string.getRandomString())},goog.Uri=function(a,b){this.domain_=this.userInfo_=this.scheme_="",this.port_=null,this.fragment_=this.path_="",this.ignoreCase_=this.isReadOnly_=!1;var c;a instanceof goog.Uri?(this.ignoreCase_=goog.isDef(b)?b:a.getIgnoreCase(),this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().clone()),this.setFragment(a.getFragment())):a&&(c=goog.uri.utils.split(String(a)))?(this.ignoreCase_=!!b,this.setScheme(c[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(c[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(c[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(c[goog.uri.utils.ComponentIndex.PORT]),this.setPath(c[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(c[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(c[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):(this.ignoreCase_=!!b,this.queryData_=new goog.Uri.QueryData(null,null,this.ignoreCase_))},goog.Uri.preserveParameterTypesCompatibilityFlag=!1,goog.Uri.RANDOM_PARAM=goog.uri.utils.StandardQueryParam.RANDOM,goog.Uri.prototype.toString=function(){var a=[],b=this.getScheme();if(b&&a.push(goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),b=this.getDomain()){a.push("//");var c=this.getUserInfo();c&&a.push(goog.Uri.encodeSpecialChars_(c,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),a.push(goog.Uri.removeDoubleEncoding_(goog.string.urlEncode(b))),b=this.getPort(),null!=b&&a.push(":",String(b))}return(b=this.getPath())&&(this.hasDomain()&&"/"!=b.charAt(0)&&a.push("/"),a.push(goog.Uri.encodeSpecialChars_(b,"/"==b.charAt(0)?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0))),(b=this.getEncodedQuery())&&a.push("?",b),(b=this.getFragment())&&a.push("#",goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInFragment_)),a.join("")},goog.Uri.prototype.resolve=function(a){var b=this.clone(),c=a.hasScheme();c?b.setScheme(a.getScheme()):c=a.hasUserInfo(),c?b.setUserInfo(a.getUserInfo()):c=a.hasDomain(),c?b.setDomain(a.getDomain()):c=a.hasPort();var d=a.getPath();if(c)b.setPort(a.getPort());else if(c=a.hasPath()){if("/"!=d.charAt(0))if(this.hasDomain()&&!this.hasPath())d="/"+d;else{var e=b.getPath().lastIndexOf("/");-1!=e&&(d=b.getPath().substr(0,e+1)+d)}d=goog.Uri.removeDotSegments(d)}return c?b.setPath(d):c=a.hasQuery(),c?b.setQueryData(a.getDecodedQuery()):c=a.hasFragment(),c&&b.setFragment(a.getFragment()),b},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(a,b){return this.enforceReadOnly(),(this.scheme_=b?goog.Uri.decodeOrEmpty_(a,!0):a)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(a,b){return this.enforceReadOnly(),this.userInfo_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(a,b){return this.enforceReadOnly(),this.domain_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(a){if(this.enforceReadOnly(),a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return null!=this.port_},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(a,b){return this.enforceReadOnly(),this.path_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},goog.Uri.prototype.setQueryData=function(a,b){return this.enforceReadOnly(),a instanceof goog.Uri.QueryData?(this.queryData_=a,this.queryData_.setIgnoreCase(this.ignoreCase_)):(b||(a=goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(a,null,this.ignoreCase_)),this},goog.Uri.prototype.setQuery=function(a,b){return this.setQueryData(a,b)},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getQuery=function(){return this.getEncodedQuery()},goog.Uri.prototype.setParameterValue=function(a,b){return this.enforceReadOnly(),this.queryData_.set(a,b),this},goog.Uri.prototype.setParameterValues=function(a,b){return this.enforceReadOnly(),goog.isArray(b)||(b=[String(b)]),this.queryData_.setValues(a,b),this},goog.Uri.prototype.getParameterValues=function(a){return this.queryData_.getValues(a)},goog.Uri.prototype.getParameterValue=function(a){return this.queryData_.get(a)},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(a,b){return this.enforceReadOnly(),this.fragment_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.prototype.hasSameDomainAs=function(a){return!((this.hasDomain()||a.hasDomain())&&this.getDomain()!=a.getDomain()||(this.hasPort()||a.hasPort())&&this.getPort()!=a.getPort())},goog.Uri.prototype.makeUnique=function(){return this.enforceReadOnly(),this.setParameterValue(goog.Uri.RANDOM_PARAM,goog.string.getRandomString()),this},goog.Uri.prototype.removeParameter=function(a){return this.enforceReadOnly(),this.queryData_.remove(a),this},goog.Uri.prototype.setReadOnly=function(a){return this.isReadOnly_=a,this},goog.Uri.prototype.isReadOnly=function(){return this.isReadOnly_},goog.Uri.prototype.enforceReadOnly=function(){if(this.isReadOnly_)throw Error("Tried to modify a read-only Uri")},goog.Uri.prototype.setIgnoreCase=function(a){return this.ignoreCase_=a,this.queryData_&&this.queryData_.setIgnoreCase(a),this},goog.Uri.prototype.getIgnoreCase=function(){return this.ignoreCase_},goog.Uri.parse=function(a,b){return a instanceof goog.Uri?a.clone():new goog.Uri(a,b)},goog.Uri.create=function(a,b,c,d,e,f,g,h){return h=new goog.Uri(null,h),a&&h.setScheme(a),b&&h.setUserInfo(b),c&&h.setDomain(c),d&&h.setPort(d),e&&h.setPath(e),f&&h.setQueryData(f),g&&h.setFragment(g),h},goog.Uri.resolve=function(a,b){return a instanceof goog.Uri||(a=goog.Uri.parse(a)),b instanceof goog.Uri||(b=goog.Uri.parse(b)),a.resolve(b)},goog.Uri.removeDotSegments=function(a){if(".."==a||"."==a)return"";if(goog.string.contains(a,"./")||goog.string.contains(a,"/.")){var b=goog.string.startsWith(a,"/");a=a.split("/");for(var c=[],d=0;d<a.length;){var e=a[d++];"."==e?b&&d==a.length&&c.push(""):".."==e?((1<c.length||1==c.length&&""!=c[0])&&c.pop(),b&&d==a.length&&c.push("")):(c.push(e),b=!0)}return c.join("/")}return a},goog.Uri.decodeOrEmpty_=function(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""},goog.Uri.encodeSpecialChars_=function(a,b,c){return goog.isString(a)?(a=encodeURI(a).replace(b,goog.Uri.encodeChar_),c&&(a=goog.Uri.removeDoubleEncoding_(a)),a):null},goog.Uri.encodeChar_=function(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(15&a).toString(16)},goog.Uri.removeDoubleEncoding_=function(a){return a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[\#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[\#\?]/g,goog.Uri.reDisallowedInQuery_=/[\#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.haveSameDomain=function(a,b){var c=goog.uri.utils.split(a),d=goog.uri.utils.split(b);return c[goog.uri.utils.ComponentIndex.DOMAIN]==d[goog.uri.utils.ComponentIndex.DOMAIN]&&c[goog.uri.utils.ComponentIndex.PORT]==d[goog.uri.utils.ComponentIndex.PORT]},goog.Uri.QueryData=function(a,b,c){this.count_=this.keyMap_=null,this.encodedQuery_=a||null,this.ignoreCase_=!!c},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_=new goog.structs.Map,this.count_=0,this.encodedQuery_)){var a=this;goog.uri.utils.parseQueryData(this.encodedQuery_,function(b,c){a.add(goog.string.urlDecode(b),c)})}},goog.Uri.QueryData.createFromMap=function(a,b,c){if(b=goog.structs.getKeys(a),"undefined"==typeof b)throw Error("Keys are undefined");c=new goog.Uri.QueryData(null,null,c),a=goog.structs.getValues(a);for(var d=0;d<b.length;d++){var e=b[d],f=a[d];goog.isArray(f)?c.setValues(e,f):c.add(e,f)}return c},goog.Uri.QueryData.createFromKeysValues=function(a,b,c,d){if(a.length!=b.length)throw Error("Mismatched lengths for keys/values");for(c=new goog.Uri.QueryData(null,null,d),d=0;d<a.length;d++)c.add(a[d],b[d]);return c},goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(a,b){this.ensureKeyMapInitialized_(),this.invalidateCache_(),a=this.getKeyName_(a);var c=this.keyMap_.get(a);return c||this.keyMap_.set(a,c=[]),c.push(b),this.count_++,this},goog.Uri.QueryData.prototype.remove=function(a){return this.ensureKeyMapInitialized_(),a=this.getKeyName_(a),this.keyMap_.containsKey(a)?(this.invalidateCache_(),this.count_-=this.keyMap_.get(a).length,this.keyMap_.remove(a)):!1},goog.Uri.QueryData.prototype.clear=function(){this.invalidateCache_(),this.keyMap_=null,this.count_=0},goog.Uri.QueryData.prototype.isEmpty=function(){return this.ensureKeyMapInitialized_(),0==this.count_},goog.Uri.QueryData.prototype.containsKey=function(a){return this.ensureKeyMapInitialized_(),a=this.getKeyName_(a),this.keyMap_.containsKey(a)},goog.Uri.QueryData.prototype.containsValue=function(a){var b=this.getValues();return goog.array.contains(b,a)},goog.Uri.QueryData.prototype.getKeys=function(){this.ensureKeyMapInitialized_();for(var a=this.keyMap_.getValues(),b=this.keyMap_.getKeys(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c},goog.Uri.QueryData.prototype.getValues=function(a){this.ensureKeyMapInitialized_();var b=[];if(goog.isString(a))this.containsKey(a)&&(b=goog.array.concat(b,this.keyMap_.get(this.getKeyName_(a))));else{a=this.keyMap_.getValues();for(var c=0;c<a.length;c++)b=goog.array.concat(b,a[c])}return b},goog.Uri.QueryData.prototype.set=function(a,b){return this.ensureKeyMapInitialized_(),this.invalidateCache_(),a=this.getKeyName_(a),this.containsKey(a)&&(this.count_-=this.keyMap_.get(a).length),this.keyMap_.set(a,[b]),this.count_++,this},goog.Uri.QueryData.prototype.get=function(a,b){var c=a?this.getValues(a):[];return goog.Uri.preserveParameterTypesCompatibilityFlag?0<c.length?c[0]:b:0<c.length?String(c[0]):b},goog.Uri.QueryData.prototype.setValues=function(a,b){this.remove(a),0<b.length&&(this.invalidateCache_(),this.keyMap_.set(this.getKeyName_(a),goog.array.clone(b)),this.count_+=b.length)},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=this.keyMap_.getKeys(),c=0;c<b.length;c++)for(var d=b[c],e=goog.string.urlEncode(d),d=this.getValues(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+goog.string.urlEncode(d[f])),a.push(g)}return this.encodedQuery_=a.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.invalidateCache_=function(){this.encodedQuery_=null},goog.Uri.QueryData.prototype.filterKeys=function(a){return this.ensureKeyMapInitialized_(),this.keyMap_.forEach(function(b,c){goog.array.contains(a,c)||this.remove(c)},this),this},goog.Uri.QueryData.prototype.clone=function(){var a=new goog.Uri.QueryData;return a.encodedQuery_=this.encodedQuery_,this.keyMap_&&(a.keyMap_=this.keyMap_.clone(),a.count_=this.count_),a},goog.Uri.QueryData.prototype.getKeyName_=function(a){return a=String(a),this.ignoreCase_&&(a=a.toLowerCase()),a},goog.Uri.QueryData.prototype.setIgnoreCase=function(a){a&&!this.ignoreCase_&&(this.ensureKeyMapInitialized_(),this.invalidateCache_(),this.keyMap_.forEach(function(a,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.setValues(d,a))},this)),this.ignoreCase_=a},goog.Uri.QueryData.prototype.extend=function(a){for(var b=0;b<arguments.length;b++)goog.structs.forEach(arguments[b],function(a,b){this.add(b,a)},this)},goog.userAgent.product={},goog.userAgent.product.ASSUME_FIREFOX=!1,goog.userAgent.product.ASSUME_IPHONE=!1,goog.userAgent.product.ASSUME_IPAD=!1,goog.userAgent.product.ASSUME_ANDROID=!1,goog.userAgent.product.ASSUME_CHROME=!1,goog.userAgent.product.ASSUME_SAFARI=!1,goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI,goog.userAgent.product.OPERA=goog.userAgent.OPERA,goog.userAgent.product.IE=goog.userAgent.IE,goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.labs.userAgent.browser.isFirefox(),goog.userAgent.product.isIphoneOrIpod_=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpod()},goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.isIphoneOrIpod_(),goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.labs.userAgent.browser.isAndroidBrowser(),goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.labs.userAgent.browser.isChrome(),goog.userAgent.product.isSafariDesktop_=function(){return goog.labs.userAgent.browser.isSafari()&&!goog.labs.userAgent.platform.isIos()},goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.isSafariDesktop_(),goog.dom.dataset={},goog.dom.dataset.ALLOWED_=!goog.userAgent.product.IE,goog.dom.dataset.PREFIX_="data-",goog.dom.dataset.set=function(a,b,c){goog.dom.dataset.ALLOWED_&&a.dataset?a.dataset[b]=c:a.setAttribute(goog.dom.dataset.PREFIX_+goog.string.toSelectorCase(b),c)},goog.dom.dataset.get=function(a,b){return goog.dom.dataset.ALLOWED_&&a.dataset?b in a.dataset?a.dataset[b]:null:a.getAttribute(goog.dom.dataset.PREFIX_+goog.string.toSelectorCase(b))},goog.dom.dataset.remove=function(a,b){goog.dom.dataset.ALLOWED_&&a.dataset?delete a.dataset[b]:a.removeAttribute(goog.dom.dataset.PREFIX_+goog.string.toSelectorCase(b))},goog.dom.dataset.has=function(a,b){return goog.dom.dataset.ALLOWED_&&a.dataset?b in a.dataset:a.hasAttribute?a.hasAttribute(goog.dom.dataset.PREFIX_+goog.string.toSelectorCase(b)):!!a.getAttribute(goog.dom.dataset.PREFIX_+goog.string.toSelectorCase(b))},goog.dom.dataset.getAll=function(a){if(goog.dom.dataset.ALLOWED_&&a.dataset)return a.dataset;var b={};a=a.attributes;for(var c=0;c<a.length;++c){var d=a[c];if(goog.string.startsWith(d.name,goog.dom.dataset.PREFIX_)){var e=goog.string.toCamelCase(d.name.substr(5));b[e]=d.value}}return b};var android={history:{}};android.history.AssetLoader=function(){this.loader_=window.PIXI.loader,this.progressCallbacks_=[],this.completeCallbacks_=[],this.resources={}},goog.addSingletonGetter(android.history.AssetLoader),android.history.AssetLoader.CACHE_BUSTER="1",android.history.AssetLoader.prototype.registerCompleteCallback=function(a){this.completeCallbacks_.push(a)},android.history.AssetLoader.prototype.addAsset=function(a,b){this.loader_.add(a,b+"?"+android.history.AssetLoader.CACHE_BUSTER)},android.history.AssetLoader.prototype.getAsset=function(a){return this.resources[a]},android.history.AssetLoader.prototype.getPixiTexture=function(a){return this.resources[a].texture},android.history.AssetLoader.prototype.getData=function(a){return this.resources[a].data},android.history.AssetLoader.prototype.load=function(){this.loader_.on("progress",goog.bind(function(){goog.array.forEach(this.progressCallbacks_,function(a){a()},this)},this)),this.loader_.load(goog.bind(function(a,b){this.resources=b,goog.array.forEach(this.completeCallbacks_,function(a){a()},this)},this))},android.history.ConvexHull=function(a){a.sort(function(a,b){return a[0]==b[0]?a[1]-b[1]:a[0]-b[0]});for(var b=[],c=0;c<a.length;c++){for(;2<=b.length&&0>=android.history.ConvexHull.cross(b[b.length-2],b[b.length-1],a[c]);)b.pop();b.push(a[c])}for(var d=[],c=a.length-1;c>=0;c--){for(;2<=d.length&&0>=android.history.ConvexHull.cross(d[d.length-2],d[d.length-1],a[c]);)d.pop();d.push(a[c])}return d.pop(),b.pop(),b.concat(d)},android.history.ConvexHull.cross=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])},android.history.Device=function(){this.mobileBreakPoint=768,this.mobile=null},goog.addSingletonGetter(android.history.Device),android.history.Device.prototype.isMobile=function(){return window.matchMedia&&window.matchMedia("(max-width: "+this.mobileBreakPoint+"px)").matches},android.history.Device.prototype.supportsVideo=function(){return document.createElement("video").canPlayType("video/mp4")},android.history.math={},android.history.math.getRandom=function(a,b){return Math.random()*(b-a)+a},android.history.math.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},android.history.math.degrees=function(a){return 180*a/Math.PI},android.history.math.radians=function(a){return Math.PI/180*a},android.history.math.limitRange=function(a,b,c){return Math.min(Math.max(c,a),b)},android.history.math.distance=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},android.history.math.willCollide=function(a,b){return!(a.y+a.height<b.y||a.y>b.y+b.height||a.x+a.width<b.x||a.x>b.x+b.width)},android.history.math.generateRandomPoints=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push({x:android.history.math.getRandomInt(b,c),y:android.history.math.getRandomInt(b,c)});return d},android.history.math.generateRandomPointsAsArray=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push([android.history.math.getRandomInt(b,c),android.history.math.getRandomInt(b,c)]);return d},android.history.pages={},android.history.pages.Intro=function(){this.tm_=window.TweenMax,this.rootElement_=document.getElementById("intro"),this.loaderRootElement_=document.getElementById("loader"),this.loaderDisplayElement_=document.getElementById("loader-display"),this.coloredTextElement_=document.getElementById("intro-content-colored"),this.spinnerElement_=document.getElementById("spinner"),this.loadingElements_=[].slice.call(this.loaderRootElement_.querySelectorAll("li")),this.versionWrapper_=document.getElementById("version-wrapper"),this.versions_=[].slice.call(this.loaderDisplayElement_.querySelectorAll(".version")),this.loaderContent_=document.getElementById("loader-content"),this.metaContents_=[].slice.call(this.loaderContent_.querySelectorAll(".meta")),this.introTout_=document.getElementById("intro-tout"),this.introContent_=document.getElementById("intro-content"),this.loadingText_=document.getElementById("loading-icon"),this.versionWidth_=null,this.activeIndex_=0,this.completeCallback=null,this.endRequested=!1,this.activeColor=null,this.init_(),window.setTimeout(goog.bind(function(){this.start()},this),200)},android.history.pages.Intro.MIN_VERSION=1,android.history.pages.Intro.LOADING_ELEMENT_DISTRIBUTION=android.history.Device.getInstance().isMobile()?30:10,android.history.pages.Intro.animationInterval=2e3,android.history.pages.Intro.animationSpeed=.8,android.history.pages.Intro.prototype.init_=function(){this.versionHeight_=this.versionWidth_=200,goog.style.setStyle(this.versionWrapper_,{width:this.versions_.length*this.versionWidth_+"px",left:-(this.versions_.length-1)*this.versionWidth_+"px"}),goog.style.setStyle(this.loaderDisplayElement_,{width:"0px",height:"0px",margin:this.versionWidth_/2+"px","margin-left":"0px"}),goog.array.forEach(this.loadingElements_,function(a){goog.style.setStyle(a,{left:"-10%"})}),this.fixPageScale_(),window.addEventListener("resize",ww.util.debounce(goog.bind(function(){window.setTimeout(goog.bind(function(){this.fixPageScale_()},this),100)},this),100))},android.history.pages.Intro.prototype.fixPageScale_=function(){var a=goog.style.getBorderBoxSize(this.introTout_).height,b=goog.style.getBorderBoxSize(this.rootElement_).height;a>=b?(a=b/a,goog.style.setStyle(this.introTout_,{top:"0",transform:"scale("+a+")","-webkit-transform":"scale("+a+")","transform-origin":"top center","-webkit-transform-origin":"top center"}),goog.dom.classlist.add(this.loaderRootElement_,"disabled")):(this.introTout_.setAttribute("style",""),goog.dom.classlist.remove(this.loaderRootElement_,"disabled"))},android.history.pages.Intro.prototype.start=function(){this.skipToAndPlay(0);var a=android.history.pages.Intro.animationSpeed-.3;this.tm_.to(this.loaderDisplayElement_,.3,{height:this.versionHeight_+"px",width:this.versionWidth_+"px","margin-top":"0px","margin-left":-this.versionWidth_/2+"px",ease:Power4.easeInOut,delay:a}),window.setTimeout(goog.bind(function(){goog.dom.classlist.add(this.introContent_,"active"),goog.dom.classlist.add(this.loaderContent_,"active"),this.loadingText_.style.opacity=1},this),1e3*a)},android.history.pages.Intro.prototype.next=function(){this.skipToAndPlay(this.activeIndex_>android.history.pages.Intro.MIN_VERSION&&this.endRequested?this.versions_.length-1:this.activeIndex_+1)},android.history.pages.Intro.prototype.skipToAndPlay=function(a){var b=this.activeIndex_;this.activeIndex_=a,this.activeColor=this.getActiveColor(this.loadingElements_[a]),window.setTimeout(goog.bind(function(){goog.style.setStyle(this.coloredTextElement_,{color:this.activeColor}),goog.style.setStyle(this.spinnerElement_,{stroke:this.activeColor}),this.metaContents_[b]&&goog.dom.classlist.remove(this.metaContents_[b],"active"),goog.dom.classlist.add(this.metaContents_[a],"active")},this),400),goog.array.forEach(this.loadingElements_,function(a,b){var e=this.activeIndex_-b,e=(e>=1?65:35)+e*android.history.pages.Intro.LOADING_ELEMENT_DISTRIBUTION,f=.1*b;b==this.activeIndex_&&(e=50,f=0),b<=this.activeIndex_&&(f=this.active_-.1*b),this.tm_.to(a,android.history.pages.Intro.animationSpeed,{left:e+"%",delay:f,ease:Power4.easeInOut})},this),this.tm_.to(this.versionWrapper_,.2,{left:(this.activeIndex_-this.versions_.length+1)*this.versionWidth_+"px",ease:Power4.easeInOut,delay:.35*android.history.pages.Intro.animationSpeed}),this.activeIndex_<this.loadingElements_.length-1?window.setTimeout(goog.bind(function(){this.next()},this),android.history.pages.Intro.animationInterval):window.setTimeout(goog.bind(function(){this.completeCallback&&this.completeCallback()},this),android.history.pages.Intro.animationInterval)},android.history.pages.Intro.prototype.skipToEnd=function(a){this.completeCallback=a,this.endRequested=!0,this.activeIndex_>=this.loadingElements_.length-1&&this.completeCallback()},android.history.pages.Intro.prototype.getActiveColor=function(a){return window.getComputedStyle(a,null).getPropertyValue("background-color")},android.history.PageScroller=function(a,b,c,d){this.canScroll=!0,this.scrollUpCallback=a,this.scrollDownCallback=b,this.dragLeftCallback=c,this.dragRightCallback=d,this.cursorDown_=!0,this.cursorPosition_={x:null,y:null},a=document.getElementsByTagName("html")[0],new window.Hammer(a),window.addEventListener("mousewheel",goog.bind(this.onMouseWheel_,this)),window.addEventListener("onmousewheel",goog.bind(this.onMouseWheel_,this)),window.addEventListener("DOMMouseScroll",goog.bind(this.onMouseWheel_,this))},android.history.PageScroller.prototype.onMouseDown_=function(a){this.cursorDown_=!0,this.cursorPosition_={x:a.pageX,y:a.pageY}},android.history.PageScroller.prototype.onMouseUp_=function(a){this.cursorDown_=!1},android.history.PageScroller.prototype.onMouseMove_=function(a){a=a.pageX-this.cursorPosition_.x,this.cursorDown_&&Math.abs(this.cursorPosition_.x)&&this.cursorDown_&&200<=Math.abs(a)&&(this.cursorDown_=!1,0>=a?this.dragLeftCallback():this.dragRightCallback())},android.history.PageScroller.prototype.onMouseWheel_=function(a){if(!android.history.Device.getInstance().isMobile()&&(a.preventDefault(),this.canScroll)){var b;b=a.wheelDelta,b=(a=a.detail)?b?b/a/40*a>0?1:-1:-a/3:b/120,.3<=Math.abs(b)&&this.canScroll&&(this.canScroll=!1,0>=b?this.scrollDownCallback():this.scrollUpCallback(),setTimeout(goog.bind(function(){this.canScroll=!0},this),810))}},android.history.PubSub=function(){goog.pubsub.PubSub.call(this);

},goog.inherits(android.history.PubSub,goog.pubsub.PubSub),goog.addSingletonGetter(android.history.PubSub),android.history.PubSub.events={EXPAND_PAGE:"expand-page",COLLAPSE_PAGE:"collapse-page"},android.history.NavigationPosition=function(a,b){if(this.rootElement_=a,this.ulElement_=document.getElementById("history-nav-list"),this.navBounds_=goog.style.getBounds(this.ulElement_),this.anchorElements_=[].slice.call(this.rootElement_.querySelectorAll("a")),this.androidElement_=document.getElementById("android-bot"),this.androidPieces_={leftArm:document.getElementById("android-left-arm"),rightArm:document.getElementById("android-right-arm"),leftLeg:document.getElementById("android-left-leg"),rightLeg:document.getElementById("android-right-leg")},this.androidLetterElement_=document.getElementById("android-letter"),this.isExpanded_=!1,this.tm_=window.TweenMax,this.tl_=new window.TimelineLite,this.previousPosition=0,this.androidMoving_=this.cursorDown_=!1,this.cursorPosition=null,this.botStates={rotation:0,ligRotation:0,left:0},this.canNavigate_=!0,this.history_=b,this.rootElement_){var c=android.history.PubSub.getInstance();c.subscribe(android.history.PubSub.events.EXPAND_PAGE,this.expand,this),c.subscribe(android.history.PubSub.events.COLLAPSE_PAGE,this.collapse,this),goog.events.listen(this.history_,goog.history.EventType.NAVIGATE,goog.bind(this.handleHistoryNavigate,this)),this.androidElement_.addEventListener("mousedown",goog.bind(this.onMouseDown_,this)),document.addEventListener("mouseup",goog.bind(this.onMouseUp_,this)),document.addEventListener("mouseleave",goog.bind(this.onMouseUp_,this)),document.addEventListener("mousemove",goog.bind(this.onMouseMove_,this)),this.androidElement_.addEventListener("touchstart",goog.bind(this.onMouseDown_,this)),document.addEventListener("touchend",goog.bind(this.onMouseUp_,this)),document.addEventListener("touchleave",goog.bind(this.onMouseUp_,this)),document.addEventListener("touchmove",goog.bind(this.onMouseMove_,this)),window.addEventListener("resize",ww.util.debounce(goog.bind(this.onWindowResize_,this),!0),250),goog.array.forEach(this.anchorElements_,goog.bind(function(a){a.addEventListener("click",goog.bind(this.handleAnchorClick_,this))},this))}},android.history.NavigationPosition.cssNames={ACTIVE:"active",FADE_IN:"nav-fade-in"},android.history.NavigationPosition.prototype.onWindowResize_=function(){window.setTimeout(goog.bind(function(){this.navBounds_=goog.style.getBounds(this.ulElement_),this.moveAndroid()},this),200)},android.history.NavigationPosition.prototype.handleAnchorClick_=function(a){var b=a.target||a.srcElement;for(a.preventDefault();!goog.dom.dataset.has(b,"href")&&!goog.dom.dataset.has(b,"href");)b=b.parentNode;(a=goog.dom.dataset.get(b,"href"))&&(this.canNavigate_=!0,this.navigate(a))},android.history.NavigationPosition.prototype.handleHistoryNavigate=function(a){this.moveAndroid()},android.history.NavigationPosition.prototype.navigate=function(a){var b=goog.string.htmlEscape(a.replace("/",""));this.canNavigate_?(this.canNavigate_=!1,this.history_.setToken(a),window.setTimeout(goog.bind(function(){this.canNavigate_=!0},this),800),a=this.history_.getToken(a),goog.string.htmlEscape(a.replace("/",""))==b&&this.moveAndroid()):this.moveAndroid()},android.history.NavigationPosition.prototype.moveAndroid=function(){if(!this.androidMoving_){if(this.androidMoving_=!0,!b)var a=this.history_.getToken(a),b=goog.string.htmlEscape(a.replace("/",""));goog.array.forEach(this.anchorElements_,function(a){var d=goog.dom.dataset.get(a,"href").match(b),e=a.querySelector(".letter");if(e.style.visibility=d?"hidden":"visible",d){var d=a.offsetTop+-12,f=a.offsetLeft+a.offsetWidth/2-23,g=30*-(this.previousPosition-f)/(a.offsetWidth*this.anchorElements_.length);this.androidLetterElement_.textContent=e.textContent,this.androidElement_.className="",a=goog.dom.dataset.get(a,"androidClass"),goog.dom.classlist.add(this.androidElement_,a),this.tl_.to(this.androidElement_,.3,{top:d+"px",left:f+"px",ease:Power4.easeOut,transform:"rotate("+g+"deg) scale(1.2)"}).to(this.androidElement_,.3,{ease:Power4.easeOut,transform:"rotate(0deg) scale(1)",onComplete:goog.bind(function(){this.androidMoving_=!1},this)}),window.requestAnimationFrame(goog.bind(function(){goog.style.setStyle(this.androidPieces_.leftArm,{transform:"rotate(0deg)",transition:"transform 0.6s cubic-bezier(0.86, 0, 0.07, 1)"}),goog.style.setStyle(this.androidPieces_.rightArm,{transform:"rotate(0deg)",transition:"transform 0.6s cubic-bezier(0.86, 0, 0.07, 1)"}),goog.style.setStyle(this.androidPieces_.leftLeg,{transform:"rotate(0deg)",transition:"transform 0.6s cubic-bezier(0.86, 0, 0.07, 1)"}),goog.style.setStyle(this.androidPieces_.rightLeg,{transform:"rotate(0deg)",transition:"transform 0.6s cubic-bezier(0.86, 0, 0.07, 1)"})},this)),this.previousPosition=f,this.botStates.left=f,this.botStates.ligRotation=0,this.botStates.rotation=0}},this)}},android.history.NavigationPosition.prototype.expand=function(){goog.style.setStyle(this.rootElement_,{display:"block"}),this.moveAndroid(),this.isExpanded_||this.fadeInNav_(),this.isExpanded_=!0},android.history.NavigationPosition.prototype.collapse=function(){goog.style.setStyle(this.rootElement_,{display:"none"})},android.history.NavigationPosition.prototype.fadeInNav_=function(){goog.dom.classlist.remove(this.rootElement_,android.history.NavigationPosition.cssNames.FADE_IN),this.rootElement_.offsetWidth=this.rootElement_.offsetWidth,goog.dom.classlist.add(this.rootElement_,android.history.NavigationPosition.cssNames.FADE_IN)},android.history.NavigationPosition.prototype.onMouseDown_=function(a){a.preventDefault(),this.cursorDown_=!0,this.cursorPosition_=a.clientX,"touchstart"==a.type&&(this.cursorPosition_=(a.touches[0]||a.changedTouches[0]).pageX),this.animate_()},android.history.NavigationPosition.prototype.onMouseUp_=function(a){if(this.cursorDown_){var b=a.clientX;("touchend"==a.type||"touchleave"==a.type)&&(b=(a.touches[0]||a.changedTouches[0]).pageX);var c=null,d=null;goog.array.forEach(this.anchorElements_,function(a){var f=Math.abs(a.offsetLeft+a.offsetWidth/2-b);c?d>=f&&(c=a,d=f):(c=a,d=f)},this),a=goog.dom.dataset.get(c,"href"),this.navigate(a)}this.cursorDown_=!1},android.history.NavigationPosition.prototype.onMouseMove_=function(a){this.cursorDown_&&(this.cursorPosition_="touchmove"==a.type?(a.touches[0]||a.changedTouches[0]).pageX:a.pageX||a.clientX)},android.history.NavigationPosition.prototype.animate_=function(){if(this.cursorDown_){window.requestAnimationFrame(goog.bind(function(){this.animate_()},this));var a=this.botStates.left-23,b=this.cursorPosition_-23,b=android.history.math.limitRange(this.navBounds_.left-23,this.navBounds_.left+this.navBounds_.width-23-50,b);this.botStates.left+=.2*(b-a),a=android.history.math.limitRange(-45,45,1.5*(b-a)),b=android.history.math.limitRange(-60,60,a),this.botStates.rotation+=.2*(a-this.botStates.rotation),this.botStates.ligRotation+=.05*(b-this.botStates.ligRotation),goog.style.setStyle(this.androidElement_,{left:Math.round(this.botStates.left)+"px",transform:"rotate("+this.botStates.rotation+"deg) scale(1.2)","transition-duration":"0s"}),goog.style.setStyle(this.androidPieces_.leftArm,{transform:"rotate("+this.botStates.ligRotation+"deg)","transition-duration":"0s"}),goog.style.setStyle(this.androidPieces_.rightArm,{transform:"rotate("+this.botStates.ligRotation+"deg)","transition-duration":"0s"}),goog.style.setStyle(this.androidPieces_.leftLeg,{transform:"rotate("+this.botStates.ligRotation+"deg)","transition-duration":"0s"}),goog.style.setStyle(this.androidPieces_.rightLeg,{transform:"rotate("+this.botStates.ligRotation+"deg)","transition-duration":"0s"})}},android.history.Renderer=function(){this.pixi=window.PIXI,this.renderer_=null},goog.addSingletonGetter(android.history.Renderer),android.history.Renderer.prototype.getRenderer=function(a,b,c){return goog.isDef(c)||(c={transparent:!0}),this.renderer_?c.backgroundColor?(this.renderer_.backgroundColor=c.backgroundColor,this.renderer_.transparent=!1):this.renderer_.transparent=!0:this.renderer_=this.pixi.autoDetectRenderer(a,b,c),this.renderer_},android.history.Slider=function(a,b){if(this.tm_=window.TweenMax,this.tl_=window.TimelineLite,this.rootElement_=a,!this.rootElement_)throw Error("Android History Slider expects a rootElementto be set");this.className_=android.history.Slider.cssNames.SLIDE||"history-page",this.contentElement_=goog.dom.getElementByClass(android.history.Slider.cssNames.CONTENT,this.rootElement_),this.slides_=[].slice.call(goog.dom.getElementsByClass(this.className_,this.rootElement_)),this.slideWidth=this.activeSlideIndex=0,this.isFirstSlide=!0,this.setElementSizes_(),window.addEventListener("resize",goog.bind(this.onWindowResize_,this),!0)},android.history.Slider.cssNames={SLIDE:"history-page",CONTENT:"slider-content"},android.history.Slider.prototype.setElementSizes_=function(){this.slideWidth=window.innerWidth,goog.style.setStyle(this.rootElement_,{position:"relative",height:window.innnerHeight+"px",width:this.slideWidth+"px"}),goog.array.forEach(this.slides_,goog.bind(function(a,b){goog.style.setStyle(a,{width:this.slideWidth+"px",position:"absolute",top:0,left:0,overflow:"hidden","-webkit-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translate3d(0,0,0)","-webkit-transform-style":"preserve-3d"})},this))},android.history.Slider.prototype.onWindowResize_=function(){this.setElementSizes_(),goog.style.setStyle(this.slides_[this.activeSlideIndex],{"-webkit-clip-path":"none","clip-path":"none"})},android.history.Slider.prototype.turnPage=function(a){this.goToSlideByIndex(this.activeSlideIndex+a)},android.history.Slider.prototype.goToSlideByIndex=function(a,b){var c=this.slides_[this.activeSlideIndex],d=this.slides_[a];this.activeSlideIndex=a;var e="circle("+Math.max(this.slideWidth,window.innerHeight)+"px at 50% 100%)";this.swapOrder(c,d),goog.style.setStyle(d,{"clip-path":"circle(0px at 50% 100%)","-webkit-clip-path":"circle(0px at 50% 100%)",visibility:"hidden"}),window.setTimeout(goog.bind(function(){var a=this.isFirstSlide?0:android.history.Device.getInstance().isMobile()?0:1;this.isFirstSlide=!1,window.requestAnimationFrame(goog.bind(function(){this.tm_.to(d,a,{"clip-path":e,ease:Power2.easeOut,"-webkit-clip-path":e,visibility:"visible",onComplete:goog.bind(function(){goog.style.setStyle(d,{"-webkit-clip-path":"none","clip-path":"none"}),b()},this)})},this))},this),android.history.Device.getInstance().isMobile()?1:0)},android.history.Slider.prototype.swapOrder=function(a,b){a.parentNode.appendChild(a),b.parentNode.appendChild(b)},android.history.typedArrayPolyfill={},android.history.typeArrayPolyfill=function(){var a=function(a){goog.isDef(window[a])||(window[a]=function(a){if("number"==typeof a){Array.call(this,a),this.length=a;for(var b=0;b<this.length;b++)this[b]=0}else for(Array.call(this,a.length),this.length=a.length,b=0;b<this.length;b++)this[b]=a[b]},window[a].prototype=[],window[a].constructor=window[a])};a("Float32Array"),a("Int16Array"),a("Uint16Array")};var ww={util:{}};ww.util.onClickish=function(a,b,c,d){var e=goog.events.listen(a,"click",function(a){!1!==d&&a.preventDefault(),b.call(c,a)});return function(){goog.events.unlistenByKey(e)}},ww.util.onHoverish=function(a,b,c,d){var e=goog.events.listen(a,["click","mouseenter"],function(a){!1!==d&&a.preventDefault(),b.call(c,a)});return function(){goog.events.unlistenByKey(e)}};var onClickish=ww.util.onClickish,onHoverish=ww.util.onHoverish;ww.util.onTap=ww.util.onClickish,ww.util.onHover=ww.util.onHoverish,ww.util.trackEvent=function(a,b,c){"undefined"!=typeof ga&&ga("send","event",a,b,null,c)},ww.util.gtmTrackEvent=function(a,b){if(!a)return!1;var c={event:a};b&&goog.object.extend(c,b),dataLayer.push(c)},ww.util.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=+new Date,e=null,f=a.apply(c,d)};return function(){var k=+new Date,l=b-(k-g);return c=this,d=arguments,0>=l?(clearTimeout(e),e=null,g=k,f=a.apply(c,d)):e||(e=setTimeout(h,l)),f}},ww.util.debounce=function(a,b,c){var d,e=null;return function(){var f=this,g=arguments,h=c&&!e;return clearTimeout(e),e=setTimeout(function(){e=null,c||(d=a.apply(f,g))},b),h&&(d=a.apply(f,g)),d}},ww.util.mouseEventsDetected=!Modernizr.touch,ww.util.listeningForFirstMouseEvent=!1,ww.util.listenForFirstMouseEvent=function(a){ww.util.listeningForFirstMouseEvent||(ww.util.listeningForFirstMouseEvent=!0,goog.events.listenOnce(document,"mousemove",function(){ww.util.mouseEventsDetected=!0,ww.util.listeningForFirstMouseEvent=!1,a()}))},ww.util.isScrolling=window.isScrolling=!1,ww.util.applyBodyClassWhenNotScrolling=function(a){if(a=a||"hoverable",ww.util.mouseEventsDetected){goog.dom.classes.add(document.body,a);var b=ww.util.debounce(function(){ww.util.isScrolling=window.isScrolling=!1,goog.dom.classes.add(document.body,a)},200);goog.events.listen(window,"scroll",function(){ww.util.isScrolling||(ww.util.isScrolling=window.isScrolling=!0,goog.dom.classes.remove(document.body,a)),b()})}else ww.util.listenForFirstMouseEvent(function(){ww.util.applyBodyClassWhenNotScrolling(a)})},ww.util.isScrolled=window.isScrolled=!1,ww.util.applyBodyClassWhenScrolled=function(a){if(a=a||"scrolled",ww.util.mouseEventsDetected){var b=ww.util.throttle(function(){!ww.util.isScrolled&&100<=goog.dom.getDocumentScroll().y?(ww.util.isScrolled=window.isScrolled=!0,goog.dom.classes.add(document.body,a)):ww.util.isScrolled&&100>goog.dom.getDocumentScroll().y&&(ww.util.isScrolled=window.isScrolled=!1,goog.dom.classes.remove(document.body,a))},200);goog.events.listen(window,"scroll",function(){b()})}else ww.util.listenForFirstMouseEvent(function(){ww.util.applyBodyClassWhenScrolled(a)})},ww.util.onMouseEnter=function(a,b){return"onmouseenter"in document.documentElement?goog.events.listen(a,"mouseenter",b):goog.events.listen(a,"mouseover",function(a){a.relatedTarget&&(a.relatedTarget===this||this.compareDocumentPosition(a.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)||b(a)})},ww.util.onMouseLeave=function(a,b){return"onmouseleave"in document.documentElement?goog.events.listen(a,"mouseleave",b):goog.events.listen(a,"mouseout",function(a){a.relatedTarget&&(a.relatedTarget===this||this.compareDocumentPosition(a.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)||b(a)})},ww.util.avoidOrphans=function(a){goog.array.forEach(a,function(a){var c=goog.string.trim(a.textContent).split(" ");if(!(3>c.length)){var d=c.pop(),c=c.join("");d.length>c.length||(a=a.lastChild)&&3==a.nodeType&&(a.nodeValue=a.nodeValue.replace(/\s+([^\s]+\s*)$/g,"$1"))}})},ww.util.createCORSRequest=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b),c.onerror=function(){},c.ontimeout=function(){},c.onprogress=function(){}):c=null,c},android.history.SlideShow=function(a){this.mobileMode_=android.history.Device.getInstance().isMobile(),(this.rootElement_=a)&&(this.navElement_=goog.dom.getElementByClass(android.history.SlideShow.cssNames.NAV,this.rootElement_),this.slideImages_=[].slice.call(this.rootElement_.querySelectorAll("."+android.history.SlideShow.cssNames.SLIDE_IMAGE)),this.slides_=[].slice.call(this.rootElement_.querySelectorAll("."+android.history.SlideShow.cssNames.SLIDE)),this.navElements_=[].slice.call(this.navElement_.querySelectorAll("."+android.history.SlideShow.cssNames.DOT)),this.activeIndex_=0,this.init_())},android.history.SlideShow.cssNames={SLIDE:"featured-slide-content--side",SLIDE_IMAGE:"featured-slide-content--image",NAV:"featured-nav",DOT:"featured-nav-dot",ACTIVE:"active",VIDEO_CONTAINER:"featured-slide-content-video"},android.history.SlideShow.prototype.init_=function(){goog.array.forEach(this.navElements_,goog.bind(function(a){a.addEventListener("click",goog.bind(function(b){for(b=b.target||b.srcElement;a!==b;)b=b.parentNode;this.onNavClick_(b)},this),!1)},this)),this.showFirstSlide();var a=goog.dom.getElementsByClass(android.history.SlideShow.cssNames.VIDEO_CONTAINER,this.rootElement_),b=this.mobileMode_||!android.history.Device.getInstance().supportsVideo();goog.array.forEach(a,function(a){goog.style.setElementShown(a.querySelector("img"),b),goog.style.setElementShown(a.querySelector("video"),!b)},this)},android.history.SlideShow.prototype.onNavClick_=function(a){a=this.navElements_.indexOf(a),-1!==a&&this.navigateToSlideByIndex(a)},android.history.SlideShow.prototype.navigateToSlideByIndex=function(a){goog.dom.classlist.remove(this.slides_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),goog.dom.classlist.remove(this.slideImages_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),goog.dom.classlist.remove(this.navElements_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),this.activeIndex_=a,goog.dom.classlist.add(this.slides_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),goog.dom.classlist.add(this.slideImages_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),goog.dom.classlist.add(this.navElements_[this.activeIndex_],android.history.SlideShow.cssNames.ACTIVE),(a=this.slideImages_[this.activeIndex_].querySelector("video"))&&a.play()},android.history.SlideShow.prototype.showFirstSlide=function(){this.navigateToSlideByIndex(0)},android.history.SlideShow.prototype.showLastSlide=function(){this.navigateToSlideByIndex(this.getNumberOfSlides()-1)},android.history.SlideShow.prototype.next=function(){this.skip_(1)},android.history.SlideShow.prototype.prev=function(){this.skip_(-1)},android.history.SlideShow.prototype.skip_=function(a){this.navigateToSlideByIndex(this.activeIndex_+a)},android.history.SlideShow.prototype.getNumberOfSlides=function(){return this.slides_.length},android.history.SlideShow.prototype.getActiveIndex=function(){return this.activeIndex_},android.history.SlideShow.prototype.isLastSlide=function(){return this.getNumberOfSlides()-1==this.activeIndex_},android.history.AbstractPage=function(a){goog.Disposable.call(this),this.tm_=window.TweenMax,this.assetLoader_=android.history.AssetLoader.getInstance(),this.rootElement_=a,this.contentElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.CONTENT,this.rootElement_),this.toutElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.TOUT,this.rootElement_),this.toutSlideElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.TOUT_SLIDE,this.rootElement_),this.toutWrapElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.TOUT_WRAP,this.rootElement_),this.learnMoreElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.LEARN_MORE,this.rootElement_),this.releaseTitleElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.TITLE,this.rootElement_),this.featuredSlideShowElement_=goog.dom.getElementByClass(android.history.AbstractPage.cssNames.FEATURED_SLIDESHOW,this.rootElement_),this.featuredSlideShow_=new android.history.SlideShow(this.featuredSlideShowElement_),this.isFullScreen=!0,this.sceneSize=this.getActiveWindowSize(),this.sceneFullSize=this.getActiveWindowSize(),this.sceneHalfSize={width:this.sceneFullSize.width/2,height:this.sceneFullSize.height/2},this.rendered_=this.isInView=this.active=!1,this.transitionDuration_=this.frame_=this.collapsedHeight=null,this.pageToPageTransitionDuration_=1,this.animateWhileTransition_=this.introComplete_=this.introStarted_=!1,this.init_()},goog.inherits(android.history.AbstractPage,goog.Disposable),android.history.AbstractPage.cssNames={COLLAPSED:"collapsed",CONTENT:"content",TOUT:"tout",TOUT_SLIDE:"tout-slide",TOUT_WRAP:"tout-wrap",TITLE:"title",LEARN_MORE:"learn-more",FEATURED_SLIDESHOW:"featured-slideshow"},android.history.AbstractPage.prototype.isWebGL=goog.memoize(function(){if(window.WebGLRenderingContext)for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,d=0;4>d;d++)try{if((c=a.getContext(b[d]))&&"function"==typeof c.getParameter)return!0}catch(e){}return!1}),android.history.AbstractPage.prototype.isMobile=function(){return goog.userAgent.MOBILE||goog.userAgent.ANDROID||goog.userAgent.IPHONE},android.history.AbstractPage.prototype.isLowGpu=function(){return this.isMobile()||!this.isWebGL()},android.history.AbstractPage.prototype.isNarrowViewPort=function(){return 769>=this.sceneFullSize.width},android.history.AbstractPage.prototype.init_=function(){this.registerAssets(),this.setElementSizes_(),this.setFullScreen(!0),this.registerClickEvents_(),window.addEventListener("resize",ww.util.debounce(goog.bind(this.onWindowResizeStart_,this),!0),250)},android.history.AbstractPage.prototype.setElementSizes_=function(){this.collapsedHeight=this.getCollapsedHeight(),goog.style.setStyle(this.rootElement_,{height:this.getActiveWindowSize().height+"px"}),goog.style.setStyle(this.featuredSlideShowElement_,{top:this.collapsedHeight+"px"}),goog.style.setStyle(this.contentElement_,{height:this.sceneFullSize.height+"px"}),this.fixToutScale_()},android.history.AbstractPage.prototype.fixToutScale_=function(){var a=goog.style.getBorderBoxSize(this.releaseTitleElement_).height,a=this.sceneHalfSize.height-a-60+"px",b=goog.style.getBorderBoxSize(this.toutElement_).height;goog.style.getBorderBoxSize(this.learnMoreElement_);var b=b+b,c=goog.style.getBorderBoxSize(this.rootElement_).height;b>=c?(a=c/b,goog.style.setStyle(this.toutElement_,{top:"10%",transform:"scale("+a+")","-webkit-transform":"scale("+a+")","transform-origin":"top center","-webkit-transform-origin":"top center"})):goog.style.setStyle(this.toutElement_,{top:a})},android.history.AbstractPage.prototype.getRootElement=function(){return this.rootElement_},android.history.AbstractPage.prototype.getActiveWindowSize=function(){var a=goog.dom.getElementByClass("l-header",document),a=goog.style.getContentBoxSize(a).height;return{width:window.innerWidth,height:window.innerHeight-a}},android.history.AbstractPage.prototype.registerClickEvents_=function(){var a=this.rootElement_.querySelectorAll("[data-click]");goog.array.forEach(a,goog.bind(function(a){var c=goog.bind(function(a){a=goog.dom.dataset.get(a.target||a.srcElement,"click");var b=/\((.*?)\)/;arrayParam=(param=a.match(b)&&a.match(b)[1])&&param.indexOf(!1)?param.split(","):null,a=a.replace(b,""),this[a].apply(this,arrayParam)},this);goog.events.listen(a,goog.events.EventType.CLICK,c),"ontouchstart"in window&&goog.events.listen(a,goog.events.EventType.TOUCHSTART,c)},this))},android.history.AbstractPage.prototype.setFullScreen=function(a,b){if(this.active){this.isFullScreen=!!a;var c=this.sceneFullSize;if(this.transitionDuration_=b?0:.8,this.isFullScreen){goog.dom.classlist.remove(this.rootElement_,android.history.AbstractPage.cssNames.COLLAPSED),this.sceneSize={width:window.innerWidth,height:this.sceneFullSize.height},this.onFullScreenStart();var d=this.active;this.active=!1,this.tm_.to(this.contentElement_,this.transitionDuration_,{y:0,ease:Power4.easeInOut,onComplete:function(){this.active=d,this.animate(),this.onFullScreenEnter(),goog.style.setStyle(this.featuredSlideShowElement_,{opacity:0})}.bind(this)}),android.history.PubSub.getInstance().publish(android.history.PubSub.events.EXPAND_PAGE,c.height)}else{goog.style.setStyle(this.featuredSlideShowElement_,{opacity:1}),goog.dom.classlist.add(this.rootElement_,android.history.AbstractPage.cssNames.COLLAPSED),this.renderer_.render(this.stage_);var e=this.active;this.active=!1,this.onCollapseScreenStart(),this.tm_.to(this.contentElement_,this.transitionDuration_,{y:-(c.height-this.collapsedHeight),ease:Power4.easeInOut,onComplete:function(){this.active=e,this.onCollapseScreenEnter()}.bind(this)}),android.history.PubSub.getInstance().publish(android.history.PubSub.events.COLLAPSE_PAGE,this.collapsedHeight)}}},android.history.AbstractPage.prototype.setToIntro=function(a){this.setFullScreen(!0,a),this.featuredSlideShow_.showFirstSlide()},android.history.AbstractPage.prototype.setToLastSlide=function(a){this.setFullScreen(!1,a),this.featuredSlideShow_.showLastSlide()},android.history.AbstractPage.prototype.isLastSlide=function(){return this.featuredSlideShow_.isLastSlide()},android.history.AbstractPage.prototype.isIntroPosition=function(){return this.isFullScreen},android.history.AbstractPage.prototype.nextSlide=function(){this.isFullScreen?this.setFullScreen(!1):this.featuredSlideShow_.next()},android.history.AbstractPage.prototype.prevSlide=function(){0===this.featuredSlideShow_.getActiveIndex()?this.setFullScreen(!0):this.featuredSlideShow_.prev()},android.history.AbstractPage.prototype.registerAssets=function(){},android.history.AbstractPage.prototype.ready=function(){},android.history.AbstractPage.prototype.onEnterPageBegin=function(){this.isInView=this.active=!0;var a=this.isMobile()?0:.8;this.tm_.to(this.toutSlideElement_,a,{opacity:1,y:0,ease:Power4.easeOut,startAt:{opacity:0,y:100}})},android.history.AbstractPage.prototype.onEnterPageStart=function(){},android.history.AbstractPage.prototype.onEnterPageComplete=function(a){this.active=!0,!this.isFullScreen||a||this.animateWhileTransition_||this.animate()},android.history.AbstractPage.prototype.onExitPage=function(){this.introStarted_=this.introComplete_=this.isInView=this.active=!1},android.history.AbstractPage.prototype.onFullScreenStart=function(){this.duringTransition(!0)},android.history.AbstractPage.prototype.onFullScreenEnter=function(){this.afterTransition(!0)},android.history.AbstractPage.prototype.onCollapseScreenStart=function(){this.duringTransition(!1)},android.history.AbstractPage.prototype.onCollapseScreenEnter=function(){this.afterTransition(!1)},android.history.AbstractPage.prototype.afterTransition=function(a){},android.history.AbstractPage.prototype.duringTransition=function(a){},android.history.AbstractPage.prototype.runIntroSequence=function(){this.introStarted_=this.introComplete_=!0},android.history.AbstractPage.prototype.animate=function(){this.active&&(this.isLowGpu()?this.lowGpuAnimate():(this.isFullScreen&&window.requestAnimationFrame(goog.bind(function(a){this.frame_=a,this.animate()},this)),this.introComplete_||this.introStarted_||this.runIntroSequence(),this.introComplete_&&this.animateInternal(this.frame_),this.renderer_.render(this.stage_),this.rendered_=!0))},android.history.AbstractPage.prototype.lowGpuAnimate=function(){this.renderer_.render(this.stage_)},android.history.AbstractPage.prototype.animateInternal=function(){},android.history.AbstractPage.prototype.onWindowResizeStart_=function(){var a=this.active;this.active=!1,this.sceneSize=this.getActiveWindowSize(),this.sceneFullSize=this.getActiveWindowSize(),this.sceneHalfSize={width:this.sceneFullSize.width/2,height:this.sceneFullSize.height/2},this.collapsedHeight=this.getCollapsedHeight(),this.setElementSizes_(),a&&(this.isFullScreen?android.history.PubSub.getInstance().publish(android.history.PubSub.events.EXPAND_PAGE,this.sceneSize.height):(this.tm_.to(this.contentElement_,0,{y:-(this.sceneFullSize.height-this.collapsedHeight)}),android.history.PubSub.getInstance().publish(android.history.PubSub.events.COLLAPSE_PAGE,this.collapsedHeight))),this.onWindowResize(),this.onWindowResizeEnd(),this.active=a},android.history.AbstractPage.prototype.onWindowResize=function(){},android.history.AbstractPage.prototype.onWindowResizeEnd=function(){},android.history.AbstractPage.prototype.disposeInternal=function(){this.rootElement_=null,android.history.AbstractPage.superClass_.disposeInternal.call(this)},android.history.AbstractPage.prototype.getCollapsedHeight=function(){return android.history.Device.getInstance().isMobile()?120:900>window.innerHeight?150:250},android.history.AbstractPixiPage=function(a,b){this.pixi=window.PIXI,this.pixiWrapperElement_=document.getElementById(b),this.rootContainer_=this.background_=this.renderer_=this.stage_=null,android.history.AbstractPage.call(this,a)},goog.inherits(android.history.AbstractPixiPage,android.history.AbstractPage),android.history.AbstractPixiPage.prototype.ready=function(){this.renderer_=this.createRenderer(),this.stage_=new this.pixi.Container,this.pixiReady()},android.history.AbstractPixiPage.prototype.pixiReady=function(){},android.history.AbstractPixiPage.prototype.onEnterPageBegin=function(){android.history.AbstractPixiPage.superClass_.onEnterPageBegin.call(this),this.showRenderer(!1),this.pixiWrapperElement_.appendChild(this.renderer_.view)},android.history.AbstractPixiPage.prototype.onEnterPageComplete=function(a){android.history.AbstractPixiPage.superClass_.onEnterPageComplete.call(this,a),this.showRenderer(!0)},android.history.AbstractPixiPage.prototype.showRenderer=function(a){this.isLowGpu()&&goog.style.setStyle(this.pixiWrapperElement_,{opacity:a?1:0})},android.history.AbstractPixiPage.prototype.onWindowResizeEnd=function(){if(this.renderer_){var a=this.sceneFullSize.width,b=this.sceneFullSize.height;for(this.renderer_.view.style.width=a+"px",this.renderer_.view.style.height=b+"px",this.renderer_.resize(a,b),a=this.stage_,b=a.children.length-1;b>=0;b--)a.removeChild(a.children[b]);this.pixiReady()}},android.history.AbstractPixiPage.prototype.onExitPage=function(){android.history.AbstractPixiPage.superClass_.onExitPage.call(this),this.showRenderer(!1),this.pixiWrapperElement_.removeChild(this.renderer_.view)},android.history.AbstractPixiPage.prototype.createRenderer=function(a){return android.history.Renderer.getInstance().getRenderer(this.sceneFullSize.width,this.sceneFullSize.height,a)},android.history.AbstractPixiPage.prototype.registerBackground=function(a,b){this.background_={name:a,url:b},this.assetLoader_.addAsset(a,b)},android.history.AbstractPixiPage.prototype.setBackground=function(){if(this.background_){var a=this.assetLoader_.getPixiTexture(this.background_.name),a=new this.pixi.Sprite(a);a.x=0,a.y=0,a.anchor.x=0,a.anchor.y=0,a.scale.x=this.sceneFullSize.width/a.width,a.scale.y=this.sceneFullSize.height/a.height,this.stage_.addChild(a)}},android.history.AbstractPixiPage.prototype.setRootContainer=function(){this.rootContainer_=new this.pixi.Container,this.rootContainer_.x=0,this.rootContainer_.originalX=this.rootContainer_.x,this.rootContainer_.y=0,this.rootContainer_.originalY=this.rootContainer_.y,this.rootContainer_.originalScale=1,this.stage_.addChild(this.rootContainer_)},android.history.pages.Donut=function(a){this.time_=0,this.donuts_=[],this.overlayParticles_=[],this.introComplete_=!1,this.mousePosition_=null,this.angle_=0,this.scale_=null,this.donutMovieClipDefinitions_=[{textureName:"pink-donut",jsonSourcePath:"/static/img/history/donut/pink-{x}.json",lowGpuSourcePath:"/static/img/history/donut/pink-mobile.json",jsonCount:0,pngImageName:"Donut_Pink_anim_{x}.png",textureNames:[]},{textureName:"chocolate-donut",jsonSourcePath:"/static/img/history/donut/chocolate-{x}.json",lowGpuSourcePath:"/static/img/history/donut/chocolate-mobile.json",jsonCount:0,pngImageName:"Donut_Choc_anim_{x}.png",textureNames:[]}],this.donutMovieClipTextures_={},android.history.AbstractPixiPage.call(this,a,"donut-canvas")},goog.inherits(android.history.pages.Donut,android.history.AbstractPixiPage),android.history.pages.Donut.sprinkleImages="/static/img/history/donut/sprinkle-1.png /static/img/history/donut/sprinkle-2.png /static/img/history/donut/sprinkle-3.png /static/img/history/donut/sprinkle-4.png /static/img/history/donut/sprinkle-5.png /static/img/history/donut/sprinkle-6.png".split(" "),android.history.pages.Donut.prototype.onWindowResize=function(){this.donuts_=[],this.overlayParticles_=[],this.introComplete_=!1,this.scale_=this.mousePosition_=null},android.history.pages.Donut.prototype.calculateScale=function(){this.scale_=Math.min(1,this.sceneFullSize.width/1500)},android.history.pages.Donut.prototype.registerAssets=function(){this.isLowGpu()?goog.array.forEach(this.donutMovieClipDefinitions_,function(a){var b=a.textureName+"-0";a.textureNames.push(b),this.assetLoader_.addAsset(b,a.lowGpuSourcePath)},this):goog.array.forEach(this.donutMovieClipDefinitions_,function(a){for(var b=0;b<=a.jsonCount;b++){
var c=a.textureName+"-"+b;a.textureNames.push(c);var d=a.jsonSourcePath.replace("{x}",b);this.assetLoader_.addAsset(c,d)}},this),goog.array.forEach(android.history.pages.Donut.sprinkleImages,function(a,b){this.assetLoader_.addAsset("sprinkle-"+b,a)},this)},android.history.pages.Donut.prototype.pixiReady=function(){this.calculateScale(),this.setRootContainer(),this.initScene()},android.history.pages.Donut.prototype.initScene=function(){this.createDonutTextures_(),this.createDonuts(),this.createOverlaySprinkles()},android.history.pages.Donut.prototype.duringTransition=function(a){if(!this.isLowGpu()){var b=this.rootContainer_;a?(this.tm_.to(b.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:b.originalScale,y:b.originalScale}),this.tm_.to(b,this.transitionDuration_,{x:b.originalX,y:b.originalY,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)})):(this.tm_.to(b,this.transitionDuration_,{x:.5*this.sceneFullSize.width/2,y:this.sceneFullSize.height-this.collapsedHeight+b.originalY*this.collapsedHeight/this.sceneFullSize.height-.25*this.sceneFullSize.height,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)}),this.tm_.to(b.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:.5*b.originalScale,y:.5*b.originalScale}))}},android.history.pages.Donut.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.Donut.prototype.onExitPage=function(){android.history.pages.Donut.superClass_.onExitPage.call(this),goog.array.forEach(this.donuts_,function(a){var b=a.donut,c=a.particleFrontContainer;a=a.particleBackContainer,b.x=b.startX,c.x=b.startX,a.x=b.startX,b.y=b.startY,c.y=b.startY,a.y=b.startY,b.scale.x=b.startScale,b.scale.y=b.startScale})},android.history.pages.Donut.prototype.createDonutTextures_=function(){goog.array.forEach(this.donutMovieClipDefinitions_,function(a){var b=[];goog.array.forEach(a.textureNames,function(a){a=this.assetLoader_.getAsset(a).textures,b.push(a)},this);var c={};goog.array.forEach(b,function(a){goog.object.forEach(a,function(a,b){c[b]=a})},this);for(var d=[],e=0,f=0;f<Object.keys(c).length;f++){var g=a.pngImageName.replace("{x}",1==e.toString().length?"0"+e:e),g=new this.pixi.Texture.fromFrame(g);d.push(g),e++}this.donutMovieClipTextures_[a.textureName]=d},this)},android.history.pages.Donut.prototype.animateInternal=function(){if(this.donuts_){this.time_=this.time_?this.time_+16:1;var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a},b=android.history.math.degrees(Math.atan2(this.mousePosition_.x-this.sceneHalfSize.width,-(this.mousePosition_.y-this.sceneHalfSize.height))),this.angle_=android.history.math.limitRange(0,30,b),this.animateDonuts(this.frame_),this.animateOverlayParticles()}},android.history.pages.Donut.prototype.animateDonuts=function(a){goog.array.forEach(this.donuts_,goog.bind(function(a){goog.array.forEach(a.particlesFront,goog.bind(function(a){this.animateParticle(a)},this)),goog.array.forEach(a.particlesBack,goog.bind(function(a){this.animateParticle(a)},this));var c=a.donut,d=a.particleFrontContainer;a=a.particleBackContainer,c.scale.x<c.baseScale&&(c.scale.x+=.05,c.scale.y+=.05);var e=Math.sin(2*this.time_*Math.PI/(3e3+c.sinOffset));c.drag=0;var f=(this.mousePosition_.y-this.sceneHalfSize.height)/this.sceneFullSize.height*100,g=android.history.math.limitRange(-this.sceneHalfSize.width,this.sceneHalfSize.width,(this.mousePosition_.x-this.sceneHalfSize.width)/this.sceneFullSize.width*100),f=android.history.math.limitRange(-this.sceneHalfSize.height,this.sceneHalfSize.height,f),h=.15*(c.originalY-this.mousePosition_.y)*c.mouseSensitivityY;c.targetX=c.originalX+50+.15*(c.originalX-this.mousePosition_.x)*c.mouseSensitivityX+g-c.drag*e,c.targetY=c.originalY+50+h+f+c.drag*e,c.targetRotation=Math.PI/180*(c.originalRotation+this.angle_+6*e),e=.03*(c.targetX-c.x),f=.03*(c.targetY-c.y),c.x+=e,c.y+=f,d.x+=e,d.y+=f,a.x+=e,a.y+=f,c.rotation+=.05*(c.targetRotation-c.rotation),a.rotation+=.05*(c.targetRotation-c.rotation),d=2*g,a=c.totalFrames/100,e=Math.sin(2*this.time_*Math.PI/c.movieClipSpeed),d=Math.round(c.totalFrames/2- -a*d),d=c.currentFrame+.05*(d-c.currentFrame),d=android.history.math.limitRange(0,c.totalFrames-1,Math.round(d)),c.gotoAndStop(d)},this))},android.history.pages.Donut.prototype.animateParticle=function(a){0<a.life?(a.life-=.02,a.y+=a.acceleration+a.distribution,a.x-=a.acceleration+Math.abs(a.distribution),a.rotation+=.005*a.acceleration,a.scale.x+=a.scaleChangeSpeed,a.scale.y+=a.scaleChangeSpeed):this.resetParticleState(a)},android.history.pages.Donut.prototype.resetParticleState=function(a){a.life=android.history.math.getRandom(0,1),a.x=android.history.math.getRandomInt(-a.spread.width/2,a.spread.width/2),a.y=android.history.math.getRandomInt(-a.spread.height/2,a.spread.height/2),a.alpha=1;var b=Math.round(android.history.math.getRandom(.9,1.1));a.scale.x=b,a.scale.y=b,a.scaleChangeSpeed=Math.round(android.history.math.getRandom(-.01,.01)),a.distribution=Math.round(android.history.math.getRandom(-2,2)),a.acceleration=android.history.math.getRandomInt(5,10)},android.history.pages.Donut.prototype.createDonuts=function(){android.history.Device.getInstance();var a=this.sceneFullSize.width,b=this.sceneFullSize.height,c=this.donutMovieClipTextures_["pink-donut"];this.createDonut({x:.15*a,y:.7*b,texture:c,baseScale:2,sinOffet:100,particleScale:.5,movieClipSpeed:1e3,particleFrontPositionSpread:{width:384.8*this.scale_,height:503*this.scale_*.8},particleBackPositionSpread:{width:384.8*this.scale_,height:503*this.scale_},mouseSensitivityX:-.5,mouseSensitivityY:-.5,startFrame:0});var c=this.donutMovieClipTextures_["pink-donut"],d=.8,e=d*this.scale_;this.createDonut({x:.6*a,y:.2*b,sinOffet:20,baseScale:d,movieClipSpeed:900,texture:c,particleScale:.6,particleFrontPositionSpread:{width:481*e*.3,height:251.5*e},particleBackPositionSpread:{width:240.5*e,height:503*e},mouseSensitivityX:.5,mouseSensitivityY:1.3,startFrame:15}),c=this.donutMovieClipTextures_["chocolate-donut"],e=d*this.scale_,this.createDonut({x:.85*a,y:.65*b,sinOffet:300,movieClipSpeed:1500,baseScale:1.2,particleScale:.6,texture:c,particleFrontPositionSpread:{width:144.9*e,height:251.5*e},particleBackPositionSpread:{width:301.8*e,height:503*e},mouseSensitivityX:-.3,mouseSensitivityY:1.5,startFrame:30})},android.history.pages.Donut.prototype.createDonut=function(a){var b=new this.pixi.extras.MovieClip(a.texture);b.anchor.x=.5,b.anchor.y=.5;var c=this.isLowGpu()?0:500;b.x=a.x-c,b.y=a.y+c,b.startX=b.x,b.startY=b.y,b.mouseSensitivityX=a.mouseSensitivityX,b.mouseSensitivityY=a.mouseSensitivityY,b.rotation=0,b.originalRotation=b.rotation,b.originalX=a.x,b.originalY=a.y,b.movieClipSpeed=a.movieClipSpeed,b.baseScale=this.scale_*a.baseScale,c=this.isLowGpu()?1:.2,b.scale.x=a.baseScale*this.scale_*c,b.scale.y=a.baseScale*this.scale_*c,b.startScale=b.scale.x,b.sinOffset=a.sinOffet||0;var c=goog.bind(function(a,b,c,d){for(var e=0;c>e;e++){var f=this.assetLoader_.getPixiTexture("sprinkle-"+android.history.math.getRandomInt(0,android.history.pages.Donut.sprinkleImages.length-1)),f=new PIXI.Sprite(f);f.anchor.x=.5,f.anchor.y=.5,f.spread=d,this.resetParticleState(f),a.addChild(f),b.push(f)}},this),d=new PIXI.Container;d.x=b.x,d.y=b.y,d.scale.x=b.baseScale,d.scale.y=b.baseScale;var e=[];c(d,e,3,a.particleFrontPositionSpread);var f=new PIXI.Container;f.x=b.x,f.y=b.y,f.scale.x=b.baseScale*a.particleScale,f.scale.y=b.baseScale*a.particleScale;var g=[];c(f,g,10,a.particleBackPositionSpread),this.donuts_.push({donut:b,particleFrontContainer:d,particlesFront:e,particleBackContainer:f,particlesBack:g,donutConfig:a}),this.rootContainer_.addChild(f),this.rootContainer_.addChild(b),this.rootContainer_.addChild(d)},android.history.pages.Donut.prototype.createOverlaySprinkles=function(){this.overlayContainer_=new PIXI.Container;var a=new this.pixi.filters.BlurFilter;for(this.overlayContainer_.blurX=5,this.overlayContainer_.blurY=5,this.overlayContainer_.filters=[a],a=0;100>a;a++){var b=this.assetLoader_.getPixiTexture("sprinkle-"+android.history.math.getRandomInt(0,android.history.pages.Donut.sprinkleImages.length-1)),b=new PIXI.Sprite(b);b.anchor.x=.5,b.anchor.y=.5,b.x=android.history.math.getRandomInt(1,2*Math.round(this.sceneFullSize.width)),b.y=android.history.math.getRandomInt(0,2*Math.round(this.sceneFullSize.height)),b.acceleration=android.history.math.getRandomInt(30,50),b.scale.x=android.history.math.getRandom(1,4),b.scale.y=android.history.math.getRandom(1,4),this.overlayContainer_.addChild(b),this.overlayParticles_.push(b)}this.rootContainer_.addChild(this.overlayContainer_)},android.history.pages.Donut.prototype.resetOverlayParticleState=function(a){android.history.math.getRandomInt(0,1)?(a.x=android.history.math.getRandomInt(1,Math.round(2*this.sceneFullSize.width)),a.y=-android.history.math.getRandomInt(0,Math.round(2*this.sceneFullSize.height))):(a.x=2*Math.round(this.sceneFullSize.width),a.y=android.history.math.getRandomInt(1,Math.round(2*this.sceneFullSize.height))),a.scale.x=android.history.math.getRandom(.5,3),a.scale.y=android.history.math.getRandom(.5,3),a.acceleration=android.history.math.getRandomInt(30,50)},android.history.pages.Donut.prototype.animateOverlayParticles=function(){this.overlayContainer_.rotation+=.05*(Math.PI/180*(this.overlayContainer_.rotation+this.angle_)-this.overlayContainer_.rotation),goog.array.forEach(this.overlayParticles_,goog.bind(function(a){this.animateOverlayParticle(a)},this))},android.history.pages.Donut.prototype.animateOverlayParticle=function(a){a.x>=-this.sceneFullSize.width||a.y<=2*this.sceneFullSize.height?(a.y+=a.acceleration,a.x-=a.acceleration,a.rotation+=.005*a.acceleration):this.resetOverlayParticleState(a)},android.history.pages.Eclair=function(a){this.eclairTexture_=[],this.light_=null,this.sprites_=[],this.eclairContainer_=null,android.history.AbstractPixiPage.call(this,a,"eclair-canvas")},goog.inherits(android.history.pages.Eclair,android.history.AbstractPixiPage),android.history.pages.Eclair.images=["/static/img/history/eclair/eclair-1.png","/static/img/history/eclair/eclair-2.png","/static/img/history/eclair/eclair-3.png"],android.history.pages.Eclair.lightImage="/static/img/history/eclair/light.png",android.history.pages.Eclair.prototype.registerAssets=function(){goog.array.forEach(android.history.pages.Eclair.images,function(a,b){this.assetLoader_.addAsset("eclair-"+(b+1),a)},this),this.assetLoader_.addAsset("eclair-light",android.history.pages.Eclair.lightImage)},android.history.pages.Eclair.prototype.onWindowResize=function(){this.sprites_=[],this.eclairTexture_=[],this.light_=null},android.history.pages.Eclair.prototype.pixiReady=function(){this.initScene()},android.history.pages.Eclair.prototype.initScene=function(){this.addLight(),this.createEclairs()},android.history.pages.Eclair.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.Eclair.prototype.onEnterPageBegin=function(){this.renderer_.type==this.pixi.RENDERER_TYPE.WEBGL&&(this.renderer_.backgroundColor="0xEAB577",this.renderer_.transparent=!1),android.history.pages.Eclair.superClass_.onEnterPageBegin.call(this)},android.history.pages.Eclair.prototype.onExitPage=function(){this.renderer_.transparent=!0,android.history.pages.Eclair.superClass_.onExitPage.call(this)},android.history.pages.Eclair.prototype.animateInternal=function(){var a=this.renderer_.plugins.interaction.mouse;this.rotateEclairs(a.global.x,a.global.y),this.moveLight(a.global.x,a.global.y),this.updateDropShadow(a.global.x,a.global.y)},android.history.pages.Eclair.prototype.addLight=function(){var a=this.assetLoader_.getPixiTexture("eclair-light");this.light_=new this.pixi.Sprite(a),this.light_.anchor.x=.5,this.light_.anchor.y=.5,this.light_.alpha=.8,this.light_.scale.x=1.2,this.light_.scale.y=1.2,a=this.renderer_.plugins.interaction.mouse,this.light_.x=a.global.x,this.light_.y=a.global.y,this.stage_.addChild(this.light_)},android.history.pages.Eclair.prototype.moveLight=function(a,b){this.light_.x=a,this.light_.y=b},android.history.pages.Eclair.prototype.createEclairs=function(){var a=this.toutWrapElement_.getBoundingClientRect(),a={x:a.left,y:a.top%this.sceneFullSize.height,width:a.width+75,height:a.height+30};this.eclairTexture_.push(this.assetLoader_.getPixiTexture("eclair-1")),this.eclairTexture_.push(this.assetLoader_.getPixiTexture("eclair-2")),this.eclairTexture_.push(this.assetLoader_.getPixiTexture("eclair-3"));var b=Math.max(this.eclairTexture_[0].width,this.eclairTexture_[0].height)+200,c=100*(this.sceneFullSize.width+b)/(6*b)/100,d=c*b,b=6*parseInt((this.sceneFullSize.height+b)/d),e=0,f=0;this.eclairContainer_=new PIXI.Container;var g=new this.pixi.filters.DropShadowFilter;g.angle=0,g.blurX=2,g.blurY=2,g.distance=15,g.alpha=.2,this.eclairContainer_.dropShadow=g,this.eclairContainer_.filters=[g];for(var g=!1,h=1;b>h;h++){var k=this.createEclair(e,f,c,this.eclairTexture_[h%this.eclairTexture_.length],l%2),e=e+d,l=h%6;0==l&&(g=!g,e=0,f+=d,g&&(e=d/2)),android.history.math.willCollide(a,k)||(this.sprites_.push(k),this.eclairContainer_.addChild(k))}this.stage_.addChild(this.eclairContainer_)},android.history.pages.Eclair.prototype.createEclair=function(a,b,c,d,e){return d=new this.pixi.Sprite(d),d.anchor.x=.5,d.anchor.y=.5,d.x=a,d.y=b,d.scale.x=c,d.scale.y=c,d.rotation=Math.PI/180*(e?0:90),d.rotationOffset=Math.PI/180*45,d},android.history.pages.Eclair.prototype.rotateEclairs=function(a,b){goog.array.forEach(this.sprites_,function(c){var d=Math.atan2(a-c.x,-(b-c.y)),d=d+c.rotationOffset,d=(d-c.rotation)/(2*Math.PI),d=d-Math.round(d),d=2*d*Math.PI;c.rotation+=.05*d},this)},android.history.pages.Eclair.prototype.updateDropShadow=function(a,b){var c=(Math.atan2(a-this.sceneHalfSize.width,-(b-this.sceneHalfSize.height))-this.eclairContainer_.dropShadow.angle)/(2*Math.PI),c=c-Math.round(c),c=2*c*Math.PI;this.eclairContainer_.dropShadow.angle+=.05*c},android.history.pages.Froyo=function(a){this.rootContainer_=null,this.froyoDef_={textureName:"froyo",jsonSourcePath:"/static/img/history/froyo/froyo-{x}.json",lowGpuSourcePath:"/static/img/history/froyo/froyo-mobile.json",jsonCount:1,pngImageName:"Froyo_animation_{x}.png",width:960,height:540,froyoWidth:321,froyoHeight:449,bottom:0,left:.1,textureNames:[]},this.froyoImageScale=1.5,this.scale_=this.froyoMovieClip_=this.mousePosition_=null,this.sprites_=[],this.textures_=[],this.fruitDefinition_=[{textureIndex:0,left:140,bottom:528,scale:1,zIndex:200},{textureIndex:1,left:730,bottom:400,scale:1,zIndex:0},{textureIndex:2,left:150,bottom:795,scale:1,zIndex:1},{textureIndex:3,left:450,bottom:803,scale:1,zIndex:201},{textureIndex:4,left:752,bottom:794,scale:1,zIndex:2},{textureIndex:5,left:291,bottom:1007,scale:1,zIndex:3}],android.history.AbstractPixiPage.call(this,a,"froyo-canvas")},goog.inherits(android.history.pages.Froyo,android.history.AbstractPixiPage),android.history.pages.Froyo.images="/static/img/history/froyo/strawberry.png /static/img/history/froyo/strawberry2.png /static/img/history/froyo/rasberry.png /static/img/history/froyo/kiwi.png /static/img/history/froyo/blueberry.png /static/img/history/froyo/blueberry2.png".split(" "),android.history.pages.Froyo.prototype.registerAssets=function(){var a=this.froyoDef_,b=a.jsonCount,c=a.jsonSourcePath;if(goog.array.forEach(android.history.pages.Froyo.images,function(a,b){this.assetLoader_.addAsset("fruit-"+b,a)},this),this.isLowGpu()){var d=a.textureName+"-0";a.textureNames.push(d),this.assetLoader_.addAsset(d,a.lowGpuSourcePath)}else for(var e=0;b>=e;e++){d=a.textureName+"-"+e,a.textureNames.push(d);var f=c.replace("{x}",e);this.assetLoader_.addAsset(d,f)}},android.history.pages.Froyo.prototype.pixiReady=function(){this.calculateScale_(),this.setRootContainer(),this.rootContainer_.x=-100*this.scale_,this.rootContainer_.originalX=this.rootContainer_.x,this.createFroyo_(),this.createFruits_()},android.history.pages.Froyo.prototype.duringTransition=function(a){if(!this.isLowGpu()){var b=this.rootContainer_;a?(this.tm_.to(b.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:b.originalScale,y:b.originalScale}),this.tm_.to(b,this.transitionDuration_,{x:b.originalX,y:b.originalY,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)})):(this.tm_.to(b,this.transitionDuration_,{x:b.originalX+this.sceneFullSize.width/5,y:this.sceneFullSize.height-this.collapsedHeight+b.originalY*this.collapsedHeight/this.sceneFullSize.height-.3*this.froyoDef_.froyoHeight,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)}),this.tm_.to(b.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:.5*b.originalScale,y:.5*b.originalScale}))}},android.history.pages.Froyo.prototype.onWindowResize=function(){this.scale_=null,this.sprites_=[],this.textures_=[],this.calculateScale_()},android.history.pages.Froyo.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.Froyo.prototype.calculateScale_=function(){this.scale_=Math.max(.3,Math.min(1,this.sceneFullSize.width/1500)),this.isLowGpu()&&(this.froyoImageScale=1)},android.history.pages.Froyo.prototype.animateInternal=function(){this.calculateMousePosition_(),this.animateFroyo_(),this.parallaxFruits()},android.history.pages.Froyo.prototype.calculateMousePosition_=function(){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a,deltaX:b-this.sceneHalfSize.width,deltaY:b-this.sceneHalfSize.height,percentageX:(b-this.sceneHalfSize.width)/this.sceneFullSize.width*100,percentageY:(a-this.sceneHalfSize.height)/this.sceneFullSize.height*100}},android.history.pages.Froyo.prototype.createFroyo_=function(){var a=this.froyoDef_,b=[];goog.array.forEach(a.textureNames,function(a){a=this.assetLoader_.getAsset(a).textures,b.push(a)},this);var c={};goog.array.forEach(b,function(a){goog.object.forEach(a,function(a,b){c[b]=a})},this);for(var d=[],e=0,f=0;f<Object.keys(c).length;f++){var g=a.pngImageName.replace("{x}",1==e.toString().length?"0"+e:e),g=new this.pixi.Texture.fromFrame(g);d.push(g),e++}a=new this.pixi.extras.MovieClip(d),d=this.scale_*this.froyoImageScale,a.loop=!1,a.scale.x=d,a.scale.y=d,a.zIndex=100,a.x=-((this.froyoDef_.width-this.froyoDef_.froyoWidth)/2*d)+this.sceneFullSize.width*this.froyoDef_.left,a.y=this.sceneFullSize.height-a.height-this.sceneFullSize.height/2*this.froyoDef_.bottom+20,this.froyoMovieClip_=a},android.history.pages.Froyo.prototype.animateFroyo_=function(){if(this.froyoMovieClip_){var a=Math.round(this.froyoMovieClip_.totalFrames/2-this.froyoMovieClip_.totalFrames/100*2*this.mousePosition_.percentageX),a=this.froyoMovieClip_.currentFrame+.04*(a-this.froyoMovieClip_.currentFrame),a=android.history.math.limitRange(0,this.froyoMovieClip_.totalFrames-1,Math.round(a));this.froyoMovieClip_.gotoAndStop(a)}},android.history.pages.Froyo.prototype.createFruits_=function(){this.textures_=[],goog.array.forEach(android.history.pages.Froyo.images,function(a,c){var d=this.assetLoader_.getPixiTexture("fruit-"+c);this.textures_.push(d)},this);var a=[this.froyoMovieClip_];goog.array.forEach(this.fruitDefinition_,function(b){b.texture=this.textures_[b.textureIndex],b=this.createFruit_(b),this.sprites_.push(b),a.push(b)},this),a.sort(function(a,c){return a.zIndex-c.zIndex}),goog.array.forEach(a,function(a){this.rootContainer_.addChild(a)},this)},android.history.pages.Froyo.prototype.createFruit_=function(a){var b=new this.pixi.Sprite(a.texture);b.anchor.x=.5,b.anchor.y=.5;var c=a.left*this.scale_,d=this.sceneFullSize.height-a.bottom*this.scale_;return b.x=c,b.y=d,b.originalX=c,b.originalY=d,b.scale.x=a.scale*this.scale_,b.scale.y=a.scale*this.scale_,b.originalScale=b.scale.x,b.zIndex=a.zIndex,b},android.history.pages.Froyo.prototype.parallaxFruits=function(){goog.array.forEach(this.sprites_,goog.bind(function(a){var b=this.froyoMovieClip_.currentFrame/this.froyoMovieClip_.totalFrames;100<=a.zIndex&&(b=-b),a.x+=50*-b+a.originalX-a.x},this))},android.history.pages.Gingerbread=function(a){this.scale_=1,this.mousePosition_=null,this.textures_={gingerbread:{spriteImageName:"gingerbread.png",texture:null},"ball-1":{spriteImageName:"ball-1.png",texture:null},"ball-2":{spriteImageName:"ball-2.png",texture:null},"ball-3":{spriteImageName:"ball-3.png",texture:null},"ball-4":{spriteImageName:"ball-4.png",texture:null},"smile-1":{spriteImageName:"smile-1.png",texture:null},"smile-2":{spriteImageName:"smile-2.png",texture:null},"smile-3":{spriteImageName:"smile-3.png",texture:null},"ribbon-1":{spriteImageName:"ribbon-1.png",texture:null},"ribbon-2":{spriteImageName:"ribbon-2.png",texture:null},"wiggle-1":{spriteImageName:"wiggle-1.png",texture:null},"wiggle-2":{spriteImageName:"wiggle-2.png",texture:null}},this.gingerBreadLayout_=[{textureName:"gingerbread",name:"gingerbread",scale:.9,left:.5,top:.5,noInteraction:!0,noShadow:!0},{textureName:"ribbon-1",name:"ribbon-1",scale:1,left:.05,top:.1},{textureName:"ribbon-2",name:"ribbon-2",scale:1,left:.95,top:.12},{textureName:"ball-1",name:"ball-1-1",scale:1,left:.35,top:.1},{textureName:"ball-1",name:"ball-1-2",scale:1,left:.85,top:.4},{textureName:"ball-2",name:"ball-2-1",scale:1,left:.15,top:.2},{textureName:"ball-2",name:"ball-2-2",scale:1,left:.15,top:.95},{textureName:"ball-3",name:"ball-3-1",scale:1,left:.85,top:.95},{textureName:"ball-3",name:"ball-3-2",scale:1,left:.1,top:.5},{textureName:"ball-4",name:"ball-4-1",scale:1,left:.8,top:.2},{textureName:"ball-4",name:"ball-4-2",scale:1,left:.25,top:.2},{textureName:"smile-1",name:"smile-1",scale:1,left:.25,top:.4},{textureName:"smile-2",name:"smile-2",scale:1,left:.05,top:.8},{textureName:"smile-3",name:"smile-3",scale:1,left:.92,top:.75},{textureName:"wiggle-1",name:"wiggle-1",scale:1,left:.95,top:.6},{textureName:"wiggle-2",name:"wiggle-2",scale:1,left:.2,top:.75}],this.autoAnimateSequence_=[{"ball-2-1":{top:-271,left:25},"ball-2-2":{top:-261,left:82},"smile-3":{top:-196,left:46},"ball-1-1":{top:-86,left:19},"ball-1-2":{top:12,left:7}},{"ball-4-1":{top:-280,left:17},"ball-4-2":{top:-263,left:80},"smile-1":{top:-197,left:49},"ribbon-1":{top:-110,left:26}},{"ball-2-1":{top:-260,left:93},"ball-2-2":{top:-276,left:25},"smile-2":{top:-186,left:42},"ribbon-2":{top:-126,left:24}}],this.autoAnimateIndex=0,this.stopAutoAnimate_=!1,this.animationInterval=3e3,this.spritesDictionary_={},this.sprites_=[],this.dragging_=!1,this.dragSprite_=null,this.dragScale_=1.5,android.history.AbstractPixiPage.call(this,a,"gingerbread-canvas")},goog.inherits(android.history.pages.Gingerbread,android.history.AbstractPixiPage),android.history.pages.Gingerbread.PATH="/static/img/history/gingerbread/",android.history.pages.Gingerbread.prototype.onExitPage=function(){this.stopAutoAnimate_=!1,goog.array.forEach(this.sprites_,function(a){a.x=a.originalX,a.y=a.originalY},this),android.history.pages.Gingerbread.superClass_.onExitPage.call(this)},android.history.pages.Gingerbread.prototype.calculateScale=function(){this.scale_=Math.max(.3,Math.min(1,this.sceneFullSize.width/1500))},android.history.pages.Gingerbread.prototype.registerAssets=function(){this.registerBackground("gingerbread-background","/static/img/history/gingerbread/background.jpg"),goog.object.forEach(this.textures_,function(a,b){this.assetLoader_.addAsset(b,android.history.pages.Gingerbread.PATH+a.spriteImageName)},this)},android.history.pages.Gingerbread.prototype.onWindowResize=function(){this.scale_=null,this.sprites_=[],this.dragging_=!1,this.dragSprite_=null,this.spritesDictionary_={},this.stopAutoAnimate_=!0},android.history.pages.Gingerbread.prototype.pixiReady=function(){this.setBackground(),this.calculateScale(),this.setRootContainer(),this.calculateMousePosition_(),this.registerTextures_(),this.initScene()},android.history.pages.Gingerbread.prototype.calculateMousePosition_=function(){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a,deltaX:b-this.sceneHalfSize.width,deltaY:b-this.sceneHalfSize.height}},android.history.pages.Gingerbread.prototype.registerTextures_=function(){goog.object.forEach(this.textures_,function(a,b){a=this.assetLoader_.getPixiTexture(b),this.textures_[b].texture=a},this)},android.history.pages.Gingerbread.prototype.initScene=function(){var a=this.sceneFullSize.width,b=this.sceneFullSize.height;goog.array.forEach(this.gingerBreadLayout_,function(c){c.texture=this.textures_[c.textureName].texture,c.scaleX=c.scale*this.scale_,c.scaleY=c.scale*this.scale_,goog.isDef(c.left)&&(c.x=a*c.left),goog.isDef(c.top)&&(c.y=b*c.top),c=this.createSprite_(c),this.rootContainer_.addChild(c)},this)},android.history.pages.Gingerbread.prototype.runIntroSequence=function(){this.introStarted_=!0;var a=this.spritesDictionary_.gingerbread;a.y-=50,a.rotation=android.history.math.radians(30);var b=this.tm_.to(a,.8,{y:a.originalY,rotation:0,ease:Power4.easeOut,onUpdate:goog.bind(function(){this.isInView?this.renderer_.render(this.stage_):b.kill()},this),onComplete:goog.bind(function(){this.introComplete_=!0,this.stopAutoAnimate_=!1,this.autoAnimate_()},this)})},android.history.pages.Gingerbread.prototype.duringTransition=function(a){if(!this.isLowGpu()){var b=this.rootContainer_;a?this.tm_.to(b,this.transitionDuration_,{x:b.originalX,y:b.originalY,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)}):this.tm_.to(b,this.transitionDuration_,{y:this.sceneFullSize.height-this.collapsedHeight-.2*this.sceneFullSize.height,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)})}},android.history.pages.Gingerbread.prototype.createSprite_=function(a){var b=new this.pixi.Sprite(a.texture);b.x=a.x||0,b.y=a.y||0,b.scale.x=goog.isDef(a.scaleX)?a.scaleX:1,b.scale.y=goog.isDef(a.scaleY)?a.scaleY:1,b.anchor.x=goog.isDef(a.anchorX)?a.anchorX:.5,b.anchor.y=goog.isDef(a.anchorY)?a.anchorY:.5,b.alpha=goog.isDef(a.alpha)?a.alpha:1,b.rotation=a.rotation||0,b.texture=a.texture,b.originalX=b.x,b.originalY=b.y,b.rotation=0,b.targetRotation=0,b.originalRotation=b.rotation,b.originalScale=b.scale.x,b.targetX=b.x,b.targetY=b.y,b.name=a.name;var c=new PIXI.filters.DropShadowFilter;return c.angle=45,c.blur=20,c.originalBlur=0,c.distance=0,c.originalDistance=c.distance,c.alpha=.2,a.noShadow||(b.filters=[c]),b.dropShadowFilter=c,a.noInteraction||(b.interactive=!0,b.buttonMode=!0,b.mousedown=b.touchstart=goog.bind(function(a){this.handleSpriteMouseDown_(a)},this),b.mouseup=b.mouseupoutside=b.touchend=b.touchendoutside=goog.bind(function(a){this.handleSpriteMouseUp_(a)},this),b.mousemove=b.touchmove=goog.bind(function(a){this.handleSpriteMouseMove_(a)},this),b.rotationSpeed=goog.isDef(a.rotationSpeed)?a.rotationSpeed:0),this.spritesDictionary_[a.name]=b,this.sprites_.push(b),b},android.history.pages.Gingerbread.prototype.animateInternal=function(){this.animateSprites_()},android.history.pages.Gingerbread.prototype.animateSprites_=function(){goog.array.forEach(this.sprites_,function(a){var b=.2*(a.targetY-a.y);a.x+=.2*(a.targetX-a.x),a.y+=b,a.rotation=.1*(a.targetRotation-a.rotation)},this)},android.history.pages.Gingerbread.prototype.handleSpriteMouseDown_=function(a){this.stopAutoAnimate_=!0,a=a.target,this.dragging_=!0,this.dragSprite_=a;var b=this.stage_.children.indexOf(a);this.stage_.children.splice(b,1),this.rootContainer_.addChild(a),this.stage_.addChild(this.rootContainer_),this.tm_.to(a.scale,.3,{x:this.dragScale_*this.scale_,y:this.dragScale_*this.scale_,ease:Power4.easeOut}),this.tm_.to(a.dropShadowFilter,.3,{blur:30,distance:50*this.scale_,ease:Power4.easeOut})},android.history.pages.Gingerbread.prototype.handleSpriteMouseUp_=function(a){this.dragging_=!1,this.dragSprite_=null,a=a.target,a.targetRotation=a.originalRotation,this.tm_.to(a.scale,.3,{x:a.originalScale,y:a.originalScale,ease:Bounce.easeOut}),a=a.dropShadowFilter,this.tm_.to(a,.3,{blur:a.orignalBlur,distance:a.originalDistance,ease:Bounce.easeOut})},android.history.pages.Gingerbread.prototype.handleSpriteMouseMove_=function(a){if(this.dragSprite_){this.calculateMousePosition_(),a=this.dragSprite_,a.targetX=this.mousePosition_.x,a.targetY=this.mousePosition_.y;var b=android.history.math.distance(a.x,a.y,this.mousePosition_.x,this.mousePosition_.y)/10;a.targetRotation=android.history.math.radians(30*b)}},android.history.pages.Gingerbread.prototype.autoAnimate_=function(){this.animateSequence_(this.autoAnimateSequence_[this.autoAnimateIndex]),this.autoAnimateIndex>=this.autoAnimateSequence_.length-1?this.autoAnimateIndex=0:this.autoAnimateIndex++,this.stopAutoAnimate_||!this.isInView||this.isLowGpu()||window.setTimeout(goog.bind(function(){this.autoAnimate_()},this),this.animationInterval)},android.history.pages.Gingerbread.prototype.animateSequence_=function(a){if(!this.stopAutoAnimate_){var b=this.spritesDictionary_.gingerbread,c=b.x,d=b.y;goog.array.forEach(this.sprites_,function(b){var f=a[b.name];if(f){var g=d+f.top*this.scale_;b.targetX=c+f.left*this.scale_,b.targetY=g}else b.targetX=b.originalX,b.targetY=b.originalY},this)}},android.history.pages.Honeycomb=function(a){android.history.AbstractPixiPage.call(this,a,"honeycomb-canvas"),this.frontwaveContainer_=this.maskFrontWave_=this.frontwave_=this.maskMidWater_=this.backwaveContainer_=this.maskFrontWave_=this.textureWave_=this.backwave_=this.scale_=null,this.waveGap_=.18*this.sceneFullSize.height,this.startingPosition_=.45*this.sceneFullSize.height,this.waveHeight_=16,this.mousePosition_=this.waterDisplacementFilter_=this.reflectionMaskSmall_=this.overWaterHoneyCombSmallReflection_=this.overWaterHoneyCombSmall_=this.reflectionMask_=this.overWaterHoneyCombReflection_=this.overWaterHoneyComb_=this.underWaterHoneyComb_=null,this.bobbles_=[],this.bobblesUnderwater_=[],this.underwaterHoneycombs_=[],this.time_=0,this.environment={rippleFactor:0,rippleAmount:15,rippleDecayRate:.1},this.speed_=1.5},goog.inherits(android.history.pages.Honeycomb,android.history.AbstractPixiPage),android.history.pages.Honeycomb.disableClickInteractions=!0,android.history.pages.Honeycomb.prototype.registerAssets=function(){this.assetLoader_.addAsset("honeycomb-1","/static/img/history/honeycomb/honeycomb-1.png"),this.assetLoader_.addAsset("honeycomb-1-underwater","/static/img/history/honeycomb/honeycomb-1-underwater.png"),this.assetLoader_.addAsset("reflection-mask","/static/img/history/honeycomb/mask.png"),this.assetLoader_.addAsset("bobble","/static/img/history/honeycomb/bobble.png"),this.assetLoader_.addAsset("bobble-underwater","/static/img/history/honeycomb/bobble-underwater.png"),this.assetLoader_.addAsset("honeycomb-underwater-1","/static/img/history/honeycomb/honeycomb-underwater-1.png"),this.assetLoader_.addAsset("honeycomb-underwater-2","/static/img/history/honeycomb/honeycomb-underwater-2.png"),this.assetLoader_.addAsset("honeycomb-underwater-3","/static/img/history/honeycomb/honeycomb-underwater-3.png"),this.assetLoader_.addAsset("wave-texture","/static/img/history/honeycomb/wave-texture.png"),this.assetLoader_.addAsset("displacement-map","/static/img/history/honeycomb/displacement-map.png"),this.assetLoader_.addAsset("back-water","/static/img/history/honeycomb/back-water.png"),this.assetLoader_.addAsset("front-water","/static/img/history/honeycomb/front-water.png")},android.history.pages.Honeycomb.prototype.calculateScale=function(){this.scale_=Math.max(.3,Math.min(1,this.sceneFullSize.width/1500))},android.history.pages.Honeycomb.prototype.onWindowResize=function(){this.bobblesUnderwater_=[],
this.underwaterHoneycombs_=[]},android.history.pages.Honeycomb.prototype.pixiReady=function(){this.calculateScale(),this.setRootContainer(),this.calculateMousePosition_(),this.initScene()},android.history.pages.Honeycomb.prototype.runIntroSequence=function(){this.introStarted_=!0,this.rootContainer_.y+=100;var a=this.tm_.to(this.rootContainer_,this.pageToPageTransitionDuration_,{y:this.rootContainer_.originalY,ease:Power4.easeOut,onUpdate:goog.bind(function(){this.isInView?(this.animateInternal(),this.renderer_.render(this.stage_)):a.kill()},this),onComplete:goog.bind(function(){this.introComplete_=!0},this)})},android.history.pages.Honeycomb.prototype.duringTransition=function(a){if(!this.isLowGpu()){var b=this.rootContainer_;a?this.tm_.to(b,this.transitionDuration_,{x:b.originalX,y:b.originalY,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)}):this.tm_.to(b,this.transitionDuration_,{y:this.sceneFullSize.height-this.collapsedHeight/2-.5*this.sceneFullSize.height,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)})}},android.history.pages.Honeycomb.prototype.initScene=function(){this.createObjects()},android.history.pages.Honeycomb.prototype.createObjects=function(){var a={speed:3500*this.speed_,height:this.waveHeight_,points:1e3,offset:this.startingPosition_,sinOffset:0,sinXOffset:5,sinXScale:.2,texture:this.assetLoader_.getPixiTexture("back-water")};this.backwave_=this.createSingleWave_(a),this.backWaveContainer_=new this.pixi.Container,this.backWaveContainer_.x=0,this.backWaveContainer_.y=0,this.backWaveContainer_.originalY=0,this.backWaveContainer_.addChild(this.backwave_),this.maskBackWave_=this.createWaveMask_({x:-a.texture.width/2,y:this.backwave_.y}),this.rootContainer_.addChild(this.maskBackWave_),this.drawBackWaveMask();var b=this.assetLoader_.getPixiTexture("wave-texture");this.textureWave_=new this.pixi.Sprite(b),this.textureWave_=this.createSprite_({texture:b,anchorX:0,anchorY:0,scaleX:Math.max(1,this.sceneFullSize.width/1500),scaleY:Math.min(1,this.sceneFullSize.height/1e3),x:0,y:this.sceneFullSize.height-this.startingPosition_,blendMode:PIXI.BLEND_MODES.OVERLAY});var b=PIXI.Sprite.fromImage("/static/img/history/honeycomb/displacement-map.png"),c=new this.pixi.filters.DisplacementFilter(b);c.scale.x=100,c.scale.y=5,this.textureWave_.displacementFilter=c,this.textureWave_.displacementTexture=b,this.textureWave_.filters=[c],this.rootContainer_.addChild(this.textureWave_.displacementTexture),this.backWaveContainer_.addChild(this.textureWave_),this.rootContainer_.addChild(this.backWaveContainer_),this.maskMidWater_=this.createWaveMask_({x:this.maskBackWave_.x,y:this.sceneFullSize.height-this.startingPosition_+this.waveGap_/2,scaleY:-1}),this.backWaveContainer_.addChild(this.maskMidWater_),this.drawMidWaterMask(),this.createBobbles_();var d=this.assetLoader_.getPixiTexture("honeycomb-1"),b=d.height*this.scale_*.25,c=this.sceneFullSize.height-this.startingPosition_+this.waveGap_/2;this.overWaterHoneyComb_=this.createSprite_({texture:d,x:this.sceneFullSize.width-d.width*this.scale_,y:c-b,scaleX:this.scale_,scaleY:this.scale_,anchorX:0,anchorY:0,mask:this.maskMidWater_}),android.history.pages.Honeycomb.disableClickInteractions||(this.overWaterHoneyComb_.interactive=!0,this.overWaterHoneyComb_.buttonMode=!0,this.overWaterHoneyComb_.click=goog.bind(function(a){this.handleHoneyCombClick_(a)},this)),this.backWaveContainer_.addChild(this.overWaterHoneyComb_);var e=this.assetLoader_.getPixiTexture("reflection-mask");this.reflectionMask_=this.createSprite_({texture:e,x:this.overWaterHoneyComb_.x,y:this.maskMidWater_.y-a.height-40*this.scale_,scaleX:this.overWaterHoneyComb_.scale.x,scaleY:this.overWaterHoneyComb_.scale.y,anchorX:0,anchorY:0}),this.backWaveContainer_.addChild(this.reflectionMask_),this.overWaterHoneyCombReflection_=this.createSprite_({texture:d,x:this.overWaterHoneyComb_.x,y:this.overWaterHoneyComb_.y,scaleX:this.overWaterHoneyComb_.scale.x,scaleY:this.overWaterHoneyComb_.scale.y,blendMode:PIXI.BLEND_MODES.HARD_LIGHT,anchorX:0,anchorY:0,mask:this.reflectionMask_}),this.backWaveContainer_.addChild(this.overWaterHoneyCombReflection_);var f=.4*this.scale_;this.overWaterHoneyCombSmall_=this.createSprite_({texture:d,x:.3*this.sceneFullSize.width,y:c-d.height*f*.3,scaleX:-f,scaleY:f,anchorX:.5,anchorY:0,rotation:0,mask:this.maskMidWater_}),android.history.pages.Honeycomb.disableClickInteractions||(this.overWaterHoneyCombSmall_.interactive=!0,this.overWaterHoneyCombSmall_.buttonMode=!0,this.overWaterHoneyCombSmall_.click=goog.bind(function(a){this.handleHoneyCombSmallClick_(a)},this)),e=this.assetLoader_.getPixiTexture("reflection-mask"),this.reflectionMaskSmall_=this.createSprite_({texture:e,x:this.overWaterHoneyCombSmall_.x,y:this.maskMidWater_.y-a.height-30*f,scaleX:this.overWaterHoneyCombSmall_.scale.x,scaleY:this.overWaterHoneyCombSmall_.scale.y,anchorX:.5,anchorY:0}),this.overWaterHoneyCombSmallReflection_=this.createSprite_({texture:d,x:this.overWaterHoneyCombSmall_.x,y:this.overWaterHoneyCombSmall_.y,scaleX:this.overWaterHoneyCombSmall_.scale.x,scaleY:this.overWaterHoneyCombSmall_.scale.y,blendMode:PIXI.BLEND_MODES.HARD_LIGHT,anchorX:.5,anchorY:0,rotation:this.overWaterHoneyCombSmall_.rotation,mask:this.reflectionMaskSmall_}),this.isWebGL()&&(this.backWaveContainer_.addChild(this.overWaterHoneyCombSmall_),this.backWaveContainer_.addChild(this.reflectionMaskSmall_),this.backWaveContainer_.addChild(this.overWaterHoneyCombSmallReflection_)),a={speed:3500*this.speed_,height:this.waveHeight_,points:1e3,offset:this.startingPosition_-this.waveGap_,sinOffset:1300,sinXOffset:10,sinXScale:10,texture:this.assetLoader_.getPixiTexture("front-water")},this.frontwave_=this.createSingleWave_(a),this.frontWaveContainer_=new this.pixi.Container,this.frontWaveContainer_.x=0,this.frontWaveContainer_.y=0,this.frontWaveContainer_.originalY=0,this.frontWaveContainer_.addChild(this.frontwave_),this.rootContainer_.addChild(this.frontWaveContainer_),this.maskFrontWave_=this.createWaveMask_({x:-a.texture.width/2,y:this.sceneFullSize.height-a.offset,anchorX:0,anchorY:0}),this.frontWaveContainer_.addChild(this.maskFrontWave_),this.drawFrontWaveMask(),a=this.assetLoader_.getPixiTexture("honeycomb-1-underwater"),this.underWaterHoneyComb_=this.createSprite_({texture:a,mask:this.maskFrontWave_,x:this.overWaterHoneyComb_.x,y:c-b,scaleX:this.scale_,scaleY:this.scale_,anchorX:0,anchorY:0}),this.frontWaveContainer_.addChild(this.underWaterHoneyComb_),this.createBobblesUnderwater_(),this.createUnderWaterHoneyCombs_()},android.history.pages.Honeycomb.prototype.createBobbles_=function(){var a=this.waveGap_/4;goog.array.forEach([{x:.1,y:1},{x:.5,y:-.4},{x:.55,y:.9},{x:.98,y:-1}],function(b){b=this.createBobble_({x:this.sceneFullSize.width*b.x,y:this.maskMidWater_.y+a*b.y,scaleX:this.scale_,scaleY:this.scale_,anchorX:.5,anchorY:.5,speed:android.history.math.getRandomInt(3e3*this.speed_,4500*this.speed_)}),android.history.pages.Honeycomb.disableClickInteractions||(b.interactive=!0,b.buttonMode=!0,b.click=goog.bind(function(a){this.handleBobbleClick_(a)},this)),this.bobbles_.push(b),this.backWaveContainer_.addChild(b)},this)},android.history.pages.Honeycomb.prototype.createBobblesUnderwater_=function(){goog.array.forEach([{x:.1,y:.1,rotationSpeed:-.02/this.speed_,yAmplitude:5,xAmplitude:5,scale:.6},{x:.35,y:.3,rotationSpeed:.02/this.speed_,yAmplitude:10,xAmplitude:5,scale:.9},{x:.55,y:.3,rotationSpeed:-.01/this.speed_,yAmplitude:15,xAmplitude:5,scale:1},{x:.98,y:.2,rotationSpeed:.01/this.speed_,yAmplitude:10,xAmplitude:5,scale:.7}],function(a){a=this.createBobble_({x:this.sceneFullSize.width*a.x,y:this.sceneFullSize.height-this.maskFrontWave_.y*a.y,scaleX:a.scale*this.scale_,scaleY:a.scale*this.scale_,anchorX:.5,anchorY:.5,rotationSpeed:a.rotationSpeed,yAmplitude:a.yAmplitude,xAmplitude:a.xAmplitude,speed:android.history.math.getRandomInt(1e4*this.speed_,13300*this.speed_)},!0),android.history.pages.Honeycomb.disableClickInteractions||(a.interactive=!0,a.buttonMode=!0,a.click=goog.bind(function(a){this.handleBobbleClick_(a,!0)},this)),this.bobblesUnderwater_.push(a),this.frontWaveContainer_.addChild(a)},this)},android.history.pages.Honeycomb.prototype.createUnderWaterHoneyCombs_=function(){var a=[{texture:this.assetLoader_.getPixiTexture("honeycomb-underwater-1"),x:-.1,y:0,rotationSpeed:0,yAmplitude:5,xAmplitude:8,scale:1,speed:13e3*this.speed_},{texture:this.assetLoader_.getPixiTexture("honeycomb-underwater-2"),x:.5,y:.15,rotationSpeed:.001,yAmplitude:5,xAmplitude:5,scale:.7,speed:11e3*this.speed_},{texture:this.assetLoader_.getPixiTexture("honeycomb-underwater-3"),x:.25,y:.1,rotationSpeed:-9e-4,yAmplitude:7,xAmplitude:5,scale:1,speed:12e3*this.speed_}];goog.array.forEach(a,function(a){a=this.createSprite_({texture:a.texture,x:this.sceneFullSize.width*a.x,y:this.sceneFullSize.height-this.maskFrontWave_.y*a.y,scaleX:a.scale*this.scale_,scaleY:a.scale*this.scale_,anchorX:.5,anchorY:.5,rotationSpeed:a.rotationSpeed,yAmplitude:a.yAmplitude,xAmplitude:a.xAmplitude,speed:a.speed},!0),android.history.pages.Honeycomb.disableClickInteractions||(a.interactive=!0,a.buttonMode=!0,a.click=goog.bind(function(a){this.handleUnderWaterHoneyCombClick_(a,!0)},this)),this.underwaterHoneycombs_.push(a),this.frontWaveContainer_.addChild(a)},this)},android.history.pages.Honeycomb.prototype.createBobble_=function(a,b){var c=this.assetLoader_.getPixiTexture(b?"bobble-underwater":"bobble");return a.texture=c,this.createSprite_(a)},android.history.pages.Honeycomb.prototype.createSprite_=function(a){var b=new this.pixi.Sprite(a.texture);return b.x=a.x||0,b.y=a.y||0,b.scale.x=goog.isDef(a.scaleX)?a.scaleX:1,b.scale.y=goog.isDef(a.scaleY)?a.scaleY:1,b.anchor.x=goog.isDef(a.anchorX)?a.anchorX:.5,b.anchor.y=goog.isDef(a.anchorY)?a.anchorY:.5,b.alpha=goog.isDef(a.alpha)?a.alpha:1,b.speed=a.speed*this.speed_||0,b.rotation=a.rotation||0,b.jump=0,b.rock=0,b.texture=a.texture,b.originalX=b.x,b.originalY=b.y,b.originalRotation=b.rotation,b.originalSpeed=b.speed,b.rotationSpeed=goog.isDef(a.rotationSpeed)?a.rotationSpeed:0,b.yAmplitude=a.yAmplitude||0,b.xAmplitude=a.xAmplitude||0,a.mask&&(b.mask=a.mask),a.blendMode&&(b.blendMode=a.blendMode),b},android.history.pages.Honeycomb.prototype.createWaveMask_=function(a){var b=new PIXI.Graphics;return b.x=a.x||0,b.y=a.y||0,b.scale.x=a.scaleX||1,b.scale.y=a.scaleY||1,b},android.history.pages.Honeycomb.prototype.drawFrontWaveMask=function(){this.drawMask(this.maskFrontWave_,this.frontwave_)},android.history.pages.Honeycomb.prototype.drawBackWaveMask=function(){this.drawMask(this.maskBackWave_,this.backwave_)},android.history.pages.Honeycomb.prototype.drawMidWaterMask=function(){this.drawMask(this.maskMidWater_,this.backwave_)},android.history.pages.Honeycomb.prototype.drawMask=function(a,b){a.clear(),a.beginFill(65280),a.moveTo(0,this.sceneFullSize.height);for(var c=b.points,d=0;d<c.length;d++)a.lineTo(c[d].x,c[d].y);a.moveTo(this.sceneFullSize.width,this.sceneFullSize.height),a.endFill()},android.history.pages.Honeycomb.prototype.createSingleWave_=function(a){for(var b=a.points||300,c=a.speed||3e3*this.speed_,d=a.offset||100,e=a.height||80,f=a.texture,g=f.width+100/b,h=[],k=0;b>k;k++)h.push(new PIXI.Point(k*g,0));return b=new PIXI.mesh.Rope(f,h),b.points=h,b.offset=d,b.startHeight=e,b.speed=c*this.speed_,b.originalSpeed=c*this.speed_,b.sinOffset=a.sinOffset,b.sinXOffset=a.sinXOffset,b.sinXScale=a.sinXScale,b.span=g,b.x=-f.width/2,b.y=this.sceneFullSize.height+f.height/2-d,b},android.history.pages.Honeycomb.prototype.calculateMousePosition_=function(){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a,deltaX:b-this.sceneHalfSize.width,deltaY:b-this.sceneHalfSize.height,percentageX:(b-this.sceneHalfSize.width)/this.sceneFullSize.width*100,percentageY:(a-this.sceneHalfSize.height)/this.sceneFullSize.height*100}},android.history.pages.Honeycomb.prototype.animateInternal=function(a){this.time_=this.time_?this.time_+16:1,this.calculateMousePosition_(),0<=this.environment.rippleFactor&&(this.environment.rippleFactor-=this.environment.rippleDecayRate),this.undulateWave(this.backwave_),this.undulateWave(this.frontwave_),a=android.history.math.limitRange(-this.sceneHalfSize.height,this.sceneHalfSize.height,this.mousePosition_.percentageY);var b=this.backWaveContainer_.originalY+a;this.backWaveContainer_.y+=.05*(b-this.backWaveContainer_.y);var c=android.history.math.limitRange(-40,40,this.mousePosition_.percentageY),b=this.frontWaveContainer_.originalY+c;this.frontWaveContainer_.y+=.05*(b-this.frontWaveContainer_.y),b=Math.sin(this.time_*Math.PI/8e3),this.textureWave_.displacementTexture.position.x=300*b,this.textureWave_.displacementTexture.position.y=20*b,this.textureWave_.alpha=android.history.math.limitRange(.4,.75,b),this.drawFrontWaveMask(),this.drawBackWaveMask(),this.drawMidWaterMask(),a-=c,this.undulate(this.overWaterHoneyComb_,12e3,5,5,.05),this.undulate(this.overWaterHoneyCombReflection_,12e3,5,5,.05),this.undulate(this.reflectionMask_,12e3,5,5,.05),this.undulate(this.underWaterHoneyComb_,12e3,5,5,.05,a),this.undulate(this.overWaterHoneyCombSmall_,1e4,5,4,.05,a),this.undulate(this.overWaterHoneyCombSmallReflection_,1e4,5,4,.05,a),this.undulate(this.reflectionMaskSmall_,1e4,5,4,.05,a),goog.array.forEach(this.bobbles_,function(a){this.undulate(a,a.originalSpeed,15,5,.03)},this),goog.array.forEach(this.bobblesUnderwater_,function(a){this.undulateUnderwater(a)},this),goog.array.forEach(this.underwaterHoneycombs_,function(a){this.undulateUnderwater(a)},this)},android.history.pages.Honeycomb.prototype.undulateWave=function(a){for(var b=this.environment.rippleFactor,c=this.time_-b/this.environment.rippleDecayRate*b+a.sinOffset,b=a.originalSpeed-b,d=a.points,e=0;e<d.length;e++){var f=Math.sin(e+2*c*Math.PI/b)*a.startHeight*this.scale_;d[e].y=f,d[e].x=a.span/a.sinXOffset*e+Math.cos(e+c*a.sinXScale)}},android.history.pages.Honeycomb.prototype.undulate=function(a,b,c,d,e,f){c*=this.scale_,d*=this.scale_;var g=this.environment.rippleFactor,h=this.time_-g/this.environment.rippleDecayRate*g,k=b*this.speed_/2-g;b=Math.sin(2*h*Math.PI/(b*this.speed_-g)),h=Math.sin(2*h*Math.PI/k),f=goog.isDef(f)?f:0,k=(this.frontwave_.y-a.y)*this.scale_*.004*this.mousePosition_.percentageX,0<=a.jump&&--a.jump,0<=a.rock&&(a.rock-=.01),c=a.originalY+f-a.jump+c*b,d=a.originalX+k+d*h,e=a.originalRotation+(e+a.rock)*b,a.y&&c&&(a.y+=.05*(c-a.y),a.x+=.05*(d-a.x),a.rotation+=.05*(e-a.rotation))},android.history.pages.Honeycomb.prototype.undulateUnderwater=function(a,b){var c=this.environment.rippleFactor,d=this.time_-c/this.environment.rippleDecayRate*c,e=Math.sin(2*d*Math.PI/(a.originalSpeed-c)),c=Math.sin(2*d*Math.PI/(a.originalSpeed/2-c));b=goog.isDef(b)?b:0,d=(this.frontwave_.y-a.y)*this.scale_*.004*this.mousePosition_.percentageX,0<=a.jump&&--a.jump,0<a.rock&&(a.rock-=.01),e=a.originalY+b-a.jump+a.yAmplitude*e,c=a.originalX+d+a.xAmplitude*c,a.y&&e&&(a.y+=.05*(e-a.y),a.x+=.05*(c-a.x),a.rotation+=a.rotationSpeed+a.rock)},android.history.pages.Honeycomb.prototype.handleHoneyCombClick_=function(a){this.environment.rippleFactor=this.environment.rippleAmount,a=android.history.math.getRandomInt(150,250)*this.scale_,this.overWaterHoneyComb_.jump=a,this.overWaterHoneyCombReflection_.jump=a,this.underWaterHoneyComb_.jump=a,this.overWaterHoneyComb_.rock=.1,this.overWaterHoneyCombReflection_.rock=.1,this.underWaterHoneyComb_.rock=.1},android.history.pages.Honeycomb.prototype.handleHoneyCombSmallClick_=function(a){this.environment.rippleFactor=this.environment.rippleAmount,a=100*this.scale_,this.overWaterHoneyCombSmall_.jump=a,this.overWaterHoneyCombSmallReflection_.jump=a,this.overWaterHoneyCombSmall_.rock=.3,this.overWaterHoneyCombSmallReflection_.rock=.3},android.history.pages.Honeycomb.prototype.handleBobbleClick_=function(a,b){var c=a.target;c.rock=b?.3:1,c.jump=(b?30:50)*this.scale_,this.timer_=1e4},android.history.pages.Honeycomb.prototype.handleUnderWaterHoneyCombClick_=function(a){a.target.jump=100*this.scale_,this.timer_=1e4},android.history.pages.Icecream=function(a){this.time_=0,this.mousePosition_=null,this.textures_={"ice-4":{spriteImageName:"ice-4.png",texture:null},"ice-5":{spriteImageName:"ice-5.png",texture:null},icecream:{spriteImageName:"icecream.png",texture:null}},this.layout_=[{textureName:"icecream",name:"icecream",scale:1,left:.175,top:.65},{textureName:"ice-4",name:"ice-4",scale:.7,left:-.1,top:1,anchorX:0,anchorY:1},{textureName:"ice-5",name:"ice-5",scale:.7,left:1.3,top:1,anchorX:1,anchorY:1}],this.spritesDictionary_={},this.sprites_=[],this.overlayContainers_=[],this.snowParticles_=[],this.scale_=null,android.history.AbstractPixiPage.call(this,a,"icecream-canvas")},goog.inherits(android.history.pages.Icecream,android.history.AbstractPixiPage),android.history.pages.Icecream.PATH="/static/img/history/icecream/",android.history.pages.Icecream.prototype.registerAssets=function(){goog.object.forEach(this.textures_,function(a,b){this.assetLoader_.addAsset(b,android.history.pages.Icecream.PATH+a.spriteImageName)},this)},android.history.pages.Icecream.prototype.calculateScale=function(){this.scale_=Math.max(.3,Math.min(1,this.sceneFullSize.width/1500))},android.history.pages.Icecream.prototype.calculateMousePosition_=function(){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a}},android.history.pages.Icecream.prototype.onWindowResize=function(){this.sprites_=[],this.snowParticles_=[]},android.history.pages.Icecream.prototype.pixiReady=function(){this.calculateScale(),this.registerTextures_(),this.initScene(),this.createSnow()},android.history.pages.Icecream.prototype.registerTextures_=function(){goog.object.forEach(this.textures_,function(a,b){a=this.assetLoader_.getPixiTexture(b),this.textures_[b].texture=a},this)},android.history.pages.Icecream.prototype.initScene=function(){this.layoutSprites_()},android.history.pages.Icecream.prototype.duringTransition=function(a){if(!this.isLowGpu())if(a)goog.array.forEach(this.sprites_,function(a,b){this.tm_.to(a.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:a.originalScale,y:a.originalScale}),this.tm_.to(a,this.transitionDuration_,{ease:Power4.easeInOut,x:a.originalX,y:a.originalY,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)})},this);else{var b=this.sceneFullSize.height-this.collapsedHeight;goog.array.forEach(this.sprites_,function(a,d){"ice-3"!=a.name&&(this.tm_.to(a,this.transitionDuration_,{ease:Power4.easeInOut,y:b+a.originalY*this.collapsedHeight/this.sceneFullSize.height,onUpdate:goog.bind(function(){this.renderer_.render(this.stage_)},this)}),this.tm_.to(a.scale,this.transitionDuration_,{ease:Power4.easeInOut,x:.5*a.originalScale,y:.5*a.originalScale}))},this)}},android.history.pages.Icecream.prototype.layoutSprites_=function(){var a=this.sceneFullSize.width,b=this.sceneFullSize.height;goog.array.forEach(this.layout_,function(c){c.texture=this.textures_[c.textureName].texture,c.scaleX=c.scale*this.scale_,c.scaleY=c.scale*this.scale_,goog.isDef(c.left)&&(c.x=a*c.left),goog.isDef(c.top)&&(c.y=b*c.top),c=this.createSprite_(c),this.stage_.addChild(c)},this)},android.history.pages.Icecream.prototype.createSprite_=function(a){var b=new this.pixi.Sprite(a.texture);return b.x=a.x||0,b.y=a.y||0,b.originalY=b.y,b.originalX=b.x,b.scale.x=goog.isDef(a.scaleX)?a.scaleX:1,b.scale.y=goog.isDef(a.scaleY)?a.scaleY:1,b.originalScale=b.scale.x,b.anchor.x=goog.isDef(a.anchorX)?a.anchorX:.5,b.anchor.y=goog.isDef(a.anchorY)?a.anchorY:.5,b.alpha=goog.isDef(a.alpha)?a.alpha:1,b.rotation=a.rotation||0,b.texture=a.texture,b.targetX=b.x,b.targetY=b.y,b.name=a.name,this.spritesDictionary_[a.name]=b,this.sprites_.push(b),b},android.history.pages.Icecream.prototype.createSnow=function(){var a=this.isLowGpu()?40:150;this.overlayContainers_=[new this.pixi.Container,new this.pixi.Container,new this.pixi.Container];var b=1;goog.array.forEach(this.overlayContainers_,function(a,c){var d=new this.pixi.filters.BlurFilter;d.blur=b,d.passes=c+5,b+=9,a.filters=[d]},this);for(var c=0;a>c;c++){var d=android.history.math.getRandom(10,60);.35<=android.history.math.getRandom(0,1)&&(d=android.history.math.getRandom(10,15));var e=this.createRandomPolygon_(d);this.resetSnowState(e),e.size=Math.round(d),e.position.y=android.history.math.getRandomInt(0,Math.round(this.sceneFullSize.height)),d=this.overlayContainers_.length-1,d=android.history.math.limitRange(0,d,Math.round(e.size/(60/d))),this.overlayContainers_[d].addChild(e),this.snowParticles_.push(e)}goog.array.forEach(this.overlayContainers_,function(a){this.stage_.addChild(a)},this)},android.history.pages.Icecream.prototype.resetSnowState=function(a){a.position.x=android.history.math.getRandomInt(1,Math.round(1.5*this.sceneFullSize.width)),a.position.y=-100,a.scale.x=android.history.math.getRandom(.5,1),a.scale.y=android.history.math.getRandom(.5,1),a.acceleration=android.history.math.getRandomInt(10,50),a.originalAcceleration=a.acceleration,a.wind=-30,a.originalWind=a.wind,a.rotationRate=android.history.math.getRandomInt(1,5),a.speedX=android.history.math.getRandomInt(1e3,5e3),a.amplitudeX=android.history.math.getRandomInt(20,50),a.originalAmplitudeX=a.amplitudeX},android.history.pages.Icecream.prototype.createRandomPolygon_=function(a){var b=android.history.math.getRandomInt(6,8);a=android.history.math.generateRandomPointsAsArray(b,5,a||10),a=new android.history.ConvexHull(a);var c=new PIXI.Graphics;return c.beginFill(16777215),goog.array.forEach(a,function(a,b){var f=a[0],g=a[1];0==b?c.moveTo(f,g):c.lineTo(f,g)}),c.endFill(),c},android.history.pages.Icecream.prototype.animateSnow=function(a){goog.array.forEach(this.snowParticles_,goog.bind(function(a){this.animateSnowParticle(a)},this))},android.history.pages.Icecream.prototype.animateSnowParticle=function(a){if(a.y<=this.sceneFullSize.height){a.rotation+=.005*a.rotationRate;var b=this.mousePosition_.x,c=this.mousePosition_.y,d=android.history.math.distance(b,c,a.x,a.y),e=0,f=0;202>=d?d>=200?(e=a.xShield,f=a.yShield,a.x<=b?a.wind=a.originalWind:(a.wind=0,a.amplitudeX=0),a.y<=c?(a.acceleration=0,a.amplitudeX=0):a.acceleration=a.originalAcceleration):(e=2,a.x<=b&&(e=-e),f=2,a.y<=c&&(f=-f),e=a.x-b+e,f=a.y-c+f,a.xShield=e,a.yShield=f):(a.xShield=0,a.yShield=0,a.wind=a.originalWind,a.acceleration=a.originalAcceleration,a.amplitudeX=a.originalAmplitudeX),b=Math.sin(2*this.time_*Math.PI/a.speedX),a.targetX=a.x+(a.amplitudeX*b+a.wind+e),a.x+=.05*(a.targetX-a.x),a.targetY=a.y+a.acceleration+f,a.y+=.05*(a.targetY-a.y)}else this.resetSnowState(a)},android.history.pages.Icecream.prototype.animateInternal=function(){this.time_=this.time_?this.time_+16:1,this.calculateMousePosition_(),this.animateSnow()},android.history.pages.Icecream.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.JellyBean=function(a){this.world_=null,this.scale_=1,this.meter_=500,this.jellyBeanSprites_=[],this.dragging_=!1,this.jellyBeanCount_=this.floor_=this.mouseJoint_=this.draggingJellyBean_=null,this.jellyBeansDefinition_=[{textureName:"jellybean-3",width:109,height:151,subBodies:[{dim:75,x:2,y:1},{dim:75,x:20,y:16},{dim:91,x:17,y:32},{dim:75,x:29,y:61},{dim:75,x:18,y:75}]},{textureName:"jellybean-4",width:157,height:156,subBodies:[{dim:87,x:2,y:1},{dim:99,x:20,y:7},{dim:105,x:44,y:28},{dim:94,x:60,y:60}]},{textureName:"jellybean-5",width:154,height:93,subBodies:[{dim:78,x:1,y:10},{dim:72,x:33,y:2},{dim:72,x:33,y:15},{dim:87,x:66,y:6}]},{textureName:"jellybean-6",width:101,height:135,subBodies:[{dim:67,x:32,y:1},{dim:77,x:9,y:18},{dim:75,x:2,y:58},{dim:22,x:3,y:59}]}],android.history.AbstractPixiPage.call(this,a,"jellybean-canvas")},goog.inherits(android.history.pages.JellyBean,android.history.AbstractPixiPage),android.history.pages.JellyBean.IMAGE_DIRECTORY="/static/img/history/jellybean/",android.history.pages.JellyBean.prototype.registerAssets=function(){goog.array.forEach(this.jellyBeansDefinition_,function(a){this.assetLoader_.addAsset(a.textureName,android.history.pages.JellyBean.IMAGE_DIRECTORY+a.textureName+".png")},this)},android.history.pages.JellyBean.prototype.calculateScale=function(){this.scale_=Math.min(1,this.sceneFullSize.width/768)},android.history.pages.JellyBean.prototype.onWindowResize=function(){this.jellyBeanSprites_=[],this.jellyBeanCount_=this.mouseJoint_=this.world_=null},android.history.pages.JellyBean.prototype.onExitPage=function(){if(!this.isLowGpu()){this.jellyBeanSprites_=[],this.mouseJoint_=null;for(var a=this.stage_,b=a.children.length-1;b>=0;b--)a.removeChild(a.children[b]);this.pixiReady()}},android.history.pages.JellyBean.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.JellyBean.prototype.pixiReady=function(){this.jellyBeanCount_=android.history.Device.getInstance().isMobile()?20:Math.max(40,window.innerWidth/1500*50),this.calculateScale(),this.createWorld_(),this.createBounds_(),this.createJellyBeans_();for(var a=this.isLowGpu()?800:150,b=0;a>b;b++)this.world_.Step(1/60,20,20);this.world_.ClearForces()},android.history.pages.JellyBean.prototype.animateInternal=function(){this.world_.Step(1/60,20,20),this.world_.ClearForces(),this.updateDragJellyBean_(),this.updateJellyBeans_()},android.history.pages.JellyBean.prototype.lowGpuAnimate=function(){this.updateJellyBeans_(),this.renderer_.render(this.stage_)},android.history.pages.JellyBean.prototype.createWorld_=function(){this.world_=new window.Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(0,4),!0)},android.history.pages.JellyBean.prototype.createBounds_=function(){var a=new Box2D.Dynamics.b2BodyDef;a.type=Box2D.Dynamics.b2Body.b2_staticBody;var b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape,b.density=1,b.shape.SetAsBox((this.sceneFullSize.width+100)/2/this.meter_,2.5/this.meter_),a.position.Set(this.sceneFullSize.width/2/this.meter_,this.sceneFullSize.height/this.meter_),this.floor_=this.world_.CreateBody(a),this.floor_.CreateFixture(b),b.shape.SetAsBox(1,100),a.position.Set(-1,0),this.world_.CreateBody(a).CreateFixture(b),a.position.Set(this.sceneFullSize.width/this.meter_+1,0),this.world_.CreateBody(a).CreateFixture(b)},android.history.pages.JellyBean.prototype.createJellyBeans_=function(){for(var a=android.history.math.getRandomInt,b=android.history.math.getRandom,c=0,d=0,e=this.jellyBeanCount_;e>d;++d){var f=a(0,1)?a(this.sceneFullSize.width-500,this.sceneFullSize.width):a(0,500),c=c+a(-150,-200),g=b(.4,.6),h=a(0,this.jellyBeansDefinition_.length-1);this.createJellyBean_(this.jellyBeansDefinition_[h],f,c,g)}},android.history.pages.JellyBean.prototype.createJellyBean_=function(a,b,c,d){var e=new this.pixi.Sprite(this.assetLoader_.getPixiTexture(a.textureName));e.x=b*this.scale_,e.y=c*this.scale_,e.anchor.x=0,e.anchor.y=0,e.scale.x=d*this.scale_,e.scale.y=d*this.scale_,e.baseScale=d,a=this.createBox2DBody(e,a),this.isLowGpu()||(e.interactive=!0,e.buttonMode=!0,e.mousedown=e.touchstart=goog.bind(function(a){this.handleJellyBeanClick_(a)},this),e.mouseup=e.mouseupoutside=jellybean.touchend=e.touchendoutside=goog.bind(function(a){this.handleJellyBeanMouseUp_(a)},this),e.mousemove=e.touchmove=goog.bind(function(a){this.handleJellyBeanMouseMove_(a)},this)),e.body=a,this.jellyBeanSprites_.push(e),this.stage_.addChild(e)},android.history.pages.JellyBean.prototype.createBox2DBody=function(a,b){var c=new Box2D.Dynamics.b2BodyDef;c.type=Box2D.Dynamics.b2Body.b2_dynamicBody,c.position.Set(a.x/this.meter_,a.y/this.meter_);var d=this.world_.CreateBody(c),e=a.scale.x;return goog.array.forEach(b.subBodies,function(a){var b=a.dim/2*e/this.meter_,c=new Box2D.Collision.Shapes.b2CircleShape(b);a=new Box2D.Common.Math.b2Vec2(a.x*e/this.meter_+b,a.y*e/this.meter_+b),c.m_p=a,a=new Box2D.Dynamics.b2FixtureDef,a.shape=c,a.density=10,a.friction=10,a.restitution=0,d.CreateFixture(a)},this),d},android.history.pages.JellyBean.prototype.updateJellyBeans_=function(){goog.array.forEach(this.jellyBeanSprites_,function(a){var b=a.body,c=b.GetPosition();a.x=c.x*this.meter_,a.y=c.y*this.meter_,a.rotation=b.GetAngle()},this)},android.history.pages.JellyBean.prototype.handleJellyBeanClick_=function(a){var b=a.target;a=b.body,this.dragging_=!0,this.draggingJellyBean_=b,this.setDragPosition_(),this.mouseJoint_||(a=this.draggingJellyBean_.body,b=new Box2D.Dynamics.Joints.b2MouseJointDef,b.bodyA=this.floor_,b.bodyB=a,b.collideConnected=!0,b.maxForce=1e5*a.GetMass(),b.target.Set(this.draggingJellyBean_.targetX,this.draggingJellyBean_.targetY),b.dampingRatio=0,b.frequencyHz=100,this.mouseJoint_=this.world_.CreateJoint(b),a.SetAwake(!0))},android.history.pages.JellyBean.prototype.handleJellyBeanMouseUp_=function(a){this.dragging_=!1,this.draggingJellyBean_=null,this.mouseJoint_&&(this.world_.DestroyJoint(this.mouseJoint_),this.mouseJoint_=null)},android.history.pages.JellyBean.prototype.handleJellyBeanMouseMove_=function(a){this.setDragPosition_()},android.history.pages.JellyBean.prototype.setDragPosition_=function(){if(this.dragging_){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.draggingJellyBean_.targetX=b/this.meter_,this.draggingJellyBean_.targetY=a/this.meter_}},android.history.pages.JellyBean.prototype.updateDragJellyBean_=function(){this.mouseJoint_&&this.draggingJellyBean_&&this.mouseJoint_.SetTarget(new Box2D.Common.Math.b2Vec2(this.draggingJellyBean_.targetX,this.draggingJellyBean_.targetY))},android.history.pages.Kitkat=function(a){android.history.AbstractPixiPage.call(this,a,"kitkat-canvas"),this.world_=null,this.sprites_=[],this.meter_=1e3,this.kitKatMobileMap=[[1,0,0,0,0,0],[1,0,0,0,0,0],[1,0,0,0,0,1],[1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,1,1],[1,1,1,1,1,1]],this.kitKatMap=[[1,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,1,1],[1,1,0,0,1,0,1,1,1],[1,1,1,1,1,1,1,1,1]],this.columnIndexBlacklist_=this.isNarrowViewPort()?[]:[3,4,5],this.kitKatDef_={source:{x:47,y:68,width:182,height:113},sourceSize:{width:276,height:249}},this.map=this.isNarrowViewPort()?this.kitKatMobileMap:this.kitKatMap,this.kitKatColumns_=this.map[0].length,this.scale_=1},goog.inherits(android.history.pages.Kitkat,android.history.AbstractPixiPage),android.history.pages.Kitkat.movieSprite="/static/img/history/kitkat/kitkat.json",android.history.pages.Kitkat.prototype.registerAssets=function(){this.assetLoader_.addAsset("kitkat-movie",android.history.pages.Kitkat.movieSprite)},android.history.pages.Kitkat.prototype.onWindowResize=function(){this.sprites_=[],this.map=this.isNarrowViewPort()?this.kitKatMobileMap:this.kitKatMap,this.kitKatColumns_=this.map[0].length},android.history.pages.Kitkat.prototype.onEnterPageStart=function(){this.animateWhileTransition_=this.active=!0},android.history.pages.Kitkat.prototype.onExitPage=function(){if(!this.isLowGpu()){this.sprites_=[];for(var a=this.stage_,b=a.children.length-1;b>=0;b--)a.removeChild(a.children[b]);this.pixiReady()}},android.history.pages.Kitkat.prototype.pixiReady=function(){this.initScene()},android.history.pages.Kitkat.prototype.initScene=function(){if(this.world_=new window.Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(0,13),!0),this.createBounds(),this.createKitkats(),this.isLowGpu()){for(var a=0;150>a;a++)this.world_.Step(1/60,10,50);this.world_.ClearForces()}},android.history.pages.Kitkat.prototype.animateInternal=function(){this.world_.Step(1/60,10,50),this.world_.ClearForces(),this.updateKitkats()},android.history.pages.Kitkat.prototype.lowGpuAnimate=function(){
this.updateKitkats(),this.renderer_.render(this.stage_)},android.history.pages.Kitkat.prototype.createBounds=function(){var a=new Box2D.Dynamics.b2BodyDef;a.type=Box2D.Dynamics.b2Body.b2_staticBody;var b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape,b.density=1,b.shape.SetAsBox(this.sceneFullSize.width/this.meter_,1/this.meter_),a.position.Set(this.sceneFullSize.width/2/this.meter_,(this.sceneFullSize.height+5)/this.meter_),this.world_.CreateBody(a).CreateFixture(b)},android.history.pages.Kitkat.prototype.createKitkats=function(){goog.array.forEach(this.map,function(a,b){goog.array.forEach(a,function(a,d){a&&this.createKitkat(d,b+1)},this)},this)},android.history.pages.Kitkat.prototype.createKitkat=function(a,b){if(!goog.array.contains(this.columnIndexBlacklist_,a)){for(var c=this.assetLoader_.getAsset("kitkat-movie").textures,d=[],e=0;e<Object.keys(c).length;e++)d.push(new this.pixi.Texture.fromFrame("kitkat_xplode_01000"+e+".png"));var c=new this.pixi.extras.MovieClip(d),d=this.kitKatDef_,e=d.source.width,f=d.source.height;this.scale_=100*this.sceneFullSize.width/(e*this.kitKatColumns_)/100,c.scale.x=this.scale_,c.scale.y=this.scale_;var g=d.source.width*this.scale_,h=d.source.height*this.scale_;c.stop(),c.loop=!1,c.anchor.x=0,c.anchor.y=.5;var k;k=2*g*a-g/2-3;var l=2*-h*b;c.x=k,c.y=l,c.interactive=!0,c.buttonMode=!0,c.click=goog.bind(function(a){this.handleKitkatClick_(a)},this),c.touchstart=goog.bind(function(a){this.handleKitkatClick_(a)},this),c.hitArea=new PIXI.Rectangle(d.source.x,-d.source.y,e,f),c.body=this.createBody(g-14,h-10,k,l,Box2D.Dynamics.b2Body.b2_dynamicBody),this.sprites_.push(c),this.stage_.addChild(c)}},android.history.pages.Kitkat.prototype.createRandomKitkat=function(){var a=android.history.math.getRandomInt(0,this.kitKatColumns_-1);goog.array.contains(this.columnIndexBlacklist_,a)&&this.createRandomKitkat(),this.createKitkat(a,1)},android.history.pages.Kitkat.prototype.handleKitkatClick_=function(a){var b=a.target;b.animationSpeed=.5,b.play(),window.setTimeout(goog.bind(function(){this.world_.DestroyBody(b.body);var c=this.sprites_.indexOf(a.target);c>-1&&this.sprites_.splice(c,1),this.stage_.removeChild(b),this.createRandomKitkat()},this),300)},android.history.pages.Kitkat.prototype.createBody=function(a,b,c,d,e){var f=new Box2D.Dynamics.b2BodyDef;return f.type=e,f.position.Set(c/2/this.meter_,d/2/this.meter_),f.fixedRotation=!0,c=new Box2D.Collision.Shapes.b2PolygonShape,c.SetAsBox(a/2/this.meter_,b/2/this.meter_),a=new Box2D.Dynamics.b2FixtureDef,a.restitution=.35,a.shape=c,f=this.world_.CreateBody(f),f.CreateFixture(a),f},android.history.pages.Kitkat.prototype.updateKitkats=function(){goog.array.forEach(this.sprites_,function(a){var b=a.body,c=b.GetPosition();a.x=c.x*this.meter_,a.y=c.y*this.meter_,a.rotation=b.GetAngle()},this)},android.history.pages.Lollipop=function(a){this.textures_=[],this.sprites_=[],this.scale_=null,this.jumpAmount_=2,this.lollipopDefinition_=[{textureIndex:0,left:.03,bottom:-50,scale:1,zIndex:30},{textureIndex:2,left:.08,bottom:-50,scale:.5,zIndex:50},{textureIndex:2,left:.1,bottom:0,scale:.95,zIndex:20},{textureIndex:1,left:.15,bottom:-120,scale:1.08,zIndex:60},{textureIndex:4,left:.19,bottom:0,scale:1,zIndex:30},{textureIndex:3,left:.23,bottom:0,scale:.95,zIndex:40},{textureIndex:0,left:.95,bottom:0,scale:.8,zIndex:20},{textureIndex:1,left:.9,bottom:-20,scale:.9,zIndex:60},{textureIndex:2,left:.88,bottom:-5,scale:.5,zIndex:40},{textureIndex:4,left:.85,bottom:0,scale:.7,zIndex:30},{textureIndex:2,left:.83,bottom:0,scale:.8,zIndex:10},{textureIndex:3,left:.8,bottom:-15,scale:.6,zIndex:20}],goog.array.forEach(this.lollipopDefinition_,function(a){a.bottom+=-20}),android.history.AbstractPixiPage.call(this,a,"lollipop-canvas")},goog.inherits(android.history.pages.Lollipop,android.history.AbstractPixiPage),android.history.pages.Lollipop.images=["/static/img/history/lollipop/lollipop-1.png","/static/img/history/lollipop/lollipop-2.png","/static/img/history/lollipop/lollipop-3.png","/static/img/history/lollipop/lollipop-4.png","/static/img/history/lollipop/lollipop-5.png"],android.history.pages.Lollipop.prototype.registerAssets=function(){goog.array.forEach(android.history.pages.Lollipop.images,function(a,b){this.assetLoader_.addAsset("lollipop-"+b,a)},this)},android.history.pages.Lollipop.prototype.calculateScale=function(){this.scale_=Math.max(.3,Math.min(1,this.sceneFullSize.width/1500))},android.history.pages.Lollipop.prototype.pixiReady=function(){this.calculateScale(),this.initScene()},android.history.pages.Lollipop.prototype.onWindowResize=function(){this.textures_=[],this.sprites_=[]},android.history.pages.Lollipop.prototype.initScene=function(){this.createLollipops(),this.centerLollipops()},android.history.pages.Lollipop.prototype.animateInternal=function(){var a=this.renderer_.plugins.interaction.mouse;this.parallaxLollipops(a.global.x,a.global.y),this.animateLollipopBackToPosition()},android.history.pages.Lollipop.prototype.createLollipops=function(){this.textures_=[],goog.array.forEach(android.history.pages.Lollipop.images,function(a,b){var e=this.assetLoader_.getPixiTexture("lollipop-"+b);this.textures_.push(e)},this);var a=this.sceneFullSize.width,b=this.sceneFullSize.height;goog.array.forEach(this.lollipopDefinition_,function(c){c=this.createLollipop(a*c.left,b+this.jumpAmount_*this.scale_-c.bottom*this.scale_,c.scale*this.scale_,this.textures_[c.textureIndex],c.zIndex),this.sprites_.push(c)},this),this.sprites_.sort(function(a,b){return a.zIndex-b.zIndex}),goog.array.forEach(this.sprites_,function(a){this.stage_.addChild(a)},this)},android.history.pages.Lollipop.prototype.createLollipop=function(a,b,c,d,e){var f=new this.pixi.Sprite(d);return f.anchor.x=.5,f.anchor.y=1,f.x=a,f.y=b,f.originalX=a,f.originalY=b,f.scale.x=c,f.scale.y=c,f.originalScale=c,f.activeScale=c,f.zIndex=e,this.isLowGpu()||(f.interactive=!0,f.mouseover=goog.bind(function(a){this.handlePopHover_(a,!0)},this)),a=d.height,d=d.width,f.hitArea=new PIXI.Rectangle(-d/2,-a,d,.4*a),f},android.history.pages.Lollipop.prototype.parallaxLollipops=function(a,b){this.active||(a=this.sceneFullSize.width/2),a=android.history.math.limitRange(0,this.sceneFullSize.width,a||0);var c=(a-this.sceneFullSize.width/2)/this.sceneFullSize.width*100,c=android.history.math.limitRange(-20,20,c);goog.array.forEach(this.sprites_,goog.bind(function(a){a.x+=.05*(a.zIndex/40*-c+a.originalX-a.x)},this))},android.history.pages.Lollipop.prototype.animateLollipopBackToPosition=function(){goog.array.forEach(this.sprites_,goog.bind(function(a){a.y+=.05*(a.originalY-a.y),a.scale.x+=.05*(a.activeScale-a.scale.x),a.scale.y+=.05*(a.activeScale-a.scale.y)},this))},android.history.pages.Lollipop.prototype.centerLollipops=function(){this.parallaxLollipops(this.sceneFullSize.width/2,this.sceneFullSize.height/2)},android.history.pages.Lollipop.prototype.runIntroSequence=function(){this.introStarted_=!0,goog.array.forEach(this.sprites_,goog.bind(function(a){a.scale.x=0,a.scale.y=0;var b=android.history.math.getRandom(.1,.5),c=this.tm_.to(a.scale,android.history.math.getRandom(.5,.8),{x:a.originalScale,y:a.originalScale,delay:b,ease:Power4.easeOut,onUpdate:goog.bind(function(){this.isInView?this.renderer_.render(this.stage_):c.kill()},this),onComplete:goog.bind(function(){this.introComplete_=!0},this)})},this))},android.history.pages.Lollipop.prototype.duringTransition=function(a){this.sprites_&&(this.isLowGpu()||goog.array.forEach(this.sprites_,goog.bind(function(b){var c;a?c=b.originalScale:(c=this.sceneSize.height*b.originalScale/this.sceneFullSize.height,c*=.5);var d=android.history.math.getRandom(.1,.5),e=this.tm_.to(b.scale,.7-d,{x:c,y:c,delay:d,ease:Power4.easeInOut,onUpdate:goog.bind(function(){this.isInView?this.renderer_.render(this.stage_):e.kill()},this)});b.activeScale=c},this)))},android.history.pages.Lollipop.prototype.handlePopHover_=function(a){a=a.target;var b=a.originalY-this.jumpAmount_*this.scale_,c=1.1*a.activeScale;android.history.math.getRandomInt(0,1)&&(b=a.originalY+this.jumpAmount_*this.scale_,c=.9*a.activeScale),this.tm_.to(a,.3,{y:b,ease:Power4.easeOut}),this.tm_.to(a.scale,.3,{x:c,y:c,ease:Power4.easeOut})},android.history.pages.Marshmallow=function(a){this.marshmallows_=[],this.mousePosition_=this.scale_=null,this.mashmallowMovieClipTextures_={},this.dragging_=!1,this.dragSprite_=null,this.marshmallowDef_=[{textureName:"marshmallow-1",jsonSourcePath:"/static/img/history/marshmallow/marshmallow-1-{x}.json",lowGpuSourcePath:"/static/img/history/marshmallow/marshmallow-1-mobile.json",jsonCount:0,pngImageName:"Marshmallow_01_{x}.png",textureNames:[],left:.3,top:.7,sourceHeight:185,sourceWidth:150,width:500,height:500,scale:1.3},{textureName:"marshmallow-4",jsonSourcePath:"/static/img/history/marshmallow/marshmallow-4-{x}.json",lowGpuSourcePath:"/static/img/history/marshmallow/marshmallow-4-mobile.json",jsonCount:0,pngImageName:"Marshmallow_04_{x}.png",textureNames:[],left:.85,top:.5,sourceHeight:120,sourceWidth:75,width:400,height:400,scale:2},{textureName:"marshmallow-3",jsonSourcePath:"/static/img/history/marshmallow/marshmallow-3-{x}.json",lowGpuSourcePath:"/static/img/history/marshmallow/marshmallow-3-mobile.json",jsonCount:0,pngImageName:"Marshmallow_03_{x}.png",textureNames:[],left:.15,top:.25,sourceHeight:90,sourceWidth:75,width:100,height:120,scale:2},{textureName:"marshmallow-2",jsonSourcePath:"/static/img/history/marshmallow/marshmallow-2-{x}.json",lowGpuSourcePath:"/static/img/history/marshmallow/marshmallow-2-mobile.json",jsonCount:0,pngImageName:"Marshmallow_02_{x}.png",textureNames:[],left:.55,top:.2,sourceHeight:120,sourceWidth:75,width:500,height:500,scale:1}],android.history.AbstractPixiPage.call(this,a,"marshmallow-canvas")},goog.inherits(android.history.pages.Marshmallow,android.history.AbstractPixiPage),android.history.pages.Marshmallow.prototype.registerAssets=function(){this.registerBackground("marshmallow-background","/static/img/history/marshmallow/background.jpg"),this.isLowGpu()?goog.array.forEach(this.marshmallowDef_,function(a){var b=a.textureName+"-0";a.textureNames.push(b),this.assetLoader_.addAsset(b,a.lowGpuSourcePath)},this):goog.array.forEach(this.marshmallowDef_,function(a){for(var b=0;b<=a.jsonCount;b++){var c=a.textureName+"-"+b;a.textureNames.push(c);var d=a.jsonSourcePath.replace("{x}",b);this.assetLoader_.addAsset(c,d)}},this)},android.history.pages.Marshmallow.prototype.onWindowResize=function(){this.marshmallows_=[],this.introStarted_=this.introComplete_=!1},android.history.pages.Marshmallow.prototype.pixiReady=function(){this.calculateScale(),this.setBackground(),this.setRootContainer(),this.calculateMousePosition_(),this.createMarshmallowTextures_(),this.createMarshmallows_()},android.history.pages.Marshmallow.prototype.calculateScale=function(){this.scale_=Math.max(.6,Math.min(1,this.sceneFullSize.width/1500))},android.history.pages.Marshmallow.prototype.duringTransition=function(a){if(!this.isLowGpu())if(a)goog.array.forEach(this.marshmallows_,function(a,b){this.tm_.to(a,this.transitionDuration_,{ease:Power4.easeInOut,x:a.originalX,y:a.originalY,onUpdate:goog.bind(function(){a.updateShadow(),this.renderer_.render(this.stage_)},this)})},this);else{var b=this.collapsedHeight/this.marshmallows_.length;goog.array.forEach(this.marshmallows_,function(a,d){this.tm_.to(a,this.transitionDuration_,{ease:Power4.easeInOut,x:a.originalX,y:this.sceneFullSize.height-b*(d+1),onUpdate:goog.bind(function(){a.updateShadow(),this.renderer_.render(this.stage_)},this)})},this)}},android.history.pages.Marshmallow.prototype.createMarshmallowTextures_=function(){goog.array.forEach(this.marshmallowDef_,function(a){var b=[];if(this.isLowGpu()){var c=this.assetLoader_.getAsset(a.textureNames[0]).textures;b.push(c)}else goog.array.forEach(a.textureNames,function(a){a=this.assetLoader_.getAsset(a).textures,b.push(a)},this);var d={};goog.array.forEach(b,function(a){goog.object.forEach(a,function(a,b){d[b]=a})},this);for(var c=[],e=0,f=this.isLowGpu()?1:Object.keys(d).length,g=0;f>g;g++){var h=a.pngImageName.replace("{x}",1==e.toString().length?"0"+e:e),h=new this.pixi.Texture.fromFrame(h);c.push(h),e++}this.mashmallowMovieClipTextures_[a.textureName]=c},this)},android.history.pages.Marshmallow.prototype.animateInternal=function(){this.updateMarshmallows_()},android.history.pages.Marshmallow.prototype.createMarshmallows_=function(){goog.array.forEach(this.marshmallowDef_,function(a,b){var c=this.mashmallowMovieClipTextures_[a.textureName],d=new this.pixi.extras.MovieClip(c);d.loop=!0;var e=this.sceneFullSize.width*a.left,f=this.sceneFullSize.height*a.top;d.x=e,d.y=f,d.originalX=e,d.originalY=f,d.targetX=e,d.targetY=f,d.targetFrame=0,d.normalizedCurrentFrame=0,d.originalSpring=.1,d.originalFriction=.85,d.targetFrame=0,d.spring=.005,d.friction=.9,d.vx=0,d.vy=0,d.isDragging=!1,this.isLowGpu()&&(a.scale=1),d.scale.x=a.scale*this.scale_,d.scale.y=a.scale*this.scale_,d.originalScale=d.scale.x*this.scale_,d.dimensions={width:a.width,height:a.height,scaledWidth:a.sourceWidth*d.scale.x,scaledHeight:a.sourceHeight*d.scale.y,sourceWidth:a.sourceWidth,sourceHeight:a.sourceHeight},d.anchor.x=.5,d.anchor.y=.5,this.isLowGpu()||(d.interactive=!0,d.buttonMode=!0,d.hitArea=new PIXI.Rectangle(-d.dimensions.sourceWidth*this.scale_/2,-d.dimensions.sourceHeight*this.scale_/2,d.dimensions.sourceWidth*this.scale_,d.dimensions.sourceHeight*this.scale_),d.mousedown=d.touchstart=goog.bind(function(a){this.handleSpriteMouseDown_(a)},this),d.mouseup=d.mouseupoutside=d.touchend=d.touchendoutside=goog.bind(function(a){this.handleSpriteMouseUp_(a)},this),d.mousemove=d.touchmove=goog.bind(function(a){this.handleSpriteMouseMove_(a)},this),d.click=goog.bind(function(a){this.handleSpriteClick_(a)},this));var g=new this.pixi.extras.MovieClip(c);d.shadowDistance=50,d.shadowSprite=g,g.anchor.x=.5,g.anchor.y=.5,g.alpha=.5,g.originalAlpha=g.alpha,c=new this.pixi.filters.BlurFilter,c.blurX=200,c.blurY=200,c.passes=5,c.dirty=!1,e=new this.pixi.filters.ColorMatrixFilter,g.colorMatrix=e,f=new this.pixi.filters.DropShadowFilter,f.originalAlpha=1,f.blurX=50,f.blurY=50,f.distance=0,g.shadow=f,g.filters=[e,c],d.updateShadow=function(){g.x=d.x,g.y=d.y+d.shadowDistance,g.gotoAndStop(d.currentFrame);var a=android.history.math.limitRange(1,1.5,d.shadowDistance/d.dimensions.scaledHeight);g.scale.x=d.scale.x/a*.9,g.scale.y=d.scale.y/a*.2,a=android.history.math.limitRange(1,50,d.shadowDistance/d.dimensions.scaledHeight),g.alpha=g.originalAlpha/a,g.shadow.alpha=g.originalAlpha/a,g.colorMatrix.matrix=[1,0,0,-3,0,1,0,-3,0,0,1,-3,0,0,0,g.alpha]},d.shadowSprite=g,this.marshmallows_.push(d),this.isWebGL()&&this.rootContainer_.addChild(g),this.rootContainer_.addChild(d),this.isLowGpu()&&(d.shadowDistance=150*d.scale.x),d.updateShadow()},this)},android.history.pages.Marshmallow.prototype.runIntroSequence=function(){this.introStarted_=!0,goog.array.forEach(this.marshmallows_,function(a,b){a.x=this.sceneFullSize.width/this.marshmallows_.length*b,a.y=-120,a.gotoAndStop(0),a.targetFrame=0,a.updateShadow();var c=this.tm_.to(a,1.5,{ease:Power3.easeInOut,x:a.originalX,y:a.originalY,targetFrame:360,onUpdate:goog.bind(function(){a.shadowDistance=.8*a.dimensions.scaledHeight+(a.originalY-a.y),a.updateShadow();var b=a.normalizedCurrentFrame+.05*(a.targetFrame-a.normalizedCurrentFrame);a.normalizedCurrentFrame=b,b=Math.round(b%360),a.gotoAndStop(b),this.isInView?this.renderer_.render(this.stage_):c.kill()},this),onComplete:goog.bind(function(){this.introComplete_=!0},this)})},this)},android.history.pages.Marshmallow.prototype.calculateMousePosition_=function(){var a=this.renderer_.plugins.interaction.mouse,b=android.history.math.limitRange(0,this.sceneFullSize.width,a.global.x||0),a=android.history.math.limitRange(0,this.sceneFullSize.height,a.global.y||0);this.mousePosition_={x:b,y:a}},android.history.pages.Marshmallow.prototype.updateMarshmallows_=function(){goog.array.forEach(this.marshmallows_,function(a){if(a.isDragging){var b=.2*(a.targetY-a.y);a.x+=.2*(a.targetX-a.x),a.y+=b}else b=(a.targetY-a.y)*a.spring,a.vx+=(a.targetX-a.x)*a.spring,a.vx*=a.friction,a.vy+=b,a.vy*=a.friction,a.x+=a.vx,a.y+=a.vy;var c=a.originalY+a.shadowDistance;a.y>=c&&(a.y=c),b=200*Math.min(1,a.scale.x),c=a.originalY-b,a.y<=c&&(a.y=c),c=a.originalX+b,a.x>=c&&(a.x=c),c=a.originalX-b,a.x<=c&&(a.x=c),a.targetFrame+=.4,b=a.normalizedCurrentFrame+.05*(a.targetFrame-a.normalizedCurrentFrame),a.normalizedCurrentFrame=b,b=Math.round(b%360),a.gotoAndStop(b),a.shadowDistance=.8*a.dimensions.scaledHeight+(a.originalY-a.y),a.updateShadow()},this)},android.history.pages.Marshmallow.prototype.handleSpriteMouseUp_=function(a){this.dragging_=!1,this.dragSprite_=null,a=a.target,a.isDragging=!1,a.targetX=a.originalX,a.targetY=a.originalY;var b=android.history.math.distance(a.x,a.y,a.originalX,a.originalY);a.targetFrame=a.normalizedCurrentFrame+Math.round(2*b)},android.history.pages.Marshmallow.prototype.handleSpriteMouseMove_=function(a){if(this.dragSprite_){this.calculateMousePosition_(),a=this.dragSprite_;var b=this.mousePosition_.y-a.originalY;a.targetX=a.x+.08*(this.mousePosition_.x-a.originalX),a.targetY=a.y+.08*b,b=android.history.math.distance(a.x,a.y,this.mousePosition_.x,this.mousePosition_.y),a.targetFrame=a.normalizedCurrentFrame+Math.round(.25*b)}},android.history.pages.Marshmallow.prototype.handleSpriteMouseDown_=function(a){a=a.target,a.spring=a.originalSpring,a.friction=a.originalFriction,this.dragging_=!0,this.dragSprite_=a,a.isDragging=!0},android.history.pages.Marshmallow.prototype.handleSpriteClick_=function(a){this.dragging_=!1,a=a.target,a.targetX=a.originalX,a.targetY=a.originalY,a.y-=25,a.targetFrame=a.normalizedCurrentFrame+100},android.history.History=function(){goog.Disposable.call(this),this.tm_=window.TweenMax,this.history_=new goog.History,this.hashChangeCount=0,this.pages_={},this.navigationPosition_=this.pageScroller_=this.slider_=this.activePage_=null,this.historyWrapperElement_=document.getElementById("history-wrapper"),this.introElement_=document.getElementById("intro"),this.navElement_=document.getElementById("history-nav"),this.sliderElement_=document.getElementById("slider"),this.continueElement_=document.getElementById("loading-icon"),this.windowSize_=this.getActiveWindowSize(),this.isTransitioning_=this.introComplete_=!1,this.transitionQueue_=null,this.history_.getToken()||this.navigateTo("marshmallow",!0),android.history.typeArrayPolyfill(),this.initIntro_(),window.addEventListener("resize",ww.util.debounce(goog.bind(this.onWindowResize_,this),100))},goog.inherits(android.history.History,goog.Disposable),android.history.History.cssNames={HISTORY_PAGE:"history-page",SLIDER:"slider"},android.history.History.pageConstructorDictionary={MARSHMALLOW:android.history.pages.Marshmallow,LOLLIPOP:android.history.pages.Lollipop,KITKAT:android.history.pages.Kitkat,JELLYBEAN:android.history.pages.JellyBean,ICECREAM:android.history.pages.Icecream,HONEYCOMB:android.history.pages.Honeycomb,GINGERBREAD:android.history.pages.Gingerbread,FROYO:android.history.pages.Froyo,ECLAIR:android.history.pages.Eclair,DONUT:android.history.pages.Donut},android.history.History.prototype.getActiveWindowSize=function(){var a=goog.dom.getElementByClass("l-header",document),a=goog.style.getContentBoxSize(a).height;return{width:window.innerWidth,height:window.innerHeight-a}},android.history.History.prototype.initIntro_=function(){this.windowSize_=this.getActiveWindowSize(),this.setElementSizes_(!0);var a=new android.history.pages.Intro;window.setTimeout(goog.bind(function(){this.registerPages_(),android.history.AssetLoader.getInstance().registerCompleteCallback(goog.bind(function(){a.skipToEnd(goog.bind(function(){this.completeIntro_()},this))},this)),android.history.AssetLoader.getInstance().load()},this),0)},android.history.History.prototype.completeIntro_=function(){this.init_(),this.transitionToRelease_()},android.history.History.prototype.transitionToRelease_=function(){var a=this.history_.getToken();pageName=goog.string.htmlEscape(a.replace("/",""));var b=this.pages_[pageName.toUpperCase()];this.slider_.goToSlideByIndex(b.position,goog.bind(function(){this.tm_.to(this.introElement_,.8,{ease:Power4.easeInOut,y:"-"+this.windowSize_.height+"px",overflow:"hidden",onComplete:goog.bind(function(){this.introElement_.style.display="none",this.pageScroller_=new android.history.PageScroller(goog.bind(function(){this.prevSection()},this),goog.bind(function(){this.nextSection()},this),goog.bind(function(){this.navigateToNextPage()},this),goog.bind(function(){this.navigateToPrevPage()},this)),this.history_.setEnabled(!0),this.introComplete_=!0;var a=b.instance;a.onEnterPageBegin(),a.setToIntro(!0),a.onEnterPageComplete(!0),this.activePage_=b},this)}),goog.style.setStyle(this.sliderElement_,{visibility:"visible"})},this))},android.history.History.prototype.onWindowResize_=function(){this.windowSize_=this.getActiveWindowSize(),this.setElementSizes_(!this.introComplete_)},android.history.History.prototype.setElementSizes_=function(a){goog.style.setStyle(this.historyWrapperElement_,{display:"block",overflow:"hidden",width:this.windowSize_.width+"px",height:this.windowSize_.height+"px"}),goog.style.setStyle(this.introElement_,{display:"block",width:this.windowSize_.width+"px",height:a?this.windowSize_.height+"px":"0px","z-index":9999})},android.history.History.prototype.init_=function(){this.initializePages_(),this.slider_=new android.history.Slider(this.sliderElement_),goog.events.listen(this.history_,goog.history.EventType.NAVIGATE,goog.bind(this.handleHistoryNavigate,this)),this.navigationPosition_=new android.history.NavigationPosition(this.navElement_,this.history_)},android.history.History.prototype.registerPages_=function(){var a=document.querySelectorAll("[data-init-page]");goog.array.forEach(a,goog.bind(function(a,c){var d=goog.dom.dataset.get(a,"initPage"),d=d.toUpperCase(),e=new android.history.History.pageConstructorDictionary[d](a);this.pages_[d]={instance:e,element:a,position:c}},this))},android.history.History.prototype.initializePages_=function(){goog.object.forEach(this.pages_,function(a){a.instance.ready()})},android.history.History.prototype.handleHistoryNavigate=function(a){this.introComplete_&&(a=goog.string.htmlEscape(a.token.replace("/","")),this.goToPageByName_(a))},android.history.History.prototype.goToPageByName_=function(a){if(this.isTransitioning_)this.transitionQueue_=a;else{this.isTransitioning_=!0;var b=this.activePage_,c=this.pages_[a.toUpperCase()],b=b&&b.instance,d=c.instance;if(!c)throw Error("Page could not be found:"+a);b&&b.onExitPage(),d.onEnterPageBegin(),this.startOnLastSlide?d.setToLastSlide(!0):d.setToIntro(!0),this.startOnLastSlide=!1;for(var e in this.pages_)this.pages_[e].instance.active=!1;d.onEnterPageStart(),window.requestAnimationFrame(goog.bind(function(){this.slider_.goToSlideByIndex(c.position,goog.bind(function(){this.isTransitioning_=!1,d.onEnterPageComplete(),this.transitionQueue_&&(this.goToPageByName_(this.transitionQueue_),this.transitionQueue_=null)},this))},this)),this.activePage_=c}},android.history.History.prototype.nextSection=function(){this.skipSection(1)},android.history.History.prototype.prevSection=function(){this.skipSection(-1)},android.history.History.prototype.skipSection=function(a){var b=this.activePage_&&this.activePage_.instance,c=!1;0>=a?b.isIntroPosition()?c=!0:b.prevSlide():b.isLastSlide()?c=!0:b.nextSlide(),c&&(a=this.findPageNameByPosition(this.activePage_.position+a))&&(this.startOnLastSlide=!1,this.navigateTo(a))},android.history.History.prototype.navigateTo=function(a){this.history_.setToken("/"+a.toLowerCase())},android.history.History.prototype.navigateToNextPage=function(){this.skipToPage(-1)},android.history.History.prototype.navigateToPrevPage=function(){this.skipToPage(1)},android.history.History.prototype.skipToPage=function(a){(a=this.findPageNameByPosition(this.activePage_.position+a))&&this.navigateTo(a)},android.history.History.prototype.findPageNameByPosition=function(a){return Object.keys(this.pages_).filter(goog.bind(function(b,c){return this.pages_[b].position==a},this))[0]},android.pages={},android.pages.history={},android.pages.history.main=function(){new android.history.History},goog.exportSymbol("androidHistory.main",android.pages.history.main)}();